2022-01-08 00:19:10.009 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/94dc45cf-d25c-48e4-8c49-22ba343866df.jpg
2022-01-08 00:19:10.043 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47872 - "POST /upload_images HTTP/1.1" 200
2022-01-08 00:19:59.837 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47928 - "GET /show_images HTTP/1.1" 200
2022-01-08 00:20:39.834 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fae4b24c940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fae60fb66a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fae654869d0>
          └ <fastapi.routing.APIRoute object at 0x7fae60774070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fae60fd4e50>
          └ <fastapi.routing.APIRoute object at 0x7fae60774070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fae4b78cc70>
                     └ <function get_request_handler.<locals>.app at 0x7fae60fd4dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fae654755e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': 'b14f8676-8af2-4b71-afa4-21ff92065d30'}
                 │                 │         └ <function delete_images at 0x7fae60fa94c0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fae607740a0>
                 └ <function run_in_threadpool at 0x7fae65661af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
                 │     │         │        └ <built-in method run of Context object at 0x7fae60791840>
                 │     │         └ <function run_sync at 0x7fae6567e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
                 │                                        └ <built-in method run of Context object at 0x7fae60791840>
                 └ <function get_asynclib at 0x7fae6567e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
             │       │   └ <built-in method run of Context object at 0x7fae60791840>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fae5a5b4100>

  File "./app/routes/images.py", line 45, in delete_images
    delete_image(image_id=image_id)
    │                     └ 'b14f8676-8af2-4b71-afa4-21ff92065d30'
    └ <function delete_image at 0x7fae62fde430>

  File "./app/models/models.py", line 103, in delete_image
    image = list(Images.query(image_id))[0]
                 │      │     └ 'b14f8676-8af2-4b71-afa4-21ff92065d30'
                 │      └ <classmethod object at 0x7fae62ee8ee0>
                 └ <class 'app.models.models.Images'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae5a5dafd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fae6a02a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fae6ada09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fae6ada0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fae699bf340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    └ <function subprocess_started at 0x7fae67886160>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fae699bf430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fae67878550>
           │       │   └ <uvicorn.server.Server object at 0x7fae699bf430>
           │       └ <function run at 0x7fae68a37700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fae66dd4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fae66e00280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fae66e00310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
          └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fae62c09f70>
                     │    └ <function exception_handler at 0x7fae60fa90d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c09f70>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae5a5dafd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:20:39.849 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fae4b24c940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fae60fb66a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fae654869d0>
          └ <fastapi.routing.APIRoute object at 0x7fae60774070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fae60fd4e50>
          └ <fastapi.routing.APIRoute object at 0x7fae60774070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fae4b78cc70>
                     └ <function get_request_handler.<locals>.app at 0x7fae60fd4dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fae654755e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': 'b14f8676-8af2-4b71-afa4-21ff92065d30'}
                 │                 │         └ <function delete_images at 0x7fae60fa94c0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fae607740a0>
                 └ <function run_in_threadpool at 0x7fae65661af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
                 │     │         │        └ <built-in method run of Context object at 0x7fae60791840>
                 │     │         └ <function run_sync at 0x7fae6567e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
                 │                                        └ <built-in method run of Context object at 0x7fae60791840>
                 └ <function get_asynclib at 0x7fae6567e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
             │       │   └ <built-in method run of Context object at 0x7fae60791840>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fae5a5b4100>

  File "./app/routes/images.py", line 45, in delete_images
    delete_image(image_id=image_id)
    │                     └ 'b14f8676-8af2-4b71-afa4-21ff92065d30'
    └ <function delete_image at 0x7fae62fde430>

  File "./app/models/models.py", line 103, in delete_image
    image = list(Images.query(image_id))[0]
                 │      │     └ 'b14f8676-8af2-4b71-afa4-21ff92065d30'
                 │      └ <classmethod object at 0x7fae62ee8ee0>
                 └ <class 'app.models.models.Images'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae5a5dafd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fae6a02a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fae6ada09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fae6ada0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fae699bf340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    └ <function subprocess_started at 0x7fae67886160>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fae699bf430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fae67878550>
           │       │   └ <uvicorn.server.Server object at 0x7fae699bf430>
           │       └ <function run at 0x7fae68a37700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fae66dd4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fae66e00280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fae66e00310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
          └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fae62c09f70>
                     │    └ <function exception_handler at 0x7fae60fa90d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c09f70>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae5a5dafd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:20:39.869 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fae4b24c940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fae60fb66a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fae654869d0>
          └ <fastapi.routing.APIRoute object at 0x7fae60774070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae4b24c8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fae60fd4e50>
          └ <fastapi.routing.APIRoute object at 0x7fae60774070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fae4b78cc70>
                     └ <function get_request_handler.<locals>.app at 0x7fae60fd4dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fae654755e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': 'b14f8676-8af2-4b71-afa4-21ff92065d30'}
                 │                 │         └ <function delete_images at 0x7fae60fa94c0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fae607740a0>
                 └ <function run_in_threadpool at 0x7fae65661af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
                 │     │         │        └ <built-in method run of Context object at 0x7fae60791840>
                 │     │         └ <function run_sync at 0x7fae6567e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
                 │                                        └ <built-in method run of Context object at 0x7fae60791840>
                 └ <function get_asynclib at 0x7fae6567e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function delete_images at 0x7fae60fa94c0>, token=Users<kaumil>, image_id='b14f8676-8af2-4b71-afa4-21ff920...
             │       │   └ <built-in method run of Context object at 0x7fae60791840>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fae5a5b4100>

  File "./app/routes/images.py", line 45, in delete_images
    delete_image(image_id=image_id)
    │                     └ 'b14f8676-8af2-4b71-afa4-21ff92065d30'
    └ <function delete_image at 0x7fae62fde430>

  File "./app/models/models.py", line 103, in delete_image
    image = list(Images.query(image_id))[0]
                 │      │     └ 'b14f8676-8af2-4b71-afa4-21ff92065d30'
                 │      └ <classmethod object at 0x7fae62ee8ee0>
                 └ <class 'app.models.models.Images'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae5a5dafd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fae6a02a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fae6ada09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fae6ada0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fae699bf340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    └ <function subprocess_started at 0x7fae67886160>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fae699bf430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fae67878550>
           │       │   └ <uvicorn.server.Server object at 0x7fae699bf430>
           │       └ <function run at 0x7fae68a37700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fae66dd4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fae66e00280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fae66e00310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78cee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b78ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae4b7...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
          └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fae62c09f70>
                     │    └ <function exception_handler at 0x7fae60fa90d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c09f70>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae5a5dafd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:20:39.894 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47964 - "GET /delete_image?image_id=b14f8676-8af2-4b71-afa4-21ff92065d30 HTTP/1.1" 500
2022-01-08 00:26:47.966 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:47.966 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:47.967 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:48.068 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:48.068 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:48.069 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:48.069 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:48.069 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:48.070 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:48.070 | INFO     | uvicorn.server:serve:94 - Finished server process [923257]
2022-01-08 00:26:48.071 | INFO     | uvicorn.server:serve:94 - Finished server process [923257]
2022-01-08 00:26:48.071 | INFO     | uvicorn.server:serve:94 - Finished server process [923257]
2022-01-08 00:26:49.228 | INFO     | uvicorn.server:serve:84 - Started server process [928481]
2022-01-08 00:26:49.228 | INFO     | uvicorn.server:serve:84 - Started server process [928481]
2022-01-08 00:26:49.229 | INFO     | uvicorn.server:serve:84 - Started server process [928481]
2022-01-08 00:26:49.229 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:26:49.230 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:26:49.230 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:26:49.232 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:26:49.233 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:26:49.233 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:26:49.534 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:49.535 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:49.536 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:49.637 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:49.638 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:49.638 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:49.639 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:49.639 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:49.640 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:49.640 | INFO     | uvicorn.server:serve:94 - Finished server process [928481]
2022-01-08 00:26:49.641 | INFO     | uvicorn.server:serve:94 - Finished server process [928481]
2022-01-08 00:26:49.641 | INFO     | uvicorn.server:serve:94 - Finished server process [928481]
2022-01-08 00:26:50.915 | INFO     | uvicorn.server:serve:84 - Started server process [928530]
2022-01-08 00:26:50.917 | INFO     | uvicorn.server:serve:84 - Started server process [928530]
2022-01-08 00:26:50.917 | INFO     | uvicorn.server:serve:84 - Started server process [928530]
2022-01-08 00:26:50.920 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:26:50.920 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:26:50.921 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:26:50.922 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:26:50.922 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:26:50.923 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:26:55.837 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:55.837 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:55.837 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:26:55.938 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:55.938 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:55.939 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:26:55.939 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:55.940 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:55.940 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:26:55.940 | INFO     | uvicorn.server:serve:94 - Finished server process [928530]
2022-01-08 00:26:55.941 | INFO     | uvicorn.server:serve:94 - Finished server process [928530]
2022-01-08 00:26:55.941 | INFO     | uvicorn.server:serve:94 - Finished server process [928530]
2022-01-08 00:29:26.773 | INFO     | uvicorn.server:serve:84 - Started server process [929687]
2022-01-08 00:29:26.773 | INFO     | uvicorn.server:serve:84 - Started server process [929687]
2022-01-08 00:29:26.774 | INFO     | uvicorn.server:serve:84 - Started server process [929687]
2022-01-08 00:29:26.774 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:29:26.774 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:29:26.775 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:29:26.777 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:29:26.777 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:29:26.780 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:29:29.442 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48146 - "GET /docs HTTP/1.1" 200
2022-01-08 00:29:29.746 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48146 - "GET /openapi.json HTTP/1.1" 200
2022-01-08 00:29:48.294 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:29:50.342 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08ee01fb80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee8598b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee878700>
          └ <fastapi.routing.APIRoute object at 0x7f08ee8598b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08ee03aca0>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee878790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>}
                 │         └ <function login_for_access_token at 0x7f08f022a040>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f08f4a4dc40>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>
           └ <function authenticate_user at 0x7f08f0218ee0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f08f086ca60>

  File "./app/models/models.py", line 84, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f08f078bee0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08ed79ee20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08ed79ee20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08ee03a910>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08ee03a910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08eca5e4c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08ee03ac70>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08ee03ac70>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08eca5e4c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:29:50.364 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08ee01fb80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee8598b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee878700>
          └ <fastapi.routing.APIRoute object at 0x7f08ee8598b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08ee03aca0>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee878790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>}
                 │         └ <function login_for_access_token at 0x7f08f022a040>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f08f4a4dc40>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>
           └ <function authenticate_user at 0x7f08f0218ee0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f08f086ca60>

  File "./app/models/models.py", line 84, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f08f078bee0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08ed79ee20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08ed79ee20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08ee03a910>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08ee03a910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08eca5e4c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08ee03ac70>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08ee03ac70>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08eca5e4c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:29:50.380 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08ee01fb80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee8598b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08ee01fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee878700>
          └ <fastapi.routing.APIRoute object at 0x7f08ee8598b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08ee03aca0>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee878790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>}
                 │         └ <function login_for_access_token at 0x7f08f022a040>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f08f4a4dc40>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f08ed785460>
           └ <function authenticate_user at 0x7f08f0218ee0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f08f086ca60>

  File "./app/models/models.py", line 84, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f08f078bee0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08ed79ee20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08ed79ee20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08ee03a910>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08ed79ee50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08ee03a910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08eca5e4c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee03a9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08ee0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08ee03ac70>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08ee03ac70>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08eca5e4c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:29:50.401 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48148 - "POST /token HTTP/1.1" 500
2022-01-08 00:30:39.568 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-08 00:30:40.209 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:30:40.358 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48182 - "GET /sanity_check HTTP/1.1" 200
2022-01-08 00:31:09.811 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48296 - "POST /token HTTP/1.1" 200
2022-01-08 00:31:59.038 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48318 - "POST /signup HTTP/1.1" 201
2022-01-08 00:32:06.270 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48332 - "POST /signup HTTP/1.1" 201
2022-01-08 00:35:07.338 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48388 - "POST /signup HTTP/1.1" 201
2022-01-08 00:35:21.817 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48404 - "POST /token HTTP/1.1" 200
2022-01-08 00:36:42.450 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/760426b0-80b8-4401-af75-d521fc346978.jpg
2022-01-08 00:36:42.556 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/18837e25-17c6-4a18-9b9b-b1d453c5ea74.jpg
2022-01-08 00:36:42.661 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/bd1789b9-9166-4199-8320-fa1302ab7d6a.jpg
2022-01-08 00:36:42.690 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48424 - "POST /upload_images HTTP/1.1" 200
2022-01-08 00:38:26.513 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48506 - "GET /show_images HTTP/1.1" 200
2022-01-08 00:38:47.344 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48530 - "GET /delete_image?image_id=9132d55d-dfb2-4539-9e27-538e95010db3 HTTP/1.1" 200
2022-01-08 00:38:53.993 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48556 - "GET /show_deleted_images HTTP/1.1" 200
2022-01-08 00:39:01.850 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48580 - "GET /show_images HTTP/1.1" 200
2022-01-08 00:39:29.584 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48606 - "GET /share_image?image_id=9132d55d-dfb2-4539-9e27-538e95010db3 HTTP/1.1" 200
2022-01-08 00:40:17.535 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48634 - "GET /register_seller HTTP/1.1" 201
2022-01-08 00:40:31.707 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:40:31.767 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc5b3700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08dc5a4130>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08dc54efc0>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08dc54efc0>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08dc54efc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dc5abec0>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08f0246e80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08f0246e80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08dc5a4760>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08dc5a4c40>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08dc5a4c40>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08dc5a4760>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:40:31.786 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc5b3700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08dc5a4130>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08dc54efc0>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08dc54efc0>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08dc54efc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dc5abec0>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08f0246e80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08f0246e80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08dc5a4760>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08dc5a4c40>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08dc5a4c40>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08dc5a4760>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:40:31.806 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc5b3700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc5b3790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08dc5a4130>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08dc54efc0>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08dc54efc0>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08dc54efc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dc5abec0>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08f0246e80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08f0246e80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08dc5a4700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08dc5a4760>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a4820>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5a48...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08dc5a4c40>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08dc5a4c40>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08dc5a4760>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:40:31.830 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48656 - "GET /list_seller_images?username=kaumil HTTP/1.1" 500
2022-01-08 00:46:49.136 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc08e280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08df8e45e0>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08ec397d80>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08ec397d80>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08ec397d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dfe64940>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08df8e9550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08df8e9550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08df8e47c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08df8e4610>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08df8e4610>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08df8e47c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:46:49.155 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc08e280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08df8e45e0>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08ec397d80>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08ec397d80>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08ec397d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dfe64940>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08df8e9550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08df8e9550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08df8e47c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08df8e4610>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08df8e4610>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08df8e47c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:46:49.177 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc08e280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc08e5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08df8e45e0>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08ec397d80>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08ec397d80>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08ec397d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dfe64940>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08df8e9550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08df8e9550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08df8e45b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08df8e47c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8e47...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08df8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08df8e4610>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08df8e4610>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08df8e47c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:46:49.202 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48762 - "GET /list_seller_images?username=kaumil HTTP/1.1" 500
2022-01-08 00:46:50.426 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc058ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08dc574b80>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08eca1dc40>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08eca1dc40>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08eca1dc40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dfe57600>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08df8603a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08df8603a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08dc5748b0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08dc574b50>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08dc574b50>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08dc5748b0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:46:50.450 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc058ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08dc574b80>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08eca1dc40>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08eca1dc40>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08eca1dc40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dfe57600>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08df8603a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08df8603a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08dc5748b0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08dc574b50>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08dc574b50>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08dc5748b0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:46:50.478 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Market'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f08f0834940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │              │               └ {'TableName': 'Market'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f08f0834af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Market'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Market) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08dc058ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f08ee859670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f08edffea30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f08f2d299d0>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08dc058c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f08ee01f310>
          └ <fastapi.routing.APIRoute object at 0x7f08ee020490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f08dc574b80>
                     └ <function get_request_handler.<locals>.app at 0x7f08ee01f280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f08f2d185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'username': 'kaumil'}
                 │                 │         └ <function list_seller_images at 0x7f08f022a820>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f08ee0204c0>
                 └ <function run_in_threadpool at 0x7f08f2f04af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │     │         │        └ <built-in method run of Context object at 0x7f08eca1dc40>
                 │     │         └ <function run_sync at 0x7f08f2f219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
                 │                                        └ <built-in method run of Context object at 0x7f08eca1dc40>
                 └ <function get_asynclib at 0x7f08f2f21310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function list_seller_images at 0x7f08f022a820>, token=Users<kaumil>, username='kaumil'),)
             │       │   └ <built-in method run of Context object at 0x7f08eca1dc40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f08dfe57600>

  File "./app/routes/ecommerce.py", line 18, in list_seller_images
    seller_images = list_marketplace_images(username)
                    │                       └ 'kaumil'
                    └ <function list_marketplace_images at 0x7f08f0794e50>

  File "./app/models/models.py", line 142, in list_marketplace_images
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            │     └ 'kaumil'
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "./app/models/models.py", line 142, in <listcomp>
    images = [image.image_public_url for image in Marketplace.seller_index.query(username)]
                                                  │           │            └ <classmethod object at 0x7f08f0842fd0>
                                                  │           └ <app.models.models.MarketplaceSellerIndex object at 0x7f08f0792a30>
                                                  └ <class 'app.models.models.Marketplace'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08f0786550>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08df8603a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08df8603a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'seller_index', 'exclusive_start_key': None, 'consisten...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08f0830610>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08dc574c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08f0838ca0>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08df8a7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Market'
          │    └ <function Connection.get_meta_table at 0x7f08f0834d30>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f08dc5748b0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f08f78cd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f08f86449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f08f8644040>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f08f7262340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
    │    └ <function subprocess_started at 0x7f08f5129160>
    └ <SpawnProcess name='SpawnProcess-1' parent=929650 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f08f7262430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f08f511b550>
           │       │   └ <uvicorn.server.Server object at 0x7f08f7262430>
           │       └ <function run at 0x7f08f62da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f08f4678040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f08f469f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f08f469f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f08f4a57df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5748...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f08dc5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>
          └ <fastapi.applications.FastAPI object at 0x7f08f398af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f08dc574b50>
                     │    └ <function exception_handler at 0x7f08ee84d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f08edffea90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f08f2d47e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f08dc574b50>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f08f71f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f08dc5748b0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:46:50.512 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:48778 - "GET /list_seller_images?username=kaumil HTTP/1.1" 500
2022-01-08 01:08:23.103 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:08:23.103 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:08:23.103 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:08:23.204 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:08:23.204 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:08:23.205 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:08:23.205 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:08:23.206 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:08:23.206 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:08:23.207 | INFO     | uvicorn.server:serve:94 - Finished server process [929687]
2022-01-08 01:08:23.207 | INFO     | uvicorn.server:serve:94 - Finished server process [929687]
2022-01-08 01:08:23.207 | INFO     | uvicorn.server:serve:94 - Finished server process [929687]
2022-01-08 01:09:53.620 | INFO     | uvicorn.server:serve:84 - Started server process [937669]
2022-01-08 01:09:53.621 | INFO     | uvicorn.server:serve:84 - Started server process [937669]
2022-01-08 01:09:53.621 | INFO     | uvicorn.server:serve:84 - Started server process [937669]
2022-01-08 01:09:53.621 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:09:53.622 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:09:53.622 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:09:53.622 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:09:53.623 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:09:53.623 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:10:07.309 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-08 01:10:07.368 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:10:07.461 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:10:07.579 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:10:07.709 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49138 - "GET /sanity_check HTTP/1.1" 200
2022-01-08 01:10:15.945 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/routes/login.py", line 51, in get_current_user
    payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
              │   │      │      │                       └ 'HS256'
              │   │      │      └ '09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7'
              │   │      └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrYXVtaWwiLCJleHAiOjE2NDE2MzI3MjF9.WYeItpTjhTAcDZC1CADXMeeYKu_6QOSdlgeuz4UyYjU'
              │   └ <function decode at 0x7f9375740940>
              └ <module 'jose.jwt' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
    └ <function _validate_claims at 0x7f9375741040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    │             │              └ 0
    │             └ {'sub': 'kaumil', 'exp': 1641632721}
    └ <function _validate_exp at 0x7f9375740ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
          └ <class 'jose.exceptions.ExpiredSignatureError'>

jose.exceptions.ExpiredSignatureError: Signature has expired.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f93731486a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f93728eda60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f93776189d0>
          └ <fastapi.routing.APIRoute object at 0x7f937290e4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f937290d310>
          └ <fastapi.routing.APIRoute object at 0x7f937290e4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f93708f4c70>
                     └ <function get_request_handler.<locals>.app at 0x7f937290d280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f9377607040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f9377607040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrYXVtaWwiLCJleHAiOjE2NDE2MzI3MjF9.WYeItpTjhTAcDZC1CADXMeeYKu_6QOSd...
                   └ <function get_current_user at 0x7f9374b0dca0>

  File "./app/routes/login.py", line 57, in get_current_user
    raise credentials_exception
          └ HTTPException(status_code=401, detail='Could not validate credentials')

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f937090e070>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f937094c550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f93728eda60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f93708f4eb0>
                     └ <function http_exception_handler at 0x7f937313baf0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f9377636ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f93708f4eb0>
    │      │         └ HTTPException(status_code=401, detail='Could not validate credentials')
    │      └ <function Logger.exception at 0x7f937bae4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f937090e070>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f937090e310>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f937c1bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f937cf339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f937cf33040>
    └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f937bb51340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
    │    └ <function subprocess_started at 0x7f9379a19160>
    └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f937bb51430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9379a0a550>
           │       │   └ <uvicorn.server.Server object at 0x7f937bb51430>
           │       └ <function run at 0x7f937abc9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9378f67040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9378f8e280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9378f8e310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9379346df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9378279f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9379346df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>
          └ <fastapi.applications.FastAPI object at 0x7f9378279f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f937090e0d0>
                     │    └ <function exception_handler at 0x7f937313b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9377636ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f937090e0d0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f937bae4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f937090e310>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:10:15.976 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/routes/login.py", line 51, in get_current_user
    payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
              │   │      │      │                       └ 'HS256'
              │   │      │      └ '09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7'
              │   │      └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrYXVtaWwiLCJleHAiOjE2NDE2MzI3MjF9.WYeItpTjhTAcDZC1CADXMeeYKu_6QOSdlgeuz4UyYjU'
              │   └ <function decode at 0x7f9375740940>
              └ <module 'jose.jwt' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
    └ <function _validate_claims at 0x7f9375741040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    │             │              └ 0
    │             └ {'sub': 'kaumil', 'exp': 1641632721}
    └ <function _validate_exp at 0x7f9375740ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
          └ <class 'jose.exceptions.ExpiredSignatureError'>

jose.exceptions.ExpiredSignatureError: Signature has expired.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f93731486a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f93728eda60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f93776189d0>
          └ <fastapi.routing.APIRoute object at 0x7f937290e4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f937290d310>
          └ <fastapi.routing.APIRoute object at 0x7f937290e4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f93708f4c70>
                     └ <function get_request_handler.<locals>.app at 0x7f937290d280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f9377607040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f9377607040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrYXVtaWwiLCJleHAiOjE2NDE2MzI3MjF9.WYeItpTjhTAcDZC1CADXMeeYKu_6QOSd...
                   └ <function get_current_user at 0x7f9374b0dca0>

  File "./app/routes/login.py", line 57, in get_current_user
    raise credentials_exception
          └ HTTPException(status_code=401, detail='Could not validate credentials')

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f937090e070>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f937094c550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f93728eda60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f93708f4eb0>
                     └ <function http_exception_handler at 0x7f937313baf0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f9377636ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f93708f4eb0>
    │      │         └ HTTPException(status_code=401, detail='Could not validate credentials')
    │      └ <function Logger.exception at 0x7f937bae4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f937090e070>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f937090e310>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f937c1bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f937cf339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f937cf33040>
    └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f937bb51340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
    │    └ <function subprocess_started at 0x7f9379a19160>
    └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f937bb51430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9379a0a550>
           │       │   └ <uvicorn.server.Server object at 0x7f937bb51430>
           │       └ <function run at 0x7f937abc9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9378f67040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9378f8e280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9378f8e310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9379346df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9378279f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9379346df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>
          └ <fastapi.applications.FastAPI object at 0x7f9378279f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f937090e0d0>
                     │    └ <function exception_handler at 0x7f937313b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9377636ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f937090e0d0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f937bae4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f937090e310>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:10:15.995 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/routes/login.py", line 51, in get_current_user
    payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
              │   │      │      │                       └ 'HS256'
              │   │      │      └ '09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7'
              │   │      └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrYXVtaWwiLCJleHAiOjE2NDE2MzI3MjF9.WYeItpTjhTAcDZC1CADXMeeYKu_6QOSdlgeuz4UyYjU'
              │   └ <function decode at 0x7f9375740940>
              └ <module 'jose.jwt' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 157, in decode
    _validate_claims(
    └ <function _validate_claims at 0x7f9375741040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 481, in _validate_claims
    _validate_exp(claims, leeway=leeway)
    │             │              └ 0
    │             └ {'sub': 'kaumil', 'exp': 1641632721}
    └ <function _validate_exp at 0x7f9375740ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/jose/jwt.py", line 314, in _validate_exp
    raise ExpiredSignatureError("Signature has expired.")
          └ <class 'jose.exceptions.ExpiredSignatureError'>

jose.exceptions.ExpiredSignatureError: Signature has expired.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f93731486a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f93728eda60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f93776189d0>
          └ <fastapi.routing.APIRoute object at 0x7f937290e4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f937094c5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f937290d310>
          └ <fastapi.routing.APIRoute object at 0x7f937290e4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f93708f4c70>
                     └ <function get_request_handler.<locals>.app at 0x7f937290d280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f9377607040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f9377607040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJrYXVtaWwiLCJleHAiOjE2NDE2MzI3MjF9.WYeItpTjhTAcDZC1CADXMeeYKu_6QOSd...
                   └ <function get_current_user at 0x7f9374b0dca0>

  File "./app/routes/login.py", line 57, in get_current_user
    raise credentials_exception
          └ HTTPException(status_code=401, detail='Could not validate credentials')

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f937090e070>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f937094c550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f93728eda60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f93708f4eb0>
                     └ <function http_exception_handler at 0x7f937313baf0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f9377636ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f93708f4eb0>
    │      │         └ HTTPException(status_code=401, detail='Could not validate credentials')
    │      └ <function Logger.exception at 0x7f937bae4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f937090e070>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f937090e310>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f937c1bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f937cf339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f937cf33040>
    └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f937bb51340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
    │    └ <function subprocess_started at 0x7f9379a19160>
    └ <SpawnProcess name='SpawnProcess-1' parent=937632 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f937bb51430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9379a0a550>
           │       │   └ <uvicorn.server.Server object at 0x7f937bb51430>
           │       └ <function run at 0x7f937abc9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9378f67040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9378f8e280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9378f8e310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9379346df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9378279f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9379346df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708f43...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f93708...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>
          └ <fastapi.applications.FastAPI object at 0x7f9378279f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f937090e0d0>
                     │    └ <function exception_handler at 0x7f937313b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f93728edac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9377636ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f937090e0d0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f937bae4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f937090e310>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:10:16.016 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49210 - "GET /list_seller_images?username=kaumil HTTP/1.1" 500
2022-01-08 01:11:15.279 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49218 - "POST /token HTTP/1.1" 200
2022-01-08 01:11:26.545 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49230 - "GET /list_seller_images?username=kaumil HTTP/1.1" 200
2022-01-08 01:11:42.701 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49262 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:12:17.724 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:12:17.725 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:12:17.726 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:12:17.827 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:12:17.828 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:12:17.829 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:12:17.830 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:12:17.831 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:12:17.831 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:12:17.833 | INFO     | uvicorn.server:serve:94 - Finished server process [937669]
2022-01-08 01:12:17.834 | INFO     | uvicorn.server:serve:94 - Finished server process [937669]
2022-01-08 01:12:17.835 | INFO     | uvicorn.server:serve:94 - Finished server process [937669]
2022-01-08 01:12:19.519 | INFO     | uvicorn.server:serve:84 - Started server process [938561]
2022-01-08 01:12:19.520 | INFO     | uvicorn.server:serve:84 - Started server process [938561]
2022-01-08 01:12:19.520 | INFO     | uvicorn.server:serve:84 - Started server process [938561]
2022-01-08 01:12:19.520 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:12:19.521 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:12:19.521 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:12:19.523 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:12:19.523 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:12:19.524 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:12:21.917 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:12:22.014 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:12:22.090 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49290 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:12:26.507 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:12:26.508 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:12:26.508 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:12:26.609 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:12:26.610 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:12:26.610 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:12:26.611 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:12:26.611 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:12:26.612 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:12:26.612 | INFO     | uvicorn.server:serve:94 - Finished server process [938561]
2022-01-08 01:12:26.613 | INFO     | uvicorn.server:serve:94 - Finished server process [938561]
2022-01-08 01:12:26.613 | INFO     | uvicorn.server:serve:94 - Finished server process [938561]
2022-01-08 01:12:30.415 | INFO     | uvicorn.server:serve:84 - Started server process [938746]
2022-01-08 01:12:30.415 | INFO     | uvicorn.server:serve:84 - Started server process [938746]
2022-01-08 01:12:30.416 | INFO     | uvicorn.server:serve:84 - Started server process [938746]
2022-01-08 01:12:30.416 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:12:30.416 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:12:30.417 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:12:30.417 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:12:30.418 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:12:30.418 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:12:31.956 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:12:32.086 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:12:32.221 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49332 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:12:50.898 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efc05e92f70>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efc07952b20>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efc081ae760>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efc07952b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7efc0c67e9d0>
          └ <fastapi.routing.APIRoute object at 0x7efc07973a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efc07974430>
          └ <fastapi.routing.APIRoute object at 0x7efc07973a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efc05ec3e50>
                     └ <function get_request_handler.<locals>.app at 0x7efc079743a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efc0c66c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'seller': Users<kaumil>, 'image_id': '953e3514-fe09-43f4-93af-dc8756b96b36', 'price': '50'}
                 │                 │         └ <function sell_image at 0x7efc09b7e9d0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7efc07973a30>
                 └ <function run_in_threadpool at 0x7efc0c858af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │     │         │        └ <built-in method run of Context object at 0x7efc06ba9ac0>
                 │     │         └ <function run_sync at 0x7efc0c8759d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │                                        └ <built-in method run of Context object at 0x7efc06ba9ac0>
                 └ <function get_asynclib at 0x7efc0c875310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeNullError('sold_on')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
             │       │   └ <built-in method run of Context object at 0x7efc06ba9ac0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7efc06356ac0>

  File "./app/routes/ecommerce.py", line 24, in sell_image
    marketplace_id = sell_user_image(image_id,price,seller)
                     │               │        │     └ Users<kaumil>
                     │               │        └ '50'
                     │               └ '953e3514-fe09-43f4-93af-dc8756b96b36'
                     └ <function sell_user_image at 0x7efc0a0e8ee0>

  File "./app/models/models.py", line 151, in sell_user_image
    marketplace_item.save()
    │                └ <function Model.save at 0x7efc0a0e3820>
    └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 445, in save
    args, kwargs = self._get_save_args(condition=condition)
                   │    │                        └ None
                   │    └ <function Model._get_save_args at 0x7efc0a0e81f0>
                   └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 907, in _get_save_args
    attribute_values = self.serialize(null_check)
                       │    │         └ True
                       │    └ <function Model.serialize at 0x7efc0a0e8940>
                       └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 1107, in serialize
    return self._container_serialize(null_check=null_check)
           │    │                               └ True
           │    └ <function AttributeContainer._container_serialize at 0x7efc0a167430>
           └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/attributes.py", line 362, in _container_serialize
    raise AttributeNullError(name)
          │                  └ 'sold_on'
          └ <class 'pynamodb.exceptions.AttributeNullError'>

pynamodb.exceptions.AttributeNullError: Attribute 'sold_on' cannot be None


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7efc05ec3dc0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efc11222430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efc11f989d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efc11f98040>
    └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efc10bb6340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
    │    └ <function subprocess_started at 0x7efc0ea7d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efc10bb6430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7efc0ea6e550>
           │       │   └ <uvicorn.server.Server object at 0x7efc10bb6430>
           │       └ <function run at 0x7efc0fc2f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7efc0dfcc040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efc0dff3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efc0dff3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efc0e3abdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efc0d2def40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efc0e3abdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>
          └ <fastapi.applications.FastAPI object at 0x7efc0d2def40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7efc05ec3fa0>
                     │    └ <function exception_handler at 0x7efc081a00d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7efc0c69cd10>
    │      │         │                  └ <starlette.requests.Request object at 0x7efc05ec3fa0>
    │      │         └ AttributeNullError('sold_on')
    │      └ <function Logger.exception at 0x7efc10b49790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7efc05ec3dc0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:12:50.928 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efc05e92f70>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efc07952b20>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efc081ae760>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efc07952b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7efc0c67e9d0>
          └ <fastapi.routing.APIRoute object at 0x7efc07973a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efc07974430>
          └ <fastapi.routing.APIRoute object at 0x7efc07973a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efc05ec3e50>
                     └ <function get_request_handler.<locals>.app at 0x7efc079743a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efc0c66c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'seller': Users<kaumil>, 'image_id': '953e3514-fe09-43f4-93af-dc8756b96b36', 'price': '50'}
                 │                 │         └ <function sell_image at 0x7efc09b7e9d0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7efc07973a30>
                 └ <function run_in_threadpool at 0x7efc0c858af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │     │         │        └ <built-in method run of Context object at 0x7efc06ba9ac0>
                 │     │         └ <function run_sync at 0x7efc0c8759d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │                                        └ <built-in method run of Context object at 0x7efc06ba9ac0>
                 └ <function get_asynclib at 0x7efc0c875310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeNullError('sold_on')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
             │       │   └ <built-in method run of Context object at 0x7efc06ba9ac0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7efc06356ac0>

  File "./app/routes/ecommerce.py", line 24, in sell_image
    marketplace_id = sell_user_image(image_id,price,seller)
                     │               │        │     └ Users<kaumil>
                     │               │        └ '50'
                     │               └ '953e3514-fe09-43f4-93af-dc8756b96b36'
                     └ <function sell_user_image at 0x7efc0a0e8ee0>

  File "./app/models/models.py", line 151, in sell_user_image
    marketplace_item.save()
    │                └ <function Model.save at 0x7efc0a0e3820>
    └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 445, in save
    args, kwargs = self._get_save_args(condition=condition)
                   │    │                        └ None
                   │    └ <function Model._get_save_args at 0x7efc0a0e81f0>
                   └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 907, in _get_save_args
    attribute_values = self.serialize(null_check)
                       │    │         └ True
                       │    └ <function Model.serialize at 0x7efc0a0e8940>
                       └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 1107, in serialize
    return self._container_serialize(null_check=null_check)
           │    │                               └ True
           │    └ <function AttributeContainer._container_serialize at 0x7efc0a167430>
           └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/attributes.py", line 362, in _container_serialize
    raise AttributeNullError(name)
          │                  └ 'sold_on'
          └ <class 'pynamodb.exceptions.AttributeNullError'>

pynamodb.exceptions.AttributeNullError: Attribute 'sold_on' cannot be None


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7efc05ec3dc0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efc11222430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efc11f989d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efc11f98040>
    └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efc10bb6340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
    │    └ <function subprocess_started at 0x7efc0ea7d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efc10bb6430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7efc0ea6e550>
           │       │   └ <uvicorn.server.Server object at 0x7efc10bb6430>
           │       └ <function run at 0x7efc0fc2f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7efc0dfcc040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efc0dff3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efc0dff3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efc0e3abdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efc0d2def40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efc0e3abdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>
          └ <fastapi.applications.FastAPI object at 0x7efc0d2def40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7efc05ec3fa0>
                     │    └ <function exception_handler at 0x7efc081a00d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7efc0c69cd10>
    │      │         │                  └ <starlette.requests.Request object at 0x7efc05ec3fa0>
    │      │         └ AttributeNullError('sold_on')
    │      └ <function Logger.exception at 0x7efc10b49790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7efc05ec3dc0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:12:50.957 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efc05e92f70>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efc07952b20>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efc081ae760>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efc07952b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7efc0c67e9d0>
          └ <fastapi.routing.APIRoute object at 0x7efc07973a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efc05e92e50>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efc07974430>
          └ <fastapi.routing.APIRoute object at 0x7efc07973a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efc05ec3e50>
                     └ <function get_request_handler.<locals>.app at 0x7efc079743a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efc0c66c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'seller': Users<kaumil>, 'image_id': '953e3514-fe09-43f4-93af-dc8756b96b36', 'price': '50'}
                 │                 │         └ <function sell_image at 0x7efc09b7e9d0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7efc07973a30>
                 └ <function run_in_threadpool at 0x7efc0c858af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │     │         │        └ <built-in method run of Context object at 0x7efc06ba9ac0>
                 │     │         └ <function run_sync at 0x7efc0c8759d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │                                        └ <built-in method run of Context object at 0x7efc06ba9ac0>
                 └ <function get_asynclib at 0x7efc0c875310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeNullError('sold_on')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function sell_image at 0x7efc09b7e9d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
             │       │   └ <built-in method run of Context object at 0x7efc06ba9ac0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7efc06356ac0>

  File "./app/routes/ecommerce.py", line 24, in sell_image
    marketplace_id = sell_user_image(image_id,price,seller)
                     │               │        │     └ Users<kaumil>
                     │               │        └ '50'
                     │               └ '953e3514-fe09-43f4-93af-dc8756b96b36'
                     └ <function sell_user_image at 0x7efc0a0e8ee0>

  File "./app/models/models.py", line 151, in sell_user_image
    marketplace_item.save()
    │                └ <function Model.save at 0x7efc0a0e3820>
    └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 445, in save
    args, kwargs = self._get_save_args(condition=condition)
                   │    │                        └ None
                   │    └ <function Model._get_save_args at 0x7efc0a0e81f0>
                   └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 907, in _get_save_args
    attribute_values = self.serialize(null_check)
                       │    │         └ True
                       │    └ <function Model.serialize at 0x7efc0a0e8940>
                       └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 1107, in serialize
    return self._container_serialize(null_check=null_check)
           │    │                               └ True
           │    └ <function AttributeContainer._container_serialize at 0x7efc0a167430>
           └ Market<bfd6d899-8939-41aa-8701-257ed386f4c9>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/attributes.py", line 362, in _container_serialize
    raise AttributeNullError(name)
          │                  └ 'sold_on'
          └ <class 'pynamodb.exceptions.AttributeNullError'>

pynamodb.exceptions.AttributeNullError: Attribute 'sold_on' cannot be None


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7efc05ec3dc0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efc11222430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efc11f989d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efc11f98040>
    └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efc10bb6340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
    │    └ <function subprocess_started at 0x7efc0ea7d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=938706 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efc10bb6430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7efc0ea6e550>
           │       │   └ <uvicorn.server.Server object at 0x7efc10bb6430>
           │       └ <function run at 0x7efc0fc2f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7efc0dfcc040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efc0dff3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efc0dff3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efc0e3abdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efc0d2def40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efc0e3abdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05ec3c...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efc05e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>
          └ <fastapi.applications.FastAPI object at 0x7efc0d2def40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7efc05ec3fa0>
                     │    └ <function exception_handler at 0x7efc081a00d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efc07952b80>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7efc0c69cd10>
    │      │         │                  └ <starlette.requests.Request object at 0x7efc05ec3fa0>
    │      │         └ AttributeNullError('sold_on')
    │      └ <function Logger.exception at 0x7efc10b49790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7efc05ec3dc0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:12:50.986 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49372 - "GET /sell_image?image_id=953e3514-fe09-43f4-93af-dc8756b96b36&price=50 HTTP/1.1" 500
2022-01-08 01:13:42.502 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:13:42.503 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:13:42.505 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:13:42.608 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:13:42.609 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:13:42.609 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:13:42.610 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:13:42.610 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:13:42.611 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:13:42.612 | INFO     | uvicorn.server:serve:94 - Finished server process [938746]
2022-01-08 01:13:42.615 | INFO     | uvicorn.server:serve:94 - Finished server process [938746]
2022-01-08 01:13:42.619 | INFO     | uvicorn.server:serve:94 - Finished server process [938746]
2022-01-08 01:13:44.456 | INFO     | uvicorn.server:serve:84 - Started server process [939212]
2022-01-08 01:13:44.457 | INFO     | uvicorn.server:serve:84 - Started server process [939212]
2022-01-08 01:13:44.457 | INFO     | uvicorn.server:serve:84 - Started server process [939212]
2022-01-08 01:13:44.458 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:13:44.458 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:13:44.458 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:13:44.459 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:13:44.459 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:13:44.459 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:13:50.674 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:13:50.674 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:13:50.675 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:13:50.775 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:13:50.776 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:13:50.776 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:13:50.777 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:13:50.779 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:13:50.780 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:13:50.781 | INFO     | uvicorn.server:serve:94 - Finished server process [939212]
2022-01-08 01:13:50.781 | INFO     | uvicorn.server:serve:94 - Finished server process [939212]
2022-01-08 01:13:50.782 | INFO     | uvicorn.server:serve:94 - Finished server process [939212]
2022-01-08 01:13:55.449 | INFO     | uvicorn.server:serve:84 - Started server process [939359]
2022-01-08 01:13:55.450 | INFO     | uvicorn.server:serve:84 - Started server process [939359]
2022-01-08 01:13:55.451 | INFO     | uvicorn.server:serve:84 - Started server process [939359]
2022-01-08 01:13:55.452 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:13:55.453 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:13:55.453 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:13:55.454 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:13:55.455 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:13:55.456 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:14:01.530 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:14:01.635 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:14:01.741 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:14:01.917 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1023, in put_item
    return self.dispatch(PUT_ITEM, operation_kwargs, settings)
           │    │        │         │                 └ <pynamodb.settings.OperationSettings object at 0x7f7b6c65f670>
           │    │        │         └ {'TableName': 'Market', 'Item': {'marketplace_id': {'S': 'b79e7c9d-7876-4e2a-8a35-d1ad47b371b5'}, 'image_id': {'S': '953e3514...
           │    │        └ 'PutItem'
           │    └ <function Connection.dispatch at 0x7f7b6c664940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f7b6c65f670>
           │    │              │               └ {'TableName': 'Market', 'Item': {'marketplace_id': {'S': 'b79e7c9d-7876-4e2a-8a35-d1ad47b371b5'}, 'image_id': {'S': '953e3514...
           │    │              └ 'PutItem'
           │    └ <function Connection._make_api_call at 0x7f7b6c664af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'a48730ab-9b54-4626-92ed-1355bdda7660', 'table_name': 'Market'}
          │                  │                         └ 'PutItem'
          │                  └ {'Error': {'Message': 'A value provided cannot be converted into a number', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on table (Market) when calling the PutItem operation: A value provided cannot be converted into a number


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f7b69e4e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7b69e2da30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f7b6a689670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7b69e2da30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f7b6eb589d0>
          └ <fastapi.routing.APIRoute object at 0x7f7b69e4f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f7b69e4e430>
          └ <fastapi.routing.APIRoute object at 0x7f7b69e4f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f7b69e69190>
                     └ <function get_request_handler.<locals>.app at 0x7f7b69e4e3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f7b6eb475e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'seller': Users<kaumil>, 'image_id': '953e3514-fe09-43f4-93af-dc8756b96b36', 'price': '50'}
                 │                 │         └ <function sell_image at 0x7f7b6c0599d0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f7b69e4f940>
                 └ <function run_in_threadpool at 0x7f7b6ed33af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │     │         │        └ <built-in method run of Context object at 0x7f7b69e60d00>
                 │     │         └ <function run_sync at 0x7f7b6ed509d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │                                        └ <built-in method run of Context object at 0x7f7b69e60d00>
                 └ <function get_asynclib at 0x7f7b6ed50310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=PutError('Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-46...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
             │       │   └ <built-in method run of Context object at 0x7f7b69e60d00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f7b690e7080>

  File "./app/routes/ecommerce.py", line 24, in sell_image
    marketplace_id = sell_user_image(image_id,price,seller)
                     │               │        │     └ Users<kaumil>
                     │               │        └ '50'
                     │               └ '953e3514-fe09-43f4-93af-dc8756b96b36'
                     └ <function sell_user_image at 0x7f7b6c5c3ee0>

  File "./app/models/models.py", line 151, in sell_user_image
    marketplace_item.save()
    │                └ <function Model.save at 0x7f7b6c5be820>
    └ Market<b79e7c9d-7876-4e2a-8a35-d1ad47b371b5>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 447, in save
    data = self._get_connection().put_item(*args, **kwargs)
           │    │                           │       └ {'attributes': {'image_id': {'S': '953e3514-fe09-43f4-93af-dc8756b96b36'}, 'image_price': {'N': '"50"'}, 'image_public_url': ...
           │    │                           └ ('b79e7c9d-7876-4e2a-8a35-d1ad47b371b5',)
           │    └ <classmethod object at 0x7f7b6c5c2340>
           └ Market<b79e7c9d-7876-4e2a-8a35-d1ad47b371b5>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 150, in put_item
    return self.connection.put_item(
           │    │          └ <function Connection.put_item at 0x7f7b6c667820>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f7b6839dac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1025, in put_item
    raise PutError("Failed to put item: {}".format(e), e)
          └ <class 'pynamodb.exceptions.PutError'>

pynamodb.exceptions.PutError: Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on table (Market) when calling the PutItem operation: A value provided cannot be converted into a number


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f7b6a6a1b50>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f7b736fd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f7b744729d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f7b74472040>
    └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f7b73091340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
    │    └ <function subprocess_started at 0x7f7b70f58160>
    └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f7b73091430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f7b70f4a550>
           │       │   └ <uvicorn.server.Server object at 0x7f7b73091430>
           │       └ <function run at 0x7f7b72109700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f7b704a7040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f7b704d2280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f7b704d2310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f7b70886df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f7b6f7b9f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f7b70886df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>
          └ <fastapi.applications.FastAPI object at 0x7f7b6f7b9f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f7b69e69160>
                     │    └ <function exception_handler at 0x7f7b6a67b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f7b6eb77d10>
    │      │         │                  └ <starlette.requests.Request object at 0x7f7b69e69160>
    │      │         └ PutError('Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on ta...
    │      └ <function Logger.exception at 0x7f7b73024790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f7b6a6a1b50>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:14:01.950 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1023, in put_item
    return self.dispatch(PUT_ITEM, operation_kwargs, settings)
           │    │        │         │                 └ <pynamodb.settings.OperationSettings object at 0x7f7b6c65f670>
           │    │        │         └ {'TableName': 'Market', 'Item': {'marketplace_id': {'S': 'b79e7c9d-7876-4e2a-8a35-d1ad47b371b5'}, 'image_id': {'S': '953e3514...
           │    │        └ 'PutItem'
           │    └ <function Connection.dispatch at 0x7f7b6c664940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f7b6c65f670>
           │    │              │               └ {'TableName': 'Market', 'Item': {'marketplace_id': {'S': 'b79e7c9d-7876-4e2a-8a35-d1ad47b371b5'}, 'image_id': {'S': '953e3514...
           │    │              └ 'PutItem'
           │    └ <function Connection._make_api_call at 0x7f7b6c664af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'a48730ab-9b54-4626-92ed-1355bdda7660', 'table_name': 'Market'}
          │                  │                         └ 'PutItem'
          │                  └ {'Error': {'Message': 'A value provided cannot be converted into a number', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on table (Market) when calling the PutItem operation: A value provided cannot be converted into a number


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f7b69e4e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7b69e2da30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f7b6a689670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7b69e2da30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f7b6eb589d0>
          └ <fastapi.routing.APIRoute object at 0x7f7b69e4f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f7b69e4e430>
          └ <fastapi.routing.APIRoute object at 0x7f7b69e4f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f7b69e69190>
                     └ <function get_request_handler.<locals>.app at 0x7f7b69e4e3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f7b6eb475e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'seller': Users<kaumil>, 'image_id': '953e3514-fe09-43f4-93af-dc8756b96b36', 'price': '50'}
                 │                 │         └ <function sell_image at 0x7f7b6c0599d0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f7b69e4f940>
                 └ <function run_in_threadpool at 0x7f7b6ed33af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │     │         │        └ <built-in method run of Context object at 0x7f7b69e60d00>
                 │     │         └ <function run_sync at 0x7f7b6ed509d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │                                        └ <built-in method run of Context object at 0x7f7b69e60d00>
                 └ <function get_asynclib at 0x7f7b6ed50310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=PutError('Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-46...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
             │       │   └ <built-in method run of Context object at 0x7f7b69e60d00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f7b690e7080>

  File "./app/routes/ecommerce.py", line 24, in sell_image
    marketplace_id = sell_user_image(image_id,price,seller)
                     │               │        │     └ Users<kaumil>
                     │               │        └ '50'
                     │               └ '953e3514-fe09-43f4-93af-dc8756b96b36'
                     └ <function sell_user_image at 0x7f7b6c5c3ee0>

  File "./app/models/models.py", line 151, in sell_user_image
    marketplace_item.save()
    │                └ <function Model.save at 0x7f7b6c5be820>
    └ Market<b79e7c9d-7876-4e2a-8a35-d1ad47b371b5>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 447, in save
    data = self._get_connection().put_item(*args, **kwargs)
           │    │                           │       └ {'attributes': {'image_id': {'S': '953e3514-fe09-43f4-93af-dc8756b96b36'}, 'image_price': {'N': '"50"'}, 'image_public_url': ...
           │    │                           └ ('b79e7c9d-7876-4e2a-8a35-d1ad47b371b5',)
           │    └ <classmethod object at 0x7f7b6c5c2340>
           └ Market<b79e7c9d-7876-4e2a-8a35-d1ad47b371b5>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 150, in put_item
    return self.connection.put_item(
           │    │          └ <function Connection.put_item at 0x7f7b6c667820>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f7b6839dac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1025, in put_item
    raise PutError("Failed to put item: {}".format(e), e)
          └ <class 'pynamodb.exceptions.PutError'>

pynamodb.exceptions.PutError: Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on table (Market) when calling the PutItem operation: A value provided cannot be converted into a number


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f7b6a6a1b50>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f7b736fd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f7b744729d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f7b74472040>
    └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f7b73091340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
    │    └ <function subprocess_started at 0x7f7b70f58160>
    └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f7b73091430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f7b70f4a550>
           │       │   └ <uvicorn.server.Server object at 0x7f7b73091430>
           │       └ <function run at 0x7f7b72109700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f7b704a7040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f7b704d2280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f7b704d2310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f7b70886df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f7b6f7b9f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f7b70886df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>
          └ <fastapi.applications.FastAPI object at 0x7f7b6f7b9f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f7b69e69160>
                     │    └ <function exception_handler at 0x7f7b6a67b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f7b6eb77d10>
    │      │         │                  └ <starlette.requests.Request object at 0x7f7b69e69160>
    │      │         └ PutError('Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on ta...
    │      └ <function Logger.exception at 0x7f7b73024790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f7b6a6a1b50>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:14:01.979 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1023, in put_item
    return self.dispatch(PUT_ITEM, operation_kwargs, settings)
           │    │        │         │                 └ <pynamodb.settings.OperationSettings object at 0x7f7b6c65f670>
           │    │        │         └ {'TableName': 'Market', 'Item': {'marketplace_id': {'S': 'b79e7c9d-7876-4e2a-8a35-d1ad47b371b5'}, 'image_id': {'S': '953e3514...
           │    │        └ 'PutItem'
           │    └ <function Connection.dispatch at 0x7f7b6c664940>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f7b6c65f670>
           │    │              │               └ {'TableName': 'Market', 'Item': {'marketplace_id': {'S': 'b79e7c9d-7876-4e2a-8a35-d1ad47b371b5'}, 'image_id': {'S': '953e3514...
           │    │              └ 'PutItem'
           │    └ <function Connection._make_api_call at 0x7f7b6c664af0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'a48730ab-9b54-4626-92ed-1355bdda7660', 'table_name': 'Market'}
          │                  │                         └ 'PutItem'
          │                  └ {'Error': {'Message': 'A value provided cannot be converted into a number', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on table (Market) when calling the PutItem operation: A value provided cannot be converted into a number


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f7b69e4e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7b69e2da30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f7b6a689670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f7b69e2da30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f7b6eb589d0>
          └ <fastapi.routing.APIRoute object at 0x7f7b69e4f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f7b69e4ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f7b69e4e430>
          └ <fastapi.routing.APIRoute object at 0x7f7b69e4f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f7b69e69190>
                     └ <function get_request_handler.<locals>.app at 0x7f7b69e4e3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f7b6eb475e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'seller': Users<kaumil>, 'image_id': '953e3514-fe09-43f4-93af-dc8756b96b36', 'price': '50'}
                 │                 │         └ <function sell_image at 0x7f7b6c0599d0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f7b69e4f940>
                 └ <function run_in_threadpool at 0x7f7b6ed33af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │     │         │        └ <built-in method run of Context object at 0x7f7b69e60d00>
                 │     │         └ <function run_sync at 0x7f7b6ed509d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
                 │                                        └ <built-in method run of Context object at 0x7f7b69e60d00>
                 └ <function get_asynclib at 0x7f7b6ed50310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=PutError('Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-46...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function sell_image at 0x7f7b6c0599d0>, seller=Users<kaumil>, image_id='953e3514-fe09-43f4-93af-dc8756b96...
             │       │   └ <built-in method run of Context object at 0x7f7b69e60d00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f7b690e7080>

  File "./app/routes/ecommerce.py", line 24, in sell_image
    marketplace_id = sell_user_image(image_id,price,seller)
                     │               │        │     └ Users<kaumil>
                     │               │        └ '50'
                     │               └ '953e3514-fe09-43f4-93af-dc8756b96b36'
                     └ <function sell_user_image at 0x7f7b6c5c3ee0>

  File "./app/models/models.py", line 151, in sell_user_image
    marketplace_item.save()
    │                └ <function Model.save at 0x7f7b6c5be820>
    └ Market<b79e7c9d-7876-4e2a-8a35-d1ad47b371b5>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 447, in save
    data = self._get_connection().put_item(*args, **kwargs)
           │    │                           │       └ {'attributes': {'image_id': {'S': '953e3514-fe09-43f4-93af-dc8756b96b36'}, 'image_price': {'N': '"50"'}, 'image_public_url': ...
           │    │                           └ ('b79e7c9d-7876-4e2a-8a35-d1ad47b371b5',)
           │    └ <classmethod object at 0x7f7b6c5c2340>
           └ Market<b79e7c9d-7876-4e2a-8a35-d1ad47b371b5>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 150, in put_item
    return self.connection.put_item(
           │    │          └ <function Connection.put_item at 0x7f7b6c667820>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f7b6839dac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1025, in put_item
    raise PutError("Failed to put item: {}".format(e), e)
          └ <class 'pynamodb.exceptions.PutError'>

pynamodb.exceptions.PutError: Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on table (Market) when calling the PutItem operation: A value provided cannot be converted into a number


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f7b6a6a1b50>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f7b736fd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f7b744729d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f7b74472040>
    └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f7b73091340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
    │    └ <function subprocess_started at 0x7f7b70f58160>
    └ <SpawnProcess name='SpawnProcess-1' parent=939322 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f7b73091430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f7b70f4a550>
           │       │   └ <uvicorn.server.Server object at 0x7f7b73091430>
           │       └ <function run at 0x7f7b72109700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f7b704a7040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f7b704d2280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f7b704d2310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f7b70886df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f7b6f7b9f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f7b70886df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e54f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f7b69e...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>
          └ <fastapi.applications.FastAPI object at 0x7f7b6f7b9f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f7b69e69160>
                     │    └ <function exception_handler at 0x7f7b6a67b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f7b69e2da90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f7b6eb77d10>
    │      │         │                  └ <starlette.requests.Request object at 0x7f7b69e69160>
    │      │         └ PutError('Failed to put item: An error occurred (ValidationException) on request (a48730ab-9b54-4626-92ed-1355bdda7660) on ta...
    │      └ <function Logger.exception at 0x7f7b73024790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f7b6a6a1b50>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:14:02.021 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49420 - "GET /sell_image?image_id=953e3514-fe09-43f4-93af-dc8756b96b36&price=50 HTTP/1.1" 500
2022-01-08 01:14:45.115 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:14:45.116 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:14:45.116 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:14:45.218 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:14:45.219 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:14:45.220 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:14:45.221 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:14:45.222 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:14:45.223 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:14:45.224 | INFO     | uvicorn.server:serve:94 - Finished server process [939359]
2022-01-08 01:14:45.224 | INFO     | uvicorn.server:serve:94 - Finished server process [939359]
2022-01-08 01:14:45.225 | INFO     | uvicorn.server:serve:94 - Finished server process [939359]
2022-01-08 01:14:49.871 | INFO     | uvicorn.server:serve:84 - Started server process [939756]
2022-01-08 01:14:49.871 | INFO     | uvicorn.server:serve:84 - Started server process [939756]
2022-01-08 01:14:49.872 | INFO     | uvicorn.server:serve:84 - Started server process [939756]
2022-01-08 01:14:49.872 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:14:49.872 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:14:49.873 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:14:49.874 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:14:49.874 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:14:49.875 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:14:52.367 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:14:52.505 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:14:52.623 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:14:52.766 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49492 - "GET /sell_image?image_id=953e3514-fe09-43f4-93af-dc8756b96b36&price=50 HTTP/1.1" 201
2022-01-08 01:15:02.668 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49550 - "GET /list_seller_images?username=kaumil HTTP/1.1" 200
2022-01-08 01:15:26.664 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fced639d700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcedc35aa90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcedcbb66d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcedc35aa90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcee10859d0>
          └ <fastapi.routing.APIRoute object at 0x7fcedc37ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcedc3785e0>
          └ <fastapi.routing.APIRoute object at 0x7fcedc37ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fced63594f0>
                     └ <function get_request_handler.<locals>.app at 0x7fcedc378550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fcee10745e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7fcede586c10>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fcedc37ce50>
                 └ <function run_in_threadpool at 0x7fcee1260af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7fced75f8140>
                 │     │         └ <function run_sync at 0x7fcee127d9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7fced75f8140>
                 └ <function get_asynclib at 0x7fcee127d310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'ResultIterator' object has no attribute 'image_id'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7fced75f8140>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fced75d7ec0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7fcedeaf4040>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 158, in buy_user_image
    image_id = marketplace_item.image_id
               └ <pynamodb.pagination.ResultIterator object at 0x7fced68b1bb0>

AttributeError: 'ResultIterator' object has no attribute 'image_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fced634e970>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcee5c29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fcee699f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fcee699f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fcee55be340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
    │    └ <function subprocess_started at 0x7fcee3485160>
    └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fcee55be430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcee3477550>
           │       │   └ <uvicorn.server.Server object at 0x7fcee55be430>
           │       └ <function run at 0x7fcee4636700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcee29d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcee29ff280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcee29ff310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcee2db3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcee1ce6f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcee2db3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>
          └ <fastapi.applications.FastAPI object at 0x7fcee1ce6f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fced634e8b0>
                     │    └ <function exception_handler at 0x7fcedcba8160>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcee10a3db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fced634e8b0>
    │      │         └ AttributeError("'ResultIterator' object has no attribute 'image_id'")
    │      └ <function Logger.exception at 0x7fcee5551790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fced634e970>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:15:26.691 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fced639d700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcedc35aa90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcedcbb66d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcedc35aa90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcee10859d0>
          └ <fastapi.routing.APIRoute object at 0x7fcedc37ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcedc3785e0>
          └ <fastapi.routing.APIRoute object at 0x7fcedc37ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fced63594f0>
                     └ <function get_request_handler.<locals>.app at 0x7fcedc378550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fcee10745e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7fcede586c10>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fcedc37ce50>
                 └ <function run_in_threadpool at 0x7fcee1260af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7fced75f8140>
                 │     │         └ <function run_sync at 0x7fcee127d9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7fced75f8140>
                 └ <function get_asynclib at 0x7fcee127d310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'ResultIterator' object has no attribute 'image_id'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7fced75f8140>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fced75d7ec0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7fcedeaf4040>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 158, in buy_user_image
    image_id = marketplace_item.image_id
               └ <pynamodb.pagination.ResultIterator object at 0x7fced68b1bb0>

AttributeError: 'ResultIterator' object has no attribute 'image_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fced634e970>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcee5c29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fcee699f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fcee699f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fcee55be340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
    │    └ <function subprocess_started at 0x7fcee3485160>
    └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fcee55be430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcee3477550>
           │       │   └ <uvicorn.server.Server object at 0x7fcee55be430>
           │       └ <function run at 0x7fcee4636700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcee29d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcee29ff280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcee29ff310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcee2db3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcee1ce6f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcee2db3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>
          └ <fastapi.applications.FastAPI object at 0x7fcee1ce6f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fced634e8b0>
                     │    └ <function exception_handler at 0x7fcedcba8160>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcee10a3db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fced634e8b0>
    │      │         └ AttributeError("'ResultIterator' object has no attribute 'image_id'")
    │      └ <function Logger.exception at 0x7fcee5551790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fced634e970>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:15:26.708 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fced639d700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcedc35aa90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcedcbb66d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcedc35aa90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcee10859d0>
          └ <fastapi.routing.APIRoute object at 0x7fcedc37ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fced639d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcedc3785e0>
          └ <fastapi.routing.APIRoute object at 0x7fcedc37ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fced63594f0>
                     └ <function get_request_handler.<locals>.app at 0x7fcedc378550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fcee10745e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7fcede586c10>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fcedc37ce50>
                 └ <function run_in_threadpool at 0x7fcee1260af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7fced75f8140>
                 │     │         └ <function run_sync at 0x7fcee127d9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7fced75f8140>
                 └ <function get_asynclib at 0x7fcee127d310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'ResultIterator' object has no attribute 'image_id'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fcede586c10>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7fced75f8140>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fced75d7ec0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7fcedeaf4040>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 158, in buy_user_image
    image_id = marketplace_item.image_id
               └ <pynamodb.pagination.ResultIterator object at 0x7fced68b1bb0>

AttributeError: 'ResultIterator' object has no attribute 'image_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fced634e970>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcee5c29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fcee699f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fcee699f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fcee55be340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
    │    └ <function subprocess_started at 0x7fcee3485160>
    └ <SpawnProcess name='SpawnProcess-1' parent=939714 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fcee55be430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcee3477550>
           │       │   └ <uvicorn.server.Server object at 0x7fcee55be430>
           │       └ <function run at 0x7fcee4636700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcee29d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcee29ff280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcee29ff310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcee2db3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcee1ce6f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcee2db3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63598...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fced63...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>
          └ <fastapi.applications.FastAPI object at 0x7fcee1ce6f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fced634e8b0>
                     │    └ <function exception_handler at 0x7fcedcba8160>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcedc35aaf0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcee10a3db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fced634e8b0>
    │      │         └ AttributeError("'ResultIterator' object has no attribute 'image_id'")
    │      └ <function Logger.exception at 0x7fcee5551790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fced634e970>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:15:26.731 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49580 - "GET /buy_image?marketplace_id=d010bb18-168c-4998-ac27-0710eb697700 HTTP/1.1" 500
2022-01-08 01:17:43.819 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:17:43.820 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:17:43.820 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:17:43.921 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:17:43.921 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:17:43.922 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:17:43.922 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:17:43.923 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:17:43.923 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:17:43.924 | INFO     | uvicorn.server:serve:94 - Finished server process [939756]
2022-01-08 01:17:43.924 | INFO     | uvicorn.server:serve:94 - Finished server process [939756]
2022-01-08 01:17:43.925 | INFO     | uvicorn.server:serve:94 - Finished server process [939756]
2022-01-08 01:17:45.452 | INFO     | uvicorn.server:serve:84 - Started server process [940541]
2022-01-08 01:17:45.452 | INFO     | uvicorn.server:serve:84 - Started server process [940541]
2022-01-08 01:17:45.453 | INFO     | uvicorn.server:serve:84 - Started server process [940541]
2022-01-08 01:17:45.453 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:17:45.453 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:17:45.453 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:17:45.454 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:17:45.454 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:17:45.455 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:17:47.461 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:17:47.461 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:17:47.462 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:17:47.563 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:17:47.563 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:17:47.563 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:17:47.564 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:17:47.565 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:17:47.565 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:17:47.566 | INFO     | uvicorn.server:serve:94 - Finished server process [940541]
2022-01-08 01:17:47.566 | INFO     | uvicorn.server:serve:94 - Finished server process [940541]
2022-01-08 01:17:47.566 | INFO     | uvicorn.server:serve:94 - Finished server process [940541]
2022-01-08 01:17:51.542 | INFO     | uvicorn.server:serve:84 - Started server process [940650]
2022-01-08 01:17:51.543 | INFO     | uvicorn.server:serve:84 - Started server process [940650]
2022-01-08 01:17:51.543 | INFO     | uvicorn.server:serve:84 - Started server process [940650]
2022-01-08 01:17:51.543 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:17:51.544 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:17:51.544 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:17:51.544 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:17:51.545 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:17:51.545 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:17:54.741 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:17:54.852 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:17:54.950 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f04631019d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f04630e09d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f046393c610>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f04630e09d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0467e0b9d0>
          └ <fastapi.routing.APIRoute object at 0x7f0463102d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0463101550>
          └ <fastapi.routing.APIRoute object at 0x7f0463102d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f046311c130>
                     └ <function get_request_handler.<locals>.app at 0x7f04631014c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0467dfa5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7f046530cb80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f0463102d90>
                 └ <function run_in_threadpool at 0x7f0467fe6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7f0463110640>
                 │     │         └ <function run_sync at 0x7f04680039d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7f0463110640>
                 └ <function get_asynclib at 0x7f0468003310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'ResultIterator' object has no attribute 'save'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7f0463110640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f0462390c40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7f0465876f70>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 173, in buy_user_image
    image.save()
    └ <pynamodb.pagination.ResultIterator object at 0x7f0461651a90>

AttributeError: 'ResultIterator' object has no attribute 'save'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f04631087c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f046c9b0430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f046d7269d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f046d726040>
    └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f046c344340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
    │    └ <function subprocess_started at 0x7f046a20c160>
    └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f046c344430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f046a1fd550>
           │       │   └ <uvicorn.server.Server object at 0x7f046c344430>
           │       └ <function run at 0x7f046b3bc700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f046975a040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f0469783280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0469783310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0469b39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0468a6cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0469b39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>
          └ <fastapi.applications.FastAPI object at 0x7f0468a6cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f046311c100>
                     │    └ <function exception_handler at 0x7f046392e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0467e29db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f046311c100>
    │      │         └ AttributeError("'ResultIterator' object has no attribute 'save'")
    │      └ <function Logger.exception at 0x7f046c2d7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f04631087c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:17:54.986 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f04631019d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f04630e09d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f046393c610>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f04630e09d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0467e0b9d0>
          └ <fastapi.routing.APIRoute object at 0x7f0463102d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0463101550>
          └ <fastapi.routing.APIRoute object at 0x7f0463102d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f046311c130>
                     └ <function get_request_handler.<locals>.app at 0x7f04631014c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0467dfa5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7f046530cb80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f0463102d90>
                 └ <function run_in_threadpool at 0x7f0467fe6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7f0463110640>
                 │     │         └ <function run_sync at 0x7f04680039d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7f0463110640>
                 └ <function get_asynclib at 0x7f0468003310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'ResultIterator' object has no attribute 'save'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7f0463110640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f0462390c40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7f0465876f70>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 173, in buy_user_image
    image.save()
    └ <pynamodb.pagination.ResultIterator object at 0x7f0461651a90>

AttributeError: 'ResultIterator' object has no attribute 'save'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f04631087c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f046c9b0430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f046d7269d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f046d726040>
    └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f046c344340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
    │    └ <function subprocess_started at 0x7f046a20c160>
    └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f046c344430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f046a1fd550>
           │       │   └ <uvicorn.server.Server object at 0x7f046c344430>
           │       └ <function run at 0x7f046b3bc700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f046975a040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f0469783280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0469783310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0469b39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0468a6cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0469b39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>
          └ <fastapi.applications.FastAPI object at 0x7f0468a6cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f046311c100>
                     │    └ <function exception_handler at 0x7f046392e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0467e29db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f046311c100>
    │      │         └ AttributeError("'ResultIterator' object has no attribute 'save'")
    │      └ <function Logger.exception at 0x7f046c2d7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f04631087c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:17:55.006 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f04631019d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f04630e09d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f046393c610>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f04630e09d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0467e0b9d0>
          └ <fastapi.routing.APIRoute object at 0x7f0463102d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0463101a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0463101550>
          └ <fastapi.routing.APIRoute object at 0x7f0463102d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f046311c130>
                     └ <function get_request_handler.<locals>.app at 0x7f04631014c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0467dfa5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7f046530cb80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f0463102d90>
                 └ <function run_in_threadpool at 0x7f0467fe6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7f0463110640>
                 │     │         └ <function run_sync at 0x7f04680039d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7f0463110640>
                 └ <function get_asynclib at 0x7f0468003310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'ResultIterator' object has no attribute 'save'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f046530cb80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7f0463110640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f0462390c40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7f0465876f70>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 173, in buy_user_image
    image.save()
    └ <pynamodb.pagination.ResultIterator object at 0x7f0461651a90>

AttributeError: 'ResultIterator' object has no attribute 'save'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f04631087c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f046c9b0430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f046d7269d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f046d726040>
    └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f046c344340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
    │    └ <function subprocess_started at 0x7f046a20c160>
    └ <SpawnProcess name='SpawnProcess-1' parent=940613 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f046c344430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f046a1fd550>
           │       │   └ <uvicorn.server.Server object at 0x7f046c344430>
           │       └ <function run at 0x7f046b3bc700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f046975a040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f0469783280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0469783310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108ee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0469b39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0468a6cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0469b39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0463108e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f04631...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>
          └ <fastapi.applications.FastAPI object at 0x7f0468a6cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f046311c100>
                     │    └ <function exception_handler at 0x7f046392e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f04630e0a30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0467e29db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f046311c100>
    │      │         └ AttributeError("'ResultIterator' object has no attribute 'save'")
    │      └ <function Logger.exception at 0x7f046c2d7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f04631087c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:17:55.030 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49622 - "GET /buy_image?marketplace_id=d010bb18-168c-4998-ac27-0710eb697700 HTTP/1.1" 500
2022-01-08 01:18:26.212 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:26.213 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:26.214 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:26.314 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:18:26.314 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:18:26.315 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:18:26.315 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:18:26.316 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:18:26.316 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:18:26.317 | INFO     | uvicorn.server:serve:94 - Finished server process [940650]
2022-01-08 01:18:26.317 | INFO     | uvicorn.server:serve:94 - Finished server process [940650]
2022-01-08 01:18:26.317 | INFO     | uvicorn.server:serve:94 - Finished server process [940650]
2022-01-08 01:18:27.670 | INFO     | uvicorn.server:serve:84 - Started server process [940872]
2022-01-08 01:18:27.671 | INFO     | uvicorn.server:serve:84 - Started server process [940872]
2022-01-08 01:18:27.671 | INFO     | uvicorn.server:serve:84 - Started server process [940872]
2022-01-08 01:18:27.672 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:18:27.672 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:18:27.673 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:18:27.674 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:18:27.675 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:18:27.676 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:18:28.178 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:28.179 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:28.179 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:28.281 | INFO     | uvicorn.server:serve:94 - Finished server process [940872]
2022-01-08 01:18:28.281 | INFO     | uvicorn.server:serve:94 - Finished server process [940872]
2022-01-08 01:18:28.281 | INFO     | uvicorn.server:serve:94 - Finished server process [940872]
2022-01-08 01:18:28.284 | ERROR    | uvicorn.lifespan.on:send:132 - Traceback (most recent call last):
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 624, in lifespan
    await receive()
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/lifespan/on.py", line 135, in receive
    return await self.receive_queue.get()
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/queues.py", line 163, in get
    await getter
asyncio.exceptions.CancelledError

2022-01-08 01:18:28.284 | ERROR    | uvicorn.lifespan.on:send:132 - Traceback (most recent call last):
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 624, in lifespan
    await receive()
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/lifespan/on.py", line 135, in receive
    return await self.receive_queue.get()
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/queues.py", line 163, in get
    await getter
asyncio.exceptions.CancelledError

2022-01-08 01:18:28.284 | ERROR    | uvicorn.lifespan.on:send:132 - Traceback (most recent call last):
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 624, in lifespan
    await receive()
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/lifespan/on.py", line 135, in receive
    return await self.receive_queue.get()
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/queues.py", line 163, in get
    await getter
asyncio.exceptions.CancelledError

2022-01-08 01:18:32.696 | INFO     | uvicorn.server:serve:84 - Started server process [940965]
2022-01-08 01:18:32.697 | INFO     | uvicorn.server:serve:84 - Started server process [940965]
2022-01-08 01:18:32.698 | INFO     | uvicorn.server:serve:84 - Started server process [940965]
2022-01-08 01:18:32.698 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:18:32.698 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:18:32.699 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:18:32.699 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:18:32.700 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:18:32.700 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:18:35.967 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:18:36.104 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:18:36.236 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:18:36.446 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49668 - "GET /buy_image?marketplace_id=d010bb18-168c-4998-ac27-0710eb697700 HTTP/1.1" 201
2022-01-08 01:18:41.335 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:41.335 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:41.336 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:18:41.437 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:18:41.437 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:18:41.437 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:18:41.438 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:18:41.438 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:18:41.439 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:18:41.440 | INFO     | uvicorn.server:serve:94 - Finished server process [940965]
2022-01-08 01:18:41.440 | INFO     | uvicorn.server:serve:94 - Finished server process [940965]
2022-01-08 01:18:41.441 | INFO     | uvicorn.server:serve:94 - Finished server process [940965]
2022-01-08 01:27:59.248 | INFO     | uvicorn.server:serve:84 - Started server process [943306]
2022-01-08 01:27:59.248 | INFO     | uvicorn.server:serve:84 - Started server process [943306]
2022-01-08 01:27:59.249 | INFO     | uvicorn.server:serve:84 - Started server process [943306]
2022-01-08 01:27:59.249 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:27:59.249 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:27:59.249 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:27:59.250 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:27:59.250 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:27:59.250 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:28:10.285 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:28:10.393 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:28:10.477 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f14a05776d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f149fd1ba90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f14a4a469d0>
          └ <fastapi.routing.APIRoute object at 0x7f149fd3ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f149fd3b550>
          └ <fastapi.routing.APIRoute object at 0x7f149fd3ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f149fd561f0>
                     └ <function get_request_handler.<locals>.app at 0x7f149fd3b4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f14a4a355e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7f14a1f47b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f149fd3ce50>
                 └ <function run_in_threadpool at 0x7f14a4c21af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7f149fd50c40>
                 │     │         └ <function run_sync at 0x7f14a4c3e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7f149fd50c40>
                 └ <function get_asynclib at 0x7f14a4c3e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=401, detail='A user cannot buy their own image')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7f149fd50c40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f149ef6f5c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7f14a24b1ee0>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 153, in buy_user_image
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f149fd427c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f149fd3b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f149fd1ba90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f149fd561c0>
                     └ <function http_exception_handler at 0x7f14a056baf0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f14a4a64db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f149fd561c0>
    │      │         └ HTTPException(status_code=401, detail='A user cannot buy their own image')
    │      └ <function Logger.exception at 0x7f14a8f12790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f149fd427c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f149e28cc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f14a95eb430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f14aa3619d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f14aa361040>
    └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f14a8f7f340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
    │    └ <function subprocess_started at 0x7f14a6e46160>
    └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f14a8f7f430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f14a6e37550>
           │       │   └ <uvicorn.server.Server object at 0x7f14a8f7f430>
           │       └ <function run at 0x7f14a7ff7700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f14a6395040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f14a63bc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f14a63bc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14a6774df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f14a56a7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14a6774df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>
          └ <fastapi.applications.FastAPI object at 0x7f14a56a7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f149e28cb20>
                     │    └ <function exception_handler at 0x7f14a056b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f14a4a64db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f149e28cb20>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f14a8f12790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f149e28cc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:28:10.513 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f14a05776d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f149fd1ba90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f14a4a469d0>
          └ <fastapi.routing.APIRoute object at 0x7f149fd3ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f149fd3b550>
          └ <fastapi.routing.APIRoute object at 0x7f149fd3ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f149fd561f0>
                     └ <function get_request_handler.<locals>.app at 0x7f149fd3b4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f14a4a355e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7f14a1f47b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f149fd3ce50>
                 └ <function run_in_threadpool at 0x7f14a4c21af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7f149fd50c40>
                 │     │         └ <function run_sync at 0x7f14a4c3e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7f149fd50c40>
                 └ <function get_asynclib at 0x7f14a4c3e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=401, detail='A user cannot buy their own image')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7f149fd50c40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f149ef6f5c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7f14a24b1ee0>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 153, in buy_user_image
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f149fd427c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f149fd3b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f149fd1ba90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f149fd561c0>
                     └ <function http_exception_handler at 0x7f14a056baf0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f14a4a64db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f149fd561c0>
    │      │         └ HTTPException(status_code=401, detail='A user cannot buy their own image')
    │      └ <function Logger.exception at 0x7f14a8f12790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f149fd427c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f149e28cc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f14a95eb430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f14aa3619d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f14aa361040>
    └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f14a8f7f340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
    │    └ <function subprocess_started at 0x7f14a6e46160>
    └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f14a8f7f430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f14a6e37550>
           │       │   └ <uvicorn.server.Server object at 0x7f14a8f7f430>
           │       └ <function run at 0x7f14a7ff7700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f14a6395040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f14a63bc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f14a63bc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14a6774df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f14a56a7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14a6774df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>
          └ <fastapi.applications.FastAPI object at 0x7f14a56a7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f149e28cb20>
                     │    └ <function exception_handler at 0x7f14a056b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f14a4a64db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f149e28cb20>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f14a8f12790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f149e28cc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:28:10.536 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f14a05776d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f149fd1ba90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f14a4a469d0>
          └ <fastapi.routing.APIRoute object at 0x7f149fd3ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f149fd3ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f149fd3b550>
          └ <fastapi.routing.APIRoute object at 0x7f149fd3ce20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f149fd561f0>
                     └ <function get_request_handler.<locals>.app at 0x7f149fd3b4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f14a4a355e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<kaumil>, 'marketplace_id': 'd010bb18-168c-4998-ac27-0710eb697700'}
                 │                 │         └ <function buy_image at 0x7f14a1f47b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f149fd3ce50>
                 └ <function run_in_threadpool at 0x7f14a4c21af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │     │         │        └ <built-in method run of Context object at 0x7f149fd50c40>
                 │     │         └ <function run_sync at 0x7f14a4c3e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
                 │                                        └ <built-in method run of Context object at 0x7f149fd50c40>
                 └ <function get_asynclib at 0x7f14a4c3e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=401, detail='A user cannot buy their own image')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f14a1f47b80>, user=Users<kaumil>, marketplace_id='d010bb18-168c-4998-ac27-0710eb...
             │       │   └ <built-in method run of Context object at 0x7f149fd50c40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f149ef6f5c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<kaumil>
    │                               │              └ 'd010bb18-168c-4998-ac27-0710eb697700'
    │                               └ <function buy_user_image at 0x7f14a24b1ee0>
    └ 'd010bb18-168c-4998-ac27-0710eb697700'

  File "./app/models/models.py", line 153, in buy_user_image
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f149fd427c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f149fd3b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f149fd1ba90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f149fd561c0>
                     └ <function http_exception_handler at 0x7f14a056baf0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f14a4a64db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f149fd561c0>
    │      │         └ HTTPException(status_code=401, detail='A user cannot buy their own image')
    │      └ <function Logger.exception at 0x7f14a8f12790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f149fd427c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f149e28cc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f14a95eb430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f14aa3619d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f14aa361040>
    └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f14a8f7f340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
    │    └ <function subprocess_started at 0x7f14a6e46160>
    └ <SpawnProcess name='SpawnProcess-1' parent=943269 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f14a8f7f430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f14a6e37550>
           │       │   └ <uvicorn.server.Server object at 0x7f14a8f7f430>
           │       └ <function run at 0x7f14a7ff7700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f14a6395040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f14a63bc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f14a63bc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42fa0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14a6774df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f14a56a7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14a6774df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd42f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f149fd...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>
          └ <fastapi.applications.FastAPI object at 0x7f14a56a7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f149e28cb20>
                     │    └ <function exception_handler at 0x7f14a056b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f149fd1baf0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f14a4a64db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f149e28cb20>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f14a8f12790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f149e28cc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:28:10.561 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:49940 - "GET /buy_image?marketplace_id=d010bb18-168c-4998-ac27-0710eb697700 HTTP/1.1" 500
2022-01-08 01:29:34.457 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:29:34.457 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:29:34.458 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:29:34.559 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:29:34.560 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:29:34.561 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:29:34.562 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:29:34.563 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:29:34.564 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:29:34.565 | INFO     | uvicorn.server:serve:94 - Finished server process [943306]
2022-01-08 01:29:34.567 | INFO     | uvicorn.server:serve:94 - Finished server process [943306]
2022-01-08 01:29:34.568 | INFO     | uvicorn.server:serve:94 - Finished server process [943306]
2022-01-08 01:29:35.695 | INFO     | uvicorn.server:serve:84 - Started server process [943792]
2022-01-08 01:29:35.695 | INFO     | uvicorn.server:serve:84 - Started server process [943792]
2022-01-08 01:29:35.696 | INFO     | uvicorn.server:serve:84 - Started server process [943792]
2022-01-08 01:29:35.696 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:29:35.696 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:29:35.697 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:29:35.697 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:29:35.697 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:29:35.698 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:29:39.612 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:29:39.612 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:29:39.613 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:29:39.714 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:29:39.714 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:29:39.715 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:29:39.715 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:29:39.716 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:29:39.716 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:29:39.716 | INFO     | uvicorn.server:serve:94 - Finished server process [943792]
2022-01-08 01:29:39.717 | INFO     | uvicorn.server:serve:94 - Finished server process [943792]
2022-01-08 01:29:39.717 | INFO     | uvicorn.server:serve:94 - Finished server process [943792]
2022-01-08 01:29:41.643 | INFO     | uvicorn.server:serve:84 - Started server process [943898]
2022-01-08 01:29:41.643 | INFO     | uvicorn.server:serve:84 - Started server process [943898]
2022-01-08 01:29:41.644 | INFO     | uvicorn.server:serve:84 - Started server process [943898]
2022-01-08 01:29:41.644 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:29:41.644 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:29:41.645 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:29:41.645 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:29:41.646 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:29:41.647 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:29:52.788 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:29:52.900 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:29:53.006 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50012 - "GET /list_seller_images?username=kaumil HTTP/1.1" 200
2022-01-08 01:30:21.848 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:30:21.849 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:30:21.849 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:30:21.950 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:30:21.950 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:30:21.951 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:30:21.951 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:30:21.951 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:30:21.952 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:30:21.952 | INFO     | uvicorn.server:serve:94 - Finished server process [943898]
2022-01-08 01:30:21.952 | INFO     | uvicorn.server:serve:94 - Finished server process [943898]
2022-01-08 01:30:21.953 | INFO     | uvicorn.server:serve:94 - Finished server process [943898]
2022-01-08 01:30:58.912 | INFO     | uvicorn.server:serve:84 - Started server process [944978]
2022-01-08 01:30:58.913 | INFO     | uvicorn.server:serve:84 - Started server process [944978]
2022-01-08 01:30:58.913 | INFO     | uvicorn.server:serve:84 - Started server process [944978]
2022-01-08 01:30:58.913 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:30:58.913 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:30:58.914 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:30:58.914 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:30:58.914 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:30:58.915 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:31:01.266 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50114 - "GET /docs HTTP/1.1" 200
2022-01-08 01:31:01.655 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50114 - "GET /openapi.json HTTP/1.1" 200
2022-01-08 01:31:14.459 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-08 01:31:14.522 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:31:17.390 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:31:17.634 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:31:17.810 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50116 - "GET /sanity_check HTTP/1.1" 200
2022-01-08 01:31:30.538 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50286 - "POST /token HTTP/1.1" 200
2022-01-08 01:31:47.608 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50298 - "POST /signup HTTP/1.1" 201
2022-01-08 01:31:55.080 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50314 - "POST /signup HTTP/1.1" 201
2022-01-08 01:32:07.116 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50330 - "POST /token HTTP/1.1" 200
2022-01-08 01:32:38.370 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/c0d0518f-7958-417f-92a6-fd3874faf2c6.jpg
2022-01-08 01:32:38.492 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/68bc4c12-ed6f-4d87-ad99-d4e99f734665.jpg
2022-01-08 01:32:38.622 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/3e65ecce-32b2-4766-918d-a85a111a5668.jpg
2022-01-08 01:32:38.744 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/426b278a-0917-49c4-a4e7-1341690721bd.jpg
2022-01-08 01:32:38.969 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/9b0a0d11-943e-46b1-b5cd-72015f160e94.jpg
2022-01-08 01:32:39.005 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50344 - "POST /upload_images HTTP/1.1" 200
2022-01-08 01:33:12.563 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50448 - "GET /register_seller HTTP/1.1" 201
2022-01-08 01:33:39.055 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50470 - "GET /sell_image?image_id=da01e6f6-ab12-4478-86f2-4003a1ab4269&price=10 HTTP/1.1" 201
2022-01-08 01:33:59.285 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50498 - "POST /token HTTP/1.1" 200
2022-01-08 01:34:13.361 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50510 - "GET /list_seller_images?username=kaumil HTTP/1.1" 200
2022-01-08 01:34:23.380 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fd3cb597af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd3da340b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fd3da31c7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd3da340b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fd3de7eb9d0>
          └ <fastapi.routing.APIRoute object at 0x7fd3d9ae0f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fd3d9ae1550>
          └ <fastapi.routing.APIRoute object at 0x7fd3d9ae0f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fd3cba00c70>
                     └ <function get_request_handler.<locals>.app at 0x7fd3d9ae14c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fd3de7da5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7fd3dbcedb80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fd3d9ae0f40>
                 └ <function run_in_threadpool at 0x7fd3de9c6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7fd3d9ae9680>
                 │     │         └ <function run_sync at 0x7fd3de9e39d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7fd3d9ae9680>
                 └ <function get_asynclib at 0x7fd3de9e3310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'str' object has no attribute 'credit'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7fd3d9ae9680>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fd3cba79980>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7fd3dc256ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 172, in buy_user_image
    seller.credit += value
    │                └ 10
    └ '3'

AttributeError: 'str' object has no attribute 'credit'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fd3cba00b20>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fd3e338f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fd3e41059d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fd3e4105040>
    └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fd3e2d24340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
    │    └ <function subprocess_started at 0x7fd3e0beb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fd3e2d24430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fd3e0bdd550>
           │       │   └ <uvicorn.server.Server object at 0x7fd3e2d24430>
           │       └ <function run at 0x7fd3e1d9c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd3e0139040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fd3e0165280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fd3e0165310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd3e0519df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fd3df44cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd3e0519df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>
          └ <fastapi.applications.FastAPI object at 0x7fd3df44cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fd3cba00af0>
                     │    └ <function exception_handler at 0x7fd3da3100d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fd3de809e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fd3cba00af0>
    │      │         └ AttributeError("'str' object has no attribute 'credit'")
    │      └ <function Logger.exception at 0x7fd3e2cb7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fd3cba00b20>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:34:23.404 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fd3cb597af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd3da340b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fd3da31c7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd3da340b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fd3de7eb9d0>
          └ <fastapi.routing.APIRoute object at 0x7fd3d9ae0f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fd3d9ae1550>
          └ <fastapi.routing.APIRoute object at 0x7fd3d9ae0f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fd3cba00c70>
                     └ <function get_request_handler.<locals>.app at 0x7fd3d9ae14c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fd3de7da5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7fd3dbcedb80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fd3d9ae0f40>
                 └ <function run_in_threadpool at 0x7fd3de9c6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7fd3d9ae9680>
                 │     │         └ <function run_sync at 0x7fd3de9e39d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7fd3d9ae9680>
                 └ <function get_asynclib at 0x7fd3de9e3310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'str' object has no attribute 'credit'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7fd3d9ae9680>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fd3cba79980>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7fd3dc256ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 172, in buy_user_image
    seller.credit += value
    │                └ 10
    └ '3'

AttributeError: 'str' object has no attribute 'credit'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fd3cba00b20>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fd3e338f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fd3e41059d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fd3e4105040>
    └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fd3e2d24340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
    │    └ <function subprocess_started at 0x7fd3e0beb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fd3e2d24430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fd3e0bdd550>
           │       │   └ <uvicorn.server.Server object at 0x7fd3e2d24430>
           │       └ <function run at 0x7fd3e1d9c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd3e0139040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fd3e0165280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fd3e0165310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd3e0519df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fd3df44cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd3e0519df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>
          └ <fastapi.applications.FastAPI object at 0x7fd3df44cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fd3cba00af0>
                     │    └ <function exception_handler at 0x7fd3da3100d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fd3de809e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fd3cba00af0>
    │      │         └ AttributeError("'str' object has no attribute 'credit'")
    │      └ <function Logger.exception at 0x7fd3e2cb7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fd3cba00b20>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:34:23.421 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fd3cb597af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd3da340b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fd3da31c7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd3da340b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fd3de7eb9d0>
          └ <fastapi.routing.APIRoute object at 0x7fd3d9ae0f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd3cb597ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fd3d9ae1550>
          └ <fastapi.routing.APIRoute object at 0x7fd3d9ae0f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fd3cba00c70>
                     └ <function get_request_handler.<locals>.app at 0x7fd3d9ae14c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fd3de7da5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7fd3dbcedb80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fd3d9ae0f40>
                 └ <function run_in_threadpool at 0x7fd3de9c6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7fd3d9ae9680>
                 │     │         └ <function run_sync at 0x7fd3de9e39d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7fd3d9ae9680>
                 └ <function get_asynclib at 0x7fd3de9e3310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'str' object has no attribute 'credit'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fd3dbcedb80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7fd3d9ae9680>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fd3cba79980>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7fd3dc256ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 172, in buy_user_image
    seller.credit += value
    │                └ 10
    └ '3'

AttributeError: 'str' object has no attribute 'credit'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fd3cba00b20>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fd3e338f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fd3e41059d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fd3e4105040>
    └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fd3e2d24340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
    │    └ <function subprocess_started at 0x7fd3e0beb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fd3e2d24430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fd3e0bdd550>
           │       │   └ <uvicorn.server.Server object at 0x7fd3e2d24430>
           │       └ <function run at 0x7fd3e1d9c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd3e0139040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fd3e0165280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fd3e0165310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d60>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd3e0519df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fd3df44cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd3e0519df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba00d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd3cba...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>
          └ <fastapi.applications.FastAPI object at 0x7fd3df44cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fd3cba00af0>
                     │    └ <function exception_handler at 0x7fd3da3100d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd3da340be0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fd3de809e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fd3cba00af0>
    │      │         └ AttributeError("'str' object has no attribute 'credit'")
    │      └ <function Logger.exception at 0x7fd3e2cb7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fd3cba00b20>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:34:23.447 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50532 - "GET /buy_image?marketplace_id=946e8a39-1366-4139-a273-1e7ae80efea2 HTTP/1.1" 500
2022-01-08 01:35:53.447 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:35:53.447 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:35:53.448 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:35:53.549 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:35:53.550 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:35:53.550 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:35:53.552 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:35:53.553 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:35:53.554 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:35:53.556 | INFO     | uvicorn.server:serve:94 - Finished server process [944978]
2022-01-08 01:35:53.558 | INFO     | uvicorn.server:serve:94 - Finished server process [944978]
2022-01-08 01:35:53.559 | INFO     | uvicorn.server:serve:94 - Finished server process [944978]
2022-01-08 01:35:54.874 | INFO     | uvicorn.server:serve:84 - Started server process [946967]
2022-01-08 01:35:54.875 | INFO     | uvicorn.server:serve:84 - Started server process [946967]
2022-01-08 01:35:54.875 | INFO     | uvicorn.server:serve:84 - Started server process [946967]
2022-01-08 01:35:54.876 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:35:54.876 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:35:54.878 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:35:54.879 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:35:54.882 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:35:54.883 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:36:04.092 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:36:04.204 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:36:04.314 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fca1e6dd9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fca1e6bcb50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fca1ef18790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fca1e6bcb50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fca233e79d0>
          └ <fastapi.routing.APIRoute object at 0x7fca1e6dcee0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fca1e6dd550>
          └ <fastapi.routing.APIRoute object at 0x7fca1e6dcee0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fca1e6f72b0>
                     └ <function get_request_handler.<locals>.app at 0x7fca1e6dd4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fca233d65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7fca208e8b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fca1e6dcf10>
                 └ <function run_in_threadpool at 0x7fca235c2af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7fca1e6efac0>
                 │     │         └ <function run_sync at 0x7fca235df9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7fca1e6efac0>
                 └ <function get_asynclib at 0x7fca235df310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7fca1e6efac0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fca1d9742c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7fca20e52ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 149, in buy_user_image
    seller = list(Users.query(marketplace_item.seller_id))[0]
                  │     │     │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7fca20e518b0>
                  │     │     └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7fca20e49f10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fca1e6e3a60>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fca27f8c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fca28d029d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fca28d02040>
    └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fca27920340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
    │    └ <function subprocess_started at 0x7fca257e7160>
    └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fca27920430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fca257d8550>
           │       │   └ <uvicorn.server.Server object at 0x7fca27920430>
           │       └ <function run at 0x7fca26998700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fca24d36040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fca24d61280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fca24d61310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fca25115df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fca24048f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fca25115df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>
          └ <fastapi.applications.FastAPI object at 0x7fca24048f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fca1e6f7280>
                     │    └ <function exception_handler at 0x7fca1ef0a0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fca23405db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fca1e6f7280>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7fca278b3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fca1e6e3a60>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:36:04.342 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fca1e6dd9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fca1e6bcb50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fca1ef18790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fca1e6bcb50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fca233e79d0>
          └ <fastapi.routing.APIRoute object at 0x7fca1e6dcee0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fca1e6dd550>
          └ <fastapi.routing.APIRoute object at 0x7fca1e6dcee0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fca1e6f72b0>
                     └ <function get_request_handler.<locals>.app at 0x7fca1e6dd4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fca233d65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7fca208e8b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fca1e6dcf10>
                 └ <function run_in_threadpool at 0x7fca235c2af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7fca1e6efac0>
                 │     │         └ <function run_sync at 0x7fca235df9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7fca1e6efac0>
                 └ <function get_asynclib at 0x7fca235df310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7fca1e6efac0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fca1d9742c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7fca20e52ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 149, in buy_user_image
    seller = list(Users.query(marketplace_item.seller_id))[0]
                  │     │     │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7fca20e518b0>
                  │     │     └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7fca20e49f10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fca1e6e3a60>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fca27f8c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fca28d029d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fca28d02040>
    └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fca27920340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
    │    └ <function subprocess_started at 0x7fca257e7160>
    └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fca27920430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fca257d8550>
           │       │   └ <uvicorn.server.Server object at 0x7fca27920430>
           │       └ <function run at 0x7fca26998700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fca24d36040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fca24d61280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fca24d61310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fca25115df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fca24048f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fca25115df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>
          └ <fastapi.applications.FastAPI object at 0x7fca24048f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fca1e6f7280>
                     │    └ <function exception_handler at 0x7fca1ef0a0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fca23405db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fca1e6f7280>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7fca278b3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fca1e6e3a60>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:36:04.366 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fca1e6dd9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fca1e6bcb50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fca1ef18790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fca1e6bcb50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fca233e79d0>
          └ <fastapi.routing.APIRoute object at 0x7fca1e6dcee0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fca1e6dda60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fca1e6dd550>
          └ <fastapi.routing.APIRoute object at 0x7fca1e6dcee0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fca1e6f72b0>
                     └ <function get_request_handler.<locals>.app at 0x7fca1e6dd4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fca233d65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7fca208e8b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fca1e6dcf10>
                 └ <function run_in_threadpool at 0x7fca235c2af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7fca1e6efac0>
                 │     │         └ <function run_sync at 0x7fca235df9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7fca1e6efac0>
                 └ <function get_asynclib at 0x7fca235df310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7fca208e8b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7fca1e6efac0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fca1d9742c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7fca20e52ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 149, in buy_user_image
    seller = list(Users.query(marketplace_item.seller_id))[0]
                  │     │     │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7fca20e518b0>
                  │     │     └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7fca20e49f10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fca1e6e3a60>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fca27f8c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fca28d029d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fca28d02040>
    └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fca27920340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
    │    └ <function subprocess_started at 0x7fca257e7160>
    └ <SpawnProcess name='SpawnProcess-3' parent=944941 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fca27920430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fca257d8550>
           │       │   └ <uvicorn.server.Server object at 0x7fca27920430>
           │       └ <function run at 0x7fca26998700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fca24d36040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fca24d61280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fca24d61310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70a0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fca25115df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fca24048f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fca25115df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6f70...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fca1e6...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>
          └ <fastapi.applications.FastAPI object at 0x7fca24048f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fca1e6f7280>
                     │    └ <function exception_handler at 0x7fca1ef0a0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fca1e6bcbb0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fca23405db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fca1e6f7280>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7fca278b3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fca1e6e3a60>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:36:04.389 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50574 - "GET /buy_image?marketplace_id=946e8a39-1366-4139-a273-1e7ae80efea2 HTTP/1.1" 500
2022-01-08 01:37:05.024 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:05.025 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:05.026 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:05.128 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:05.128 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:05.128 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:05.129 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:05.129 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:05.130 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:05.131 | INFO     | uvicorn.server:serve:94 - Finished server process [946967]
2022-01-08 01:37:05.132 | INFO     | uvicorn.server:serve:94 - Finished server process [946967]
2022-01-08 01:37:05.132 | INFO     | uvicorn.server:serve:94 - Finished server process [946967]
2022-01-08 01:37:06.604 | INFO     | uvicorn.server:serve:84 - Started server process [947354]
2022-01-08 01:37:06.605 | INFO     | uvicorn.server:serve:84 - Started server process [947354]
2022-01-08 01:37:06.606 | INFO     | uvicorn.server:serve:84 - Started server process [947354]
2022-01-08 01:37:06.608 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:06.610 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:06.611 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:06.612 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:06.613 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:06.614 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:09.122 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:09.122 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:09.122 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:09.222 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:09.223 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:09.223 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:09.224 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:09.226 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:09.227 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:09.227 | INFO     | uvicorn.server:serve:94 - Finished server process [947354]
2022-01-08 01:37:09.227 | INFO     | uvicorn.server:serve:94 - Finished server process [947354]
2022-01-08 01:37:09.228 | INFO     | uvicorn.server:serve:94 - Finished server process [947354]
2022-01-08 01:37:11.392 | INFO     | uvicorn.server:serve:84 - Started server process [947473]
2022-01-08 01:37:11.395 | INFO     | uvicorn.server:serve:84 - Started server process [947473]
2022-01-08 01:37:11.397 | INFO     | uvicorn.server:serve:84 - Started server process [947473]
2022-01-08 01:37:11.398 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:11.399 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:11.400 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:11.402 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:11.403 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:11.404 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:12.991 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:37:13.101 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:37:13.197 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f72a95de9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f72a95bdac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f72a9e19700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f72a95bdac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f72ae2e89d0>
          └ <fastapi.routing.APIRoute object at 0x7f72a95dde50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f72a95de550>
          └ <fastapi.routing.APIRoute object at 0x7f72a95dde50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f72a95f8220>
                     └ <function get_request_handler.<locals>.app at 0x7f72a95de4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f72ae2d75e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f72ab7e9b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f72a95dde80>
                 └ <function run_in_threadpool at 0x7f72ae4c3af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f72a95f0bc0>
                 │     │         └ <function run_sync at 0x7f72ae4e09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f72a95f0bc0>
                 └ <function get_asynclib at 0x7f72ae4e0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f72a95f0bc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f72ab3f38c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f72abd53ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 149, in buy_user_image
    seller = list(Users.query(str(marketplace_item.seller_id)))[0]
                  │     │         │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7f72abd528b0>
                  │     │         └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7f72abd4af10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f72a8810460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f72b2e8d430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f72b3c039d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f72b3c03040>
    └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f72b2821340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
    │    └ <function subprocess_started at 0x7f72b06e8160>
    └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f72b2821430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f72b06da550>
           │       │   └ <uvicorn.server.Server object at 0x7f72b2821430>
           │       └ <function run at 0x7f72b1899700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f72afc36040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f72afc62280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f72afc62310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f72b0016df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f72aef49f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f72b0016df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>
          └ <fastapi.applications.FastAPI object at 0x7f72aef49f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f72a95e4af0>
                     │    └ <function exception_handler at 0x7f72a9e0b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f72ae306d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f72a95e4af0>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7f72b27b4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f72a8810460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:37:13.228 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f72a95de9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f72a95bdac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f72a9e19700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f72a95bdac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f72ae2e89d0>
          └ <fastapi.routing.APIRoute object at 0x7f72a95dde50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f72a95de550>
          └ <fastapi.routing.APIRoute object at 0x7f72a95dde50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f72a95f8220>
                     └ <function get_request_handler.<locals>.app at 0x7f72a95de4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f72ae2d75e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f72ab7e9b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f72a95dde80>
                 └ <function run_in_threadpool at 0x7f72ae4c3af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f72a95f0bc0>
                 │     │         └ <function run_sync at 0x7f72ae4e09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f72a95f0bc0>
                 └ <function get_asynclib at 0x7f72ae4e0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f72a95f0bc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f72ab3f38c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f72abd53ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 149, in buy_user_image
    seller = list(Users.query(str(marketplace_item.seller_id)))[0]
                  │     │         │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7f72abd528b0>
                  │     │         └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7f72abd4af10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f72a8810460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f72b2e8d430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f72b3c039d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f72b3c03040>
    └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f72b2821340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
    │    └ <function subprocess_started at 0x7f72b06e8160>
    └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f72b2821430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f72b06da550>
           │       │   └ <uvicorn.server.Server object at 0x7f72b2821430>
           │       └ <function run at 0x7f72b1899700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f72afc36040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f72afc62280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f72afc62310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f72b0016df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f72aef49f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f72b0016df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>
          └ <fastapi.applications.FastAPI object at 0x7f72aef49f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f72a95e4af0>
                     │    └ <function exception_handler at 0x7f72a9e0b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f72ae306d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f72a95e4af0>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7f72b27b4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f72a8810460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:37:13.248 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f72a95de9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f72a95bdac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f72a9e19700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f72a95bdac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f72ae2e89d0>
          └ <fastapi.routing.APIRoute object at 0x7f72a95dde50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f72a95dea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f72a95de550>
          └ <fastapi.routing.APIRoute object at 0x7f72a95dde50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f72a95f8220>
                     └ <function get_request_handler.<locals>.app at 0x7f72a95de4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f72ae2d75e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f72ab7e9b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f72a95dde80>
                 └ <function run_in_threadpool at 0x7f72ae4c3af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f72a95f0bc0>
                 │     │         └ <function run_sync at 0x7f72ae4e09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f72a95f0bc0>
                 └ <function get_asynclib at 0x7f72ae4e0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f72ab7e9b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f72a95f0bc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f72ab3f38c0>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f72abd53ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 149, in buy_user_image
    seller = list(Users.query(str(marketplace_item.seller_id)))[0]
                  │     │         │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7f72abd528b0>
                  │     │         └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7f72abd4af10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f72a8810460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f72b2e8d430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f72b3c039d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f72b3c03040>
    └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f72b2821340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
    │    └ <function subprocess_started at 0x7f72b06e8160>
    └ <SpawnProcess name='SpawnProcess-1' parent=947431 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f72b2821430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f72b06da550>
           │       │   └ <uvicorn.server.Server object at 0x7f72b2821430>
           │       └ <function run at 0x7f72b1899700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f72afc36040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f72afc62280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f72afc62310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f72b0016df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f72aef49f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f72b0016df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95e4f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f72a95...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>
          └ <fastapi.applications.FastAPI object at 0x7f72aef49f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f72a95e4af0>
                     │    └ <function exception_handler at 0x7f72a9e0b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f72a95bdb20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f72ae306d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f72a95e4af0>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7f72b27b4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f72a8810460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:37:13.268 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50650 - "GET /buy_image?marketplace_id=946e8a39-1366-4139-a273-1e7ae80efea2 HTTP/1.1" 500
2022-01-08 01:37:45.464 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:45.465 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:45.466 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:45.568 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:45.569 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:45.570 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:45.571 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:45.572 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:45.572 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:45.573 | INFO     | uvicorn.server:serve:94 - Finished server process [947473]
2022-01-08 01:37:45.573 | INFO     | uvicorn.server:serve:94 - Finished server process [947473]
2022-01-08 01:37:45.574 | INFO     | uvicorn.server:serve:94 - Finished server process [947473]
2022-01-08 01:37:46.938 | INFO     | uvicorn.server:serve:84 - Started server process [947679]
2022-01-08 01:37:46.938 | INFO     | uvicorn.server:serve:84 - Started server process [947679]
2022-01-08 01:37:46.939 | INFO     | uvicorn.server:serve:84 - Started server process [947679]
2022-01-08 01:37:46.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:46.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:46.940 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:46.941 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:46.941 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:46.942 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:48.246 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:48.247 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:48.247 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:37:48.348 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:48.349 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:48.349 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:37:48.349 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:48.350 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:48.351 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:37:48.351 | INFO     | uvicorn.server:serve:94 - Finished server process [947679]
2022-01-08 01:37:48.351 | INFO     | uvicorn.server:serve:94 - Finished server process [947679]
2022-01-08 01:37:48.352 | INFO     | uvicorn.server:serve:94 - Finished server process [947679]
2022-01-08 01:37:50.733 | INFO     | uvicorn.server:serve:84 - Started server process [947765]
2022-01-08 01:37:50.734 | INFO     | uvicorn.server:serve:84 - Started server process [947765]
2022-01-08 01:37:50.736 | INFO     | uvicorn.server:serve:84 - Started server process [947765]
2022-01-08 01:37:50.737 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:50.738 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:50.739 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:37:50.740 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:50.743 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:50.744 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:37:51.612 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:37:51.717 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:37:51.815 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f9d9bfe19d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9d9bfc0ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f9da083a700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9d9bfc0ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f9da4d099d0>
          └ <fastapi.routing.APIRoute object at 0x7f9d9bfe0e50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f9d9bfe1550>
          └ <fastapi.routing.APIRoute object at 0x7f9d9bfe0e50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f9d9bffb220>
                     └ <function get_request_handler.<locals>.app at 0x7f9d9bfe14c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f9da4cf85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f9da220ab80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f9d9bfe0e80>
                 └ <function run_in_threadpool at 0x7f9da4ee4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f9d9b2fc500>
                 │     │         └ <function run_sync at 0x7f9da4f019d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f9d9b2fc500>
                 └ <function get_asynclib at 0x7f9da4f01310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f9d9b2fc500>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f9d9b270e40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f9da2774ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 150, in buy_user_image
    seller = list(Users.query(str(marketplace_item.seller_id)))[0]
                  │     │         │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7f9da27738b0>
                  │     │         └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7f9da276bf10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f9d9b214460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f9da98ad430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f9daa6249d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f9daa624040>
    └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f9da9242340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
    │    └ <function subprocess_started at 0x7f9da7109160>
    └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f9da9242430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9da70fb550>
           │       │   └ <uvicorn.server.Server object at 0x7f9da9242430>
           │       └ <function run at 0x7f9da82ba700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9da6657040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9da6683280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9da6683310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9da6a37df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9da596af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9da6a37df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>
          └ <fastapi.applications.FastAPI object at 0x7f9da596af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f9da6a37d00>
                     │    └ <function exception_handler at 0x7f9da082d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9da4d28cc0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f9da6a37d00>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7f9da91d5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f9d9b214460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:37:51.841 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f9d9bfe19d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9d9bfc0ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f9da083a700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9d9bfc0ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f9da4d099d0>
          └ <fastapi.routing.APIRoute object at 0x7f9d9bfe0e50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f9d9bfe1550>
          └ <fastapi.routing.APIRoute object at 0x7f9d9bfe0e50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f9d9bffb220>
                     └ <function get_request_handler.<locals>.app at 0x7f9d9bfe14c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f9da4cf85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f9da220ab80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f9d9bfe0e80>
                 └ <function run_in_threadpool at 0x7f9da4ee4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f9d9b2fc500>
                 │     │         └ <function run_sync at 0x7f9da4f019d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f9d9b2fc500>
                 └ <function get_asynclib at 0x7f9da4f01310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f9d9b2fc500>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f9d9b270e40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f9da2774ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 150, in buy_user_image
    seller = list(Users.query(str(marketplace_item.seller_id)))[0]
                  │     │         │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7f9da27738b0>
                  │     │         └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7f9da276bf10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f9d9b214460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f9da98ad430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f9daa6249d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f9daa624040>
    └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f9da9242340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
    │    └ <function subprocess_started at 0x7f9da7109160>
    └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f9da9242430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9da70fb550>
           │       │   └ <uvicorn.server.Server object at 0x7f9da9242430>
           │       └ <function run at 0x7f9da82ba700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9da6657040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9da6683280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9da6683310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9da6a37df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9da596af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9da6a37df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>
          └ <fastapi.applications.FastAPI object at 0x7f9da596af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f9da6a37d00>
                     │    └ <function exception_handler at 0x7f9da082d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9da4d28cc0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f9da6a37d00>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7f9da91d5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f9d9b214460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:37:51.859 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f9d9bfe19d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9d9bfc0ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f9da083a700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9d9bfc0ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f9da4d099d0>
          └ <fastapi.routing.APIRoute object at 0x7f9d9bfe0e50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9d9bfe1a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f9d9bfe1550>
          └ <fastapi.routing.APIRoute object at 0x7f9d9bfe0e50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f9d9bffb220>
                     └ <function get_request_handler.<locals>.app at 0x7f9d9bfe14c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f9da4cf85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f9da220ab80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f9d9bfe0e80>
                 └ <function run_in_threadpool at 0x7f9da4ee4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f9d9b2fc500>
                 │     │         └ <function run_sync at 0x7f9da4f019d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f9d9b2fc500>
                 └ <function get_asynclib at 0x7f9da4f01310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=IndexError('list index out of range')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f9da220ab80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f9d9b2fc500>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f9d9b270e40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f9da2774ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 150, in buy_user_image
    seller = list(Users.query(str(marketplace_item.seller_id)))[0]
                  │     │         │                └ <pynamodb.attributes.UnicodeAttribute object at 0x7f9da27738b0>
                  │     │         └ Market<946e8a39-1366-4139-a273-1e7ae80efea2>
                  │     └ <classmethod object at 0x7f9da276bf10>
                  └ <class 'app.models.models.Users'>

IndexError: list index out of range


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f9d9b214460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f9da98ad430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f9daa6249d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f9daa624040>
    └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f9da9242340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
    │    └ <function subprocess_started at 0x7f9da7109160>
    └ <SpawnProcess name='SpawnProcess-1' parent=947728 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f9da9242430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9da70fb550>
           │       │   └ <uvicorn.server.Server object at 0x7f9da9242430>
           │       └ <function run at 0x7f9da82ba700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9da6657040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9da6683280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9da6683310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9da6a37df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9da596af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9da6a37df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bfe7f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9d9bf...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>
          └ <fastapi.applications.FastAPI object at 0x7f9da596af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f9da6a37d00>
                     │    └ <function exception_handler at 0x7f9da082d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9d9bfc0b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9da4d28cc0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f9da6a37d00>
    │      │         └ IndexError('list index out of range')
    │      └ <function Logger.exception at 0x7f9da91d5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f9d9b214460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:37:51.878 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50708 - "GET /buy_image?marketplace_id=946e8a39-1366-4139-a273-1e7ae80efea2 HTTP/1.1" 500
2022-01-08 01:38:18.360 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:18.360 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:18.361 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:18.462 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:18.463 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:18.464 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:18.465 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:18.465 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:18.466 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:18.466 | INFO     | uvicorn.server:serve:94 - Finished server process [947765]
2022-01-08 01:38:18.467 | INFO     | uvicorn.server:serve:94 - Finished server process [947765]
2022-01-08 01:38:18.468 | INFO     | uvicorn.server:serve:94 - Finished server process [947765]
2022-01-08 01:38:19.697 | INFO     | uvicorn.server:serve:84 - Started server process [947937]
2022-01-08 01:38:19.697 | INFO     | uvicorn.server:serve:84 - Started server process [947937]
2022-01-08 01:38:19.698 | INFO     | uvicorn.server:serve:84 - Started server process [947937]
2022-01-08 01:38:19.698 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:19.699 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:19.699 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:19.700 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:19.700 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:19.701 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:35.238 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:35.239 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:35.240 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:35.341 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:35.342 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:35.342 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:35.343 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:35.345 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:35.346 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:35.347 | INFO     | uvicorn.server:serve:94 - Finished server process [947937]
2022-01-08 01:38:35.348 | INFO     | uvicorn.server:serve:94 - Finished server process [947937]
2022-01-08 01:38:35.348 | INFO     | uvicorn.server:serve:94 - Finished server process [947937]
2022-01-08 01:38:36.610 | INFO     | uvicorn.server:serve:84 - Started server process [948070]
2022-01-08 01:38:36.611 | INFO     | uvicorn.server:serve:84 - Started server process [948070]
2022-01-08 01:38:36.611 | INFO     | uvicorn.server:serve:84 - Started server process [948070]
2022-01-08 01:38:36.612 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:36.612 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:36.612 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:36.614 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:36.614 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:36.615 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:38.320 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:38.320 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:38.322 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:38.422 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:38.424 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:38.425 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:38.427 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:38.428 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:38.429 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:38.429 | INFO     | uvicorn.server:serve:94 - Finished server process [948070]
2022-01-08 01:38:38.430 | INFO     | uvicorn.server:serve:94 - Finished server process [948070]
2022-01-08 01:38:38.430 | INFO     | uvicorn.server:serve:94 - Finished server process [948070]
2022-01-08 01:38:39.773 | INFO     | uvicorn.server:serve:84 - Started server process [948120]
2022-01-08 01:38:39.774 | INFO     | uvicorn.server:serve:84 - Started server process [948120]
2022-01-08 01:38:39.775 | INFO     | uvicorn.server:serve:84 - Started server process [948120]
2022-01-08 01:38:39.775 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:39.776 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:39.776 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:39.777 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:39.778 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:39.779 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:40.180 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:40.181 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:40.181 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:40.282 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:40.282 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:40.282 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:40.283 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:40.284 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:40.285 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:40.285 | INFO     | uvicorn.server:serve:94 - Finished server process [948120]
2022-01-08 01:38:40.286 | INFO     | uvicorn.server:serve:94 - Finished server process [948120]
2022-01-08 01:38:40.286 | INFO     | uvicorn.server:serve:94 - Finished server process [948120]
2022-01-08 01:38:42.442 | INFO     | uvicorn.server:serve:84 - Started server process [948178]
2022-01-08 01:38:42.443 | INFO     | uvicorn.server:serve:84 - Started server process [948178]
2022-01-08 01:38:42.444 | INFO     | uvicorn.server:serve:84 - Started server process [948178]
2022-01-08 01:38:42.444 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:42.445 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:42.445 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:42.448 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:42.449 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:42.449 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:43.466 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:38:43.590 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:38:43.723 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:38:43.899 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50760 - "GET /buy_image?marketplace_id=946e8a39-1366-4139-a273-1e7ae80efea2 HTTP/1.1" 201
2022-01-08 01:38:57.521 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:57.522 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:57.522 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:38:57.623 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:57.623 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:57.624 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:38:57.624 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:57.625 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:57.625 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:38:57.625 | INFO     | uvicorn.server:serve:94 - Finished server process [948178]
2022-01-08 01:38:57.626 | INFO     | uvicorn.server:serve:94 - Finished server process [948178]
2022-01-08 01:38:57.626 | INFO     | uvicorn.server:serve:94 - Finished server process [948178]
2022-01-08 01:38:58.912 | INFO     | uvicorn.server:serve:84 - Started server process [948345]
2022-01-08 01:38:58.913 | INFO     | uvicorn.server:serve:84 - Started server process [948345]
2022-01-08 01:38:58.914 | INFO     | uvicorn.server:serve:84 - Started server process [948345]
2022-01-08 01:38:58.914 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:58.915 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:58.915 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:38:58.916 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:58.917 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:38:58.917 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:24.473 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:39:24.474 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:39:24.475 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:39:24.576 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:39:24.577 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:39:24.577 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:39:24.579 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:39:24.580 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:39:24.581 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:39:24.582 | INFO     | uvicorn.server:serve:94 - Finished server process [948345]
2022-01-08 01:39:24.582 | INFO     | uvicorn.server:serve:94 - Finished server process [948345]
2022-01-08 01:39:24.582 | INFO     | uvicorn.server:serve:94 - Finished server process [948345]
2022-01-08 01:39:25.916 | INFO     | uvicorn.server:serve:84 - Started server process [948542]
2022-01-08 01:39:25.917 | INFO     | uvicorn.server:serve:84 - Started server process [948542]
2022-01-08 01:39:25.917 | INFO     | uvicorn.server:serve:84 - Started server process [948542]
2022-01-08 01:39:25.918 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:39:25.918 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:39:25.918 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:39:25.919 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:25.919 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:25.919 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:28.119 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:39:28.228 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:39:28.321 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f73cecc67f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f73ce46abb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f73d31959d0>
          └ <fastapi.routing.APIRoute object at 0x7f73ce48af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f73ce48b550>
          └ <fastapi.routing.APIRoute object at 0x7f73ce48af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f73ce4a5310>
                     └ <function get_request_handler.<locals>.app at 0x7f73ce48b4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f73d31845e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f73d0696b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f73ce48af70>
                 └ <function run_in_threadpool at 0x7f73d3370af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f73cd755c80>
                 │     │         └ <function run_sync at 0x7f73d338d9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f73cd755c80>
                 └ <function get_asynclib at 0x7f73d338d310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=401, detail='Image already sold')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f73cd755c80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f73cd755d40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f73d0c00ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 153, in buy_user_image
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f73ce4919a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f73ce48b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f73ce46abb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f73ce4a52e0>
                     └ <function http_exception_handler at 0x7f73cecb8af0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f73d31b3e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f73ce4a52e0>
    │      │         └ HTTPException(status_code=401, detail='Image already sold')
    │      └ <function Logger.exception at 0x7f73d7661790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f73ce4919a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f73cc9dbd90>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f73d7d3a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f73d8ab09d0>
           └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f73d8ab0040>
    └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f73d76ce340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
    │    └ <function subprocess_started at 0x7f73d5594160>
    └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f73d76ce430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f73d5585550>
           │       │   └ <uvicorn.server.Server object at 0x7f73d76ce430>
           │       └ <function run at 0x7f73d6746700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f73d4ae4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f73d4b0f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f73d4b0f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f73d4ec3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f73d3df6f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f73d4ec3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>
          └ <fastapi.applications.FastAPI object at 0x7f73d3df6f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f73cc9dbaf0>
                     │    └ <function exception_handler at 0x7f73cecb80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f73d31b3e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f73cc9dbaf0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f73d7661790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f73cc9dbd90>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:39:28.349 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f73cecc67f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f73ce46abb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f73d31959d0>
          └ <fastapi.routing.APIRoute object at 0x7f73ce48af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f73ce48b550>
          └ <fastapi.routing.APIRoute object at 0x7f73ce48af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f73ce4a5310>
                     └ <function get_request_handler.<locals>.app at 0x7f73ce48b4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f73d31845e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f73d0696b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f73ce48af70>
                 └ <function run_in_threadpool at 0x7f73d3370af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f73cd755c80>
                 │     │         └ <function run_sync at 0x7f73d338d9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f73cd755c80>
                 └ <function get_asynclib at 0x7f73d338d310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=401, detail='Image already sold')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f73cd755c80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f73cd755d40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f73d0c00ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 153, in buy_user_image
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f73ce4919a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f73ce48b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f73ce46abb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f73ce4a52e0>
                     └ <function http_exception_handler at 0x7f73cecb8af0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f73d31b3e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f73ce4a52e0>
    │      │         └ HTTPException(status_code=401, detail='Image already sold')
    │      └ <function Logger.exception at 0x7f73d7661790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f73ce4919a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f73cc9dbd90>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f73d7d3a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f73d8ab09d0>
           └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f73d8ab0040>
    └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f73d76ce340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
    │    └ <function subprocess_started at 0x7f73d5594160>
    └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f73d76ce430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f73d5585550>
           │       │   └ <uvicorn.server.Server object at 0x7f73d76ce430>
           │       └ <function run at 0x7f73d6746700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f73d4ae4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f73d4b0f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f73d4b0f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f73d4ec3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f73d3df6f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f73d4ec3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>
          └ <fastapi.applications.FastAPI object at 0x7f73d3df6f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f73cc9dbaf0>
                     │    └ <function exception_handler at 0x7f73cecb80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f73d31b3e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f73cc9dbaf0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f73d7661790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f73cc9dbd90>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:39:28.369 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f73cecc67f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f73ce46abb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f73d31959d0>
          └ <fastapi.routing.APIRoute object at 0x7f73ce48af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f73ce48ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f73ce48b550>
          └ <fastapi.routing.APIRoute object at 0x7f73ce48af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f73ce4a5310>
                     └ <function get_request_handler.<locals>.app at 0x7f73ce48b4c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f73d31845e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'user': Users<renil>, 'marketplace_id': '946e8a39-1366-4139-a273-1e7ae80efea2'}
                 │                 │         └ <function buy_image at 0x7f73d0696b80>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f73ce48af70>
                 └ <function run_in_threadpool at 0x7f73d3370af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │     │         │        └ <built-in method run of Context object at 0x7f73cd755c80>
                 │     │         └ <function run_sync at 0x7f73d338d9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
                 │                                        └ <built-in method run of Context object at 0x7f73cd755c80>
                 └ <function get_asynclib at 0x7f73d338d310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=401, detail='Image already sold')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function buy_image at 0x7f73d0696b80>, user=Users<renil>, marketplace_id='946e8a39-1366-4139-a273-1e7ae80...
             │       │   └ <built-in method run of Context object at 0x7f73cd755c80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f73cd755d40>

  File "./app/routes/ecommerce.py", line 30, in buy_image
    marketplace_id,transaction_id = buy_user_image(marketplace_id,user)
    │                               │              │              └ Users<renil>
    │                               │              └ '946e8a39-1366-4139-a273-1e7ae80efea2'
    │                               └ <function buy_user_image at 0x7f73d0c00ee0>
    └ '946e8a39-1366-4139-a273-1e7ae80efea2'

  File "./app/models/models.py", line 153, in buy_user_image
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f73ce4919a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f73ce48b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f73ce46abb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f73ce4a52e0>
                     └ <function http_exception_handler at 0x7f73cecb8af0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f73d31b3e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f73ce4a52e0>
    │      │         └ HTTPException(status_code=401, detail='Image already sold')
    │      └ <function Logger.exception at 0x7f73d7661790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f73ce4919a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f73cc9dbd90>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f73d7d3a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f73d8ab09d0>
           └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f73d8ab0040>
    └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f73d76ce340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
    │    └ <function subprocess_started at 0x7f73d5594160>
    └ <SpawnProcess name='SpawnProcess-5' parent=948141 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f73d76ce430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f73d5585550>
           │       │   └ <uvicorn.server.Server object at 0x7f73d76ce430>
           │       └ <function run at 0x7f73d6746700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f73d4ae4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f73d4b0f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f73d4b0f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a5100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f73d4ec3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f73d3df6f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f73d4ec3df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4a51...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f73ce4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>
          └ <fastapi.applications.FastAPI object at 0x7f73d3df6f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f73cc9dbaf0>
                     │    └ <function exception_handler at 0x7f73cecb80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f73ce46ac10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f73d31b3e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f73cc9dbaf0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f73d7661790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f73cc9dbd90>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 01:39:28.397 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50860 - "GET /buy_image?marketplace_id=946e8a39-1366-4139-a273-1e7ae80efea2 HTTP/1.1" 500
2022-01-08 01:39:32.624 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:39:32.624 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:39:32.625 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:39:32.725 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:39:32.726 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:39:32.726 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:39:32.726 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:39:32.727 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:39:32.727 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:39:32.727 | INFO     | uvicorn.server:serve:94 - Finished server process [948542]
2022-01-08 01:39:32.728 | INFO     | uvicorn.server:serve:94 - Finished server process [948542]
2022-01-08 01:39:32.728 | INFO     | uvicorn.server:serve:94 - Finished server process [948542]
2022-01-08 01:39:35.085 | INFO     | uvicorn.server:serve:84 - Started server process [948684]
2022-01-08 01:39:35.087 | INFO     | uvicorn.server:serve:84 - Started server process [948684]
2022-01-08 01:39:35.088 | INFO     | uvicorn.server:serve:84 - Started server process [948684]
2022-01-08 01:39:35.089 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:39:35.090 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:39:35.091 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:39:35.093 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:35.094 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:35.095 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:39:43.468 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:39:43.860 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50906 - "POST /token HTTP/1.1" 200
2022-01-08 01:39:56.715 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:39:56.805 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50928 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:40:11.637 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50958 - "POST /token HTTP/1.1" 200
2022-01-08 01:40:19.777 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50966 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:40:37.209 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50996 - "POST /token HTTP/1.1" 200
2022-01-08 01:40:41.998 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 01:40:42.143 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:50996 - "GET /list_seller_images?username=kaumil HTTP/1.1" 200
2022-01-08 01:41:01.274 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51038 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:41:27.147 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51068 - "POST /token HTTP/1.1" 200
2022-01-08 01:41:37.363 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51078 - "GET /sell_image?image_id=fa53a1b6-9ad1-4217-800b-ddbe52a660c2&price=20 HTTP/1.1" 201
2022-01-08 01:41:53.075 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51114 - "POST /token HTTP/1.1" 200
2022-01-08 01:42:04.254 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51126 - "GET /buy_image?marketplace_id=071b11ac-042d-492b-a56e-bdff29c2be81 HTTP/1.1" 201
2022-01-08 01:46:32.424 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51244 - "POST /token HTTP/1.1" 200
2022-01-08 01:46:38.421 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51252 - "GET /show_images HTTP/1.1" 200
2022-01-08 01:47:04.240 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51284 - "GET /list_seller_images?username=kaumil HTTP/1.1" 200
2022-01-08 01:47:19.895 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51312 - "GET /sell_image?image_id=da01e6f6-ab12-4478-86f2-4003a1ab4269&price=30 HTTP/1.1" 201
2022-01-08 01:56:18.898 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51454 - "POST /token HTTP/1.1" 200
2022-01-08 01:56:29.983 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:51462 - "GET /buy_image?marketplace_id=d856b871-a730-4aa6-82c6-082be344cb1f HTTP/1.1" 201
2022-01-08 01:56:52.882 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:56:52.883 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:56:52.884 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 01:56:52.985 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:56:52.986 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:56:52.986 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 01:56:52.987 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:56:52.988 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:56:52.988 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 01:56:52.990 | INFO     | uvicorn.server:serve:94 - Finished server process [948684]
2022-01-08 01:56:52.991 | INFO     | uvicorn.server:serve:94 - Finished server process [948684]
2022-01-08 01:56:52.992 | INFO     | uvicorn.server:serve:94 - Finished server process [948684]
2022-01-08 01:56:54.495 | INFO     | uvicorn.server:serve:84 - Started server process [953153]
2022-01-08 01:56:54.496 | INFO     | uvicorn.server:serve:84 - Started server process [953153]
2022-01-08 01:56:54.496 | INFO     | uvicorn.server:serve:84 - Started server process [953153]
2022-01-08 01:56:54.497 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:56:54.497 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:56:54.498 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 01:56:54.499 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:56:54.500 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 01:56:54.500 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:38:09.680 | INFO     | uvicorn.server:serve:84 - Started server process [968620]
2022-01-08 10:38:09.681 | INFO     | uvicorn.server:serve:84 - Started server process [968620]
2022-01-08 10:38:09.681 | INFO     | uvicorn.server:serve:84 - Started server process [968620]
2022-01-08 10:38:09.681 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 10:38:09.682 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 10:38:09.682 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 10:38:09.682 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:38:09.683 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:38:09.683 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:38:11.937 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:52850 - "GET /docs HTTP/1.1" 200
2022-01-08 10:38:12.189 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:52850 - "GET /openapi.json HTTP/1.1" 200
2022-01-08 10:38:19.526 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 10:38:21.581 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f79c7bd2c10>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f79c7bd2dc0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f79c6a20ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f79c75b1700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f79cb7219d0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f79c75d08b0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f79c61bcbb0>
                     └ <function get_request_handler.<locals>.app at 0x7f79c75d0940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f79cb7105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>}
                 │         └ <function login_for_access_token at 0x7f79c75fa4c0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f79cd445c70>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'kaumil'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>
           │                 │         └ 'kaumil'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>
           └ <function authenticate_user at 0x7f79c75fa3a0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'kaumil'
           └ <function query_user at 0x7f79c9264a60>

  File "./app/models/models.py", line 112, in query_user
    result = list(Users.query(username))
                  │     │     └ 'kaumil'
                  │     └ <classmethod object at 0x7f79c7b6b5b0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f79c7b64820>
    └ <pynamodb.pagination.ResultIterator object at 0x7f79c91cca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
                └ <pynamodb.pagination.ResultIterator object at 0x7f79c91cca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f79c7bd4f70>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f79c7bd4040>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f79c544ac10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f79d02c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f79d103b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f79d103b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f79cfc5a370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    └ <function subprocess_started at 0x7f79cdb21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f79cfc5a460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f79cdb12550>
           │       │   └ <uvicorn.server.Server object at 0x7f79cfc5a460>
           │       └ <function run at 0x7f79cecd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f79cd06f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f79cd09b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f79cd09b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
          └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f79c61bc0a0>
                     │    └ <function exception_handler at 0x7f79c75a41f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f79cb73fdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f79c61bc0a0>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f79cfbed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f79c544ac10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 10:38:21.617 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f79c7bd2c10>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f79c7bd2dc0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f79c6a20ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f79c75b1700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f79cb7219d0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f79c75d08b0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f79c61bcbb0>
                     └ <function get_request_handler.<locals>.app at 0x7f79c75d0940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f79cb7105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>}
                 │         └ <function login_for_access_token at 0x7f79c75fa4c0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f79cd445c70>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'kaumil'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>
           │                 │         └ 'kaumil'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>
           └ <function authenticate_user at 0x7f79c75fa3a0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'kaumil'
           └ <function query_user at 0x7f79c9264a60>

  File "./app/models/models.py", line 112, in query_user
    result = list(Users.query(username))
                  │     │     └ 'kaumil'
                  │     └ <classmethod object at 0x7f79c7b6b5b0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f79c7b64820>
    └ <pynamodb.pagination.ResultIterator object at 0x7f79c91cca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
                └ <pynamodb.pagination.ResultIterator object at 0x7f79c91cca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f79c7bd4f70>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f79c7bd4040>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f79c544ac10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f79d02c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f79d103b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f79d103b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f79cfc5a370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    └ <function subprocess_started at 0x7f79cdb21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f79cfc5a460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f79cdb12550>
           │       │   └ <uvicorn.server.Server object at 0x7f79cfc5a460>
           │       └ <function run at 0x7f79cecd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f79cd06f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f79cd09b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f79cd09b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
          └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f79c61bc0a0>
                     │    └ <function exception_handler at 0x7f79c75a41f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f79cb73fdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f79c61bc0a0>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f79cfbed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f79c544ac10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 10:38:21.640 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f79c7bd2c10>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f79c7bd2dc0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f79c6a20ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f79c75b1700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f79cb7219d0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c6a20dc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f79c75d08b0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f79c61bcbb0>
                     └ <function get_request_handler.<locals>.app at 0x7f79c75d0940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f79cb7105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>}
                 │         └ <function login_for_access_token at 0x7f79c75fa4c0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f79cd445c70>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'kaumil'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>
           │                 │         └ 'kaumil'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61854f0>
           └ <function authenticate_user at 0x7f79c75fa3a0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'kaumil'
           └ <function query_user at 0x7f79c9264a60>

  File "./app/models/models.py", line 112, in query_user
    result = list(Users.query(username))
                  │     │     └ 'kaumil'
                  │     └ <classmethod object at 0x7f79c7b6b5b0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f79c7b64820>
    └ <pynamodb.pagination.ResultIterator object at 0x7f79c91cca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
                └ <pynamodb.pagination.ResultIterator object at 0x7f79c91cca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    │           │    └ ('kaumil',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f79c619ca30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f79c7bd4f70>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f79c7bd4040>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f79c544ac10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f79d02c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f79d103b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f79d103b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f79cfc5a370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    └ <function subprocess_started at 0x7f79cdb21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f79cfc5a460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f79cdb12550>
           │       │   └ <uvicorn.server.Server object at 0x7f79cfc5a460>
           │       └ <function run at 0x7f79cecd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f79cd06f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f79cd09b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f79cd09b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61bce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c61...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
          └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f79c61bc0a0>
                     │    └ <function exception_handler at 0x7f79c75a41f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f79cb73fdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f79c61bc0a0>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f79cfbed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f79c544ac10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 10:38:21.661 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:52852 - "POST /token HTTP/1.1" 500
2022-01-08 10:38:32.928 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f79c7bd2c10>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f79c7bd2dc0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f79c54a28b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f79c75b1700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f79cb7219d0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f79c75d08b0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f79c5466d00>
                     └ <function get_request_handler.<locals>.app at 0x7f79c75d0940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f79cb7105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>}
                 │         └ <function login_for_access_token at 0x7f79c75fa4c0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f79cd445c70>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>
           └ <function authenticate_user at 0x7f79c75fa3a0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f79c9264a60>

  File "./app/models/models.py", line 112, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f79c7b6b5b0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f79c7b64820>
    └ <pynamodb.pagination.ResultIterator object at 0x7f79c5466b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
                └ <pynamodb.pagination.ResultIterator object at 0x7f79c5466b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f79c7bd4f70>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f79c7bd4040>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f79c533c670>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f79d02c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f79d103b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f79d103b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f79cfc5a370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    └ <function subprocess_started at 0x7f79cdb21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f79cfc5a460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f79cdb12550>
           │       │   └ <uvicorn.server.Server object at 0x7f79cfc5a460>
           │       └ <function run at 0x7f79cecd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f79cd06f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f79cd09b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f79cd09b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
          └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f79c5466cd0>
                     │    └ <function exception_handler at 0x7f79c75a41f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f79cb73fdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f79c5466cd0>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f79cfbed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f79c533c670>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 10:38:32.951 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f79c7bd2c10>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f79c7bd2dc0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f79c54a28b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f79c75b1700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f79cb7219d0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f79c75d08b0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f79c5466d00>
                     └ <function get_request_handler.<locals>.app at 0x7f79c75d0940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f79cb7105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>}
                 │         └ <function login_for_access_token at 0x7f79c75fa4c0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f79cd445c70>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>
           └ <function authenticate_user at 0x7f79c75fa3a0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f79c9264a60>

  File "./app/models/models.py", line 112, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f79c7b6b5b0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f79c7b64820>
    └ <pynamodb.pagination.ResultIterator object at 0x7f79c5466b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
                └ <pynamodb.pagination.ResultIterator object at 0x7f79c5466b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f79c7bd4f70>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f79c7bd4040>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f79c533c670>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f79d02c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f79d103b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f79d103b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f79cfc5a370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    └ <function subprocess_started at 0x7f79cdb21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f79cfc5a460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f79cdb12550>
           │       │   └ <uvicorn.server.Server object at 0x7f79cfc5a460>
           │       └ <function run at 0x7f79cecd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f79cd06f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f79cd09b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f79cd09b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
          └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f79c5466cd0>
                     │    └ <function exception_handler at 0x7f79c75a41f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f79cb73fdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f79c5466cd0>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f79cfbed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f79c533c670>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 10:38:32.976 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f79c7bd2c10>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f79c7bd2dc0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f79c54a28b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f79c75b1700>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f79c69f7ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f79cb7219d0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f79c54a2940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f79c75d08b0>
          └ <fastapi.routing.APIRoute object at 0x7f79c75b1940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f79c5466d00>
                     └ <function get_request_handler.<locals>.app at 0x7f79c75d0940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f79cb7105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>}
                 │         └ <function login_for_access_token at 0x7f79c75fa4c0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f79cd445c70>

  File "./app/routes/login.py", line 98, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f79c61bc190>
           └ <function authenticate_user at 0x7f79c75fa3a0>

  File "./app/routes/login.py", line 88, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f79c9264a60>

  File "./app/models/models.py", line 112, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f79c7b6b5b0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f79c7b64820>
    └ <pynamodb.pagination.ResultIterator object at 0x7f79c5466b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
                └ <pynamodb.pagination.ResultIterator object at 0x7f79c5466b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f79c7bbcd90>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f79c5466f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f79c7bd4f70>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f79c61bc2b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f79c7bd4040>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f79c533c670>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f79d02c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f79d103b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f79d103b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f79cfc5a370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
    │    └ <function subprocess_started at 0x7f79cdb21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=968577 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f79cfc5a460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f79cdb12550>
           │       │   └ <uvicorn.server.Server object at 0x7f79cfc5a460>
           │       └ <function run at 0x7f79cecd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f79cd06f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f79cd09b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f79cd09b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f79cd44fe20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c5466b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f79c54...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>
          └ <fastapi.applications.FastAPI object at 0x7f79cc381f70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f79c5466cd0>
                     │    └ <function exception_handler at 0x7f79c75a41f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f79c69f7b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f79cb73fdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f79c5466cd0>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f79cfbed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f79c533c670>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 10:38:33.000 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:52890 - "POST /token HTTP/1.1" 500
2022-01-08 10:38:51.622 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-08 10:38:52.288 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 10:38:52.453 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 10:38:52.600 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:52902 - "GET /sanity_check HTTP/1.1" 200
2022-01-08 10:38:59.649 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:53044 - "POST /token HTTP/1.1" 200
2022-01-08 10:39:13.932 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:53056 - "POST /signup HTTP/1.1" 201
2022-01-08 10:39:35.714 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/2bc3c8dc-359a-4c19-bbbe-0ad9c33b8edf.jpg
2022-01-08 10:39:35.748 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:53078 - "POST /upload_images HTTP/1.1" 200
2022-01-08 10:40:12.086 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 10:40:12.086 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 10:40:12.087 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 10:40:12.188 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 10:40:12.188 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 10:40:12.188 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 10:40:12.189 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 10:40:12.190 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 10:40:12.190 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 10:40:12.191 | INFO     | uvicorn.server:serve:94 - Finished server process [968620]
2022-01-08 10:40:12.191 | INFO     | uvicorn.server:serve:94 - Finished server process [968620]
2022-01-08 10:40:12.192 | INFO     | uvicorn.server:serve:94 - Finished server process [968620]
2022-01-08 10:40:13.116 | INFO     | uvicorn.server:serve:84 - Started server process [970226]
2022-01-08 10:40:13.117 | INFO     | uvicorn.server:serve:84 - Started server process [970226]
2022-01-08 10:40:13.117 | INFO     | uvicorn.server:serve:84 - Started server process [970226]
2022-01-08 10:40:13.118 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 10:40:13.118 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 10:40:13.118 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 10:40:13.119 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:40:13.120 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:40:13.120 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 10:40:14.123 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 10:40:14.123 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 10:40:14.124 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 10:40:14.224 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 10:40:14.225 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 10:40:14.226 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 10:40:14.226 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 10:40:14.227 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 10:40:14.228 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 10:40:14.228 | INFO     | uvicorn.server:serve:94 - Finished server process [970226]
2022-01-08 10:40:14.229 | INFO     | uvicorn.server:serve:94 - Finished server process [970226]
2022-01-08 10:40:14.229 | INFO     | uvicorn.server:serve:94 - Finished server process [970226]
2022-01-08 11:18:17.552 | INFO     | uvicorn.server:serve:84 - Started server process [980001]
2022-01-08 11:18:17.552 | INFO     | uvicorn.server:serve:84 - Started server process [980001]
2022-01-08 11:18:17.553 | INFO     | uvicorn.server:serve:84 - Started server process [980001]
2022-01-08 11:18:17.553 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:18:17.553 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:18:17.553 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:18:17.554 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:18:17.554 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:18:17.554 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:18:20.470 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54032 - "GET /docs HTTP/1.1" 200
2022-01-08 11:18:20.754 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54032 - "GET /openapi.json HTTP/1.1" 200
2022-01-08 11:18:28.889 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:18:29.268 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54034 - "POST /token HTTP/1.1" 200
2022-01-08 11:18:49.158 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:18:49.236 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54066 - "GET /show_images HTTP/1.1" 200
2022-01-08 11:19:07.977 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/d5050926-7e03-4e94-a122-869f651c0069.jpg
2022-01-08 11:19:08.028 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54098 - "POST /upload_images HTTP/1.1" 200
2022-01-08 11:19:24.319 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5c184511f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5c1a501c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5c1ad5a850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5c1a501c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5c1f2299d0>
          └ <fastapi.routing.APIRoute object at 0x7f5c1a5186a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5c1a51d1f0>
          └ <fastapi.routing.APIRoute object at 0x7f5c1a5186a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5c18466d90>
                     └ <function get_request_handler.<locals>.app at 0x7f5c1a51d160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5c1f2185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7f5c1ad4f940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5c1a5186d0>
                 └ <function run_in_threadpool at 0x7f5c1f404af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7f5c1840f240>
                 │     │         └ <function run_sync at 0x7f5c1f4219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7f5c1840f240>
                 └ <function get_asynclib at 0x7f5c1f421310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'service_name'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7f5c1840f240>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5c1840f1c0>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7f5c1cc9b040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client('s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                        │                    │  │       └ <function Mapping.get at 0x7f5c24e7a820>
         │       │                        │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                        │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f5c1e610310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'service_name'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5c18a2f580>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5c23dcd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5c24b449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5c24b44040>
    └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5c23762370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
    │    └ <function subprocess_started at 0x7f5c2162a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5c23762460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5c2161a550>
           │       │   └ <uvicorn.server.Server object at 0x7f5c23762460>
           │       └ <function run at 0x7f5c227da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5c20b78040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5c20ba3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5c20ba3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5c20f57e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5c1fe8af70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5c20f57e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>
          └ <fastapi.applications.FastAPI object at 0x7f5c1fe8af70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5c18a2f160>
                     │    └ <function exception_handler at 0x7f5c1ad4f310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5c1f247db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5c18a2f160>
    │      │         └ TypeError("client() missing 1 required positional argument: 'service_name'")
    │      └ <function Logger.exception at 0x7f5c236f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5c18a2f580>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:19:24.342 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5c184511f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5c1a501c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5c1ad5a850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5c1a501c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5c1f2299d0>
          └ <fastapi.routing.APIRoute object at 0x7f5c1a5186a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5c1a51d1f0>
          └ <fastapi.routing.APIRoute object at 0x7f5c1a5186a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5c18466d90>
                     └ <function get_request_handler.<locals>.app at 0x7f5c1a51d160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5c1f2185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7f5c1ad4f940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5c1a5186d0>
                 └ <function run_in_threadpool at 0x7f5c1f404af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7f5c1840f240>
                 │     │         └ <function run_sync at 0x7f5c1f4219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7f5c1840f240>
                 └ <function get_asynclib at 0x7f5c1f421310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'service_name'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7f5c1840f240>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5c1840f1c0>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7f5c1cc9b040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client('s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                        │                    │  │       └ <function Mapping.get at 0x7f5c24e7a820>
         │       │                        │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                        │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f5c1e610310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'service_name'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5c18a2f580>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5c23dcd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5c24b449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5c24b44040>
    └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5c23762370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
    │    └ <function subprocess_started at 0x7f5c2162a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5c23762460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5c2161a550>
           │       │   └ <uvicorn.server.Server object at 0x7f5c23762460>
           │       └ <function run at 0x7f5c227da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5c20b78040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5c20ba3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5c20ba3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5c20f57e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5c1fe8af70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5c20f57e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>
          └ <fastapi.applications.FastAPI object at 0x7f5c1fe8af70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5c18a2f160>
                     │    └ <function exception_handler at 0x7f5c1ad4f310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5c1f247db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5c18a2f160>
    │      │         └ TypeError("client() missing 1 required positional argument: 'service_name'")
    │      └ <function Logger.exception at 0x7f5c236f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5c18a2f580>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:19:24.360 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5c184511f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5c1a501c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5c1ad5a850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5c1a501c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5c1f2299d0>
          └ <fastapi.routing.APIRoute object at 0x7f5c1a5186a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5c18451310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5c1a51d1f0>
          └ <fastapi.routing.APIRoute object at 0x7f5c1a5186a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5c18466d90>
                     └ <function get_request_handler.<locals>.app at 0x7f5c1a51d160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5c1f2185e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7f5c1ad4f940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5c1a5186d0>
                 └ <function run_in_threadpool at 0x7f5c1f404af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7f5c1840f240>
                 │     │         └ <function run_sync at 0x7f5c1f4219d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7f5c1840f240>
                 └ <function get_asynclib at 0x7f5c1f421310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'service_name'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7f5c1ad4f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7f5c1840f240>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5c1840f1c0>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7f5c1cc9b040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client('s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                        │                    │  │       └ <function Mapping.get at 0x7f5c24e7a820>
         │       │                        │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                        │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f5c1e610310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'service_name'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5c18a2f580>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5c23dcd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5c24b449d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5c24b44040>
    └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5c23762370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
    │    └ <function subprocess_started at 0x7f5c2162a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=979964 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5c23762460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5c2161a550>
           │       │   └ <uvicorn.server.Server object at 0x7f5c23762460>
           │       └ <function run at 0x7f5c227da700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5c20b78040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5c20ba3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5c20ba3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5c20f57e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5c1fe8af70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5c20f57e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c18466f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5c184...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>
          └ <fastapi.applications.FastAPI object at 0x7f5c1fe8af70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5c18a2f160>
                     │    └ <function exception_handler at 0x7f5c1ad4f310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5c1a501c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5c1f247db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5c18a2f160>
    │      │         └ TypeError("client() missing 1 required positional argument: 'service_name'")
    │      └ <function Logger.exception at 0x7f5c236f5790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5c18a2f580>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:19:24.376 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54140 - "GET /share_image?image_id=496b023d-5fd8-4e0c-833b-f6386a601a36 HTTP/1.1" 500
2022-01-08 11:19:51.664 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:19:51.665 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:19:51.665 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:19:51.766 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:19:51.767 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:19:51.767 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:19:51.768 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:19:51.769 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:19:51.770 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:19:51.770 | INFO     | uvicorn.server:serve:94 - Finished server process [980001]
2022-01-08 11:19:51.771 | INFO     | uvicorn.server:serve:94 - Finished server process [980001]
2022-01-08 11:19:51.772 | INFO     | uvicorn.server:serve:94 - Finished server process [980001]
2022-01-08 11:19:52.791 | INFO     | uvicorn.server:serve:84 - Started server process [980775]
2022-01-08 11:19:52.791 | INFO     | uvicorn.server:serve:84 - Started server process [980775]
2022-01-08 11:19:52.792 | INFO     | uvicorn.server:serve:84 - Started server process [980775]
2022-01-08 11:19:52.792 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:19:52.792 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:19:52.792 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:19:52.793 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:19:52.794 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:19:52.794 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:19:52.995 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:19:52.995 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:19:52.996 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:19:53.097 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:19:53.097 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:19:53.097 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:19:53.098 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:19:53.098 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:19:53.098 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:19:53.099 | INFO     | uvicorn.server:serve:94 - Finished server process [980775]
2022-01-08 11:19:53.099 | INFO     | uvicorn.server:serve:94 - Finished server process [980775]
2022-01-08 11:19:53.099 | INFO     | uvicorn.server:serve:94 - Finished server process [980775]
2022-01-08 11:19:56.811 | INFO     | uvicorn.server:serve:84 - Started server process [980865]
2022-01-08 11:19:56.811 | INFO     | uvicorn.server:serve:84 - Started server process [980865]
2022-01-08 11:19:56.811 | INFO     | uvicorn.server:serve:84 - Started server process [980865]
2022-01-08 11:19:56.812 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:19:56.812 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:19:56.812 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:19:56.813 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:19:56.813 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:19:56.813 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:19:59.277 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:19:59.372 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:19:59.442 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fc1c0c0ec10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fc1c0bf1c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fc1c144b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fc1c0bf1c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fc1c591a9d0>
          └ <fastapi.routing.APIRoute object at 0x7fc1c0c0a6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fc1c0c0e1f0>
          └ <fastapi.routing.APIRoute object at 0x7fc1c0c0a6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fc1c0c2b370>
                     └ <function get_request_handler.<locals>.app at 0x7fc1c0c0e160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fc1c59095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7fc1c143f940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fc1c0c0a6d0>
                 └ <function run_in_threadpool at 0x7fc1c5af5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7fc1c0c1b180>
                 │     │         └ <function run_sync at 0x7fc1c5b129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7fc1c0c1b180>
                 └ <function get_asynclib at 0x7fc1c5b12310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'self'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7fc1c0c1b180>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fc1bbe7b100>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7fc1c338c040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client(service_name='s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                                     │                    │  │       └ <function Mapping.get at 0x7fc1cb56b820>
         │       │                                     │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                                     │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                                     └ 'us-east-1'
         │       └ <function Session.client at 0x7fc1c4d01310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'self'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fc1c0c19850>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fc1ca4be430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fc1cb2359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fc1cb235040>
    └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fc1c9e53370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
    │    └ <function subprocess_started at 0x7fc1c7d1b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fc1c9e53460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fc1c7d0c550>
           │       │   └ <uvicorn.server.Server object at 0x7fc1c9e53460>
           │       └ <function run at 0x7fc1c8ecb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fc1c7269040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fc1c7294280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fc1c7294310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fc1c7648e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fc1c657bf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fc1c7648e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>
          └ <fastapi.applications.FastAPI object at 0x7fc1c657bf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fc1c0c2b340>
                     │    └ <function exception_handler at 0x7fc1c143f310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fc1c5938d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fc1c0c2b340>
    │      │         └ TypeError("client() missing 1 required positional argument: 'self'")
    │      └ <function Logger.exception at 0x7fc1c9de6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fc1c0c19850>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:19:59.465 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fc1c0c0ec10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fc1c0bf1c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fc1c144b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fc1c0bf1c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fc1c591a9d0>
          └ <fastapi.routing.APIRoute object at 0x7fc1c0c0a6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fc1c0c0e1f0>
          └ <fastapi.routing.APIRoute object at 0x7fc1c0c0a6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fc1c0c2b370>
                     └ <function get_request_handler.<locals>.app at 0x7fc1c0c0e160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fc1c59095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7fc1c143f940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fc1c0c0a6d0>
                 └ <function run_in_threadpool at 0x7fc1c5af5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7fc1c0c1b180>
                 │     │         └ <function run_sync at 0x7fc1c5b129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7fc1c0c1b180>
                 └ <function get_asynclib at 0x7fc1c5b12310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'self'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7fc1c0c1b180>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fc1bbe7b100>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7fc1c338c040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client(service_name='s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                                     │                    │  │       └ <function Mapping.get at 0x7fc1cb56b820>
         │       │                                     │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                                     │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                                     └ 'us-east-1'
         │       └ <function Session.client at 0x7fc1c4d01310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'self'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fc1c0c19850>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fc1ca4be430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fc1cb2359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fc1cb235040>
    └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fc1c9e53370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
    │    └ <function subprocess_started at 0x7fc1c7d1b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fc1c9e53460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fc1c7d0c550>
           │       │   └ <uvicorn.server.Server object at 0x7fc1c9e53460>
           │       └ <function run at 0x7fc1c8ecb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fc1c7269040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fc1c7294280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fc1c7294310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fc1c7648e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fc1c657bf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fc1c7648e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>
          └ <fastapi.applications.FastAPI object at 0x7fc1c657bf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fc1c0c2b340>
                     │    └ <function exception_handler at 0x7fc1c143f310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fc1c5938d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fc1c0c2b340>
    │      │         └ TypeError("client() missing 1 required positional argument: 'self'")
    │      └ <function Logger.exception at 0x7fc1c9de6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fc1c0c19850>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:19:59.481 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fc1c0c0ec10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fc1c0bf1c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fc1c144b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fc1c0bf1c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fc1c591a9d0>
          └ <fastapi.routing.APIRoute object at 0x7fc1c0c0a6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fc1c0c0eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fc1c0c0e1f0>
          └ <fastapi.routing.APIRoute object at 0x7fc1c0c0a6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fc1c0c2b370>
                     └ <function get_request_handler.<locals>.app at 0x7fc1c0c0e160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fc1c59095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7fc1c143f940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fc1c0c0a6d0>
                 └ <function run_in_threadpool at 0x7fc1c5af5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7fc1c0c1b180>
                 │     │         └ <function run_sync at 0x7fc1c5b129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7fc1c0c1b180>
                 └ <function get_asynclib at 0x7fc1c5b12310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'self'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7fc1c143f940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7fc1c0c1b180>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fc1bbe7b100>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7fc1c338c040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client(service_name='s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                                     │                    │  │       └ <function Mapping.get at 0x7fc1cb56b820>
         │       │                                     │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                                     │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                                     └ 'us-east-1'
         │       └ <function Session.client at 0x7fc1c4d01310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'self'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fc1c0c19850>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fc1ca4be430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fc1cb2359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fc1cb235040>
    └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fc1c9e53370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
    │    └ <function subprocess_started at 0x7fc1c7d1b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=980828 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fc1c9e53460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fc1c7d0c550>
           │       │   └ <uvicorn.server.Server object at 0x7fc1c9e53460>
           │       └ <function run at 0x7fc1c8ecb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fc1c7269040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fc1c7294280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fc1c7294310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fc1c7648e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fc1c657bf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fc1c7648e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c2b1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fc1c0c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>
          └ <fastapi.applications.FastAPI object at 0x7fc1c657bf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fc1c0c2b340>
                     │    └ <function exception_handler at 0x7fc1c143f310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fc1c0bf1c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fc1c5938d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fc1c0c2b340>
    │      │         └ TypeError("client() missing 1 required positional argument: 'self'")
    │      └ <function Logger.exception at 0x7fc1c9de6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fc1c0c19850>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:19:59.506 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54158 - "GET /share_image?image_id=496b023d-5fd8-4e0c-833b-f6386a601a36 HTTP/1.1" 500
2022-01-08 11:20:36.513 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:36.513 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:36.514 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:36.615 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:36.616 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:36.616 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:36.617 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:36.618 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:36.618 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:36.619 | INFO     | uvicorn.server:serve:94 - Finished server process [980865]
2022-01-08 11:20:36.619 | INFO     | uvicorn.server:serve:94 - Finished server process [980865]
2022-01-08 11:20:36.619 | INFO     | uvicorn.server:serve:94 - Finished server process [980865]
2022-01-08 11:20:40.715 | INFO     | uvicorn.server:serve:84 - Started server process [981181]
2022-01-08 11:20:40.716 | INFO     | uvicorn.server:serve:84 - Started server process [981181]
2022-01-08 11:20:40.717 | INFO     | uvicorn.server:serve:84 - Started server process [981181]
2022-01-08 11:20:40.717 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:20:40.717 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:20:40.718 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:20:40.721 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:20:40.722 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:20:40.722 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:20:41.763 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:20:41.854 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:20:41.924 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb3fa06fc10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb3fa052af0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb3fa8ac730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb3fa052af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fb3fed7b9d0>
          └ <fastapi.routing.APIRoute object at 0x7fb3fa06a580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb3fa06f1f0>
          └ <fastapi.routing.APIRoute object at 0x7fb3fa06a580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb3fa08d250>
                     └ <function get_request_handler.<locals>.app at 0x7fb3fa06f160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb3fed6a5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7fb3fa8a1940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fb3fa06a5b0>
                 └ <function run_in_threadpool at 0x7fb3fef56af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7fb3fa084a40>
                 │     │         └ <function run_sync at 0x7fb3fef739d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7fb3fa084a40>
                 └ <function get_asynclib at 0x7fb3fef73310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'self'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7fb3fa084a40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fb3f930a180>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7fb3fc7ed040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client(service_name='s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                                     │                    │  │       └ <function Mapping.get at 0x7fb4049cc820>
         │       │                                     │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                                     │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                                     └ 'us-east-1'
         │       └ <function Session.client at 0x7fb3fe162310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'self'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fb3fa052910>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb40391f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb4046969d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb404696040>
    └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb4032b4370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
    │    └ <function subprocess_started at 0x7fb40117b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb4032b4460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fb40116c550>
           │       │   └ <uvicorn.server.Server object at 0x7fb4032b4460>
           │       └ <function run at 0x7fb40232c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fb4006ca040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb4006f1280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb4006f1310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb400aa9e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb3ff9dcf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb400aa9e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>
          └ <fastapi.applications.FastAPI object at 0x7fb3ff9dcf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fb3fa08d220>
                     │    └ <function exception_handler at 0x7fb3fa8a1310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fb3fed99e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fb3fa08d220>
    │      │         └ TypeError("client() missing 1 required positional argument: 'self'")
    │      └ <function Logger.exception at 0x7fb403247790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fb3fa052910>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:20:41.946 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb3fa06fc10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb3fa052af0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb3fa8ac730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb3fa052af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fb3fed7b9d0>
          └ <fastapi.routing.APIRoute object at 0x7fb3fa06a580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb3fa06f1f0>
          └ <fastapi.routing.APIRoute object at 0x7fb3fa06a580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb3fa08d250>
                     └ <function get_request_handler.<locals>.app at 0x7fb3fa06f160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb3fed6a5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7fb3fa8a1940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fb3fa06a5b0>
                 └ <function run_in_threadpool at 0x7fb3fef56af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7fb3fa084a40>
                 │     │         └ <function run_sync at 0x7fb3fef739d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7fb3fa084a40>
                 └ <function get_asynclib at 0x7fb3fef73310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'self'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7fb3fa084a40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fb3f930a180>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7fb3fc7ed040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client(service_name='s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                                     │                    │  │       └ <function Mapping.get at 0x7fb4049cc820>
         │       │                                     │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                                     │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                                     └ 'us-east-1'
         │       └ <function Session.client at 0x7fb3fe162310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'self'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fb3fa052910>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb40391f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb4046969d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb404696040>
    └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb4032b4370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
    │    └ <function subprocess_started at 0x7fb40117b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb4032b4460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fb40116c550>
           │       │   └ <uvicorn.server.Server object at 0x7fb4032b4460>
           │       └ <function run at 0x7fb40232c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fb4006ca040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb4006f1280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb4006f1310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb400aa9e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb3ff9dcf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb400aa9e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>
          └ <fastapi.applications.FastAPI object at 0x7fb3ff9dcf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fb3fa08d220>
                     │    └ <function exception_handler at 0x7fb3fa8a1310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fb3fed99e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fb3fa08d220>
    │      │         └ TypeError("client() missing 1 required positional argument: 'self'")
    │      └ <function Logger.exception at 0x7fb403247790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fb3fa052910>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:20:41.963 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb3fa06fc10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb3fa052af0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb3fa8ac730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb3fa052af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fb3fed7b9d0>
          └ <fastapi.routing.APIRoute object at 0x7fb3fa06a580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb3fa06fca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb3fa06f1f0>
          └ <fastapi.routing.APIRoute object at 0x7fb3fa06a580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb3fa08d250>
                     └ <function get_request_handler.<locals>.app at 0x7fb3fa06f160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb3fed6a5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7fb3fa8a1940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fb3fa06a5b0>
                 └ <function run_in_threadpool at 0x7fb3fef56af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7fb3fa084a40>
                 │     │         └ <function run_sync at 0x7fb3fef739d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7fb3fa084a40>
                 └ <function get_asynclib at 0x7fb3fef73310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("client() missing 1 required positional argument: 'self'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7fb3fa8a1940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7fb3fa084a40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fb3f930a180>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7fb3fc7ed040>

  File "./app/models/models.py", line 218, in make_image_public
    with Session.client(service_name='s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                                     │                    │  │       └ <function Mapping.get at 0x7fb4049cc820>
         │       │                                     │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                                     │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                                     └ 'us-east-1'
         │       └ <function Session.client at 0x7fb3fe162310>
         └ <class 'boto3.session.Session'>

TypeError: client() missing 1 required positional argument: 'self'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fb3fa052910>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb40391f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb4046969d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb404696040>
    └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb4032b4370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
    │    └ <function subprocess_started at 0x7fb40117b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=981144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb4032b4460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fb40116c550>
           │       │   └ <uvicorn.server.Server object at 0x7fb4032b4460>
           │       └ <function run at 0x7fb40232c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fb4006ca040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb4006f1280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb4006f1310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d040>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb400aa9e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb3ff9dcf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb400aa9e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa08d0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb3fa0...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>
          └ <fastapi.applications.FastAPI object at 0x7fb3ff9dcf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fb3fa08d220>
                     │    └ <function exception_handler at 0x7fb3fa8a1310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb3fa052b50>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fb3fed99e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fb3fa08d220>
    │      │         └ TypeError("client() missing 1 required positional argument: 'self'")
    │      └ <function Logger.exception at 0x7fb403247790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fb3fa052910>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:20:41.981 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54206 - "GET /share_image?image_id=496b023d-5fd8-4e0c-833b-f6386a601a36 HTTP/1.1" 500
2022-01-08 11:20:54.510 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:54.510 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:54.511 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:54.611 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:54.612 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:54.612 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:54.612 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:54.613 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:54.613 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:54.613 | INFO     | uvicorn.server:serve:94 - Finished server process [981181]
2022-01-08 11:20:54.614 | INFO     | uvicorn.server:serve:94 - Finished server process [981181]
2022-01-08 11:20:54.614 | INFO     | uvicorn.server:serve:94 - Finished server process [981181]
2022-01-08 11:20:56.051 | INFO     | uvicorn.server:serve:84 - Started server process [981338]
2022-01-08 11:20:56.052 | INFO     | uvicorn.server:serve:84 - Started server process [981338]
2022-01-08 11:20:56.053 | INFO     | uvicorn.server:serve:84 - Started server process [981338]
2022-01-08 11:20:56.053 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:20:56.054 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:20:56.055 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:20:56.059 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:20:56.059 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:20:56.060 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:20:58.066 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:58.066 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:58.067 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:20:58.166 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:58.167 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:58.167 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:20:58.168 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:58.168 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:58.169 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:20:58.169 | INFO     | uvicorn.server:serve:94 - Finished server process [981338]
2022-01-08 11:20:58.169 | INFO     | uvicorn.server:serve:94 - Finished server process [981338]
2022-01-08 11:20:58.170 | INFO     | uvicorn.server:serve:94 - Finished server process [981338]
2022-01-08 11:26:39.312 | INFO     | uvicorn.server:serve:84 - Started server process [982793]
2022-01-08 11:26:39.313 | INFO     | uvicorn.server:serve:84 - Started server process [982793]
2022-01-08 11:26:39.313 | INFO     | uvicorn.server:serve:84 - Started server process [982793]
2022-01-08 11:26:39.313 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:26:39.314 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:26:39.314 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:26:39.315 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:26:39.315 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:26:39.315 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:26:42.232 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:26:42.338 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:26:42.495 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f3be7770c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3be7753bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f3be7fad7f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3be7753bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3bec47c9d0>
          └ <fastapi.routing.APIRoute object at 0x7f3be776c640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3be77701f0>
          └ <fastapi.routing.APIRoute object at 0x7f3be776c640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3be778d310>
                     └ <function get_request_handler.<locals>.app at 0x7f3be7770160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3bec46b5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7f3be7fa2940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f3be776c670>
                 └ <function run_in_threadpool at 0x7f3bec657af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7f3be7787280>
                 │     │         └ <function run_sync at 0x7f3bec6749d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7f3be7787280>
                 └ <function get_asynclib at 0x7f3bec674310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError('__enter__')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7f3be7787280>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f3be69a85c0>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7f3be9eee040>

  File "./app/models/models.py", line 218, in make_image_public
    with session.client('s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                        │                    │  │       └ <function Mapping.get at 0x7f3bf20cd820>
         │       │                        │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                        │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f3beb863310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3be77539d0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f3bf101f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f3bf1d979d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f3bf1d97040>
    └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f3bf09b5370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
    │    └ <function subprocess_started at 0x7f3bee87d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f3bf09b5460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f3bee86d550>
           │       │   └ <uvicorn.server.Server object at 0x7f3bf09b5460>
           │       └ <function run at 0x7f3befa2d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3beddcb040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3beddf6280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3beddf6310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3bee1aae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3bed0ddf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3bee1aae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>
          └ <fastapi.applications.FastAPI object at 0x7f3bed0ddf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3be778d2e0>
                     │    └ <function exception_handler at 0x7f3be7fa2310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3bec49ad10>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3be778d2e0>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7f3bf0948790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3be77539d0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:26:42.516 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f3be7770c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3be7753bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f3be7fad7f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3be7753bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3bec47c9d0>
          └ <fastapi.routing.APIRoute object at 0x7f3be776c640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3be77701f0>
          └ <fastapi.routing.APIRoute object at 0x7f3be776c640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3be778d310>
                     └ <function get_request_handler.<locals>.app at 0x7f3be7770160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3bec46b5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7f3be7fa2940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f3be776c670>
                 └ <function run_in_threadpool at 0x7f3bec657af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7f3be7787280>
                 │     │         └ <function run_sync at 0x7f3bec6749d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7f3be7787280>
                 └ <function get_asynclib at 0x7f3bec674310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError('__enter__')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7f3be7787280>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f3be69a85c0>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7f3be9eee040>

  File "./app/models/models.py", line 218, in make_image_public
    with session.client('s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                        │                    │  │       └ <function Mapping.get at 0x7f3bf20cd820>
         │       │                        │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                        │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f3beb863310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3be77539d0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f3bf101f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f3bf1d979d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f3bf1d97040>
    └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f3bf09b5370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
    │    └ <function subprocess_started at 0x7f3bee87d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f3bf09b5460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f3bee86d550>
           │       │   └ <uvicorn.server.Server object at 0x7f3bf09b5460>
           │       └ <function run at 0x7f3befa2d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3beddcb040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3beddf6280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3beddf6310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3bee1aae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3bed0ddf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3bee1aae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>
          └ <fastapi.applications.FastAPI object at 0x7f3bed0ddf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3be778d2e0>
                     │    └ <function exception_handler at 0x7f3be7fa2310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3bec49ad10>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3be778d2e0>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7f3bf0948790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3be77539d0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:26:42.533 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f3be7770c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3be7753bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f3be7fad7f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3be7753bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3bec47c9d0>
          └ <fastapi.routing.APIRoute object at 0x7f3be776c640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3be7770ca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3be77701f0>
          └ <fastapi.routing.APIRoute object at 0x7f3be776c640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3be778d310>
                     └ <function get_request_handler.<locals>.app at 0x7f3be7770160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3bec46b5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>, 'image_id': '496b023d-5fd8-4e0c-833b-f6386a601a36'}
                 │                 │         └ <function share_image_url at 0x7f3be7fa2940>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f3be776c670>
                 └ <function run_in_threadpool at 0x7f3bec657af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │     │         │        └ <built-in method run of Context object at 0x7f3be7787280>
                 │     │         └ <function run_sync at 0x7f3bec6749d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
                 │                                        └ <built-in method run of Context object at 0x7f3be7787280>
                 └ <function get_asynclib at 0x7f3bec674310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError('__enter__')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function share_image_url at 0x7f3be7fa2940>, token=Users<kaumil>, image_id='496b023d-5fd8-4e0c-833b-f6386...
             │       │   └ <built-in method run of Context object at 0x7f3be7787280>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f3be69a85c0>

  File "./app/routes/images.py", line 50, in share_image_url
    public_url = make_image_public(image_id=image_id)
                 │                          └ '496b023d-5fd8-4e0c-833b-f6386a601a36'
                 └ <function make_image_public at 0x7f3be9eee040>

  File "./app/models/models.py", line 218, in make_image_public
    with session.client('s3', region_name=region, endpoint_url=os.environ.get("path"),
         │       │                        │                    │  │       └ <function Mapping.get at 0x7f3bf20cd820>
         │       │                        │                    │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
         │       │                        │                    └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f3beb863310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3be77539d0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f3bf101f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f3bf1d979d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f3bf1d97040>
    └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f3bf09b5370>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
    │    └ <function subprocess_started at 0x7f3bee87d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=982753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f3bf09b5460>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f3bee86d550>
           │       │   └ <uvicorn.server.Server object at 0x7f3bf09b5460>
           │       └ <function run at 0x7f3befa2d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3beddcb040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3beddf6280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3beddf6310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3bee1aae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3bed0ddf70>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3bee1aae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be778d1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3be77...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>
          └ <fastapi.applications.FastAPI object at 0x7f3bed0ddf70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3be778d2e0>
                     │    └ <function exception_handler at 0x7f3be7fa2310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3be7753c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3bec49ad10>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3be778d2e0>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7f3bf0948790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3be77539d0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 11:26:42.554 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54366 - "GET /share_image?image_id=496b023d-5fd8-4e0c-833b-f6386a601a36 HTTP/1.1" 500
2022-01-08 11:27:30.287 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:27:30.287 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:27:30.288 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:27:30.389 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:27:30.389 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:27:30.390 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:27:30.390 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:27:30.390 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:27:30.391 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:27:30.391 | INFO     | uvicorn.server:serve:94 - Finished server process [982793]
2022-01-08 11:27:30.392 | INFO     | uvicorn.server:serve:94 - Finished server process [982793]
2022-01-08 11:27:30.393 | INFO     | uvicorn.server:serve:94 - Finished server process [982793]
2022-01-08 11:27:31.560 | INFO     | uvicorn.server:serve:84 - Started server process [983090]
2022-01-08 11:27:31.560 | INFO     | uvicorn.server:serve:84 - Started server process [983090]
2022-01-08 11:27:31.561 | INFO     | uvicorn.server:serve:84 - Started server process [983090]
2022-01-08 11:27:31.561 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:27:31.562 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:27:31.562 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:27:31.563 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:27:31.564 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:27:31.564 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:27:31.966 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:27:31.966 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:27:31.966 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:27:32.067 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:27:32.068 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:27:32.068 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:27:32.069 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:27:32.069 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:27:32.069 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:27:32.069 | INFO     | uvicorn.server:serve:94 - Finished server process [983090]
2022-01-08 11:27:32.070 | INFO     | uvicorn.server:serve:94 - Finished server process [983090]
2022-01-08 11:27:32.070 | INFO     | uvicorn.server:serve:94 - Finished server process [983090]
2022-01-08 11:27:35.458 | INFO     | uvicorn.server:serve:84 - Started server process [983182]
2022-01-08 11:27:35.459 | INFO     | uvicorn.server:serve:84 - Started server process [983182]
2022-01-08 11:27:35.459 | INFO     | uvicorn.server:serve:84 - Started server process [983182]
2022-01-08 11:27:35.459 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:27:35.460 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:27:35.460 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 11:27:35.460 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:27:35.461 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:27:35.461 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 11:27:37.771 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:27:37.862 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 11:27:38.045 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:54424 - "GET /share_image?image_id=496b023d-5fd8-4e0c-833b-f6386a601a36 HTTP/1.1" 200
2022-01-08 11:28:03.355 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:28:03.355 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:28:03.355 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 11:28:03.456 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:28:03.457 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:28:03.457 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 11:28:03.458 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:28:03.458 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:28:03.458 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 11:28:03.459 | INFO     | uvicorn.server:serve:94 - Finished server process [983182]
2022-01-08 11:28:03.459 | INFO     | uvicorn.server:serve:94 - Finished server process [983182]
2022-01-08 11:28:03.459 | INFO     | uvicorn.server:serve:94 - Finished server process [983182]
