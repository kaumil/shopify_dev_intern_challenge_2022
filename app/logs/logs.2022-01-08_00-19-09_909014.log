2022-01-07 00:04:43.131 | INFO     | uvicorn.server:serve:84 - Started server process [717127]
2022-01-07 00:04:43.131 | INFO     | uvicorn.server:serve:84 - Started server process [717127]
2022-01-07 00:04:43.132 | INFO     | uvicorn.server:serve:84 - Started server process [717127]
2022-01-07 00:04:43.132 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:04:43.133 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:04:43.134 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:04:43.135 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:04:43.136 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:04:43.136 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:04:45.065 | INFO     | botocore.credentials:load:1111 - Found credentials in environment variables.
2022-01-07 00:04:50.905 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/internal/utilities.py", line 33, in create_bucket
    response = s3_client.create_bucket(
               │         └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7fbb51a6c040>
               └ <botocore.client.S3 object at 0x7fbb51cdff70>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
    return self._make_api_call(operation_name, kwargs)
           │    │              │               └ {'Bucket': 'imagerepobucket'}
           │    │              └ 'CreateBucket'
           │    └ <function BaseClient._make_api_call at 0x7fbb53bd60d0>
           └ <botocore.client.S3 object at 0x7fbb51cdff70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'CreateBucket'
          │           └ {'Error': {'Code': 'IllegalLocationConstraintException', 'Message': 'The unspecified location constraint is incompatible for ...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb51bcc550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbb51bb47c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbb51bf0c70>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbb51bb47c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbb546fc9d0>
          └ <fastapi.routing.APIRoute object at 0x7fbb51bbf7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbb51bcc0d0>
          └ <fastapi.routing.APIRoute object at 0x7fbb51bbf7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbb507f7a60>
                     └ <function get_request_handler.<locals>.app at 0x7fbb51bcc040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbb546e95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7fbb51bf6e50>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbb51bbf820>
                 └ <function run_in_threadpool at 0x7fbb548d5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbb507f4380>
                 │     │         └ <function run_sync at 0x7fbb548f49d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
                 │                                        └ <built-in method run of Context object at 0x7fbb507f4380>
                 └ <function get_asynclib at 0x7fbb548f4310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=NameError("name 'logger' is not defined")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
             │       │   └ <built-in method run of Context object at 0x7fbb507f4380>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbb50824300>

  File "./app/routes/login.py", line 115, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7fbb51c2c280>

  File "./app/internal/utilities.py", line 61, in sanity_check
    create_bucket("imagerepobucket")
    └ <function create_bucket at 0x7fbb51c2c1f0>

  File "./app/internal/utilities.py", line 36, in create_bucket
    logger.exception('Could not create S3 bucket locally.')

NameError: name 'logger' is not defined


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbb507f7c10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbb5929f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbb5a0159d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbb5a015040>
    └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbb58c35340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
    │    └ <function subprocess_started at 0x7fbb56afb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbb58c35430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbb56aec550>
           │       │   └ <uvicorn.server.Server object at 0x7fbb58c35430>
           │       └ <function run at 0x7fbb57cac700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbb5604b040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbb56080280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbb56080310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbb5642adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbb5535cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbb5642adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>
          └ <fastapi.applications.FastAPI object at 0x7fbb5535cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbb507f7a30>
                     │    └ <function exception_handler at 0x7fbb51bf6a60>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbb5471ba90>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbb507f7a30>
    │      │         └ NameError("name 'logger' is not defined")
    │      └ <function Logger.exception at 0x7fbb58bc7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbb507f7c10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 00:04:50.933 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/internal/utilities.py", line 33, in create_bucket
    response = s3_client.create_bucket(
               │         └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7fbb51a6c040>
               └ <botocore.client.S3 object at 0x7fbb51cdff70>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
    return self._make_api_call(operation_name, kwargs)
           │    │              │               └ {'Bucket': 'imagerepobucket'}
           │    │              └ 'CreateBucket'
           │    └ <function BaseClient._make_api_call at 0x7fbb53bd60d0>
           └ <botocore.client.S3 object at 0x7fbb51cdff70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'CreateBucket'
          │           └ {'Error': {'Code': 'IllegalLocationConstraintException', 'Message': 'The unspecified location constraint is incompatible for ...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb51bcc550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbb51bb47c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbb51bf0c70>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbb51bb47c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbb546fc9d0>
          └ <fastapi.routing.APIRoute object at 0x7fbb51bbf7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbb51bcc0d0>
          └ <fastapi.routing.APIRoute object at 0x7fbb51bbf7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbb507f7a60>
                     └ <function get_request_handler.<locals>.app at 0x7fbb51bcc040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbb546e95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7fbb51bf6e50>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbb51bbf820>
                 └ <function run_in_threadpool at 0x7fbb548d5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbb507f4380>
                 │     │         └ <function run_sync at 0x7fbb548f49d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
                 │                                        └ <built-in method run of Context object at 0x7fbb507f4380>
                 └ <function get_asynclib at 0x7fbb548f4310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=NameError("name 'logger' is not defined")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
             │       │   └ <built-in method run of Context object at 0x7fbb507f4380>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbb50824300>

  File "./app/routes/login.py", line 115, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7fbb51c2c280>

  File "./app/internal/utilities.py", line 61, in sanity_check
    create_bucket("imagerepobucket")
    └ <function create_bucket at 0x7fbb51c2c1f0>

  File "./app/internal/utilities.py", line 36, in create_bucket
    logger.exception('Could not create S3 bucket locally.')

NameError: name 'logger' is not defined


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbb507f7c10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbb5929f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbb5a0159d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbb5a015040>
    └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbb58c35340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
    │    └ <function subprocess_started at 0x7fbb56afb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbb58c35430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbb56aec550>
           │       │   └ <uvicorn.server.Server object at 0x7fbb58c35430>
           │       └ <function run at 0x7fbb57cac700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbb5604b040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbb56080280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbb56080310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbb5642adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbb5535cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbb5642adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>
          └ <fastapi.applications.FastAPI object at 0x7fbb5535cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbb507f7a30>
                     │    └ <function exception_handler at 0x7fbb51bf6a60>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbb5471ba90>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbb507f7a30>
    │      │         └ NameError("name 'logger' is not defined")
    │      └ <function Logger.exception at 0x7fbb58bc7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbb507f7c10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 00:04:50.953 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/internal/utilities.py", line 33, in create_bucket
    response = s3_client.create_bucket(
               │         └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7fbb51a6c040>
               └ <botocore.client.S3 object at 0x7fbb51cdff70>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
    return self._make_api_call(operation_name, kwargs)
           │    │              │               └ {'Bucket': 'imagerepobucket'}
           │    │              └ 'CreateBucket'
           │    └ <function BaseClient._make_api_call at 0x7fbb53bd60d0>
           └ <botocore.client.S3 object at 0x7fbb51cdff70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'CreateBucket'
          │           └ {'Error': {'Code': 'IllegalLocationConstraintException', 'Message': 'The unspecified location constraint is incompatible for ...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbb51bcc550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbb51bb47c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbb51bf0c70>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbb51bb47c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbb546fc9d0>
          └ <fastapi.routing.APIRoute object at 0x7fbb51bbf7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbb51bcc5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbb51bcc0d0>
          └ <fastapi.routing.APIRoute object at 0x7fbb51bbf7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbb507f7a60>
                     └ <function get_request_handler.<locals>.app at 0x7fbb51bcc040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbb546e95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7fbb51bf6e50>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbb51bbf820>
                 └ <function run_in_threadpool at 0x7fbb548d5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbb507f4380>
                 │     │         └ <function run_sync at 0x7fbb548f49d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
                 │                                        └ <built-in method run of Context object at 0x7fbb507f4380>
                 └ <function get_asynclib at 0x7fbb548f4310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=NameError("name 'logger' is not defined")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7fbb51bf6e50>),)
             │       │   └ <built-in method run of Context object at 0x7fbb507f4380>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbb50824300>

  File "./app/routes/login.py", line 115, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7fbb51c2c280>

  File "./app/internal/utilities.py", line 61, in sanity_check
    create_bucket("imagerepobucket")
    └ <function create_bucket at 0x7fbb51c2c1f0>

  File "./app/internal/utilities.py", line 36, in create_bucket
    logger.exception('Could not create S3 bucket locally.')

NameError: name 'logger' is not defined


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbb507f7c10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbb5929f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbb5a0159d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbb5a015040>
    └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbb58c35340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
    │    └ <function subprocess_started at 0x7fbb56afb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=717076 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbb58c35430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbb56aec550>
           │       │   └ <uvicorn.server.Server object at 0x7fbb58c35430>
           │       └ <function run at 0x7fbb57cac700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbb5604b040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbb56080280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbb56080310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f7850>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbb5642adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbb5535cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbb5642adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507f78...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbb507...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>
          └ <fastapi.applications.FastAPI object at 0x7fbb5535cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbb507f7a30>
                     │    └ <function exception_handler at 0x7fbb51bf6a60>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbb51bb4820>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbb5471ba90>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbb507f7a30>
    │      │         └ NameError("name 'logger' is not defined")
    │      └ <function Logger.exception at 0x7fbb58bc7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbb507f7c10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 00:04:50.973 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:55376 - "GET /sanity_check HTTP/1.1" 500
2022-01-07 00:05:17.633 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:05:17.634 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:05:17.634 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:05:17.734 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:05:17.735 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:05:17.735 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:05:17.736 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:05:17.736 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:05:17.736 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:05:17.737 | INFO     | uvicorn.server:serve:94 - Finished server process [717127]
2022-01-07 00:05:17.737 | INFO     | uvicorn.server:serve:94 - Finished server process [717127]
2022-01-07 00:05:17.739 | INFO     | uvicorn.server:serve:94 - Finished server process [717127]
2022-01-07 00:05:18.769 | INFO     | uvicorn.server:serve:84 - Started server process [717369]
2022-01-07 00:05:18.769 | INFO     | uvicorn.server:serve:84 - Started server process [717369]
2022-01-07 00:05:18.770 | INFO     | uvicorn.server:serve:84 - Started server process [717369]
2022-01-07 00:05:18.770 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:05:18.770 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:05:18.771 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:05:18.773 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:05:18.774 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:05:18.774 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:06:41.162 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:06:41.162 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:06:41.163 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:06:41.264 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:06:41.265 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:06:41.266 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:06:41.267 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:06:41.268 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:06:41.268 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:06:41.270 | INFO     | uvicorn.server:serve:94 - Finished server process [717369]
2022-01-07 00:06:41.271 | INFO     | uvicorn.server:serve:94 - Finished server process [717369]
2022-01-07 00:06:41.271 | INFO     | uvicorn.server:serve:94 - Finished server process [717369]
2022-01-07 00:06:42.274 | INFO     | uvicorn.server:serve:84 - Started server process [717682]
2022-01-07 00:06:42.276 | INFO     | uvicorn.server:serve:84 - Started server process [717682]
2022-01-07 00:06:42.276 | INFO     | uvicorn.server:serve:84 - Started server process [717682]
2022-01-07 00:06:42.277 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:06:42.277 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:06:42.277 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:06:42.278 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:06:42.279 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:06:42.280 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:07:27.082 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:07:27.083 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:07:27.083 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:07:27.183 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:07:27.184 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:07:27.184 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:07:27.185 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:07:27.186 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:07:27.187 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:07:27.187 | INFO     | uvicorn.server:serve:94 - Finished server process [717682]
2022-01-07 00:07:27.189 | INFO     | uvicorn.server:serve:94 - Finished server process [717682]
2022-01-07 00:07:27.189 | INFO     | uvicorn.server:serve:94 - Finished server process [717682]
2022-01-07 00:10:35.919 | INFO     | uvicorn.server:serve:84 - Started server process [718851]
2022-01-07 00:10:35.919 | INFO     | uvicorn.server:serve:84 - Started server process [718851]
2022-01-07 00:10:35.920 | INFO     | uvicorn.server:serve:84 - Started server process [718851]
2022-01-07 00:10:35.920 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:10:35.920 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:10:35.921 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:10:35.922 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:10:35.923 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:10:35.924 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:10:54.445 | INFO     | botocore.credentials:load:1111 - Found credentials in environment variables.
2022-01-07 00:10:55.385 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/internal/utilities.py", line 47, in create_bucket
    response = s3_client.create_bucket(
               │         └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f2f6cd46040>
               └ <botocore.client.S3 object at 0x7f2f6cfc3490>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
    return self._make_api_call(operation_name, kwargs)
           │    │              │               └ {'Bucket': 'imagerepobucket'}
           │    │              └ 'CreateBucket'
           │    └ <function BaseClient._make_api_call at 0x7f2f6eeb00d0>
           └ <botocore.client.S3 object at 0x7f2f6cfc3490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'CreateBucket'
          │           └ {'Error': {'Code': 'IllegalLocationConstraintException', 'Message': 'The unspecified location constraint is incompatible for ...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2f6cea65e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2f6ce908b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2f6cecbdc0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2f6ce908b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2f6f9d69d0>
          └ <fastapi.routing.APIRoute object at 0x7f2f6ce9a8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2f6cea6160>
          └ <fastapi.routing.APIRoute object at 0x7f2f6ce9a8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2f6c2cdb50>
                     └ <function get_request_handler.<locals>.app at 0x7f2f6cea60d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2f6f9c35e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f2f6ced0ee0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2f6ce9a910>
                 └ <function run_in_threadpool at 0x7f2f6fbb0af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2f6c2ce640>
                 │     │         └ <function run_sync at 0x7f2f6fbce9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
                 │                                        └ <built-in method run of Context object at 0x7f2f6c2ce640>
                 └ <function get_asynclib at 0x7f2f6fbce310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
             │       │   └ <built-in method run of Context object at 0x7f2f6c2ce640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2f6c2eec40>

  File "./app/routes/login.py", line 115, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f2f6cf06310>

  File "./app/internal/utilities.py", line 74, in sanity_check
    create_bucket("imagerepobucket")
    └ <function create_bucket at 0x7f2f6cf06280>

  File "./app/internal/utilities.py", line 50, in create_bucket
    raise HTTPException('Could not create S3 bucket locally.')
          └ <class 'fastapi.exceptions.HTTPException'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/exceptions.py", line 15, in __init__
    super().__init__(status_code=status_code, detail=detail)
                                 │                   └ None
                                 └ 'Could not create S3 bucket locally.'
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 14, in __init__
    detail = http.HTTPStatus(status_code).phrase
             │    │          └ 'Could not create S3 bucket locally.'
             │    └ <enum 'HTTPStatus'>
             └ <module 'http' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/http/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 304, in __call__
    return cls.__new__(cls, value)
           │   │       │    └ 'Could not create S3 bucket locally.'
           │   │       └ <enum 'HTTPStatus'>
           │   └ <function Enum.__new__ at 0x7f2f752e8550>
           └ <enum 'HTTPStatus'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 595, in __new__
    raise exc
          └ ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 579, in __new__
    result = cls._missing_(value)
             │   │         └ 'Could not create S3 bucket locally.'
             │   └ <classmethod object at 0x7f2f752e6490>
             └ <enum 'HTTPStatus'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 608, in _missing_
    raise ValueError("%r is not a valid %s" % (value, cls.__name__))
                                               │      │   └ <attribute '__name__' of 'type' objects>
                                               │      └ <enum 'HTTPStatus'>
                                               └ 'Could not create S3 bucket locally.'

ValueError: 'Could not create S3 bucket locally.' is not a valid HTTPStatus


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2f6c2cdd00>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2f74579430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2f752ef9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2f752ef040>
    └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2f73f0f340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
    │    └ <function subprocess_started at 0x7f2f71dd5160>
    └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2f73f0f430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2f71dc6550>
           │       │   └ <uvicorn.server.Server object at 0x7f2f73f0f430>
           │       └ <function run at 0x7f2f72f86700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2f71325040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2f71349280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2f71349310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2f71704df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2f70636f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2f71704df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>
          └ <fastapi.applications.FastAPI object at 0x7f2f70636f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2f6c2cdb20>
                     │    └ <function exception_handler at 0x7f2f6ced0af0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2f6f9f5ae0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2f6c2cdb20>
    │      │         └ ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")
    │      └ <function Logger.exception at 0x7f2f73ea1790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2f6c2cdd00>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 00:10:55.418 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/internal/utilities.py", line 47, in create_bucket
    response = s3_client.create_bucket(
               │         └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f2f6cd46040>
               └ <botocore.client.S3 object at 0x7f2f6cfc3490>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
    return self._make_api_call(operation_name, kwargs)
           │    │              │               └ {'Bucket': 'imagerepobucket'}
           │    │              └ 'CreateBucket'
           │    └ <function BaseClient._make_api_call at 0x7f2f6eeb00d0>
           └ <botocore.client.S3 object at 0x7f2f6cfc3490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'CreateBucket'
          │           └ {'Error': {'Code': 'IllegalLocationConstraintException', 'Message': 'The unspecified location constraint is incompatible for ...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2f6cea65e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2f6ce908b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2f6cecbdc0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2f6ce908b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2f6f9d69d0>
          └ <fastapi.routing.APIRoute object at 0x7f2f6ce9a8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2f6cea6160>
          └ <fastapi.routing.APIRoute object at 0x7f2f6ce9a8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2f6c2cdb50>
                     └ <function get_request_handler.<locals>.app at 0x7f2f6cea60d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2f6f9c35e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f2f6ced0ee0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2f6ce9a910>
                 └ <function run_in_threadpool at 0x7f2f6fbb0af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2f6c2ce640>
                 │     │         └ <function run_sync at 0x7f2f6fbce9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
                 │                                        └ <built-in method run of Context object at 0x7f2f6c2ce640>
                 └ <function get_asynclib at 0x7f2f6fbce310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
             │       │   └ <built-in method run of Context object at 0x7f2f6c2ce640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2f6c2eec40>

  File "./app/routes/login.py", line 115, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f2f6cf06310>

  File "./app/internal/utilities.py", line 74, in sanity_check
    create_bucket("imagerepobucket")
    └ <function create_bucket at 0x7f2f6cf06280>

  File "./app/internal/utilities.py", line 50, in create_bucket
    raise HTTPException('Could not create S3 bucket locally.')
          └ <class 'fastapi.exceptions.HTTPException'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/exceptions.py", line 15, in __init__
    super().__init__(status_code=status_code, detail=detail)
                                 │                   └ None
                                 └ 'Could not create S3 bucket locally.'
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 14, in __init__
    detail = http.HTTPStatus(status_code).phrase
             │    │          └ 'Could not create S3 bucket locally.'
             │    └ <enum 'HTTPStatus'>
             └ <module 'http' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/http/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 304, in __call__
    return cls.__new__(cls, value)
           │   │       │    └ 'Could not create S3 bucket locally.'
           │   │       └ <enum 'HTTPStatus'>
           │   └ <function Enum.__new__ at 0x7f2f752e8550>
           └ <enum 'HTTPStatus'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 595, in __new__
    raise exc
          └ ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 579, in __new__
    result = cls._missing_(value)
             │   │         └ 'Could not create S3 bucket locally.'
             │   └ <classmethod object at 0x7f2f752e6490>
             └ <enum 'HTTPStatus'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 608, in _missing_
    raise ValueError("%r is not a valid %s" % (value, cls.__name__))
                                               │      │   └ <attribute '__name__' of 'type' objects>
                                               │      └ <enum 'HTTPStatus'>
                                               └ 'Could not create S3 bucket locally.'

ValueError: 'Could not create S3 bucket locally.' is not a valid HTTPStatus


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2f6c2cdd00>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2f74579430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2f752ef9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2f752ef040>
    └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2f73f0f340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
    │    └ <function subprocess_started at 0x7f2f71dd5160>
    └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2f73f0f430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2f71dc6550>
           │       │   └ <uvicorn.server.Server object at 0x7f2f73f0f430>
           │       └ <function run at 0x7f2f72f86700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2f71325040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2f71349280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2f71349310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2f71704df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2f70636f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2f71704df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>
          └ <fastapi.applications.FastAPI object at 0x7f2f70636f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2f6c2cdb20>
                     │    └ <function exception_handler at 0x7f2f6ced0af0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2f6f9f5ae0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2f6c2cdb20>
    │      │         └ ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")
    │      └ <function Logger.exception at 0x7f2f73ea1790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2f6c2cdd00>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 00:10:55.452 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "./app/internal/utilities.py", line 47, in create_bucket
    response = s3_client.create_bucket(
               │         └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f2f6cd46040>
               └ <botocore.client.S3 object at 0x7f2f6cfc3490>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 391, in _api_call
    return self._make_api_call(operation_name, kwargs)
           │    │              │               └ {'Bucket': 'imagerepobucket'}
           │    │              └ 'CreateBucket'
           │    └ <function BaseClient._make_api_call at 0x7f2f6eeb00d0>
           └ <botocore.client.S3 object at 0x7f2f6cfc3490>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 719, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'CreateBucket'
          │           └ {'Error': {'Code': 'IllegalLocationConstraintException', 'Message': 'The unspecified location constraint is incompatible for ...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (IllegalLocationConstraintException) when calling the CreateBucket operation: The unspecified location constraint is incompatible for the region specific endpoint this request was sent to.


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2f6cea65e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2f6ce908b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2f6cecbdc0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2f6ce908b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2f6f9d69d0>
          └ <fastapi.routing.APIRoute object at 0x7f2f6ce9a8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2f6cea6670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2f6cea6160>
          └ <fastapi.routing.APIRoute object at 0x7f2f6ce9a8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2f6c2cdb50>
                     └ <function get_request_handler.<locals>.app at 0x7f2f6cea60d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2f6f9c35e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f2f6ced0ee0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2f6ce9a910>
                 └ <function run_in_threadpool at 0x7f2f6fbb0af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2f6c2ce640>
                 │     │         └ <function run_sync at 0x7f2f6fbce9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
                 │                                        └ <built-in method run of Context object at 0x7f2f6c2ce640>
                 └ <function get_asynclib at 0x7f2f6fbce310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f2f6ced0ee0>),)
             │       │   └ <built-in method run of Context object at 0x7f2f6c2ce640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2f6c2eec40>

  File "./app/routes/login.py", line 115, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f2f6cf06310>

  File "./app/internal/utilities.py", line 74, in sanity_check
    create_bucket("imagerepobucket")
    └ <function create_bucket at 0x7f2f6cf06280>

  File "./app/internal/utilities.py", line 50, in create_bucket
    raise HTTPException('Could not create S3 bucket locally.')
          └ <class 'fastapi.exceptions.HTTPException'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/exceptions.py", line 15, in __init__
    super().__init__(status_code=status_code, detail=detail)
                                 │                   └ None
                                 └ 'Could not create S3 bucket locally.'
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 14, in __init__
    detail = http.HTTPStatus(status_code).phrase
             │    │          └ 'Could not create S3 bucket locally.'
             │    └ <enum 'HTTPStatus'>
             └ <module 'http' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/http/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 304, in __call__
    return cls.__new__(cls, value)
           │   │       │    └ 'Could not create S3 bucket locally.'
           │   │       └ <enum 'HTTPStatus'>
           │   └ <function Enum.__new__ at 0x7f2f752e8550>
           └ <enum 'HTTPStatus'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 595, in __new__
    raise exc
          └ ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 579, in __new__
    result = cls._missing_(value)
             │   │         └ 'Could not create S3 bucket locally.'
             │   └ <classmethod object at 0x7f2f752e6490>
             └ <enum 'HTTPStatus'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/enum.py", line 608, in _missing_
    raise ValueError("%r is not a valid %s" % (value, cls.__name__))
                                               │      │   └ <attribute '__name__' of 'type' objects>
                                               │      └ <enum 'HTTPStatus'>
                                               └ 'Could not create S3 bucket locally.'

ValueError: 'Could not create S3 bucket locally.' is not a valid HTTPStatus


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2f6c2cdd00>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2f74579430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2f752ef9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2f752ef040>
    └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2f73f0f340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
    │    └ <function subprocess_started at 0x7f2f71dd5160>
    └ <SpawnProcess name='SpawnProcess-1' parent=718814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2f73f0f430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2f71dc6550>
           │       │   └ <uvicorn.server.Server object at 0x7f2f73f0f430>
           │       └ <function run at 0x7f2f72f86700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2f71325040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2f71349280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2f71349310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2f71704df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2f70636f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2f71704df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2cd9...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2f6c2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>
          └ <fastapi.applications.FastAPI object at 0x7f2f70636f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2f6c2cdb20>
                     │    └ <function exception_handler at 0x7f2f6ced0af0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2f6ce90910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2f6f9f5ae0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2f6c2cdb20>
    │      │         └ ValueError("'Could not create S3 bucket locally.' is not a valid HTTPStatus")
    │      └ <function Logger.exception at 0x7f2f73ea1790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2f6c2cdd00>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 00:10:55.480 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:55548 - "GET /sanity_check HTTP/1.1" 500
2022-01-07 00:11:48.706 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:11:48.707 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:11:48.708 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:11:48.810 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:11:48.811 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:11:48.812 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:11:48.813 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:11:48.814 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:11:48.814 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:11:48.815 | INFO     | uvicorn.server:serve:94 - Finished server process [718851]
2022-01-07 00:11:48.816 | INFO     | uvicorn.server:serve:94 - Finished server process [718851]
2022-01-07 00:11:48.816 | INFO     | uvicorn.server:serve:94 - Finished server process [718851]
2022-01-07 00:11:50.097 | INFO     | uvicorn.server:serve:84 - Started server process [719272]
2022-01-07 00:11:50.098 | INFO     | uvicorn.server:serve:84 - Started server process [719272]
2022-01-07 00:11:50.099 | INFO     | uvicorn.server:serve:84 - Started server process [719272]
2022-01-07 00:11:50.100 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:11:50.101 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:11:50.101 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:11:50.103 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:11:50.103 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:11:50.104 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:11:50.405 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:11:50.406 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:11:50.406 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:11:50.507 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:11:50.509 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:11:50.510 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:11:50.511 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:11:50.512 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:11:50.513 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:11:50.514 | INFO     | uvicorn.server:serve:94 - Finished server process [719272]
2022-01-07 00:11:50.514 | INFO     | uvicorn.server:serve:94 - Finished server process [719272]
2022-01-07 00:11:50.514 | INFO     | uvicorn.server:serve:94 - Finished server process [719272]
2022-01-07 00:11:53.972 | INFO     | uvicorn.server:serve:84 - Started server process [719383]
2022-01-07 00:11:53.972 | INFO     | uvicorn.server:serve:84 - Started server process [719383]
2022-01-07 00:11:53.972 | INFO     | uvicorn.server:serve:84 - Started server process [719383]
2022-01-07 00:11:53.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:11:53.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:11:53.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:11:53.974 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:11:53.974 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:11:53.975 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:11:56.268 | INFO     | botocore.credentials:load:1233 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 00:11:56.347 | INFO     | botocore.credentials:load:1111 - Found credentials in environment variables.
2022-01-07 00:11:56.480 | INFO     | botocore.credentials:load:1111 - Found credentials in environment variables.
2022-01-07 00:11:56.564 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:55588 - "GET /sanity_check HTTP/1.1" 200
2022-01-07 00:12:10.634 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:12:10.635 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:12:10.635 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:12:10.736 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:12:10.737 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:12:10.738 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:12:10.740 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:12:10.741 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:12:10.741 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:12:10.742 | INFO     | uvicorn.server:serve:94 - Finished server process [719383]
2022-01-07 00:12:10.742 | INFO     | uvicorn.server:serve:94 - Finished server process [719383]
2022-01-07 00:12:10.743 | INFO     | uvicorn.server:serve:94 - Finished server process [719383]
2022-01-07 00:12:11.933 | INFO     | uvicorn.server:serve:84 - Started server process [719516]
2022-01-07 00:12:11.934 | INFO     | uvicorn.server:serve:84 - Started server process [719516]
2022-01-07 00:12:11.935 | INFO     | uvicorn.server:serve:84 - Started server process [719516]
2022-01-07 00:12:11.935 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:12:11.936 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:12:11.936 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:12:11.937 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:12:11.938 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:12:11.939 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:12:13.430 | INFO     | botocore.credentials:load:1233 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 00:12:13.514 | INFO     | botocore.credentials:load:1111 - Found credentials in environment variables.
2022-01-07 00:12:13.652 | INFO     | botocore.credentials:load:1111 - Found credentials in environment variables.
2022-01-07 00:12:13.746 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:55628 - "GET /sanity_check HTTP/1.1" 200
2022-01-07 00:17:45.763 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:17:45.766 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:17:45.767 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:17:45.868 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:17:45.869 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:17:45.870 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:17:45.871 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:17:45.872 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:17:45.873 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:17:45.873 | INFO     | uvicorn.server:serve:94 - Finished server process [719516]
2022-01-07 00:17:45.876 | INFO     | uvicorn.server:serve:94 - Finished server process [719516]
2022-01-07 00:17:45.877 | INFO     | uvicorn.server:serve:94 - Finished server process [719516]
2022-01-07 00:17:46.797 | INFO     | uvicorn.server:serve:84 - Started server process [720743]
2022-01-07 00:17:46.798 | INFO     | uvicorn.server:serve:84 - Started server process [720743]
2022-01-07 00:17:46.799 | INFO     | uvicorn.server:serve:84 - Started server process [720743]
2022-01-07 00:17:46.799 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:17:46.800 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:17:46.800 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:17:46.801 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:17:46.802 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:17:46.803 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:23:28.078 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:23:28.079 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:23:28.080 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:23:28.181 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:23:28.182 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:23:28.182 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:23:28.184 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:23:28.185 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:23:28.186 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:23:28.187 | INFO     | uvicorn.server:serve:94 - Finished server process [720743]
2022-01-07 00:23:28.188 | INFO     | uvicorn.server:serve:94 - Finished server process [720743]
2022-01-07 00:23:28.189 | INFO     | uvicorn.server:serve:94 - Finished server process [720743]
2022-01-07 00:23:29.281 | INFO     | uvicorn.server:serve:84 - Started server process [722445]
2022-01-07 00:23:29.281 | INFO     | uvicorn.server:serve:84 - Started server process [722445]
2022-01-07 00:23:29.282 | INFO     | uvicorn.server:serve:84 - Started server process [722445]
2022-01-07 00:23:29.282 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:23:29.283 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:23:29.283 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:23:29.284 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:23:29.285 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:23:29.285 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:25:02.099 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:25:02.100 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:25:02.100 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:25:02.201 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:25:02.201 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:25:02.201 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:25:02.202 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:25:02.203 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:25:02.204 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:25:02.205 | INFO     | uvicorn.server:serve:94 - Finished server process [722445]
2022-01-07 00:25:02.205 | INFO     | uvicorn.server:serve:94 - Finished server process [722445]
2022-01-07 00:25:02.206 | INFO     | uvicorn.server:serve:94 - Finished server process [722445]
2022-01-07 00:25:03.131 | INFO     | uvicorn.server:serve:84 - Started server process [722869]
2022-01-07 00:25:03.132 | INFO     | uvicorn.server:serve:84 - Started server process [722869]
2022-01-07 00:25:03.133 | INFO     | uvicorn.server:serve:84 - Started server process [722869]
2022-01-07 00:25:03.134 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:25:03.134 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:25:03.135 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:25:03.135 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:25:03.136 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:25:03.136 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:28:44.837 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:28:44.837 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:28:44.838 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 00:28:44.939 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:28:44.939 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:28:44.940 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 00:28:44.941 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:28:44.941 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:28:44.942 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 00:28:44.943 | INFO     | uvicorn.server:serve:94 - Finished server process [722869]
2022-01-07 00:28:44.943 | INFO     | uvicorn.server:serve:94 - Finished server process [722869]
2022-01-07 00:28:44.943 | INFO     | uvicorn.server:serve:94 - Finished server process [722869]
2022-01-07 00:28:46.106 | INFO     | uvicorn.server:serve:84 - Started server process [723640]
2022-01-07 00:28:46.107 | INFO     | uvicorn.server:serve:84 - Started server process [723640]
2022-01-07 00:28:46.108 | INFO     | uvicorn.server:serve:84 - Started server process [723640]
2022-01-07 00:28:46.109 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:28:46.109 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:28:46.111 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 00:28:46.114 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:28:46.114 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 00:28:46.115 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:29:41.110 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:29:41.110 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:29:41.111 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:29:41.211 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:29:41.212 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:29:41.212 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:29:41.213 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:29:41.214 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:29:41.215 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:29:41.215 | INFO     | uvicorn.server:serve:94 - Finished server process [723640]
2022-01-07 09:29:41.216 | INFO     | uvicorn.server:serve:94 - Finished server process [723640]
2022-01-07 09:29:41.216 | INFO     | uvicorn.server:serve:94 - Finished server process [723640]
2022-01-07 09:29:41.953 | INFO     | uvicorn.server:serve:84 - Started server process [726508]
2022-01-07 09:29:41.954 | INFO     | uvicorn.server:serve:84 - Started server process [726508]
2022-01-07 09:29:41.955 | INFO     | uvicorn.server:serve:84 - Started server process [726508]
2022-01-07 09:29:41.955 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:29:41.956 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:29:41.956 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:29:41.957 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:29:41.957 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:29:41.958 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:31:31.100 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:31:31.101 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:31:31.102 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:31:31.203 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:31:31.203 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:31:31.204 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:31:31.204 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:31:31.205 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:31:31.205 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:31:31.206 | INFO     | uvicorn.server:serve:94 - Finished server process [726508]
2022-01-07 09:31:31.207 | INFO     | uvicorn.server:serve:94 - Finished server process [726508]
2022-01-07 09:31:31.207 | INFO     | uvicorn.server:serve:94 - Finished server process [726508]
2022-01-07 09:31:31.938 | INFO     | uvicorn.server:serve:84 - Started server process [727035]
2022-01-07 09:31:31.938 | INFO     | uvicorn.server:serve:84 - Started server process [727035]
2022-01-07 09:31:31.938 | INFO     | uvicorn.server:serve:84 - Started server process [727035]
2022-01-07 09:31:31.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:31:31.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:31:31.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:31:31.940 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:31:31.941 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:31:31.942 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:31:54.700 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:31:54.700 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:31:54.700 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:31:54.801 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:31:54.802 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:31:54.803 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:31:54.804 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:31:54.805 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:31:54.806 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:31:54.807 | INFO     | uvicorn.server:serve:94 - Finished server process [727035]
2022-01-07 09:31:54.808 | INFO     | uvicorn.server:serve:94 - Finished server process [727035]
2022-01-07 09:31:54.809 | INFO     | uvicorn.server:serve:94 - Finished server process [727035]
2022-01-07 09:31:55.483 | INFO     | uvicorn.server:serve:84 - Started server process [727200]
2022-01-07 09:31:55.484 | INFO     | uvicorn.server:serve:84 - Started server process [727200]
2022-01-07 09:31:55.484 | INFO     | uvicorn.server:serve:84 - Started server process [727200]
2022-01-07 09:31:55.485 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:31:55.485 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:31:55.486 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:31:55.487 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:31:55.487 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:31:55.488 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:33:12.086 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:33:12.086 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:33:12.087 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:33:12.188 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:33:12.189 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:33:12.189 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:33:12.190 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:33:12.190 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:33:12.191 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:33:12.191 | INFO     | uvicorn.server:serve:94 - Finished server process [727200]
2022-01-07 09:33:12.192 | INFO     | uvicorn.server:serve:94 - Finished server process [727200]
2022-01-07 09:33:12.192 | INFO     | uvicorn.server:serve:94 - Finished server process [727200]
2022-01-07 09:33:13.153 | INFO     | uvicorn.server:serve:84 - Started server process [727558]
2022-01-07 09:33:13.153 | INFO     | uvicorn.server:serve:84 - Started server process [727558]
2022-01-07 09:33:13.153 | INFO     | uvicorn.server:serve:84 - Started server process [727558]
2022-01-07 09:33:13.154 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:33:13.154 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:33:13.154 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:33:13.155 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:33:13.155 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:33:13.155 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:37:29.667 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:37:29.668 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:37:29.668 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:37:29.769 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:37:29.769 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:37:29.770 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:37:29.770 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:37:29.771 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:37:29.771 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:37:29.771 | INFO     | uvicorn.server:serve:94 - Finished server process [727558]
2022-01-07 09:37:29.772 | INFO     | uvicorn.server:serve:94 - Finished server process [727558]
2022-01-07 09:37:29.772 | INFO     | uvicorn.server:serve:94 - Finished server process [727558]
2022-01-07 09:37:30.858 | INFO     | uvicorn.server:serve:84 - Started server process [728556]
2022-01-07 09:37:30.859 | INFO     | uvicorn.server:serve:84 - Started server process [728556]
2022-01-07 09:37:30.859 | INFO     | uvicorn.server:serve:84 - Started server process [728556]
2022-01-07 09:37:30.859 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:37:30.860 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:37:30.860 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:37:30.860 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:37:30.861 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:37:30.861 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:38:51.854 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:38:51.854 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:38:51.855 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:38:51.955 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:38:51.956 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:38:51.956 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:38:51.957 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:38:51.959 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:38:51.960 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:38:51.960 | INFO     | uvicorn.server:serve:94 - Finished server process [728556]
2022-01-07 09:38:51.961 | INFO     | uvicorn.server:serve:94 - Finished server process [728556]
2022-01-07 09:38:51.961 | INFO     | uvicorn.server:serve:94 - Finished server process [728556]
2022-01-07 09:38:52.943 | INFO     | uvicorn.server:serve:84 - Started server process [729497]
2022-01-07 09:38:52.944 | INFO     | uvicorn.server:serve:84 - Started server process [729497]
2022-01-07 09:38:52.944 | INFO     | uvicorn.server:serve:84 - Started server process [729497]
2022-01-07 09:38:52.945 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:38:52.945 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:38:52.946 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:38:52.947 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:38:52.948 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:38:52.948 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:39:58.514 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:39:58.515 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:39:58.515 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:39:58.616 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:39:58.617 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:39:58.617 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:39:58.618 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:39:58.618 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:39:58.619 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:39:58.620 | INFO     | uvicorn.server:serve:94 - Finished server process [729497]
2022-01-07 09:39:58.621 | INFO     | uvicorn.server:serve:94 - Finished server process [729497]
2022-01-07 09:39:58.622 | INFO     | uvicorn.server:serve:94 - Finished server process [729497]
2022-01-07 09:39:59.617 | INFO     | uvicorn.server:serve:84 - Started server process [729827]
2022-01-07 09:39:59.618 | INFO     | uvicorn.server:serve:84 - Started server process [729827]
2022-01-07 09:39:59.618 | INFO     | uvicorn.server:serve:84 - Started server process [729827]
2022-01-07 09:39:59.618 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:39:59.619 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:39:59.620 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:39:59.620 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:39:59.621 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:39:59.622 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:51:33.104 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:51:33.104 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:51:33.105 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 09:51:33.206 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:51:33.206 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:51:33.207 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 09:51:33.207 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:51:33.208 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:51:33.208 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 09:51:33.211 | INFO     | uvicorn.server:serve:94 - Finished server process [729827]
2022-01-07 09:51:33.212 | INFO     | uvicorn.server:serve:94 - Finished server process [729827]
2022-01-07 09:51:33.213 | INFO     | uvicorn.server:serve:94 - Finished server process [729827]
2022-01-07 09:51:33.975 | INFO     | uvicorn.server:serve:84 - Started server process [732548]
2022-01-07 09:51:33.976 | INFO     | uvicorn.server:serve:84 - Started server process [732548]
2022-01-07 09:51:33.977 | INFO     | uvicorn.server:serve:84 - Started server process [732548]
2022-01-07 09:51:33.977 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:51:33.977 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:51:33.978 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 09:51:33.980 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:51:33.981 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 09:51:33.983 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:10:51.061 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:10:51.062 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:10:51.062 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:10:51.163 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:10:51.163 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:10:51.163 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:10:51.164 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:10:51.164 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:10:51.165 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:10:51.165 | INFO     | uvicorn.server:serve:94 - Finished server process [732548]
2022-01-07 10:10:51.165 | INFO     | uvicorn.server:serve:94 - Finished server process [732548]
2022-01-07 10:10:51.166 | INFO     | uvicorn.server:serve:94 - Finished server process [732548]
2022-01-07 10:10:51.827 | INFO     | uvicorn.server:serve:84 - Started server process [737133]
2022-01-07 10:10:51.828 | INFO     | uvicorn.server:serve:84 - Started server process [737133]
2022-01-07 10:10:51.828 | INFO     | uvicorn.server:serve:84 - Started server process [737133]
2022-01-07 10:10:51.829 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:10:51.829 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:10:51.829 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:10:51.831 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:10:51.832 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:10:51.832 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:11:08.571 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:11:08.571 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:11:08.572 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:11:08.672 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:11:08.673 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:11:08.673 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:11:08.674 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:11:08.674 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:11:08.674 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:11:08.675 | INFO     | uvicorn.server:serve:94 - Finished server process [737133]
2022-01-07 10:11:08.676 | INFO     | uvicorn.server:serve:94 - Finished server process [737133]
2022-01-07 10:11:08.676 | INFO     | uvicorn.server:serve:94 - Finished server process [737133]
2022-01-07 10:11:09.403 | INFO     | uvicorn.server:serve:84 - Started server process [737279]
2022-01-07 10:11:09.404 | INFO     | uvicorn.server:serve:84 - Started server process [737279]
2022-01-07 10:11:09.404 | INFO     | uvicorn.server:serve:84 - Started server process [737279]
2022-01-07 10:11:09.404 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:11:09.405 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:11:09.405 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:11:09.406 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:11:09.406 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:11:09.407 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:11:39.184 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:11:39.185 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:11:39.186 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:11:39.287 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:11:39.287 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:11:39.287 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:11:39.288 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:11:39.288 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:11:39.289 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:11:39.289 | INFO     | uvicorn.server:serve:94 - Finished server process [737279]
2022-01-07 10:11:39.290 | INFO     | uvicorn.server:serve:94 - Finished server process [737279]
2022-01-07 10:11:39.290 | INFO     | uvicorn.server:serve:94 - Finished server process [737279]
2022-01-07 10:11:39.959 | INFO     | uvicorn.server:serve:84 - Started server process [737437]
2022-01-07 10:11:39.960 | INFO     | uvicorn.server:serve:84 - Started server process [737437]
2022-01-07 10:11:39.960 | INFO     | uvicorn.server:serve:84 - Started server process [737437]
2022-01-07 10:11:39.961 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:11:39.961 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:11:39.962 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:11:39.963 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:11:39.964 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:11:39.964 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:13:07.571 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:13:07.571 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:13:07.572 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:13:07.672 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:13:07.673 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:13:07.673 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:13:07.673 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:13:07.674 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:13:07.674 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:13:07.675 | INFO     | uvicorn.server:serve:94 - Finished server process [737437]
2022-01-07 10:13:07.675 | INFO     | uvicorn.server:serve:94 - Finished server process [737437]
2022-01-07 10:13:07.675 | INFO     | uvicorn.server:serve:94 - Finished server process [737437]
2022-01-07 10:13:08.339 | INFO     | uvicorn.server:serve:84 - Started server process [738043]
2022-01-07 10:13:08.339 | INFO     | uvicorn.server:serve:84 - Started server process [738043]
2022-01-07 10:13:08.339 | INFO     | uvicorn.server:serve:84 - Started server process [738043]
2022-01-07 10:13:08.340 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:13:08.340 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:13:08.340 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:13:08.341 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:13:08.342 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:13:08.343 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:13:31.396 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:13:31.396 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:13:31.397 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:13:31.498 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:13:31.498 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:13:31.499 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:13:31.499 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:13:31.500 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:13:31.500 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:13:31.501 | INFO     | uvicorn.server:serve:94 - Finished server process [738043]
2022-01-07 10:13:31.501 | INFO     | uvicorn.server:serve:94 - Finished server process [738043]
2022-01-07 10:13:31.501 | INFO     | uvicorn.server:serve:94 - Finished server process [738043]
2022-01-07 10:13:32.267 | INFO     | uvicorn.server:serve:84 - Started server process [738313]
2022-01-07 10:13:32.267 | INFO     | uvicorn.server:serve:84 - Started server process [738313]
2022-01-07 10:13:32.267 | INFO     | uvicorn.server:serve:84 - Started server process [738313]
2022-01-07 10:13:32.268 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:13:32.268 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:13:32.268 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:13:32.269 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:13:32.269 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:13:32.270 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:14:00.446 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:14:00.447 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:14:00.447 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:14:00.548 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:14:00.549 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:14:00.550 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:14:00.550 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:14:00.550 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:14:00.551 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:14:00.551 | INFO     | uvicorn.server:serve:94 - Finished server process [738313]
2022-01-07 10:14:00.551 | INFO     | uvicorn.server:serve:94 - Finished server process [738313]
2022-01-07 10:14:00.552 | INFO     | uvicorn.server:serve:94 - Finished server process [738313]
2022-01-07 10:14:01.242 | INFO     | uvicorn.server:serve:84 - Started server process [738494]
2022-01-07 10:14:01.243 | INFO     | uvicorn.server:serve:84 - Started server process [738494]
2022-01-07 10:14:01.243 | INFO     | uvicorn.server:serve:84 - Started server process [738494]
2022-01-07 10:14:01.243 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:14:01.244 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:14:01.244 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:14:01.246 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:14:01.246 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:14:01.247 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:14:07.263 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:14:07.264 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:14:07.264 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:14:07.365 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:14:07.365 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:14:07.366 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:14:07.366 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:14:07.366 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:14:07.367 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:14:07.367 | INFO     | uvicorn.server:serve:94 - Finished server process [738494]
2022-01-07 10:14:07.368 | INFO     | uvicorn.server:serve:94 - Finished server process [738494]
2022-01-07 10:14:07.368 | INFO     | uvicorn.server:serve:94 - Finished server process [738494]
2022-01-07 10:14:08.273 | INFO     | uvicorn.server:serve:84 - Started server process [738596]
2022-01-07 10:14:08.274 | INFO     | uvicorn.server:serve:84 - Started server process [738596]
2022-01-07 10:14:08.274 | INFO     | uvicorn.server:serve:84 - Started server process [738596]
2022-01-07 10:14:08.275 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:14:08.275 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:14:08.276 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:14:08.276 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:14:08.277 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:14:08.277 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:15:04.408 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:15:04.409 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:15:04.409 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:15:04.510 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:15:04.511 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:15:04.511 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:15:04.512 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:15:04.513 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:15:04.514 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:15:04.514 | INFO     | uvicorn.server:serve:94 - Finished server process [738596]
2022-01-07 10:15:04.515 | INFO     | uvicorn.server:serve:94 - Finished server process [738596]
2022-01-07 10:15:04.515 | INFO     | uvicorn.server:serve:94 - Finished server process [738596]
2022-01-07 10:15:05.248 | INFO     | uvicorn.server:serve:84 - Started server process [738855]
2022-01-07 10:15:05.249 | INFO     | uvicorn.server:serve:84 - Started server process [738855]
2022-01-07 10:15:05.249 | INFO     | uvicorn.server:serve:84 - Started server process [738855]
2022-01-07 10:15:05.249 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:15:05.250 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:15:05.250 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:15:05.251 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:15:05.251 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:15:05.252 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:15:27.206 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:15:27.207 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:15:27.207 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:15:27.308 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:15:27.309 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:15:27.309 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:15:27.310 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:15:27.310 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:15:27.310 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:15:27.311 | INFO     | uvicorn.server:serve:94 - Finished server process [738855]
2022-01-07 10:15:27.311 | INFO     | uvicorn.server:serve:94 - Finished server process [738855]
2022-01-07 10:15:27.312 | INFO     | uvicorn.server:serve:94 - Finished server process [738855]
2022-01-07 10:15:28.233 | INFO     | uvicorn.server:serve:84 - Started server process [739009]
2022-01-07 10:15:28.234 | INFO     | uvicorn.server:serve:84 - Started server process [739009]
2022-01-07 10:15:28.234 | INFO     | uvicorn.server:serve:84 - Started server process [739009]
2022-01-07 10:15:28.235 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:15:28.235 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:15:28.235 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:15:28.236 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:15:28.237 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:15:28.238 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:16:26.081 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:16:26.081 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:16:26.082 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:16:26.182 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:16:26.183 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:16:26.183 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:16:26.184 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:16:26.184 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:16:26.185 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:16:26.185 | INFO     | uvicorn.server:serve:94 - Finished server process [739009]
2022-01-07 10:16:26.186 | INFO     | uvicorn.server:serve:94 - Finished server process [739009]
2022-01-07 10:16:26.186 | INFO     | uvicorn.server:serve:94 - Finished server process [739009]
2022-01-07 10:16:27.127 | INFO     | uvicorn.server:serve:84 - Started server process [739303]
2022-01-07 10:16:27.127 | INFO     | uvicorn.server:serve:84 - Started server process [739303]
2022-01-07 10:16:27.128 | INFO     | uvicorn.server:serve:84 - Started server process [739303]
2022-01-07 10:16:27.128 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:16:27.128 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:16:27.129 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:16:27.129 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:16:27.129 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:16:27.130 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:20:37.133 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:20:37.133 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:20:37.133 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:20:37.234 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:20:37.235 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:20:37.235 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:20:37.238 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:20:37.238 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:20:37.239 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:20:37.239 | INFO     | uvicorn.server:serve:94 - Finished server process [739303]
2022-01-07 10:20:37.240 | INFO     | uvicorn.server:serve:94 - Finished server process [739303]
2022-01-07 10:20:37.240 | INFO     | uvicorn.server:serve:94 - Finished server process [739303]
2022-01-07 10:20:38.188 | INFO     | uvicorn.server:serve:84 - Started server process [740234]
2022-01-07 10:20:38.188 | INFO     | uvicorn.server:serve:84 - Started server process [740234]
2022-01-07 10:20:38.189 | INFO     | uvicorn.server:serve:84 - Started server process [740234]
2022-01-07 10:20:38.189 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:20:38.189 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:20:38.189 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:20:38.190 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:20:38.191 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:20:38.191 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:21:25.308 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:21:25.309 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:21:25.309 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:21:25.410 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:21:25.410 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:21:25.410 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:21:25.411 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:21:25.411 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:21:25.411 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:21:25.412 | INFO     | uvicorn.server:serve:94 - Finished server process [740234]
2022-01-07 10:21:25.412 | INFO     | uvicorn.server:serve:94 - Finished server process [740234]
2022-01-07 10:21:25.413 | INFO     | uvicorn.server:serve:94 - Finished server process [740234]
2022-01-07 10:21:26.080 | INFO     | uvicorn.server:serve:84 - Started server process [740453]
2022-01-07 10:21:26.081 | INFO     | uvicorn.server:serve:84 - Started server process [740453]
2022-01-07 10:21:26.081 | INFO     | uvicorn.server:serve:84 - Started server process [740453]
2022-01-07 10:21:26.081 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:21:26.082 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:21:26.082 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:21:26.083 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:21:26.083 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:21:26.083 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:22:03.279 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:22:03.279 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:22:03.279 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:22:03.380 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:22:03.380 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:22:03.381 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:22:03.381 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:22:03.382 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:22:03.383 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:22:03.383 | INFO     | uvicorn.server:serve:94 - Finished server process [740453]
2022-01-07 10:22:03.383 | INFO     | uvicorn.server:serve:94 - Finished server process [740453]
2022-01-07 10:22:03.384 | INFO     | uvicorn.server:serve:94 - Finished server process [740453]
2022-01-07 10:22:11.241 | INFO     | uvicorn.server:serve:84 - Started server process [741188]
2022-01-07 10:22:11.241 | INFO     | uvicorn.server:serve:84 - Started server process [741188]
2022-01-07 10:22:11.242 | INFO     | uvicorn.server:serve:84 - Started server process [741188]
2022-01-07 10:22:11.242 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:22:11.242 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:22:11.243 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:22:11.243 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:22:11.243 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:22:11.244 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:22:32.241 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57744 - "GET / HTTP/1.1" 404
2022-01-07 10:22:32.450 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57744 - "GET /favicon.ico HTTP/1.1" 404
2022-01-07 10:22:36.762 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57744 - "GET /docs HTTP/1.1" 200
2022-01-07 10:22:37.251 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57744 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:22:55.380 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 10:22:55.779 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57748 - "POST /login HTTP/1.1" 202
2022-01-07 10:23:12.302 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f1d6e281280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1d703a78e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f1d703fd520>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1d703a78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f1d72efa9d0>
          └ <fastapi.routing.APIRoute object at 0x7f1d703b11c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f1d7039dee0>
          └ <fastapi.routing.APIRoute object at 0x7f1d703b11c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1d6e276460>
                     └ <function get_request_handler.<locals>.app at 0x7f1d7039de50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f1d72ee95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f1d6eff40a0>}
                 │                 │         └ <function login at 0x7f1d703e8c10>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f1d703b11f0>
                 └ <function run_in_threadpool at 0x7f1d730d4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
                 │     │         │        └ <built-in method run of Context object at 0x7f1d703c2a40>
                 │     │         └ <function run_sync at 0x7f1d730f29d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
                 │                                        └ <built-in method run of Context object at 0x7f1d703c2a40>
                 └ <function get_asynclib at 0x7f1d730f2310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=UnknownHashError('hash could not be identified', None)>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
             │       │   └ <built-in method run of Context object at 0x7f1d703c2a40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f1d703c2680>

  File "./app/routes/login.py", line 96, in login
    user = authenticate_user(username,password)
           │                 │        └ 'admin'
           │                 └ 'admin'
           └ <function authenticate_user at 0x7f1d703e8940>

  File "./app/routes/login.py", line 71, in authenticate_user
    if not verify_password(password,user.password):
           │               │        │    └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1d70a32e50>
           │               │        └ Users<admin>
           │               └ 'admin'
           └ <function verify_password at 0x7f1d74c27940>

  File "./app/routes/login.py", line 23, in verify_password
    return pwd_context.verify(plain_password, hashed_password)
           │           │      │               └ 'admin'
           │           │      └ 'admin'
           │           └ <function CryptContext.verify at 0x7f1d70a36af0>
           └ <CryptContext at 0x7f1d722e3970>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 2343, in verify
    record = self._get_or_identify_record(hash, scheme, category)
             │    │                       │     │       └ None
             │    │                       │     └ None
             │    │                       └ 'admin'
             │    └ <function CryptContext._get_or_identify_record at 0x7f1d70a364c0>
             └ <CryptContext at 0x7f1d722e3970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 2031, in _get_or_identify_record
    return self._identify_record(hash, category)
           │    │                │     └ None
           │    │                └ 'admin'
           │    └ <bound method _CryptConfig.identify_record of <passlib.context._CryptConfig object at 0x7f1d70415d90>>
           └ <CryptContext at 0x7f1d722e3970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 1132, in identify_record
    raise exc.UnknownHashError("hash could not be identified")
          │   └ <class 'passlib.exc.UnknownHashError'>
          └ <module 'passlib.exc' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/exc.py'>

passlib.exc.UnknownHashError: hash could not be identified


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1d6e276ee0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1d77a9f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f1d788159d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f1d78815040>
    └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1d77433340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
    │    └ <function subprocess_started at 0x7f1d752f9160>
    └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1d77433430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1d752eb550>
           │       │   └ <uvicorn.server.Server object at 0x7f1d77433430>
           │       └ <function run at 0x7f1d764ab700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f1d74848040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1d74874280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1d74874310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1d74c28df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f1d73b5bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1d74c28df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>
          └ <fastapi.applications.FastAPI object at 0x7f1d73b5bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1d6e276a90>
                     │    └ <function exception_handler at 0x7f1d703e89d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f1d72f18db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1d6e276a90>
    │      │         └ UnknownHashError('hash could not be identified', None)
    │      └ <function Logger.exception at 0x7f1d773c6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1d6e276ee0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:23:12.339 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f1d6e281280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1d703a78e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f1d703fd520>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1d703a78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f1d72efa9d0>
          └ <fastapi.routing.APIRoute object at 0x7f1d703b11c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f1d7039dee0>
          └ <fastapi.routing.APIRoute object at 0x7f1d703b11c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1d6e276460>
                     └ <function get_request_handler.<locals>.app at 0x7f1d7039de50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f1d72ee95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f1d6eff40a0>}
                 │                 │         └ <function login at 0x7f1d703e8c10>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f1d703b11f0>
                 └ <function run_in_threadpool at 0x7f1d730d4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
                 │     │         │        └ <built-in method run of Context object at 0x7f1d703c2a40>
                 │     │         └ <function run_sync at 0x7f1d730f29d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
                 │                                        └ <built-in method run of Context object at 0x7f1d703c2a40>
                 └ <function get_asynclib at 0x7f1d730f2310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=UnknownHashError('hash could not be identified', None)>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
             │       │   └ <built-in method run of Context object at 0x7f1d703c2a40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f1d703c2680>

  File "./app/routes/login.py", line 96, in login
    user = authenticate_user(username,password)
           │                 │        └ 'admin'
           │                 └ 'admin'
           └ <function authenticate_user at 0x7f1d703e8940>

  File "./app/routes/login.py", line 71, in authenticate_user
    if not verify_password(password,user.password):
           │               │        │    └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1d70a32e50>
           │               │        └ Users<admin>
           │               └ 'admin'
           └ <function verify_password at 0x7f1d74c27940>

  File "./app/routes/login.py", line 23, in verify_password
    return pwd_context.verify(plain_password, hashed_password)
           │           │      │               └ 'admin'
           │           │      └ 'admin'
           │           └ <function CryptContext.verify at 0x7f1d70a36af0>
           └ <CryptContext at 0x7f1d722e3970>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 2343, in verify
    record = self._get_or_identify_record(hash, scheme, category)
             │    │                       │     │       └ None
             │    │                       │     └ None
             │    │                       └ 'admin'
             │    └ <function CryptContext._get_or_identify_record at 0x7f1d70a364c0>
             └ <CryptContext at 0x7f1d722e3970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 2031, in _get_or_identify_record
    return self._identify_record(hash, category)
           │    │                │     └ None
           │    │                └ 'admin'
           │    └ <bound method _CryptConfig.identify_record of <passlib.context._CryptConfig object at 0x7f1d70415d90>>
           └ <CryptContext at 0x7f1d722e3970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 1132, in identify_record
    raise exc.UnknownHashError("hash could not be identified")
          │   └ <class 'passlib.exc.UnknownHashError'>
          └ <module 'passlib.exc' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/exc.py'>

passlib.exc.UnknownHashError: hash could not be identified


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1d6e276ee0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1d77a9f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f1d788159d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f1d78815040>
    └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1d77433340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
    │    └ <function subprocess_started at 0x7f1d752f9160>
    └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1d77433430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1d752eb550>
           │       │   └ <uvicorn.server.Server object at 0x7f1d77433430>
           │       └ <function run at 0x7f1d764ab700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f1d74848040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1d74874280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1d74874310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1d74c28df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f1d73b5bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1d74c28df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>
          └ <fastapi.applications.FastAPI object at 0x7f1d73b5bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1d6e276a90>
                     │    └ <function exception_handler at 0x7f1d703e89d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f1d72f18db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1d6e276a90>
    │      │         └ UnknownHashError('hash could not be identified', None)
    │      └ <function Logger.exception at 0x7f1d773c6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1d6e276ee0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:23:12.358 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f1d6e281280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1d703a78e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f1d703fd520>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1d703a78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f1d72efa9d0>
          └ <fastapi.routing.APIRoute object at 0x7f1d703b11c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1d6e281160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f1d7039dee0>
          └ <fastapi.routing.APIRoute object at 0x7f1d703b11c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1d6e276460>
                     └ <function get_request_handler.<locals>.app at 0x7f1d7039de50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f1d72ee95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f1d6eff40a0>}
                 │                 │         └ <function login at 0x7f1d703e8c10>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f1d703b11f0>
                 └ <function run_in_threadpool at 0x7f1d730d4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
                 │     │         │        └ <built-in method run of Context object at 0x7f1d703c2a40>
                 │     │         └ <function run_sync at 0x7f1d730f29d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
                 │                                        └ <built-in method run of Context object at 0x7f1d703c2a40>
                 └ <function get_asynclib at 0x7f1d730f2310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=UnknownHashError('hash could not be identified', None)>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function login at 0x7f1d703e8c10>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object at...
             │       │   └ <built-in method run of Context object at 0x7f1d703c2a40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f1d703c2680>

  File "./app/routes/login.py", line 96, in login
    user = authenticate_user(username,password)
           │                 │        └ 'admin'
           │                 └ 'admin'
           └ <function authenticate_user at 0x7f1d703e8940>

  File "./app/routes/login.py", line 71, in authenticate_user
    if not verify_password(password,user.password):
           │               │        │    └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1d70a32e50>
           │               │        └ Users<admin>
           │               └ 'admin'
           └ <function verify_password at 0x7f1d74c27940>

  File "./app/routes/login.py", line 23, in verify_password
    return pwd_context.verify(plain_password, hashed_password)
           │           │      │               └ 'admin'
           │           │      └ 'admin'
           │           └ <function CryptContext.verify at 0x7f1d70a36af0>
           └ <CryptContext at 0x7f1d722e3970>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 2343, in verify
    record = self._get_or_identify_record(hash, scheme, category)
             │    │                       │     │       └ None
             │    │                       │     └ None
             │    │                       └ 'admin'
             │    └ <function CryptContext._get_or_identify_record at 0x7f1d70a364c0>
             └ <CryptContext at 0x7f1d722e3970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 2031, in _get_or_identify_record
    return self._identify_record(hash, category)
           │    │                │     └ None
           │    │                └ 'admin'
           │    └ <bound method _CryptConfig.identify_record of <passlib.context._CryptConfig object at 0x7f1d70415d90>>
           └ <CryptContext at 0x7f1d722e3970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/context.py", line 1132, in identify_record
    raise exc.UnknownHashError("hash could not be identified")
          │   └ <class 'passlib.exc.UnknownHashError'>
          └ <module 'passlib.exc' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/passlib/exc.py'>

passlib.exc.UnknownHashError: hash could not be identified


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1d6e276ee0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1d77a9f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f1d788159d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f1d78815040>
    └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1d77433340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
    │    └ <function subprocess_started at 0x7f1d752f9160>
    └ <SpawnProcess name='SpawnProcess-1' parent=741151 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1d77433430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1d752eb550>
           │       │   └ <uvicorn.server.Server object at 0x7f1d77433430>
           │       └ <function run at 0x7f1d764ab700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f1d74848040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1d74874280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1d74874310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1d74c28df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f1d73b5bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1d74c28df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e276b...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1d6e2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>
          └ <fastapi.applications.FastAPI object at 0x7f1d73b5bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1d6e276a90>
                     │    └ <function exception_handler at 0x7f1d703e89d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1d703a7940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f1d72f18db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1d6e276a90>
    │      │         └ UnknownHashError('hash could not be identified', None)
    │      └ <function Logger.exception at 0x7f1d773c6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1d6e276ee0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:23:12.377 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57782 - "POST /login HTTP/1.1" 500
2022-01-07 10:25:14.880 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:25:14.881 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:25:14.881 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:25:14.982 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:25:14.982 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:25:14.983 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:25:14.983 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:25:14.984 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:25:14.984 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:25:14.984 | INFO     | uvicorn.server:serve:94 - Finished server process [741188]
2022-01-07 10:25:14.985 | INFO     | uvicorn.server:serve:94 - Finished server process [741188]
2022-01-07 10:25:14.985 | INFO     | uvicorn.server:serve:94 - Finished server process [741188]
2022-01-07 10:25:16.421 | INFO     | uvicorn.server:serve:84 - Started server process [742737]
2022-01-07 10:25:16.422 | INFO     | uvicorn.server:serve:84 - Started server process [742737]
2022-01-07 10:25:16.422 | INFO     | uvicorn.server:serve:84 - Started server process [742737]
2022-01-07 10:25:16.423 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:25:16.423 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:25:16.423 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:25:16.424 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:25:16.425 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:25:16.426 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:25:21.739 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:25:21.739 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:25:21.740 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:25:21.839 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:25:21.840 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:25:21.840 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:25:21.841 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:25:21.842 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:25:21.842 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:25:21.843 | INFO     | uvicorn.server:serve:94 - Finished server process [742737]
2022-01-07 10:25:21.843 | INFO     | uvicorn.server:serve:94 - Finished server process [742737]
2022-01-07 10:25:21.843 | INFO     | uvicorn.server:serve:94 - Finished server process [742737]
2022-01-07 10:25:52.808 | INFO     | uvicorn.server:serve:84 - Started server process [743598]
2022-01-07 10:25:52.808 | INFO     | uvicorn.server:serve:84 - Started server process [743598]
2022-01-07 10:25:52.809 | INFO     | uvicorn.server:serve:84 - Started server process [743598]
2022-01-07 10:25:52.809 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:25:52.809 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:25:52.810 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:25:52.810 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:25:52.810 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:25:52.811 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:25:53.341 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57950 - "GET /docs HTTP/1.1" 200
2022-01-07 10:25:53.666 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57950 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:26:02.158 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 10:26:02.220 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 10:26:04.950 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 10:26:05.095 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:57954 - "GET /sanity_check HTTP/1.1" 200
2022-01-07 10:26:16.701 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58084 - "POST /login HTTP/1.1" 202
2022-01-07 10:26:42.469 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58094 - "POST /signup HTTP/1.1" 201
2022-01-07 10:27:11.715 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:27:11.716 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:27:11.716 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:27:11.817 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:27:11.817 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:27:11.818 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:27:11.818 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:27:11.819 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:27:11.819 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:27:11.820 | INFO     | uvicorn.server:serve:94 - Finished server process [743598]
2022-01-07 10:27:11.820 | INFO     | uvicorn.server:serve:94 - Finished server process [743598]
2022-01-07 10:27:11.821 | INFO     | uvicorn.server:serve:94 - Finished server process [743598]
2022-01-07 10:27:12.637 | INFO     | uvicorn.server:serve:84 - Started server process [744249]
2022-01-07 10:27:12.637 | INFO     | uvicorn.server:serve:84 - Started server process [744249]
2022-01-07 10:27:12.638 | INFO     | uvicorn.server:serve:84 - Started server process [744249]
2022-01-07 10:27:12.638 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:27:12.638 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:27:12.639 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:27:12.639 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:27:12.639 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:27:12.640 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:27:39.305 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:27:39.306 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:27:39.306 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:27:39.407 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:27:39.407 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:27:39.408 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:27:39.408 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:27:39.408 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:27:39.409 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:27:39.409 | INFO     | uvicorn.server:serve:94 - Finished server process [744249]
2022-01-07 10:27:39.409 | INFO     | uvicorn.server:serve:94 - Finished server process [744249]
2022-01-07 10:27:39.410 | INFO     | uvicorn.server:serve:94 - Finished server process [744249]
2022-01-07 10:27:40.144 | INFO     | uvicorn.server:serve:84 - Started server process [744398]
2022-01-07 10:27:40.144 | INFO     | uvicorn.server:serve:84 - Started server process [744398]
2022-01-07 10:27:40.144 | INFO     | uvicorn.server:serve:84 - Started server process [744398]
2022-01-07 10:27:40.145 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:27:40.145 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:27:40.145 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:27:40.146 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:27:40.146 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:27:40.147 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:28:01.398 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:28:01.399 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:28:01.399 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:28:01.500 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:28:01.500 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:28:01.501 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:28:01.501 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:28:01.502 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:28:01.503 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:28:01.503 | INFO     | uvicorn.server:serve:94 - Finished server process [744398]
2022-01-07 10:28:01.504 | INFO     | uvicorn.server:serve:94 - Finished server process [744398]
2022-01-07 10:28:01.505 | INFO     | uvicorn.server:serve:94 - Finished server process [744398]
2022-01-07 10:28:02.508 | INFO     | uvicorn.server:serve:84 - Started server process [744568]
2022-01-07 10:28:02.508 | INFO     | uvicorn.server:serve:84 - Started server process [744568]
2022-01-07 10:28:02.509 | INFO     | uvicorn.server:serve:84 - Started server process [744568]
2022-01-07 10:28:02.509 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:28:02.509 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:28:02.510 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:28:02.511 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:28:02.511 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:28:02.512 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:28:02.925 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58144 - "GET /docs HTTP/1.1" 200
2022-01-07 10:28:03.142 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58144 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:28:12.121 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 10:28:12.199 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58148 - "POST /signup HTTP/1.1" 201
2022-01-07 10:29:11.086 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:29:11.086 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:29:11.087 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:29:11.187 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:29:11.188 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:29:11.189 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:29:11.190 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:29:11.190 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:29:11.191 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:29:11.191 | INFO     | uvicorn.server:serve:94 - Finished server process [744568]
2022-01-07 10:29:11.192 | INFO     | uvicorn.server:serve:94 - Finished server process [744568]
2022-01-07 10:29:11.193 | INFO     | uvicorn.server:serve:94 - Finished server process [744568]
2022-01-07 10:29:12.212 | INFO     | uvicorn.server:serve:84 - Started server process [744939]
2022-01-07 10:29:12.213 | INFO     | uvicorn.server:serve:84 - Started server process [744939]
2022-01-07 10:29:12.213 | INFO     | uvicorn.server:serve:84 - Started server process [744939]
2022-01-07 10:29:12.213 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:29:12.214 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:29:12.214 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:29:12.215 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:29:12.215 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:29:12.216 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:29:12.747 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58196 - "GET /docs HTTP/1.1" 200
2022-01-07 10:29:12.984 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58196 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:29:22.569 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 10:29:22.645 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fed5a1a5520>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fed5a14f8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fed5cca19d0>
          └ <fastapi.routing.APIRoute object at 0x7fed5a1a5760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fed5a144dc0>
          └ <fastapi.routing.APIRoute object at 0x7fed5a1a5760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fed58d99850>
                     └ <function get_request_handler.<locals>.app at 0x7fed5a144d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fed5cc905e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7fed58d99160>}
                 │                 │         └ <function signup at 0x7fed5a18fa60>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fed5a1a56d0>
                 └ <function run_in_threadpool at 0x7fed5ce7baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7fed5a168480>
                 │     │         └ <function run_sync at 0x7fed5ce999d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7fed5a168480>
                 └ <function get_asynclib at 0x7fed5ce99310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7fed5a168480>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fed5aed5a80>

  File "./app/routes/login.py", line 78, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fed58d99730>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fed5a1645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fed5a14f8e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fed5a158dc0>
                     └ <function http_exception_handler at 0x7fed5a18ff70>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fed5ccbfdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fed5a158dc0>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7fed6116d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fed58d99730>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fed58066fd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fed61845430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fed625bb9d0>
           └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fed625bb040>
    └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fed611da340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
    │    └ <function subprocess_started at 0x7fed5f0a1160>
    └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fed611da430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fed5f093550>
           │       │   └ <uvicorn.server.Server object at 0x7fed611da430>
           │       └ <function run at 0x7fed60252700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fed5e5f0040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fed5e617280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fed5e617310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fed5e9cfdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fed5d902f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fed5e9cfdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>
          └ <fastapi.applications.FastAPI object at 0x7fed5d902f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fed58d99130>
                     │    └ <function exception_handler at 0x7fed5a18f9d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fed5ccbfdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fed58d99130>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fed6116d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fed58066fd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:29:22.678 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fed5a1a5520>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fed5a14f8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fed5cca19d0>
          └ <fastapi.routing.APIRoute object at 0x7fed5a1a5760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fed5a144dc0>
          └ <fastapi.routing.APIRoute object at 0x7fed5a1a5760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fed58d99850>
                     └ <function get_request_handler.<locals>.app at 0x7fed5a144d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fed5cc905e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7fed58d99160>}
                 │                 │         └ <function signup at 0x7fed5a18fa60>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fed5a1a56d0>
                 └ <function run_in_threadpool at 0x7fed5ce7baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7fed5a168480>
                 │     │         └ <function run_sync at 0x7fed5ce999d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7fed5a168480>
                 └ <function get_asynclib at 0x7fed5ce99310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7fed5a168480>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fed5aed5a80>

  File "./app/routes/login.py", line 78, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fed58d99730>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fed5a1645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fed5a14f8e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fed5a158dc0>
                     └ <function http_exception_handler at 0x7fed5a18ff70>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fed5ccbfdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fed5a158dc0>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7fed6116d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fed58d99730>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fed58066fd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fed61845430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fed625bb9d0>
           └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fed625bb040>
    └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fed611da340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
    │    └ <function subprocess_started at 0x7fed5f0a1160>
    └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fed611da430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fed5f093550>
           │       │   └ <uvicorn.server.Server object at 0x7fed611da430>
           │       └ <function run at 0x7fed60252700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fed5e5f0040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fed5e617280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fed5e617310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fed5e9cfdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fed5d902f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fed5e9cfdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>
          └ <fastapi.applications.FastAPI object at 0x7fed5d902f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fed58d99130>
                     │    └ <function exception_handler at 0x7fed5a18f9d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fed5ccbfdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fed58d99130>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fed6116d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fed58066fd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:29:22.696 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fed5a1a5520>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fed5a14f8e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fed5cca19d0>
          └ <fastapi.routing.APIRoute object at 0x7fed5a1a5760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fed5a164790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fed5a144dc0>
          └ <fastapi.routing.APIRoute object at 0x7fed5a1a5760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fed58d99850>
                     └ <function get_request_handler.<locals>.app at 0x7fed5a144d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fed5cc905e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7fed58d99160>}
                 │                 │         └ <function signup at 0x7fed5a18fa60>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fed5a1a56d0>
                 └ <function run_in_threadpool at 0x7fed5ce7baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7fed5a168480>
                 │     │         └ <function run_sync at 0x7fed5ce999d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7fed5a168480>
                 └ <function get_asynclib at 0x7fed5ce99310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7fed5a18fa60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7fed5a168480>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fed5aed5a80>

  File "./app/routes/login.py", line 78, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fed58d99730>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fed5a1645e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fed5a14f8e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fed5a158dc0>
                     └ <function http_exception_handler at 0x7fed5a18ff70>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fed5ccbfdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fed5a158dc0>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7fed6116d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fed58d99730>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fed58066fd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fed61845430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fed625bb9d0>
           └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fed625bb040>
    └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fed611da340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
    │    └ <function subprocess_started at 0x7fed5f0a1160>
    └ <SpawnProcess name='SpawnProcess-7' parent=743560 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fed611da430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fed5f093550>
           │       │   └ <uvicorn.server.Server object at 0x7fed611da430>
           │       └ <function run at 0x7fed60252700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fed5e5f0040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fed5e617280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fed5e617310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d070>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fed5e9cfdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fed5d902f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fed5e9cfdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a16d0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fed5a1...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>
          └ <fastapi.applications.FastAPI object at 0x7fed5d902f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fed58d99130>
                     │    └ <function exception_handler at 0x7fed5a18f9d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fed5a14f940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fed5ccbfdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fed58d99130>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fed6116d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fed58066fd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:29:22.716 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58200 - "POST /signup HTTP/1.1" 500
2022-01-07 10:35:16.107 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58362 - "POST /signup HTTP/1.1" 201
2022-01-07 10:36:06.732 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:36:06.733 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:36:06.733 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:36:06.834 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:36:06.834 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:36:06.834 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:36:06.835 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:36:06.835 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:36:06.835 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:36:06.836 | INFO     | uvicorn.server:serve:94 - Finished server process [744939]
2022-01-07 10:36:06.836 | INFO     | uvicorn.server:serve:94 - Finished server process [744939]
2022-01-07 10:36:06.836 | INFO     | uvicorn.server:serve:94 - Finished server process [744939]
2022-01-07 10:39:31.971 | INFO     | uvicorn.server:serve:84 - Started server process [747638]
2022-01-07 10:39:31.972 | INFO     | uvicorn.server:serve:84 - Started server process [747638]
2022-01-07 10:39:31.973 | INFO     | uvicorn.server:serve:84 - Started server process [747638]
2022-01-07 10:39:31.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:39:31.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:39:31.974 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:39:31.974 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:39:31.975 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:39:31.975 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:39:34.041 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58500 - "GET /docs HTTP/1.1" 200
2022-01-07 10:39:34.271 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58500 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:39:55.795 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58504 - "POST /upload_images HTTP/1.1" 201
2022-01-07 10:40:15.276 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:40:15.276 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:40:15.277 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:40:15.377 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:40:15.378 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:40:15.379 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:40:15.379 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:40:15.379 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:40:15.380 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:40:15.380 | INFO     | uvicorn.server:serve:94 - Finished server process [747638]
2022-01-07 10:40:15.381 | INFO     | uvicorn.server:serve:94 - Finished server process [747638]
2022-01-07 10:40:15.382 | INFO     | uvicorn.server:serve:94 - Finished server process [747638]
2022-01-07 10:40:40.212 | INFO     | uvicorn.server:serve:84 - Started server process [748295]
2022-01-07 10:40:40.212 | INFO     | uvicorn.server:serve:84 - Started server process [748295]
2022-01-07 10:40:40.213 | INFO     | uvicorn.server:serve:84 - Started server process [748295]
2022-01-07 10:40:40.213 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:40:40.213 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:40:40.214 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:40:40.214 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:40:40.214 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:40:40.215 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:40:44.026 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58546 - "GET /docs HTTP/1.1" 200
2022-01-07 10:40:44.313 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58546 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:40:50.218 | WARNING  | multipart.multipart:_internal_write:1151 - Did not find CR at end of boundary (40)
2022-01-07 10:40:50.219 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58550 - "POST /upload_images HTTP/1.1" 400
2022-01-07 10:41:01.962 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fa57ab860d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa57bf190d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fa57bf66670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa57bf190d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fa57ea639d0>
          └ <fastapi.routing.APIRoute object at 0x7fa57bf2d460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa57bf164c0>
          └ <fastapi.routing.APIRoute object at 0x7fa57bf2d460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fa57ab65f40>
                     └ <function get_request_handler.<locals>.app at 0x7fa57bf16430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa57ea525e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fa57ab880d0>]}
                 │         └ <function upload_images at 0x7fa57bf69280>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fa57bf2d490>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fa57f90a820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fa5846b4820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fa57ab880d0>
          └ <function upload_image at 0x7fa57bf69040>

  File "./app/routes/images.py", line 15, in upload_image
    session = aiobotocore.get_session()
              └ <module 'aiobotocore' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/__init__....

AttributeError: module 'aiobotocore' has no attribute 'get_session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fa57ab88250>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fa583608430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa58437d9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa58437d040>
    └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa582f9c340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
    │    └ <function subprocess_started at 0x7fa580e63160>
    └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa582f9c430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fa580e54550>
           │       │   └ <uvicorn.server.Server object at 0x7fa582f9c430>
           │       └ <function run at 0x7fa582014700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fa5803b2040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fa5803db280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fa5803db310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa580791df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fa57f6c4f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa580791df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>
          └ <fastapi.applications.FastAPI object at 0x7fa57f6c4f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fa57ab65f10>
                     │    └ <function exception_handler at 0x7fa57bf69160>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fa57ea81ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fa57ab65f10>
    │      │         └ AttributeError("module 'aiobotocore' has no attribute 'get_session'")
    │      └ <function Logger.exception at 0x7fa582f2f790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fa57ab88250>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:41:01.993 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fa57ab860d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa57bf190d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fa57bf66670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa57bf190d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fa57ea639d0>
          └ <fastapi.routing.APIRoute object at 0x7fa57bf2d460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa57bf164c0>
          └ <fastapi.routing.APIRoute object at 0x7fa57bf2d460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fa57ab65f40>
                     └ <function get_request_handler.<locals>.app at 0x7fa57bf16430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa57ea525e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fa57ab880d0>]}
                 │         └ <function upload_images at 0x7fa57bf69280>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fa57bf2d490>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fa57f90a820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fa5846b4820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fa57ab880d0>
          └ <function upload_image at 0x7fa57bf69040>

  File "./app/routes/images.py", line 15, in upload_image
    session = aiobotocore.get_session()
              └ <module 'aiobotocore' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/__init__....

AttributeError: module 'aiobotocore' has no attribute 'get_session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fa57ab88250>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fa583608430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa58437d9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa58437d040>
    └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa582f9c340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
    │    └ <function subprocess_started at 0x7fa580e63160>
    └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa582f9c430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fa580e54550>
           │       │   └ <uvicorn.server.Server object at 0x7fa582f9c430>
           │       └ <function run at 0x7fa582014700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fa5803b2040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fa5803db280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fa5803db310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa580791df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fa57f6c4f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa580791df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>
          └ <fastapi.applications.FastAPI object at 0x7fa57f6c4f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fa57ab65f10>
                     │    └ <function exception_handler at 0x7fa57bf69160>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fa57ea81ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fa57ab65f10>
    │      │         └ AttributeError("module 'aiobotocore' has no attribute 'get_session'")
    │      └ <function Logger.exception at 0x7fa582f2f790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fa57ab88250>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:41:02.010 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fa57ab860d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa57bf190d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fa57bf66670>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa57bf190d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fa57ea639d0>
          └ <fastapi.routing.APIRoute object at 0x7fa57bf2d460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa57ab86160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa57bf164c0>
          └ <fastapi.routing.APIRoute object at 0x7fa57bf2d460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fa57ab65f40>
                     └ <function get_request_handler.<locals>.app at 0x7fa57bf16430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa57ea525e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fa57ab880d0>]}
                 │         └ <function upload_images at 0x7fa57bf69280>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fa57bf2d490>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fa57f90a820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fa5846b4820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fa57ab880d0>
          └ <function upload_image at 0x7fa57bf69040>

  File "./app/routes/images.py", line 15, in upload_image
    session = aiobotocore.get_session()
              └ <module 'aiobotocore' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/__init__....

AttributeError: module 'aiobotocore' has no attribute 'get_session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fa57ab88250>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fa583608430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa58437d9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa58437d040>
    └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa582f9c340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
    │    └ <function subprocess_started at 0x7fa580e63160>
    └ <SpawnProcess name='SpawnProcess-1' parent=748258 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa582f9c430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fa580e54550>
           │       │   └ <uvicorn.server.Server object at 0x7fa582f9c430>
           │       └ <function run at 0x7fa582014700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fa5803b2040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fa5803db280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fa5803db310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d90>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa580791df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fa57f6c4f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa580791df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab65d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa57ab...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>
          └ <fastapi.applications.FastAPI object at 0x7fa57f6c4f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fa57ab65f10>
                     │    └ <function exception_handler at 0x7fa57bf69160>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa57bf19130>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fa57ea81ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fa57ab65f10>
    │      │         └ AttributeError("module 'aiobotocore' has no attribute 'get_session'")
    │      └ <function Logger.exception at 0x7fa582f2f790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fa57ab88250>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:41:02.030 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58570 - "POST /upload_images HTTP/1.1" 500
2022-01-07 10:42:11.106 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:42:11.107 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:42:11.107 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:42:11.208 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:42:11.208 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:42:11.209 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:42:11.209 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:42:11.210 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:42:11.211 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:42:11.211 | INFO     | uvicorn.server:serve:94 - Finished server process [748295]
2022-01-07 10:42:11.212 | INFO     | uvicorn.server:serve:94 - Finished server process [748295]
2022-01-07 10:42:11.212 | INFO     | uvicorn.server:serve:94 - Finished server process [748295]
2022-01-07 10:42:12.203 | INFO     | uvicorn.server:serve:84 - Started server process [748994]
2022-01-07 10:42:12.204 | INFO     | uvicorn.server:serve:84 - Started server process [748994]
2022-01-07 10:42:12.204 | INFO     | uvicorn.server:serve:84 - Started server process [748994]
2022-01-07 10:42:12.204 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:42:12.204 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:42:12.205 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:42:12.205 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:42:12.206 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:42:12.207 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:42:12.710 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:42:12.711 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:42:12.711 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:42:12.813 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:42:12.813 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:42:12.814 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:42:12.815 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:42:12.815 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:42:12.815 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:42:12.816 | INFO     | uvicorn.server:serve:94 - Finished server process [748994]
2022-01-07 10:42:12.816 | INFO     | uvicorn.server:serve:94 - Finished server process [748994]
2022-01-07 10:42:12.816 | INFO     | uvicorn.server:serve:94 - Finished server process [748994]
2022-01-07 10:42:16.609 | INFO     | uvicorn.server:serve:84 - Started server process [749109]
2022-01-07 10:42:16.609 | INFO     | uvicorn.server:serve:84 - Started server process [749109]
2022-01-07 10:42:16.610 | INFO     | uvicorn.server:serve:84 - Started server process [749109]
2022-01-07 10:42:16.610 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:42:16.610 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:42:16.611 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:42:16.611 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:42:16.612 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:42:16.612 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:42:23.289 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58616 - "GET /docs HTTP/1.1" 200
2022-01-07 10:42:23.618 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58616 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:42:33.341 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fd4f9eaaa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd4f9ead0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fd4f9efb640>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd4f9ead0d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fd4fc9f89d0>
          └ <fastapi.routing.APIRoute object at 0x7fd4f9ec2460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fd4f9eaa4c0>
          └ <fastapi.routing.APIRoute object at 0x7fd4f9ec2460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fd4f8afa8e0>
                     └ <function get_request_handler.<locals>.app at 0x7fd4f9eaa430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fd4fc9e75e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fd4f8afa700>]}
                 │         └ <function upload_images at 0x7fd4f9efe280>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fd4f9ec2490>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fd4fd8a0820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fd502649820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fd4f8afa700>
          └ <function upload_image at 0x7fd4f9ee6f70>

  File "./app/routes/images.py", line 15, in upload_image
    session = aiobotocore.session.get_session()
              └ <module 'aiobotocore' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/__init__....

AttributeError: module 'aiobotocore' has no attribute 'session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fd4f8afa3a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fd50159c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fd5023129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fd502312040>
    └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fd500f31340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
    │    └ <function subprocess_started at 0x7fd4fedf7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fd500f31430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fd4fede9550>
           │       │   └ <uvicorn.server.Server object at 0x7fd500f31430>
           │       └ <function run at 0x7fd4fffa9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd4fe346040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fd4fe372280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fd4fe372310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd4fe726df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fd4fd658f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd4fe726df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>
          └ <fastapi.applications.FastAPI object at 0x7fd4fd658f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fd4f8afa8b0>
                     │    └ <function exception_handler at 0x7fd4f9efe0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fd4fca16e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fd4f8afa8b0>
    │      │         └ AttributeError("module 'aiobotocore' has no attribute 'session'")
    │      └ <function Logger.exception at 0x7fd500ec4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fd4f8afa3a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:42:33.373 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fd4f9eaaa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd4f9ead0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fd4f9efb640>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd4f9ead0d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fd4fc9f89d0>
          └ <fastapi.routing.APIRoute object at 0x7fd4f9ec2460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fd4f9eaa4c0>
          └ <fastapi.routing.APIRoute object at 0x7fd4f9ec2460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fd4f8afa8e0>
                     └ <function get_request_handler.<locals>.app at 0x7fd4f9eaa430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fd4fc9e75e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fd4f8afa700>]}
                 │         └ <function upload_images at 0x7fd4f9efe280>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fd4f9ec2490>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fd4fd8a0820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fd502649820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fd4f8afa700>
          └ <function upload_image at 0x7fd4f9ee6f70>

  File "./app/routes/images.py", line 15, in upload_image
    session = aiobotocore.session.get_session()
              └ <module 'aiobotocore' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/__init__....

AttributeError: module 'aiobotocore' has no attribute 'session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fd4f8afa3a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fd50159c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fd5023129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fd502312040>
    └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fd500f31340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
    │    └ <function subprocess_started at 0x7fd4fedf7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fd500f31430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fd4fede9550>
           │       │   └ <uvicorn.server.Server object at 0x7fd500f31430>
           │       └ <function run at 0x7fd4fffa9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd4fe346040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fd4fe372280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fd4fe372310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd4fe726df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fd4fd658f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd4fe726df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>
          └ <fastapi.applications.FastAPI object at 0x7fd4fd658f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fd4f8afa8b0>
                     │    └ <function exception_handler at 0x7fd4f9efe0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fd4fca16e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fd4f8afa8b0>
    │      │         └ AttributeError("module 'aiobotocore' has no attribute 'session'")
    │      └ <function Logger.exception at 0x7fd500ec4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fd4f8afa3a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:42:33.390 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fd4f9eaaa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd4f9ead0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fd4f9efb640>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fd4f9ead0d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fd4fc9f89d0>
          └ <fastapi.routing.APIRoute object at 0x7fd4f9ec2460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fd4f9eaac10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fd4f9eaa4c0>
          └ <fastapi.routing.APIRoute object at 0x7fd4f9ec2460>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fd4f8afa8e0>
                     └ <function get_request_handler.<locals>.app at 0x7fd4f9eaa430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fd4fc9e75e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fd4f8afa700>]}
                 │         └ <function upload_images at 0x7fd4f9efe280>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fd4f9ec2490>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fd4fd8a0820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fd502649820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fd4f8afa700>
          └ <function upload_image at 0x7fd4f9ee6f70>

  File "./app/routes/images.py", line 15, in upload_image
    session = aiobotocore.session.get_session()
              └ <module 'aiobotocore' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/__init__....

AttributeError: module 'aiobotocore' has no attribute 'session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fd4f8afa3a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fd50159c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fd5023129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fd502312040>
    └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fd500f31340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
    │    └ <function subprocess_started at 0x7fd4fedf7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=749072 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fd500f31430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fd4fede9550>
           │       │   └ <uvicorn.server.Server object at 0x7fd500f31430>
           │       └ <function run at 0x7fd4fffa9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fd4fe346040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fd4fe372280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fd4fe372310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedbb0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd4fe726df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fd4fd658f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fd4fe726df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8aedb...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fd4f8a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>
          └ <fastapi.applications.FastAPI object at 0x7fd4fd658f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fd4f8afa8b0>
                     │    └ <function exception_handler at 0x7fd4f9efe0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fd4f9ead130>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fd4fca16e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fd4f8afa8b0>
    │      │         └ AttributeError("module 'aiobotocore' has no attribute 'session'")
    │      └ <function Logger.exception at 0x7fd500ec4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fd4f8afa3a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:42:33.406 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58620 - "POST /upload_images HTTP/1.1" 500
2022-01-07 10:43:40.275 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:43:40.276 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:43:40.276 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:43:40.378 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:43:40.378 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:43:40.378 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:43:40.379 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:43:40.379 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:43:40.379 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:43:40.380 | INFO     | uvicorn.server:serve:94 - Finished server process [749109]
2022-01-07 10:43:40.380 | INFO     | uvicorn.server:serve:94 - Finished server process [749109]
2022-01-07 10:43:40.380 | INFO     | uvicorn.server:serve:94 - Finished server process [749109]
2022-01-07 10:43:41.383 | INFO     | uvicorn.server:serve:84 - Started server process [749713]
2022-01-07 10:43:41.384 | INFO     | uvicorn.server:serve:84 - Started server process [749713]
2022-01-07 10:43:41.384 | INFO     | uvicorn.server:serve:84 - Started server process [749713]
2022-01-07 10:43:41.385 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:43:41.385 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:43:41.385 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:43:41.386 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:43:41.386 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:43:41.386 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:44:52.463 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:44:52.463 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:44:52.464 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:44:52.565 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:44:52.565 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:44:52.566 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:44:52.567 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:44:52.567 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:44:52.568 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:44:52.568 | INFO     | uvicorn.server:serve:94 - Finished server process [749713]
2022-01-07 10:44:52.569 | INFO     | uvicorn.server:serve:94 - Finished server process [749713]
2022-01-07 10:44:52.569 | INFO     | uvicorn.server:serve:94 - Finished server process [749713]
2022-01-07 10:44:53.554 | INFO     | uvicorn.server:serve:84 - Started server process [750234]
2022-01-07 10:44:53.555 | INFO     | uvicorn.server:serve:84 - Started server process [750234]
2022-01-07 10:44:53.556 | INFO     | uvicorn.server:serve:84 - Started server process [750234]
2022-01-07 10:44:53.557 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:44:53.558 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:44:53.558 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:44:53.559 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:44:53.560 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:44:53.560 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:04.488 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:04.488 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:04.488 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:04.589 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:04.590 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:04.590 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:04.590 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:04.591 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:04.591 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:04.591 | INFO     | uvicorn.server:serve:94 - Finished server process [750234]
2022-01-07 10:45:04.592 | INFO     | uvicorn.server:serve:94 - Finished server process [750234]
2022-01-07 10:45:04.592 | INFO     | uvicorn.server:serve:94 - Finished server process [750234]
2022-01-07 10:45:05.541 | INFO     | uvicorn.server:serve:84 - Started server process [750367]
2022-01-07 10:45:05.542 | INFO     | uvicorn.server:serve:84 - Started server process [750367]
2022-01-07 10:45:05.542 | INFO     | uvicorn.server:serve:84 - Started server process [750367]
2022-01-07 10:45:05.542 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:05.543 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:05.543 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:05.543 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:05.544 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:05.544 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:21.684 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:21.685 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:21.685 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:21.786 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:21.787 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:21.787 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:21.787 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:21.788 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:21.788 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:21.789 | INFO     | uvicorn.server:serve:94 - Finished server process [750367]
2022-01-07 10:45:21.789 | INFO     | uvicorn.server:serve:94 - Finished server process [750367]
2022-01-07 10:45:21.790 | INFO     | uvicorn.server:serve:94 - Finished server process [750367]
2022-01-07 10:45:24.942 | INFO     | uvicorn.server:serve:84 - Started server process [750547]
2022-01-07 10:45:24.943 | INFO     | uvicorn.server:serve:84 - Started server process [750547]
2022-01-07 10:45:24.943 | INFO     | uvicorn.server:serve:84 - Started server process [750547]
2022-01-07 10:45:24.944 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:24.944 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:24.944 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:24.945 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:24.945 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:24.946 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:27.301 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58768 - "GET /docs HTTP/1.1" 200
2022-01-07 10:45:27.555 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58768 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 10:45:35.166 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f399fa68a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f399fa60040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f399fab15b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f399fa60040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f39a25ae9d0>
          └ <fastapi.routing.APIRoute object at 0x7f399fa763d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f399fa68430>
          └ <fastapi.routing.APIRoute object at 0x7f399fa763d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f399e6ba880>
                     └ <function get_request_handler.<locals>.app at 0x7f399fa683a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f39a259c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f399e6ba340>]}
                 │         └ <function upload_images at 0x7f399fab41f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f399fa76400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f39a3455820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f39a81ff820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f399e6ba340>
          └ <function upload_image at 0x7f399fa9cf70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.create_client('s3', region_name=region,
         │                                       └ 'us-east-1'
         └ Session(region_name=None)

AttributeError: 'Session' object has no attribute 'create_client'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f399e6ba490>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f39a7152430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f39a7ec89d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f39a7ec8040>
    └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f39a6ae7340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
    │    └ <function subprocess_started at 0x7f39a49ad160>
    └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f39a6ae7430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f39a499f550>
           │       │   └ <uvicorn.server.Server object at 0x7f39a6ae7430>
           │       └ <function run at 0x7f39a5b5f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f39a3efd040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f39a3f24280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f39a3f24310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f39a42dcdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f39a320ef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f39a42dcdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>
          └ <fastapi.applications.FastAPI object at 0x7f39a320ef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f399e6ba850>
                     │    └ <function exception_handler at 0x7f399fab4040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f39a25ccdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f399e6ba850>
    │      │         └ AttributeError("'Session' object has no attribute 'create_client'")
    │      └ <function Logger.exception at 0x7f39a6a7a790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f399e6ba490>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:45:35.189 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f399fa68a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f399fa60040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f399fab15b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f399fa60040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f39a25ae9d0>
          └ <fastapi.routing.APIRoute object at 0x7f399fa763d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f399fa68430>
          └ <fastapi.routing.APIRoute object at 0x7f399fa763d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f399e6ba880>
                     └ <function get_request_handler.<locals>.app at 0x7f399fa683a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f39a259c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f399e6ba340>]}
                 │         └ <function upload_images at 0x7f399fab41f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f399fa76400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f39a3455820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f39a81ff820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f399e6ba340>
          └ <function upload_image at 0x7f399fa9cf70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.create_client('s3', region_name=region,
         │                                       └ 'us-east-1'
         └ Session(region_name=None)

AttributeError: 'Session' object has no attribute 'create_client'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f399e6ba490>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f39a7152430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f39a7ec89d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f39a7ec8040>
    └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f39a6ae7340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
    │    └ <function subprocess_started at 0x7f39a49ad160>
    └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f39a6ae7430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f39a499f550>
           │       │   └ <uvicorn.server.Server object at 0x7f39a6ae7430>
           │       └ <function run at 0x7f39a5b5f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f39a3efd040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f39a3f24280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f39a3f24310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f39a42dcdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f39a320ef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f39a42dcdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>
          └ <fastapi.applications.FastAPI object at 0x7f39a320ef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f399e6ba850>
                     │    └ <function exception_handler at 0x7f399fab4040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f39a25ccdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f399e6ba850>
    │      │         └ AttributeError("'Session' object has no attribute 'create_client'")
    │      └ <function Logger.exception at 0x7f39a6a7a790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f399e6ba490>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:45:35.207 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f399fa68a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f399fa60040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f399fab15b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f399fa60040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f39a25ae9d0>
          └ <fastapi.routing.APIRoute object at 0x7f399fa763d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f399fa68b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f399fa68430>
          └ <fastapi.routing.APIRoute object at 0x7f399fa763d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f399e6ba880>
                     └ <function get_request_handler.<locals>.app at 0x7f399fa683a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f39a259c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f399e6ba340>]}
                 │         └ <function upload_images at 0x7f399fab41f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f399fa76400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f39a3455820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f39a81ff820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f399e6ba340>
          └ <function upload_image at 0x7f399fa9cf70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.create_client('s3', region_name=region,
         │                                       └ 'us-east-1'
         └ Session(region_name=None)

AttributeError: 'Session' object has no attribute 'create_client'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f399e6ba490>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f39a7152430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f39a7ec89d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f39a7ec8040>
    └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f39a6ae7340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
    │    └ <function subprocess_started at 0x7f39a49ad160>
    └ <SpawnProcess name='SpawnProcess-1' parent=750510 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f39a6ae7430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f39a499f550>
           │       │   └ <uvicorn.server.Server object at 0x7f39a6ae7430>
           │       └ <function run at 0x7f39a5b5f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f39a3efd040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f39a3f24280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f39a3f24310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76af0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f39a42dcdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f39a320ef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f39a42dcdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa76a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f399fa...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>
          └ <fastapi.applications.FastAPI object at 0x7f39a320ef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f399e6ba850>
                     │    └ <function exception_handler at 0x7f399fab4040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f399fa600a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f39a25ccdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f399e6ba850>
    │      │         └ AttributeError("'Session' object has no attribute 'create_client'")
    │      └ <function Logger.exception at 0x7f39a6a7a790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f399e6ba490>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:45:35.226 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58772 - "POST /upload_images HTTP/1.1" 500
2022-01-07 10:45:49.459 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:49.460 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:49.460 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:49.561 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:49.561 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:49.561 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:49.562 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:49.562 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:49.563 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:49.563 | INFO     | uvicorn.server:serve:94 - Finished server process [750547]
2022-01-07 10:45:49.564 | INFO     | uvicorn.server:serve:94 - Finished server process [750547]
2022-01-07 10:45:49.564 | INFO     | uvicorn.server:serve:94 - Finished server process [750547]
2022-01-07 10:45:50.661 | INFO     | uvicorn.server:serve:84 - Started server process [750795]
2022-01-07 10:45:50.661 | INFO     | uvicorn.server:serve:84 - Started server process [750795]
2022-01-07 10:45:50.661 | INFO     | uvicorn.server:serve:84 - Started server process [750795]
2022-01-07 10:45:50.662 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:50.662 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:50.662 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:50.663 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:50.663 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:50.663 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:51.065 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:51.065 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:51.066 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:45:51.167 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:51.167 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:51.167 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:45:51.168 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:51.168 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:51.169 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:45:51.169 | INFO     | uvicorn.server:serve:94 - Finished server process [750795]
2022-01-07 10:45:51.170 | INFO     | uvicorn.server:serve:94 - Finished server process [750795]
2022-01-07 10:45:51.171 | INFO     | uvicorn.server:serve:94 - Finished server process [750795]
2022-01-07 10:45:54.183 | INFO     | uvicorn.server:serve:84 - Started server process [750918]
2022-01-07 10:45:54.183 | INFO     | uvicorn.server:serve:84 - Started server process [750918]
2022-01-07 10:45:54.184 | INFO     | uvicorn.server:serve:84 - Started server process [750918]
2022-01-07 10:45:54.184 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:54.184 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:54.185 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 10:45:54.185 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:54.185 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:54.186 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 10:45:58.131 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f3a575ef8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3a575e8040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f3a576385b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3a575e8040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3a5a1359d0>
          └ <fastapi.routing.APIRoute object at 0x7f3a575fd3d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3a575ef430>
          └ <fastapi.routing.APIRoute object at 0x7f3a575fd3d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3a5622c970>
                     └ <function get_request_handler.<locals>.app at 0x7f3a575ef3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3a5a1245e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f3a5622cb80>]}
                 │         └ <function upload_images at 0x7f3a5763b1f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f3a575fd400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f3a5afdb820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f3a5fd86820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f3a5622cb80>
          └ <function upload_image at 0x7f3a57623f70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.client('s3', region_name=region,
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f3a5951d310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3a5622cd30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f3a5ecda430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f3a5fa509d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f3a5fa50040>
    └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f3a5e66e340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
    │    └ <function subprocess_started at 0x7f3a5c535160>
    └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f3a5e66e430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f3a5c526550>
           │       │   └ <uvicorn.server.Server object at 0x7f3a5e66e430>
           │       └ <function run at 0x7f3a5d6e6700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3a5ba83040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3a5baaf280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3a5baaf310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3a5be63df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3a5ad96f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3a5be63df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>
          └ <fastapi.applications.FastAPI object at 0x7f3a5ad96f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3a5622c940>
                     │    └ <function exception_handler at 0x7f3a5763b040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3a5a153e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3a5622c940>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7f3a5e601790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3a5622cd30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:45:58.151 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f3a575ef8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3a575e8040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f3a576385b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3a575e8040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3a5a1359d0>
          └ <fastapi.routing.APIRoute object at 0x7f3a575fd3d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3a575ef430>
          └ <fastapi.routing.APIRoute object at 0x7f3a575fd3d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3a5622c970>
                     └ <function get_request_handler.<locals>.app at 0x7f3a575ef3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3a5a1245e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f3a5622cb80>]}
                 │         └ <function upload_images at 0x7f3a5763b1f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f3a575fd400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f3a5afdb820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f3a5fd86820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f3a5622cb80>
          └ <function upload_image at 0x7f3a57623f70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.client('s3', region_name=region,
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f3a5951d310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3a5622cd30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f3a5ecda430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f3a5fa509d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f3a5fa50040>
    └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f3a5e66e340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
    │    └ <function subprocess_started at 0x7f3a5c535160>
    └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f3a5e66e430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f3a5c526550>
           │       │   └ <uvicorn.server.Server object at 0x7f3a5e66e430>
           │       └ <function run at 0x7f3a5d6e6700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3a5ba83040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3a5baaf280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3a5baaf310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3a5be63df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3a5ad96f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3a5be63df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>
          └ <fastapi.applications.FastAPI object at 0x7f3a5ad96f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3a5622c940>
                     │    └ <function exception_handler at 0x7f3a5763b040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3a5a153e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3a5622c940>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7f3a5e601790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3a5622cd30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:45:58.165 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f3a575ef8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3a575e8040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f3a576385b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f3a575e8040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3a5a1359d0>
          └ <fastapi.routing.APIRoute object at 0x7f3a575fd3d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f3a575ef940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3a575ef430>
          └ <fastapi.routing.APIRoute object at 0x7f3a575fd3d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3a5622c970>
                     └ <function get_request_handler.<locals>.app at 0x7f3a575ef3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3a5a1245e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f3a5622cb80>]}
                 │         └ <function upload_images at 0x7f3a5763b1f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f3a575fd400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f3a5afdb820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f3a5fd86820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f3a5622cb80>
          └ <function upload_image at 0x7f3a57623f70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.client('s3', region_name=region,
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7f3a5951d310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3a5622cd30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f3a5ecda430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f3a5fa509d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f3a5fa50040>
    └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f3a5e66e340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
    │    └ <function subprocess_started at 0x7f3a5c535160>
    └ <SpawnProcess name='SpawnProcess-1' parent=750881 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f3a5e66e430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f3a5c526550>
           │       │   └ <uvicorn.server.Server object at 0x7f3a5e66e430>
           │       └ <function run at 0x7f3a5d6e6700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3a5ba83040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3a5baaf280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3a5baaf310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3a5be63df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3a5ad96f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3a5be63df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a5622c7...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f3a562...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>
          └ <fastapi.applications.FastAPI object at 0x7f3a5ad96f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3a5622c940>
                     │    └ <function exception_handler at 0x7f3a5763b040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3a575e80a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3a5a153e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3a5622c940>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7f3a5e601790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3a5622cd30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 10:45:58.180 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:58786 - "POST /upload_images HTTP/1.1" 500
2022-01-07 10:46:23.045 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:46:23.046 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:46:23.046 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 10:46:23.147 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:46:23.148 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:46:23.148 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 10:46:23.148 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:46:23.149 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:46:23.149 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 10:46:23.149 | INFO     | uvicorn.server:serve:94 - Finished server process [750918]
2022-01-07 10:46:23.150 | INFO     | uvicorn.server:serve:94 - Finished server process [750918]
2022-01-07 10:46:23.150 | INFO     | uvicorn.server:serve:94 - Finished server process [750918]
2022-01-07 13:05:09.431 | INFO     | uvicorn.server:serve:84 - Started server process [756181]
2022-01-07 13:05:09.432 | INFO     | uvicorn.server:serve:84 - Started server process [756181]
2022-01-07 13:05:09.432 | INFO     | uvicorn.server:serve:84 - Started server process [756181]
2022-01-07 13:05:09.432 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:05:09.433 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:05:09.433 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:05:09.433 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:05:09.434 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:05:09.434 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:05:19.998 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efe12adb8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe12ad3040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efe12b245b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe12ad3040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7efe156219d0>
          └ <fastapi.routing.APIRoute object at 0x7efe12ae93d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efe12adb430>
          └ <fastapi.routing.APIRoute object at 0x7efe12ae93d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efe11718970>
                     └ <function get_request_handler.<locals>.app at 0x7efe12adb3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efe156105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7efe11718b80>]}
                 │         └ <function upload_images at 0x7efe12b271f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7efe12ae9400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7efe164c8820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7efe1b272820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7efe11718b80>
          └ <function upload_image at 0x7efe12b0ff70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.client('s3', region_name=region,
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7efe14a09310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7efe11718d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efe1a1c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efe1af3c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efe1af3c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efe19b5a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
    │    └ <function subprocess_started at 0x7efe17a21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efe19b5a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7efe17a13550>
           │       │   └ <uvicorn.server.Server object at 0x7efe19b5a430>
           │       └ <function run at 0x7efe18bd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7efe16f70040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efe16f9b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efe16f9b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe1734fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efe16282f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe1734fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>
          └ <fastapi.applications.FastAPI object at 0x7efe16282f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7efe11718940>
                     │    └ <function exception_handler at 0x7efe12b27040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7efe1563fe00>
    │      │         │                  └ <starlette.requests.Request object at 0x7efe11718940>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7efe19aed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7efe11718d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:05:20.019 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efe12adb8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe12ad3040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efe12b245b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe12ad3040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7efe156219d0>
          └ <fastapi.routing.APIRoute object at 0x7efe12ae93d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efe12adb430>
          └ <fastapi.routing.APIRoute object at 0x7efe12ae93d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efe11718970>
                     └ <function get_request_handler.<locals>.app at 0x7efe12adb3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efe156105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7efe11718b80>]}
                 │         └ <function upload_images at 0x7efe12b271f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7efe12ae9400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7efe164c8820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7efe1b272820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7efe11718b80>
          └ <function upload_image at 0x7efe12b0ff70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.client('s3', region_name=region,
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7efe14a09310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7efe11718d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efe1a1c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efe1af3c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efe1af3c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efe19b5a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
    │    └ <function subprocess_started at 0x7efe17a21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efe19b5a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7efe17a13550>
           │       │   └ <uvicorn.server.Server object at 0x7efe19b5a430>
           │       └ <function run at 0x7efe18bd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7efe16f70040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efe16f9b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efe16f9b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe1734fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efe16282f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe1734fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>
          └ <fastapi.applications.FastAPI object at 0x7efe16282f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7efe11718940>
                     │    └ <function exception_handler at 0x7efe12b27040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7efe1563fe00>
    │      │         │                  └ <starlette.requests.Request object at 0x7efe11718940>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7efe19aed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7efe11718d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:05:20.039 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7efe12adb8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe12ad3040>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7efe12b245b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7efe12ad3040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7efe156219d0>
          └ <fastapi.routing.APIRoute object at 0x7efe12ae93d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7efe12adb940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7efe12adb430>
          └ <fastapi.routing.APIRoute object at 0x7efe12ae93d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7efe11718970>
                     └ <function get_request_handler.<locals>.app at 0x7efe12adb3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7efe156105e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7efe11718b80>]}
                 │         └ <function upload_images at 0x7efe12b271f0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7efe12ae9400>

  File "./app/routes/images.py", line 33, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7efe164c8820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7efe1b272820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7efe11718b80>
          └ <function upload_image at 0x7efe12b0ff70>

  File "./app/routes/images.py", line 17, in upload_image
    with session.client('s3', region_name=region,
         │       │                        └ 'us-east-1'
         │       └ <function Session.client at 0x7efe14a09310>
         └ Session(region_name=None)

AttributeError: __enter__


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7efe11718d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7efe1a1c5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7efe1af3c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7efe1af3c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7efe19b5a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
    │    └ <function subprocess_started at 0x7efe17a21160>
    └ <SpawnProcess name='SpawnProcess-1' parent=756143 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7efe19b5a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7efe17a13550>
           │       │   └ <uvicorn.server.Server object at 0x7efe19b5a430>
           │       └ <function run at 0x7efe18bd2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7efe16f70040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7efe16f9b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7efe16f9b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe11718760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe1734fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7efe16282f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7efe1734fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117187...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7efe117...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>
          └ <fastapi.applications.FastAPI object at 0x7efe16282f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7efe11718940>
                     │    └ <function exception_handler at 0x7efe12b27040>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7efe12ad30a0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7efe1563fe00>
    │      │         │                  └ <starlette.requests.Request object at 0x7efe11718940>
    │      │         └ AttributeError('__enter__')
    │      └ <function Logger.exception at 0x7efe19aed790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7efe11718d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:05:20.063 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:59250 - "POST /upload_images HTTP/1.1" 500
2022-01-07 13:05:51.737 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:05:51.738 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:05:51.738 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:05:51.839 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:05:51.840 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:05:51.840 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:05:51.841 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:05:51.841 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:05:51.841 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:05:51.842 | INFO     | uvicorn.server:serve:94 - Finished server process [756181]
2022-01-07 13:05:51.842 | INFO     | uvicorn.server:serve:94 - Finished server process [756181]
2022-01-07 13:05:51.843 | INFO     | uvicorn.server:serve:94 - Finished server process [756181]
2022-01-07 13:05:52.883 | INFO     | uvicorn.server:serve:84 - Started server process [756538]
2022-01-07 13:05:52.884 | INFO     | uvicorn.server:serve:84 - Started server process [756538]
2022-01-07 13:05:52.885 | INFO     | uvicorn.server:serve:84 - Started server process [756538]
2022-01-07 13:05:52.886 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:05:52.886 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:05:52.887 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:05:52.888 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:05:52.889 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:05:52.889 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:06:49.942 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:06:49.942 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:06:49.943 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:06:50.043 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:06:50.044 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:06:50.044 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:06:50.044 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:06:50.045 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:06:50.045 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:06:50.046 | INFO     | uvicorn.server:serve:94 - Finished server process [756538]
2022-01-07 13:06:50.046 | INFO     | uvicorn.server:serve:94 - Finished server process [756538]
2022-01-07 13:06:50.047 | INFO     | uvicorn.server:serve:94 - Finished server process [756538]
2022-01-07 13:06:51.116 | INFO     | uvicorn.server:serve:84 - Started server process [756899]
2022-01-07 13:06:51.117 | INFO     | uvicorn.server:serve:84 - Started server process [756899]
2022-01-07 13:06:51.117 | INFO     | uvicorn.server:serve:84 - Started server process [756899]
2022-01-07 13:06:51.118 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:06:51.118 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:06:51.118 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:06:51.119 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:06:51.120 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:06:51.121 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:14.981 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:14.982 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:14.982 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:15.083 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:15.084 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:15.084 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:15.085 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:15.086 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:15.087 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:15.088 | INFO     | uvicorn.server:serve:94 - Finished server process [756899]
2022-01-07 13:07:15.089 | INFO     | uvicorn.server:serve:94 - Finished server process [756899]
2022-01-07 13:07:15.089 | INFO     | uvicorn.server:serve:94 - Finished server process [756899]
2022-01-07 13:07:15.970 | INFO     | uvicorn.server:serve:84 - Started server process [757074]
2022-01-07 13:07:15.971 | INFO     | uvicorn.server:serve:84 - Started server process [757074]
2022-01-07 13:07:15.972 | INFO     | uvicorn.server:serve:84 - Started server process [757074]
2022-01-07 13:07:15.972 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:15.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:15.973 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:15.975 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:15.975 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:15.976 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:16.078 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:16.078 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:16.079 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:16.180 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:16.180 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:16.181 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:16.182 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:16.182 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:16.183 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:16.184 | INFO     | uvicorn.server:serve:94 - Finished server process [757074]
2022-01-07 13:07:16.185 | INFO     | uvicorn.server:serve:94 - Finished server process [757074]
2022-01-07 13:07:16.185 | INFO     | uvicorn.server:serve:94 - Finished server process [757074]
2022-01-07 13:07:17.276 | INFO     | uvicorn.server:serve:84 - Started server process [757107]
2022-01-07 13:07:17.276 | INFO     | uvicorn.server:serve:84 - Started server process [757107]
2022-01-07 13:07:17.276 | INFO     | uvicorn.server:serve:84 - Started server process [757107]
2022-01-07 13:07:17.277 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:17.277 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:17.277 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:17.278 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:17.278 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:17.278 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:19.784 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:19.785 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:19.786 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:07:19.888 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:19.889 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:19.889 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:07:19.890 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:19.891 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:19.891 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:07:19.891 | INFO     | uvicorn.server:serve:94 - Finished server process [757107]
2022-01-07 13:07:19.892 | INFO     | uvicorn.server:serve:94 - Finished server process [757107]
2022-01-07 13:07:19.892 | INFO     | uvicorn.server:serve:94 - Finished server process [757107]
2022-01-07 13:07:22.647 | INFO     | uvicorn.server:serve:84 - Started server process [757192]
2022-01-07 13:07:22.648 | INFO     | uvicorn.server:serve:84 - Started server process [757192]
2022-01-07 13:07:22.648 | INFO     | uvicorn.server:serve:84 - Started server process [757192]
2022-01-07 13:07:22.649 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:22.649 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:22.650 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:07:22.650 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:22.651 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:22.651 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:07:25.209 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb4bb278b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb4bb27a760>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb4bb4e3370>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb4bb27a760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fb4bf74d9d0>
          └ <fastapi.routing.APIRoute object at 0x7fb4bb284af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb4bb278700>
          └ <fastapi.routing.APIRoute object at 0x7fb4bb284af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb4ba2210d0>
                     └ <function get_request_handler.<locals>.app at 0x7fb4bb278670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb4bf73c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fb4ba2212e0>]}
                 │         └ <function upload_images at 0x7fb4bb4dd550>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fb4bb284b20>

  File "./app/routes/images.py", line 36, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fb4c05f4820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fb4c539e820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fb4ba2212e0>
          └ <function upload_image at 0x7fb4bcc3bf70>

  File "./app/routes/images.py", line 22, in upload_image
    if file_upload_response["ResponseMetadata"]["HTTPStatusCode"] == 200:
       └ <coroutine object AioBaseClient._make_api_call at 0x7fb4ba22c0c0>

TypeError: 'coroutine' object is not subscriptable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fb4ba221490>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb4c42f1430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb4c50689d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb4c5068040>
    └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb4c3c86340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
    │    └ <function subprocess_started at 0x7fb4c1b4d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb4c3c86430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fb4c1b3e550>
           │       │   └ <uvicorn.server.Server object at 0x7fb4c3c86430>
           │       └ <function run at 0x7fb4c2cfe700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fb4c109c040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb4c10c5280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb4c10c5310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb4c147bdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb4c03aef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb4c147bdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>
          └ <fastapi.applications.FastAPI object at 0x7fb4c03aef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fb4ba2210a0>
                     │    └ <function exception_handler at 0x7fb4bb4dd3a0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fb4bf76be00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fb4ba2210a0>
    │      │         └ TypeError("'coroutine' object is not subscriptable")
    │      └ <function Logger.exception at 0x7fb4c3c19790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fb4ba221490>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:07:25.231 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb4bb278b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb4bb27a760>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb4bb4e3370>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb4bb27a760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fb4bf74d9d0>
          └ <fastapi.routing.APIRoute object at 0x7fb4bb284af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb4bb278700>
          └ <fastapi.routing.APIRoute object at 0x7fb4bb284af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb4ba2210d0>
                     └ <function get_request_handler.<locals>.app at 0x7fb4bb278670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb4bf73c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fb4ba2212e0>]}
                 │         └ <function upload_images at 0x7fb4bb4dd550>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fb4bb284b20>

  File "./app/routes/images.py", line 36, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fb4c05f4820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fb4c539e820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fb4ba2212e0>
          └ <function upload_image at 0x7fb4bcc3bf70>

  File "./app/routes/images.py", line 22, in upload_image
    if file_upload_response["ResponseMetadata"]["HTTPStatusCode"] == 200:
       └ <coroutine object AioBaseClient._make_api_call at 0x7fb4ba22c0c0>

TypeError: 'coroutine' object is not subscriptable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fb4ba221490>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb4c42f1430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb4c50689d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb4c5068040>
    └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb4c3c86340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
    │    └ <function subprocess_started at 0x7fb4c1b4d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb4c3c86430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fb4c1b3e550>
           │       │   └ <uvicorn.server.Server object at 0x7fb4c3c86430>
           │       └ <function run at 0x7fb4c2cfe700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fb4c109c040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb4c10c5280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb4c10c5310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb4c147bdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb4c03aef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb4c147bdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>
          └ <fastapi.applications.FastAPI object at 0x7fb4c03aef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fb4ba2210a0>
                     │    └ <function exception_handler at 0x7fb4bb4dd3a0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fb4bf76be00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fb4ba2210a0>
    │      │         └ TypeError("'coroutine' object is not subscriptable")
    │      └ <function Logger.exception at 0x7fb4c3c19790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fb4ba221490>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:07:25.247 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fb4bb278b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb4bb27a760>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fb4bb4e3370>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fb4bb27a760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fb4bf74d9d0>
          └ <fastapi.routing.APIRoute object at 0x7fb4bb284af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fb4bb278c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fb4bb278700>
          └ <fastapi.routing.APIRoute object at 0x7fb4bb284af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fb4ba2210d0>
                     └ <function get_request_handler.<locals>.app at 0x7fb4bb278670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fb4bf73c5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7fb4ba2212e0>]}
                 │         └ <function upload_images at 0x7fb4bb4dd550>
                 └ <fastapi.dependencies.models.Dependant object at 0x7fb4bb284b20>

  File "./app/routes/images.py", line 36, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7fb4c05f4820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7fb4c539e820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7fb4ba2212e0>
          └ <function upload_image at 0x7fb4bcc3bf70>

  File "./app/routes/images.py", line 22, in upload_image
    if file_upload_response["ResponseMetadata"]["HTTPStatusCode"] == 200:
       └ <coroutine object AioBaseClient._make_api_call at 0x7fb4ba22c0c0>

TypeError: 'coroutine' object is not subscriptable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fb4ba221490>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fb4c42f1430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fb4c50689d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fb4c5068040>
    └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fb4c3c86340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
    │    └ <function subprocess_started at 0x7fb4c1b4d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=757155 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fb4c3c86430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fb4c1b3e550>
           │       │   └ <uvicorn.server.Server object at 0x7fb4c3c86430>
           │       └ <function run at 0x7fb4c2cfe700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fb4c109c040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fb4c10c5280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fb4c10c5310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb4c147bdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fb4c03aef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fb4c147bdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb28ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fb4bb2...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>
          └ <fastapi.applications.FastAPI object at 0x7fb4c03aef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fb4ba2210a0>
                     │    └ <function exception_handler at 0x7fb4bb4dd3a0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fb4bb27a7c0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fb4bf76be00>
    │      │         │                  └ <starlette.requests.Request object at 0x7fb4ba2210a0>
    │      │         └ TypeError("'coroutine' object is not subscriptable")
    │      └ <function Logger.exception at 0x7fb4c3c19790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fb4ba221490>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:07:25.265 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:59316 - "POST /upload_images HTTP/1.1" 500
2022-01-07 13:09:01.002 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:09:01.003 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:09:01.003 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:09:01.104 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:09:01.105 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:09:01.106 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:09:01.108 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:09:01.108 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:09:01.109 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:09:01.110 | INFO     | uvicorn.server:serve:94 - Finished server process [757192]
2022-01-07 13:09:01.111 | INFO     | uvicorn.server:serve:94 - Finished server process [757192]
2022-01-07 13:09:01.112 | INFO     | uvicorn.server:serve:94 - Finished server process [757192]
2022-01-07 13:09:02.196 | INFO     | uvicorn.server:serve:84 - Started server process [757656]
2022-01-07 13:09:02.197 | INFO     | uvicorn.server:serve:84 - Started server process [757656]
2022-01-07 13:09:02.197 | INFO     | uvicorn.server:serve:84 - Started server process [757656]
2022-01-07 13:09:02.197 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:09:02.198 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:09:02.198 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:09:02.198 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:09:02.199 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:09:02.199 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:11:53.664 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:11:53.665 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:11:53.665 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:11:53.766 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:11:53.767 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:11:53.768 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:11:53.769 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:11:53.769 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:11:53.770 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:11:53.770 | INFO     | uvicorn.server:serve:94 - Finished server process [757656]
2022-01-07 13:11:53.770 | INFO     | uvicorn.server:serve:94 - Finished server process [757656]
2022-01-07 13:11:53.770 | INFO     | uvicorn.server:serve:94 - Finished server process [757656]
2022-01-07 13:11:54.903 | INFO     | uvicorn.server:serve:84 - Started server process [758414]
2022-01-07 13:11:54.904 | INFO     | uvicorn.server:serve:84 - Started server process [758414]
2022-01-07 13:11:54.904 | INFO     | uvicorn.server:serve:84 - Started server process [758414]
2022-01-07 13:11:54.905 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:11:54.905 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:11:54.906 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:11:54.907 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:11:54.908 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:11:54.908 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:11:56.512 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:11:56.513 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:11:56.513 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:11:56.614 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:11:56.614 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:11:56.614 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:11:56.615 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:11:56.615 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:11:56.615 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:11:56.616 | INFO     | uvicorn.server:serve:94 - Finished server process [758414]
2022-01-07 13:11:56.616 | INFO     | uvicorn.server:serve:94 - Finished server process [758414]
2022-01-07 13:11:56.616 | INFO     | uvicorn.server:serve:94 - Finished server process [758414]
2022-01-07 13:11:59.896 | INFO     | uvicorn.server:serve:84 - Started server process [758543]
2022-01-07 13:11:59.896 | INFO     | uvicorn.server:serve:84 - Started server process [758543]
2022-01-07 13:11:59.897 | INFO     | uvicorn.server:serve:84 - Started server process [758543]
2022-01-07 13:11:59.897 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:11:59.897 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:11:59.898 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:11:59.898 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:11:59.898 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:11:59.899 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:12:02.732 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f14603c7b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f14603c97c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f14606303d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f14603c97c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f146489c9d0>
          └ <fastapi.routing.APIRoute object at 0x7f14603d4b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f14603c7700>
          └ <fastapi.routing.APIRoute object at 0x7f14603d4b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f145f370130>
                     └ <function get_request_handler.<locals>.app at 0x7f14603c7670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f146488b5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f145f370340>]}
                 │         └ <function upload_images at 0x7f146062c550>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f14603d4b80>

  File "./app/routes/images.py", line 37, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f1465744820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f146a4ed820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
          └ <function upload_image at 0x7f1461d8af70>

  File "./app/routes/images.py", line 20, in upload_image
    file_upload_response = await client.put_object(ACL="private", Bucket=bucket, Key=key, Body=fileobject)
                                 │      │                                │           │         └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                                 │      │                                │           └ '8b0167ab-bccc-4181-a076-101490564057'
                                 │      │                                └ 'imagerepobucket'
                                 │      └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f145ee075e0>
                                 └ <aiobotocore.client.S3 object at 0x7f145ee0a940>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/client.py", line 163, in _make_api_call
    handler, event_response = await self.meta.events.emit_until_response(
                                    │    │    │      └ <function EventAliaser.emit_until_response at 0x7f14675fd280>
                                    │    │    └ <botocore.hooks.EventAliaser object at 0x7f145ee0aa00>
                                    │    └ <botocore.client.ClientMeta object at 0x7f145ee0ab20>
                                    └ <aiobotocore.client.S3 object at 0x7f145ee0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/hooks.py", line 37, in emit_until_response
    responses = await self._emit(event_name, kwargs, stop_on_response=True)
                      │    │     │           └ {'model': OperationModel(name=PutObject), 'params': {'url_path': '/imagerepobucket/8b0167ab-bccc-4181-a076-101490564057', 'qu...
                      │    │     └ 'before-call.s3.PutObject'
                      │    └ <function AioHierarchicalEmitter._emit at 0x7f1461da24c0>
                      └ <aiobotocore.hooks.AioHierarchicalEmitter object at 0x7f145ee0a9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/hooks.py", line 29, in _emit
    response = handler(**kwargs)
               │         └ {'model': OperationModel(name=PutObject), 'params': {'url_path': '/imagerepobucket/8b0167ab-bccc-4181-a076-101490564057', 'qu...
               └ <function conditionally_calculate_md5 at 0x7f14675f4430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2474, in conditionally_calculate_md5
    md5_digest = calculate_md5(body, **kwargs)
                 │             │       └ {'model': OperationModel(name=PutObject), 'request_signer': <aiobotocore.signers.AioRequestSigner object at 0x7f145ee0aa60>, ...
                 │             └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                 └ <function calculate_md5 at 0x7f14675f4280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2451, in calculate_md5
    binary_md5 = _calculate_md5_from_file(body)
                 │                        └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                 └ <function _calculate_md5_from_file at 0x7f14675f43a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2461, in _calculate_md5_from_file
    start_position = fileobj.tell()
                     └ <starlette.datastructures.UploadFile object at 0x7f145f370340>

AttributeError: 'UploadFile' object has no attribute 'tell'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f145f3704f0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1469440430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f146a1b79d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f146a1b7040>
    └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1468dd5340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
    │    └ <function subprocess_started at 0x7f1466c9b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1468dd5430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1466c8d550>
           │       │   └ <uvicorn.server.Server object at 0x7f1468dd5430>
           │       └ <function run at 0x7f1467e4d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f14661ea040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1466216280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1466216310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14665cadf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f14654fcf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14665cadf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>
          └ <fastapi.applications.FastAPI object at 0x7f14654fcf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f145f370100>
                     │    └ <function exception_handler at 0x7f146062c3a0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f14648bae50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f145f370100>
    │      │         └ AttributeError("'UploadFile' object has no attribute 'tell'")
    │      └ <function Logger.exception at 0x7f1468d68790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f145f3704f0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:12:02.755 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f14603c7b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f14603c97c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f14606303d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f14603c97c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f146489c9d0>
          └ <fastapi.routing.APIRoute object at 0x7f14603d4b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f14603c7700>
          └ <fastapi.routing.APIRoute object at 0x7f14603d4b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f145f370130>
                     └ <function get_request_handler.<locals>.app at 0x7f14603c7670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f146488b5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f145f370340>]}
                 │         └ <function upload_images at 0x7f146062c550>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f14603d4b80>

  File "./app/routes/images.py", line 37, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f1465744820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f146a4ed820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
          └ <function upload_image at 0x7f1461d8af70>

  File "./app/routes/images.py", line 20, in upload_image
    file_upload_response = await client.put_object(ACL="private", Bucket=bucket, Key=key, Body=fileobject)
                                 │      │                                │           │         └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                                 │      │                                │           └ '8b0167ab-bccc-4181-a076-101490564057'
                                 │      │                                └ 'imagerepobucket'
                                 │      └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f145ee075e0>
                                 └ <aiobotocore.client.S3 object at 0x7f145ee0a940>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/client.py", line 163, in _make_api_call
    handler, event_response = await self.meta.events.emit_until_response(
                                    │    │    │      └ <function EventAliaser.emit_until_response at 0x7f14675fd280>
                                    │    │    └ <botocore.hooks.EventAliaser object at 0x7f145ee0aa00>
                                    │    └ <botocore.client.ClientMeta object at 0x7f145ee0ab20>
                                    └ <aiobotocore.client.S3 object at 0x7f145ee0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/hooks.py", line 37, in emit_until_response
    responses = await self._emit(event_name, kwargs, stop_on_response=True)
                      │    │     │           └ {'model': OperationModel(name=PutObject), 'params': {'url_path': '/imagerepobucket/8b0167ab-bccc-4181-a076-101490564057', 'qu...
                      │    │     └ 'before-call.s3.PutObject'
                      │    └ <function AioHierarchicalEmitter._emit at 0x7f1461da24c0>
                      └ <aiobotocore.hooks.AioHierarchicalEmitter object at 0x7f145ee0a9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/hooks.py", line 29, in _emit
    response = handler(**kwargs)
               │         └ {'model': OperationModel(name=PutObject), 'params': {'url_path': '/imagerepobucket/8b0167ab-bccc-4181-a076-101490564057', 'qu...
               └ <function conditionally_calculate_md5 at 0x7f14675f4430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2474, in conditionally_calculate_md5
    md5_digest = calculate_md5(body, **kwargs)
                 │             │       └ {'model': OperationModel(name=PutObject), 'request_signer': <aiobotocore.signers.AioRequestSigner object at 0x7f145ee0aa60>, ...
                 │             └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                 └ <function calculate_md5 at 0x7f14675f4280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2451, in calculate_md5
    binary_md5 = _calculate_md5_from_file(body)
                 │                        └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                 └ <function _calculate_md5_from_file at 0x7f14675f43a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2461, in _calculate_md5_from_file
    start_position = fileobj.tell()
                     └ <starlette.datastructures.UploadFile object at 0x7f145f370340>

AttributeError: 'UploadFile' object has no attribute 'tell'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f145f3704f0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1469440430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f146a1b79d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f146a1b7040>
    └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1468dd5340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
    │    └ <function subprocess_started at 0x7f1466c9b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1468dd5430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1466c8d550>
           │       │   └ <uvicorn.server.Server object at 0x7f1468dd5430>
           │       └ <function run at 0x7f1467e4d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f14661ea040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1466216280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1466216310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14665cadf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f14654fcf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14665cadf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>
          └ <fastapi.applications.FastAPI object at 0x7f14654fcf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f145f370100>
                     │    └ <function exception_handler at 0x7f146062c3a0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f14648bae50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f145f370100>
    │      │         └ AttributeError("'UploadFile' object has no attribute 'tell'")
    │      └ <function Logger.exception at 0x7f1468d68790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f145f3704f0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:12:02.772 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f14603c7b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f14603c97c0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f14606303d0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f14603c97c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f146489c9d0>
          └ <fastapi.routing.APIRoute object at 0x7f14603d4b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f14603c7c10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f14603c7700>
          └ <fastapi.routing.APIRoute object at 0x7f14603d4b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f145f370130>
                     └ <function get_request_handler.<locals>.app at 0x7f14603c7670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f146488b5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f145f370340>]}
                 │         └ <function upload_images at 0x7f146062c550>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f14603d4b80>

  File "./app/routes/images.py", line 37, in upload_images
    await upload_image(image,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │            │  │       │                         │    └ <function uuid4 at 0x7f1465744820>
          │            │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │            │  │       └ <function Mapping.get at 0x7f146a4ed820>
          │            │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
          └ <function upload_image at 0x7f1461d8af70>

  File "./app/routes/images.py", line 20, in upload_image
    file_upload_response = await client.put_object(ACL="private", Bucket=bucket, Key=key, Body=fileobject)
                                 │      │                                │           │         └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                                 │      │                                │           └ '8b0167ab-bccc-4181-a076-101490564057'
                                 │      │                                └ 'imagerepobucket'
                                 │      └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f145ee075e0>
                                 └ <aiobotocore.client.S3 object at 0x7f145ee0a940>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/client.py", line 163, in _make_api_call
    handler, event_response = await self.meta.events.emit_until_response(
                                    │    │    │      └ <function EventAliaser.emit_until_response at 0x7f14675fd280>
                                    │    │    └ <botocore.hooks.EventAliaser object at 0x7f145ee0aa00>
                                    │    └ <botocore.client.ClientMeta object at 0x7f145ee0ab20>
                                    └ <aiobotocore.client.S3 object at 0x7f145ee0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/hooks.py", line 37, in emit_until_response
    responses = await self._emit(event_name, kwargs, stop_on_response=True)
                      │    │     │           └ {'model': OperationModel(name=PutObject), 'params': {'url_path': '/imagerepobucket/8b0167ab-bccc-4181-a076-101490564057', 'qu...
                      │    │     └ 'before-call.s3.PutObject'
                      │    └ <function AioHierarchicalEmitter._emit at 0x7f1461da24c0>
                      └ <aiobotocore.hooks.AioHierarchicalEmitter object at 0x7f145ee0a9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/hooks.py", line 29, in _emit
    response = handler(**kwargs)
               │         └ {'model': OperationModel(name=PutObject), 'params': {'url_path': '/imagerepobucket/8b0167ab-bccc-4181-a076-101490564057', 'qu...
               └ <function conditionally_calculate_md5 at 0x7f14675f4430>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2474, in conditionally_calculate_md5
    md5_digest = calculate_md5(body, **kwargs)
                 │             │       └ {'model': OperationModel(name=PutObject), 'request_signer': <aiobotocore.signers.AioRequestSigner object at 0x7f145ee0aa60>, ...
                 │             └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                 └ <function calculate_md5 at 0x7f14675f4280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2451, in calculate_md5
    binary_md5 = _calculate_md5_from_file(body)
                 │                        └ <starlette.datastructures.UploadFile object at 0x7f145f370340>
                 └ <function _calculate_md5_from_file at 0x7f14675f43a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/utils.py", line 2461, in _calculate_md5_from_file
    start_position = fileobj.tell()
                     └ <starlette.datastructures.UploadFile object at 0x7f145f370340>

AttributeError: 'UploadFile' object has no attribute 'tell'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f145f3704f0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1469440430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f146a1b79d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f146a1b7040>
    └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1468dd5340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
    │    └ <function subprocess_started at 0x7f1466c9b160>
    └ <SpawnProcess name='SpawnProcess-1' parent=758503 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1468dd5430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1466c8d550>
           │       │   └ <uvicorn.server.Server object at 0x7f1468dd5430>
           │       └ <function run at 0x7f1467e4d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f14661ea040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1466216280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1466216310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14665cadf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f14654fcf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f14665cadf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603dbe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f14603...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>
          └ <fastapi.applications.FastAPI object at 0x7f14654fcf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f145f370100>
                     │    └ <function exception_handler at 0x7f146062c3a0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f14603c9820>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f14648bae50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f145f370100>
    │      │         └ AttributeError("'UploadFile' object has no attribute 'tell'")
    │      └ <function Logger.exception at 0x7f1468d68790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f145f3704f0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:12:02.791 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:59436 - "POST /upload_images HTTP/1.1" 500
2022-01-07 13:14:14.110 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:14.110 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:14.111 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:14.211 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:14.212 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:14.214 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:14.215 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:14.215 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:14.217 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:14.220 | INFO     | uvicorn.server:serve:94 - Finished server process [758543]
2022-01-07 13:14:14.223 | INFO     | uvicorn.server:serve:94 - Finished server process [758543]
2022-01-07 13:14:14.225 | INFO     | uvicorn.server:serve:94 - Finished server process [758543]
2022-01-07 13:14:15.161 | INFO     | uvicorn.server:serve:84 - Started server process [759234]
2022-01-07 13:14:15.162 | INFO     | uvicorn.server:serve:84 - Started server process [759234]
2022-01-07 13:14:15.162 | INFO     | uvicorn.server:serve:84 - Started server process [759234]
2022-01-07 13:14:15.163 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:15.163 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:15.163 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:15.164 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:15.165 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:15.166 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:46.243 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:46.243 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:46.244 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:46.345 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:46.345 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:46.345 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:46.346 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:46.347 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:46.348 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:46.348 | INFO     | uvicorn.server:serve:94 - Finished server process [759234]
2022-01-07 13:14:46.349 | INFO     | uvicorn.server:serve:94 - Finished server process [759234]
2022-01-07 13:14:46.350 | INFO     | uvicorn.server:serve:94 - Finished server process [759234]
2022-01-07 13:14:47.516 | INFO     | uvicorn.server:serve:84 - Started server process [759446]
2022-01-07 13:14:47.517 | INFO     | uvicorn.server:serve:84 - Started server process [759446]
2022-01-07 13:14:47.518 | INFO     | uvicorn.server:serve:84 - Started server process [759446]
2022-01-07 13:14:47.518 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:47.518 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:47.519 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:47.520 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:47.521 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:47.521 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:47.823 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:47.823 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:47.824 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:14:47.925 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:47.925 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:47.925 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:14:47.926 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:47.926 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:47.926 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:14:47.927 | INFO     | uvicorn.server:serve:94 - Finished server process [759446]
2022-01-07 13:14:47.928 | INFO     | uvicorn.server:serve:94 - Finished server process [759446]
2022-01-07 13:14:47.928 | INFO     | uvicorn.server:serve:94 - Finished server process [759446]
2022-01-07 13:14:51.042 | INFO     | uvicorn.server:serve:84 - Started server process [759555]
2022-01-07 13:14:51.043 | INFO     | uvicorn.server:serve:84 - Started server process [759555]
2022-01-07 13:14:51.043 | INFO     | uvicorn.server:serve:84 - Started server process [759555]
2022-01-07 13:14:51.043 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:51.044 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:51.044 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:14:51.045 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:51.046 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:14:51.046 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:15:03.042 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0e4d56ec10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0e4d56d700>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f0e4d7d7310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0e4d56d700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0e51a419d0>
          └ <fastapi.routing.APIRoute object at 0x7f0e4d576a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0e4d56e790>
          └ <fastapi.routing.APIRoute object at 0x7f0e4d576a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0e4d596070>
                     └ <function get_request_handler.<locals>.app at 0x7f0e4d56e700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0e51a2f5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f0e4d596280>]}
                 │         └ <function upload_images at 0x7f0e4d7d05e0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f0e4d576ac0>

  File "./app/routes/images.py", line 37, in upload_images
    await upload_image(image.file._file,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │     │    │            │  │       │                         │    └ <function uuid4 at 0x7f0e528ea820>
          │            │     │    │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │     │    │            │  │       └ <function Mapping.get at 0x7f0e57692820>
          │            │     │    │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │     │    │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            │     │    └ <_io.BytesIO object at 0x7f0e4c5190e0>
          │            │     └ <tempfile.SpooledTemporaryFile object at 0x7f0e4d5964c0>
          │            └ <starlette.datastructures.UploadFile object at 0x7f0e4d596280>
          └ <function upload_image at 0x7f0e4ef2ff70>

  File "./app/routes/images.py", line 20, in upload_image
    file_upload_response = await client.put_object(ACL="private", Bucket=bucket, Key=key, Body=fileobject)
                                 │      │                                │           │         └ <_io.BytesIO object at 0x7f0e4c5190e0>
                                 │      │                                │           └ '450f77a6-29e6-4ae0-a195-ff49de9c3fdd'
                                 │      │                                └ 'imagerepobucket'
                                 │      └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f0e47f94670>
                                 └ <aiobotocore.client.S3 object at 0x7f0e47f998b0>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/client.py", line 187, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'PutObject'
          │           └ {'Error': {'Code': 'AccessDenied', 'Message': 'Access Denied'}, 'ResponseMetadata': {'RequestId': 'KYQFD77KSNE7Y5CY', 'HostId...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (AccessDenied) when calling the PutObject operation: Access Denied


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f0e4d596460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f0e565e6430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f0e5735c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f0e5735c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f0e55f7a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
    │    └ <function subprocess_started at 0x7f0e53e41160>
    └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f0e55f7a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f0e53e33550>
           │       │   └ <uvicorn.server.Server object at 0x7f0e55f7a430>
           │       └ <function run at 0x7f0e54ff2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f0e5338f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f0e533bb280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0e533bb310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0e5376fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0e526a2f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0e5376fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>
          └ <fastapi.applications.FastAPI object at 0x7f0e526a2f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f0e4d596040>
                     │    └ <function exception_handler at 0x7f0e4d7d0430>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0e51a5fe50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f0e4d596040>
    │      │         └ ClientError('An error occurred (AccessDenied) when calling the PutObject operation: Access Denied')
    │      └ <function Logger.exception at 0x7f0e55f0d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f0e4d596460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:15:03.062 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0e4d56ec10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0e4d56d700>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f0e4d7d7310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0e4d56d700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0e51a419d0>
          └ <fastapi.routing.APIRoute object at 0x7f0e4d576a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0e4d56e790>
          └ <fastapi.routing.APIRoute object at 0x7f0e4d576a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0e4d596070>
                     └ <function get_request_handler.<locals>.app at 0x7f0e4d56e700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0e51a2f5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f0e4d596280>]}
                 │         └ <function upload_images at 0x7f0e4d7d05e0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f0e4d576ac0>

  File "./app/routes/images.py", line 37, in upload_images
    await upload_image(image.file._file,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │     │    │            │  │       │                         │    └ <function uuid4 at 0x7f0e528ea820>
          │            │     │    │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │     │    │            │  │       └ <function Mapping.get at 0x7f0e57692820>
          │            │     │    │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │     │    │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            │     │    └ <_io.BytesIO object at 0x7f0e4c5190e0>
          │            │     └ <tempfile.SpooledTemporaryFile object at 0x7f0e4d5964c0>
          │            └ <starlette.datastructures.UploadFile object at 0x7f0e4d596280>
          └ <function upload_image at 0x7f0e4ef2ff70>

  File "./app/routes/images.py", line 20, in upload_image
    file_upload_response = await client.put_object(ACL="private", Bucket=bucket, Key=key, Body=fileobject)
                                 │      │                                │           │         └ <_io.BytesIO object at 0x7f0e4c5190e0>
                                 │      │                                │           └ '450f77a6-29e6-4ae0-a195-ff49de9c3fdd'
                                 │      │                                └ 'imagerepobucket'
                                 │      └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f0e47f94670>
                                 └ <aiobotocore.client.S3 object at 0x7f0e47f998b0>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/client.py", line 187, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'PutObject'
          │           └ {'Error': {'Code': 'AccessDenied', 'Message': 'Access Denied'}, 'ResponseMetadata': {'RequestId': 'KYQFD77KSNE7Y5CY', 'HostId...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (AccessDenied) when calling the PutObject operation: Access Denied


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f0e4d596460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f0e565e6430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f0e5735c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f0e5735c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f0e55f7a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
    │    └ <function subprocess_started at 0x7f0e53e41160>
    └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f0e55f7a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f0e53e33550>
           │       │   └ <uvicorn.server.Server object at 0x7f0e55f7a430>
           │       └ <function run at 0x7f0e54ff2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f0e5338f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f0e533bb280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0e533bb310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0e5376fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0e526a2f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0e5376fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>
          └ <fastapi.applications.FastAPI object at 0x7f0e526a2f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f0e4d596040>
                     │    └ <function exception_handler at 0x7f0e4d7d0430>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0e51a5fe50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f0e4d596040>
    │      │         └ ClientError('An error occurred (AccessDenied) when calling the PutObject operation: Access Denied')
    │      └ <function Logger.exception at 0x7f0e55f0d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f0e4d596460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:15:03.078 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f0e4d56ec10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0e4d56d700>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f0e4d7d7310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0e4d56d700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0e51a419d0>
          └ <fastapi.routing.APIRoute object at 0x7f0e4d576a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f0e4d56eca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0e4d56e790>
          └ <fastapi.routing.APIRoute object at 0x7f0e4d576a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0e4d596070>
                     └ <function get_request_handler.<locals>.app at 0x7f0e4d56e700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0e51a2f5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'images': [<starlette.datastructures.UploadFile object at 0x7f0e4d596280>]}
                 │         └ <function upload_images at 0x7f0e4d7d05e0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f0e4d576ac0>

  File "./app/routes/images.py", line 37, in upload_images
    await upload_image(image.file._file,bucket=os.environ.get("bucketname"),key=str(uuid.uuid4()))
          │            │     │    │            │  │       │                         │    └ <function uuid4 at 0x7f0e528ea820>
          │            │     │    │            │  │       │                         └ <module 'uuid' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/uuid.py'>
          │            │     │    │            │  │       └ <function Mapping.get at 0x7f0e57692820>
          │            │     │    │            │  └ environ({'SHELL': '/usr/bin/zsh', 'LSCOLORS': 'Gxfxcxdxbxegedabagacad', 'SESSION_MANAGER': 'local/dellxps:@/tmp/.ICE-unix/211...
          │            │     │    │            └ <module 'os' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/os.py'>
          │            │     │    └ <_io.BytesIO object at 0x7f0e4c5190e0>
          │            │     └ <tempfile.SpooledTemporaryFile object at 0x7f0e4d5964c0>
          │            └ <starlette.datastructures.UploadFile object at 0x7f0e4d596280>
          └ <function upload_image at 0x7f0e4ef2ff70>

  File "./app/routes/images.py", line 20, in upload_image
    file_upload_response = await client.put_object(ACL="private", Bucket=bucket, Key=key, Body=fileobject)
                                 │      │                                │           │         └ <_io.BytesIO object at 0x7f0e4c5190e0>
                                 │      │                                │           └ '450f77a6-29e6-4ae0-a195-ff49de9c3fdd'
                                 │      │                                └ 'imagerepobucket'
                                 │      └ <function ClientCreator._create_api_method.<locals>._api_call at 0x7f0e47f94670>
                                 └ <aiobotocore.client.S3 object at 0x7f0e47f998b0>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/aiobotocore/client.py", line 187, in _make_api_call
    raise error_class(parsed_response, operation_name)
          │           │                └ 'PutObject'
          │           └ {'Error': {'Code': 'AccessDenied', 'Message': 'Access Denied'}, 'ResponseMetadata': {'RequestId': 'KYQFD77KSNE7Y5CY', 'HostId...
          └ <class 'botocore.exceptions.ClientError'>

botocore.exceptions.ClientError: An error occurred (AccessDenied) when calling the PutObject operation: Access Denied


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f0e4d596460>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f0e565e6430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f0e5735c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f0e5735c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f0e55f7a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
    │    └ <function subprocess_started at 0x7f0e53e41160>
    └ <SpawnProcess name='SpawnProcess-1' parent=759518 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f0e55f7a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f0e53e33550>
           │       │   └ <uvicorn.server.Server object at 0x7f0e55f7a430>
           │       └ <function run at 0x7f0e54ff2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f0e5338f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f0e533bb280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f0e533bb310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0e5376fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0e526a2f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0e5376fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d57fe...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0e4d5...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>
          └ <fastapi.applications.FastAPI object at 0x7f0e526a2f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f0e4d596040>
                     │    └ <function exception_handler at 0x7f0e4d7d0430>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0e4d56d760>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0e51a5fe50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f0e4d596040>
    │      │         └ ClientError('An error occurred (AccessDenied) when calling the PutObject operation: Access Denied')
    │      └ <function Logger.exception at 0x7f0e55f0d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f0e4d596460>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 13:15:03.096 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:59524 - "POST /upload_images HTTP/1.1" 500
2022-01-07 13:21:28.976 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:21:28.976 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:21:28.976 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:21:29.077 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:21:29.077 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:21:29.078 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:21:29.078 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:21:29.079 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:21:29.079 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:21:29.079 | INFO     | uvicorn.server:serve:94 - Finished server process [759555]
2022-01-07 13:21:29.080 | INFO     | uvicorn.server:serve:94 - Finished server process [759555]
2022-01-07 13:21:29.080 | INFO     | uvicorn.server:serve:94 - Finished server process [759555]
2022-01-07 13:21:29.909 | INFO     | uvicorn.server:serve:84 - Started server process [761217]
2022-01-07 13:21:29.909 | INFO     | uvicorn.server:serve:84 - Started server process [761217]
2022-01-07 13:21:29.910 | INFO     | uvicorn.server:serve:84 - Started server process [761217]
2022-01-07 13:21:29.910 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:21:29.911 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:21:29.911 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:21:29.912 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:21:29.912 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:21:29.913 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:47:41.787 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:47:41.787 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:47:41.788 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:47:41.889 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:47:41.890 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:47:41.890 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:47:41.891 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:47:41.892 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:47:41.892 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:47:41.893 | INFO     | uvicorn.server:serve:94 - Finished server process [761217]
2022-01-07 13:47:41.894 | INFO     | uvicorn.server:serve:94 - Finished server process [761217]
2022-01-07 13:47:41.895 | INFO     | uvicorn.server:serve:94 - Finished server process [761217]
2022-01-07 13:47:42.682 | INFO     | uvicorn.server:serve:84 - Started server process [766848]
2022-01-07 13:47:42.683 | INFO     | uvicorn.server:serve:84 - Started server process [766848]
2022-01-07 13:47:42.684 | INFO     | uvicorn.server:serve:84 - Started server process [766848]
2022-01-07 13:47:42.684 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:47:42.685 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:47:42.685 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:47:42.686 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:47:42.686 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:47:42.687 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:17.173 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:17.173 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:17.174 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:17.275 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:17.276 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:17.277 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:17.277 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:17.279 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:17.279 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:17.280 | INFO     | uvicorn.server:serve:94 - Finished server process [766848]
2022-01-07 13:48:17.280 | INFO     | uvicorn.server:serve:94 - Finished server process [766848]
2022-01-07 13:48:17.281 | INFO     | uvicorn.server:serve:94 - Finished server process [766848]
2022-01-07 13:48:18.167 | INFO     | uvicorn.server:serve:84 - Started server process [767044]
2022-01-07 13:48:18.167 | INFO     | uvicorn.server:serve:84 - Started server process [767044]
2022-01-07 13:48:18.168 | INFO     | uvicorn.server:serve:84 - Started server process [767044]
2022-01-07 13:48:18.168 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:18.169 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:18.171 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:18.172 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:18.172 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:18.173 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:20.178 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:20.179 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:20.179 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:20.279 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:20.280 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:20.281 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:20.282 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:20.283 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:20.284 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:20.284 | INFO     | uvicorn.server:serve:94 - Finished server process [767044]
2022-01-07 13:48:20.285 | INFO     | uvicorn.server:serve:94 - Finished server process [767044]
2022-01-07 13:48:20.286 | INFO     | uvicorn.server:serve:94 - Finished server process [767044]
2022-01-07 13:48:21.314 | INFO     | uvicorn.server:serve:84 - Started server process [767122]
2022-01-07 13:48:21.315 | INFO     | uvicorn.server:serve:84 - Started server process [767122]
2022-01-07 13:48:21.315 | INFO     | uvicorn.server:serve:84 - Started server process [767122]
2022-01-07 13:48:21.316 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:21.316 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:21.316 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:21.317 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:21.318 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:21.319 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:21.920 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:21.921 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:21.921 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:48:22.022 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:22.023 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:22.023 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:48:22.024 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:22.024 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:22.024 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:48:22.025 | INFO     | uvicorn.server:serve:94 - Finished server process [767122]
2022-01-07 13:48:22.025 | INFO     | uvicorn.server:serve:94 - Finished server process [767122]
2022-01-07 13:48:22.025 | INFO     | uvicorn.server:serve:94 - Finished server process [767122]
2022-01-07 13:48:22.831 | INFO     | uvicorn.server:serve:84 - Started server process [767139]
2022-01-07 13:48:22.831 | INFO     | uvicorn.server:serve:84 - Started server process [767139]
2022-01-07 13:48:22.832 | INFO     | uvicorn.server:serve:84 - Started server process [767139]
2022-01-07 13:48:22.832 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:22.833 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:22.834 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:48:22.835 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:22.836 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:48:22.837 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:53:31.712 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:53:31.713 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:53:31.713 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:53:31.814 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:53:31.814 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:53:31.816 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:53:31.817 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:53:31.818 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:53:31.818 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:53:31.818 | INFO     | uvicorn.server:serve:94 - Finished server process [767139]
2022-01-07 13:53:31.819 | INFO     | uvicorn.server:serve:94 - Finished server process [767139]
2022-01-07 13:53:31.819 | INFO     | uvicorn.server:serve:94 - Finished server process [767139]
2022-01-07 13:53:48.684 | INFO     | uvicorn.server:serve:84 - Started server process [768436]
2022-01-07 13:53:48.684 | INFO     | uvicorn.server:serve:84 - Started server process [768436]
2022-01-07 13:53:48.685 | INFO     | uvicorn.server:serve:84 - Started server process [768436]
2022-01-07 13:53:48.685 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:53:48.686 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:53:48.686 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:53:48.687 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:53:48.688 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:53:48.690 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:53:51.204 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60368 - "GET /docs HTTP/1.1" 200
2022-01-07 13:53:51.413 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60368 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 13:54:00.361 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60372 - "POST /upload_images HTTP/1.1" 201
2022-01-07 13:54:27.405 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:54:27.406 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:54:27.407 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:54:27.508 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:54:27.508 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:54:27.509 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:54:27.510 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:54:27.510 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:54:27.512 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:54:27.512 | INFO     | uvicorn.server:serve:94 - Finished server process [768436]
2022-01-07 13:54:27.513 | INFO     | uvicorn.server:serve:94 - Finished server process [768436]
2022-01-07 13:54:27.514 | INFO     | uvicorn.server:serve:94 - Finished server process [768436]
2022-01-07 13:54:28.452 | INFO     | uvicorn.server:serve:84 - Started server process [768795]
2022-01-07 13:54:28.453 | INFO     | uvicorn.server:serve:84 - Started server process [768795]
2022-01-07 13:54:28.454 | INFO     | uvicorn.server:serve:84 - Started server process [768795]
2022-01-07 13:54:28.454 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:54:28.454 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:54:28.454 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:54:28.455 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:54:28.456 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:54:28.457 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:54:29.684 | INFO     | app.routes.images:upload_image:23 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/2804fbb7-327c-4b6a-9d23-27dfde272a54
2022-01-07 13:54:29.686 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60398 - "POST /upload_images HTTP/1.1" 201
2022-01-07 13:54:34.441 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60398 - "GET /docs HTTP/1.1" 200
2022-01-07 13:54:34.704 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60398 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 13:56:40.782 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:56:40.783 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:56:40.783 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:56:40.884 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:56:40.884 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:56:40.884 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:56:40.885 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:56:40.886 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:56:40.887 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:56:40.888 | INFO     | uvicorn.server:serve:94 - Finished server process [768795]
2022-01-07 13:56:40.888 | INFO     | uvicorn.server:serve:94 - Finished server process [768795]
2022-01-07 13:56:40.889 | INFO     | uvicorn.server:serve:94 - Finished server process [768795]
2022-01-07 13:56:42.027 | INFO     | uvicorn.server:serve:84 - Started server process [769643]
2022-01-07 13:56:42.027 | INFO     | uvicorn.server:serve:84 - Started server process [769643]
2022-01-07 13:56:42.027 | INFO     | uvicorn.server:serve:84 - Started server process [769643]
2022-01-07 13:56:42.028 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:56:42.028 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:56:42.029 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:56:42.029 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:56:42.029 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:56:42.030 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:31.455 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:57:31.456 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:57:31.457 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:57:31.558 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:57:31.559 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:57:31.560 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:57:31.560 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:57:31.561 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:57:31.562 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:57:31.563 | INFO     | uvicorn.server:serve:94 - Finished server process [769643]
2022-01-07 13:57:31.564 | INFO     | uvicorn.server:serve:94 - Finished server process [769643]
2022-01-07 13:57:31.564 | INFO     | uvicorn.server:serve:94 - Finished server process [769643]
2022-01-07 13:57:32.716 | INFO     | uvicorn.server:serve:84 - Started server process [769902]
2022-01-07 13:57:32.716 | INFO     | uvicorn.server:serve:84 - Started server process [769902]
2022-01-07 13:57:32.717 | INFO     | uvicorn.server:serve:84 - Started server process [769902]
2022-01-07 13:57:32.718 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:57:32.719 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:57:32.719 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:57:32.720 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:32.721 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:32.721 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:35.528 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:57:35.529 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:57:35.529 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 13:57:35.630 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:57:35.631 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:57:35.632 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 13:57:35.633 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:57:35.634 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:57:35.634 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 13:57:35.635 | INFO     | uvicorn.server:serve:94 - Finished server process [769902]
2022-01-07 13:57:35.635 | INFO     | uvicorn.server:serve:94 - Finished server process [769902]
2022-01-07 13:57:35.636 | INFO     | uvicorn.server:serve:94 - Finished server process [769902]
2022-01-07 13:57:36.494 | INFO     | uvicorn.server:serve:84 - Started server process [769944]
2022-01-07 13:57:36.495 | INFO     | uvicorn.server:serve:84 - Started server process [769944]
2022-01-07 13:57:36.495 | INFO     | uvicorn.server:serve:84 - Started server process [769944]
2022-01-07 13:57:36.496 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:57:36.496 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:57:36.497 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 13:57:36.498 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:36.498 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:36.499 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 13:57:59.683 | INFO     | app.routes.images:upload_image:25 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/e225a961-bc86-4d8e-8978-767cf77271ab
2022-01-07 13:57:59.759 | INFO     | app.routes.images:upload_image:25 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/945a41c8-798c-45a3-abcf-6238dbc1bd96
2022-01-07 13:57:59.761 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60532 - "POST /upload_images HTTP/1.1" 200
2022-01-07 14:06:12.587 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:06:12.587 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:06:12.588 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:06:12.688 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:06:12.689 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:06:12.689 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:06:12.689 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:06:12.690 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:06:12.690 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:06:12.691 | INFO     | uvicorn.server:serve:94 - Finished server process [769944]
2022-01-07 14:06:12.692 | INFO     | uvicorn.server:serve:94 - Finished server process [769944]
2022-01-07 14:06:12.692 | INFO     | uvicorn.server:serve:94 - Finished server process [769944]
2022-01-07 14:09:45.233 | INFO     | uvicorn.server:serve:84 - Started server process [773203]
2022-01-07 14:09:45.234 | INFO     | uvicorn.server:serve:84 - Started server process [773203]
2022-01-07 14:09:45.234 | INFO     | uvicorn.server:serve:84 - Started server process [773203]
2022-01-07 14:09:45.234 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:09:45.235 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:09:45.235 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:09:45.235 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:09:45.236 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:09:45.236 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:09:53.137 | INFO     | app.routes.images:upload_image:25 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/8bb902a6-7783-473d-8d42-38e3352abb4c
2022-01-07 14:09:53.212 | INFO     | app.routes.images:upload_image:25 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/f2751446-9e11-4ae3-b5fa-37b78bbbf400
2022-01-07 14:09:53.214 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60916 - "POST /upload_images HTTP/1.1" 200
2022-01-07 14:10:12.676 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:12.676 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:12.677 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:12.778 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:12.778 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:12.779 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:12.779 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:12.780 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:12.781 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:12.782 | INFO     | uvicorn.server:serve:94 - Finished server process [773203]
2022-01-07 14:10:12.782 | INFO     | uvicorn.server:serve:94 - Finished server process [773203]
2022-01-07 14:10:12.782 | INFO     | uvicorn.server:serve:94 - Finished server process [773203]
2022-01-07 14:10:13.580 | INFO     | uvicorn.server:serve:84 - Started server process [773444]
2022-01-07 14:10:13.580 | INFO     | uvicorn.server:serve:84 - Started server process [773444]
2022-01-07 14:10:13.581 | INFO     | uvicorn.server:serve:84 - Started server process [773444]
2022-01-07 14:10:13.581 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:13.581 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:13.582 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:13.582 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:13.582 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:13.583 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:21.702 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:21.702 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:21.703 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:21.803 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:21.804 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:21.804 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:21.805 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:21.805 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:21.806 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:21.806 | INFO     | uvicorn.server:serve:94 - Finished server process [773444]
2022-01-07 14:10:21.807 | INFO     | uvicorn.server:serve:94 - Finished server process [773444]
2022-01-07 14:10:21.807 | INFO     | uvicorn.server:serve:94 - Finished server process [773444]
2022-01-07 14:10:22.728 | INFO     | uvicorn.server:serve:84 - Started server process [773556]
2022-01-07 14:10:22.729 | INFO     | uvicorn.server:serve:84 - Started server process [773556]
2022-01-07 14:10:22.729 | INFO     | uvicorn.server:serve:84 - Started server process [773556]
2022-01-07 14:10:22.729 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:22.730 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:22.730 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:22.731 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:22.732 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:22.732 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:24.271 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/d902b669-e231-47fc-b32b-21c87a13f09a.jpg
2022-01-07 14:10:24.349 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/fd05d51a-2bf6-45aa-911b-0893a7bcc26d.jpg
2022-01-07 14:10:24.351 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:60944 - "POST /upload_images HTTP/1.1" 200
2022-01-07 14:10:31.975 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:31.976 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:31.976 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:10:32.077 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:32.077 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:32.077 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:10:32.078 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:32.079 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:32.079 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:10:32.080 | INFO     | uvicorn.server:serve:94 - Finished server process [773556]
2022-01-07 14:10:32.080 | INFO     | uvicorn.server:serve:94 - Finished server process [773556]
2022-01-07 14:10:32.080 | INFO     | uvicorn.server:serve:94 - Finished server process [773556]
2022-01-07 14:10:32.897 | INFO     | uvicorn.server:serve:84 - Started server process [773644]
2022-01-07 14:10:32.897 | INFO     | uvicorn.server:serve:84 - Started server process [773644]
2022-01-07 14:10:32.897 | INFO     | uvicorn.server:serve:84 - Started server process [773644]
2022-01-07 14:10:32.898 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:32.898 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:32.898 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 14:10:32.899 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:32.899 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:10:32.900 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 14:25:06.338 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:25:06.339 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:25:06.339 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 14:25:06.440 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:25:06.440 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:25:06.440 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 14:25:06.441 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:25:06.441 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:25:06.442 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 14:25:06.442 | INFO     | uvicorn.server:serve:94 - Finished server process [773644]
2022-01-07 14:25:06.442 | INFO     | uvicorn.server:serve:94 - Finished server process [773644]
2022-01-07 14:25:06.443 | INFO     | uvicorn.server:serve:94 - Finished server process [773644]
2022-01-07 15:02:59.637 | INFO     | uvicorn.server:serve:84 - Started server process [784821]
2022-01-07 15:02:59.637 | INFO     | uvicorn.server:serve:84 - Started server process [784821]
2022-01-07 15:02:59.637 | INFO     | uvicorn.server:serve:84 - Started server process [784821]
2022-01-07 15:02:59.638 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:02:59.638 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:02:59.638 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:02:59.639 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:02:59.639 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:02:59.639 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:03:29.257 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33836 - "GET / HTTP/1.1" 404
2022-01-07 15:03:32.791 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33836 - "GET /docs HTTP/1.1" 200
2022-01-07 15:03:33.050 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33836 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:03:44.689 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:03:45.085 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33840 - "POST /login HTTP/1.1" 202
2022-01-07 15:03:55.530 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33864 - "POST /token HTTP/1.1" 404
2022-01-07 15:04:06.963 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33876 - "POST /token HTTP/1.1" 404
2022-01-07 15:04:21.256 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33892 - "GET /docs HTTP/1.1" 200
2022-01-07 15:04:21.445 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33892 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:04:35.309 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33896 - "POST /token HTTP/1.1" 404
2022-01-07 15:04:42.092 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33916 - "POST /token HTTP/1.1" 404
2022-01-07 15:04:56.700 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33920 - "POST /login HTTP/1.1" 202
2022-01-07 15:08:39.145 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33988 - "GET /docs HTTP/1.1" 200
2022-01-07 15:08:39.343 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33988 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:08:50.339 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:33992 - "POST /token HTTP/1.1" 404
2022-01-07 15:13:19.255 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34164 - "GET /docs HTTP/1.1" 200
2022-01-07 15:13:19.489 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34164 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:13:25.478 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f377338b5b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f37775f79d0>
          └ <fastapi.routing.APIRoute object at 0x7f3773130ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3773126670>
          └ <fastapi.routing.APIRoute object at 0x7f3773130ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f377131bc10>
                     └ <function get_request_handler.<locals>.app at 0x7f37731265e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'request': <starlette.requests.Request object at 0x7f377131bc10>}
                   └ <fastapi.security.oauth2.OAuth2PasswordBearer object at 0x7f37769f7520>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/security/oauth2.py", line 164, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f377131bc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f377131a1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f377131bbe0>
                     └ <function http_exception_handler at 0x7f3773387550>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f377131bbe0>
    │      │         └ HTTPException(status_code=401, detail='Not authenticated')
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f377131bc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f377131be20>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f377c19c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f377cf129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f377cf12040>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f377bb30340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    └ <function subprocess_started at 0x7f37799f7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f377bb30430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f37799e8550>
           │       │   └ <uvicorn.server.Server object at 0x7f377bb30430>
           │       └ <function run at 0x7f377aba8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3778f46040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3778f71280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3778f71310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
          └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f377131bcd0>
                     │    └ <function exception_handler at 0x7f3773387310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f377131bcd0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f377131be20>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:13:25.503 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f377338b5b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f37775f79d0>
          └ <fastapi.routing.APIRoute object at 0x7f3773130ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3773126670>
          └ <fastapi.routing.APIRoute object at 0x7f3773130ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f377131bc10>
                     └ <function get_request_handler.<locals>.app at 0x7f37731265e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'request': <starlette.requests.Request object at 0x7f377131bc10>}
                   └ <fastapi.security.oauth2.OAuth2PasswordBearer object at 0x7f37769f7520>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/security/oauth2.py", line 164, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f377131bc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f377131a1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f377131bbe0>
                     └ <function http_exception_handler at 0x7f3773387550>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f377131bbe0>
    │      │         └ HTTPException(status_code=401, detail='Not authenticated')
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f377131bc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f377131be20>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f377c19c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f377cf129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f377cf12040>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f377bb30340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    └ <function subprocess_started at 0x7f37799f7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f377bb30430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f37799e8550>
           │       │   └ <uvicorn.server.Server object at 0x7f377bb30430>
           │       └ <function run at 0x7f377aba8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3778f46040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3778f71280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3778f71310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
          └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f377131bcd0>
                     │    └ <function exception_handler at 0x7f3773387310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f377131bcd0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f377131be20>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:13:25.518 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f377338b5b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f37775f79d0>
          └ <fastapi.routing.APIRoute object at 0x7f3773130ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a310>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3773126670>
          └ <fastapi.routing.APIRoute object at 0x7f3773130ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f377131bc10>
                     └ <function get_request_handler.<locals>.app at 0x7f37731265e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f37775e6040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'request': <starlette.requests.Request object at 0x7f377131bc10>}
                   └ <fastapi.security.oauth2.OAuth2PasswordBearer object at 0x7f37769f7520>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/security/oauth2.py", line 164, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f377131bc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f377131a1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f377131bbe0>
                     └ <function http_exception_handler at 0x7f3773387550>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f377131bbe0>
    │      │         └ HTTPException(status_code=401, detail='Not authenticated')
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f377131bc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f377131be20>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f377c19c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f377cf129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f377cf12040>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f377bb30340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    └ <function subprocess_started at 0x7f37799f7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f377bb30430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f37799e8550>
           │       │   └ <uvicorn.server.Server object at 0x7f377bb30430>
           │       └ <function run at 0x7f377aba8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3778f46040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3778f71280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3778f71310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4c0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f377131b4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
          └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f377131bcd0>
                     │    └ <function exception_handler at 0x7f3773387310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f377131bcd0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f377131be20>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:13:25.535 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34168 - "POST /upload_images HTTP/1.1" 500
2022-01-07 15:28:47.396 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f377338b5b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f37775f79d0>
          └ <fastapi.routing.APIRoute object at 0x7f377338b7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3773126310>
          └ <fastapi.routing.APIRoute object at 0x7f377338b7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3771315e50>
                     └ <function get_request_handler.<locals>.app at 0x7f3773126280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f37775e65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f377208b310>}
                 │                 │         └ <function signup at 0x7f3774ae5a60>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f377338b760>
                 └ <function run_in_threadpool at 0x7f37777d1af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7f37720aadc0>
                 │     │         └ <function run_sync at 0x7f37777ee9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7f37720aadc0>
                 └ <function get_asynclib at 0x7f37777ee310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7f37720aadc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f37720aae40>

  File "./app/routes/login.py", line 85, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3771315100>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f377131a280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f3771315e80>
                     └ <function http_exception_handler at 0x7f3773387550>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3771315e80>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3771315100>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3771315b80>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f377c19c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f377cf129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f377cf12040>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f377bb30340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    └ <function subprocess_started at 0x7f37799f7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f377bb30430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f37799e8550>
           │       │   └ <uvicorn.server.Server object at 0x7f377bb30430>
           │       └ <function run at 0x7f377aba8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3778f46040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3778f71280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3778f71310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
          └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3771315a90>
                     │    └ <function exception_handler at 0x7f3773387310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3771315a90>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3771315b80>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:28:47.417 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f377338b5b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f37775f79d0>
          └ <fastapi.routing.APIRoute object at 0x7f377338b7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3773126310>
          └ <fastapi.routing.APIRoute object at 0x7f377338b7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3771315e50>
                     └ <function get_request_handler.<locals>.app at 0x7f3773126280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f37775e65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f377208b310>}
                 │                 │         └ <function signup at 0x7f3774ae5a60>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f377338b760>
                 └ <function run_in_threadpool at 0x7f37777d1af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7f37720aadc0>
                 │     │         └ <function run_sync at 0x7f37777ee9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7f37720aadc0>
                 └ <function get_asynclib at 0x7f37777ee310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7f37720aadc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f37720aae40>

  File "./app/routes/login.py", line 85, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3771315100>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f377131a280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f3771315e80>
                     └ <function http_exception_handler at 0x7f3773387550>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3771315e80>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3771315100>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3771315b80>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f377c19c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f377cf129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f377cf12040>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f377bb30340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    └ <function subprocess_started at 0x7f37799f7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f377bb30430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f37799e8550>
           │       │   └ <uvicorn.server.Server object at 0x7f377bb30430>
           │       └ <function run at 0x7f377aba8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3778f46040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3778f71280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3778f71310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
          └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3771315a90>
                     │    └ <function exception_handler at 0x7f3773387310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3771315a90>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3771315b80>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:28:47.435 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f377338b5b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f37775f79d0>
          └ <fastapi.routing.APIRoute object at 0x7f377338b7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f377131a3a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f3773126310>
          └ <fastapi.routing.APIRoute object at 0x7f377338b7f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f3771315e50>
                     └ <function get_request_handler.<locals>.app at 0x7f3773126280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f37775e65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f377208b310>}
                 │                 │         └ <function signup at 0x7f3774ae5a60>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f377338b760>
                 └ <function run_in_threadpool at 0x7f37777d1af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7f37720aadc0>
                 │     │         └ <function run_sync at 0x7f37777ee9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7f37720aadc0>
                 └ <function get_asynclib at 0x7f37777ee310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7f3774ae5a60>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7f37720aadc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f37720aae40>

  File "./app/routes/login.py", line 85, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3771315100>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f377131a280>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f37731248b0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7f3771315e80>
                     └ <function http_exception_handler at 0x7f3773387550>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3771315e80>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3771315100>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f3771315b80>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f377c19c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f377cf129d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f377cf12040>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f377bb30340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
    │    └ <function subprocess_started at 0x7f37799f7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f377bb30430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f37799e8550>
           │       │   └ <uvicorn.server.Server object at 0x7f377bb30430>
           │       └ <function run at 0x7f377aba8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3778f46040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3778f71280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3778f71310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3779325df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713156...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f37713...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>
          └ <fastapi.applications.FastAPI object at 0x7f3778258f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3771315a90>
                     │    └ <function exception_handler at 0x7f3773387310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f3773124910>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3777615d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3771315a90>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7f377bac3790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f3771315b80>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:28:47.462 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34456 - "POST /signup HTTP/1.1" 500
2022-01-07 15:29:24.160 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34476 - "POST /login HTTP/1.1" 202
2022-01-07 15:29:47.579 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34502 - "POST /token HTTP/1.1" 404
2022-01-07 15:30:06.868 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:30:06.869 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:30:06.870 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:30:06.970 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:30:06.971 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:30:06.972 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:30:06.972 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:30:06.974 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:30:06.975 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:30:06.975 | INFO     | uvicorn.server:serve:94 - Finished server process [784821]
2022-01-07 15:30:06.976 | INFO     | uvicorn.server:serve:94 - Finished server process [784821]
2022-01-07 15:30:06.977 | INFO     | uvicorn.server:serve:94 - Finished server process [784821]
2022-01-07 15:30:08.158 | INFO     | uvicorn.server:serve:84 - Started server process [792038]
2022-01-07 15:30:08.159 | INFO     | uvicorn.server:serve:84 - Started server process [792038]
2022-01-07 15:30:08.159 | INFO     | uvicorn.server:serve:84 - Started server process [792038]
2022-01-07 15:30:08.160 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:30:08.160 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:30:08.161 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:30:08.162 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:30:08.162 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:30:08.162 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:30:09.641 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34516 - "GET /docs HTTP/1.1" 200
2022-01-07 15:30:09.930 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34516 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:30:16.046 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:30:16.441 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34520 - "POST /login HTTP/1.1" 202
2022-01-07 15:30:30.161 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f69bc06e8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f69bd5d78e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f69bd83e5e0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f69bd5d78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f69c1aa99d0>
          └ <fastapi.routing.APIRoute object at 0x7f69bd5e2cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f69bd5d8670>
          └ <fastapi.routing.APIRoute object at 0x7f69bd5e2cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f69b77da9d0>
                     └ <function get_request_handler.<locals>.app at 0x7f69bd5d85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f69c1a98040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f69bef97820>

  File "./app/routes/login.py", line 58, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f69b77daa30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f69c664c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f69c73c49d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f69c73c4040>
    └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f69c5fe2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
    │    └ <function subprocess_started at 0x7f69c3ea8160>
    └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f69c5fe2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f69c3e9a550>
           │       │   └ <uvicorn.server.Server object at 0x7f69c5fe2430>
           │       └ <function run at 0x7f69c505a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f69c33f8040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f69c341f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f69c341f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f69c37d7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f69c2709f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f69c37d7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>
          └ <fastapi.applications.FastAPI object at 0x7f69c2709f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f69b77da8e0>
                     │    └ <function exception_handler at 0x7f69bd839310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f69c1ac7e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f69b77da8e0>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f69c5f75790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f69b77daa30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:30:30.181 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f69bc06e8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f69bd5d78e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f69bd83e5e0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f69bd5d78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f69c1aa99d0>
          └ <fastapi.routing.APIRoute object at 0x7f69bd5e2cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f69bd5d8670>
          └ <fastapi.routing.APIRoute object at 0x7f69bd5e2cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f69b77da9d0>
                     └ <function get_request_handler.<locals>.app at 0x7f69bd5d85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f69c1a98040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f69bef97820>

  File "./app/routes/login.py", line 58, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f69b77daa30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f69c664c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f69c73c49d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f69c73c4040>
    └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f69c5fe2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
    │    └ <function subprocess_started at 0x7f69c3ea8160>
    └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f69c5fe2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f69c3e9a550>
           │       │   └ <uvicorn.server.Server object at 0x7f69c5fe2430>
           │       └ <function run at 0x7f69c505a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f69c33f8040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f69c341f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f69c341f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f69c37d7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f69c2709f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f69c37d7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>
          └ <fastapi.applications.FastAPI object at 0x7f69c2709f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f69b77da8e0>
                     │    └ <function exception_handler at 0x7f69bd839310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f69c1ac7e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f69b77da8e0>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f69c5f75790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f69b77daa30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:30:30.196 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f69bc06e8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f69bd5d78e0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f69bd83e5e0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f69bd5d78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f69c1aa99d0>
          └ <fastapi.routing.APIRoute object at 0x7f69bd5e2cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f69bc06e790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f69bd5d8670>
          └ <fastapi.routing.APIRoute object at 0x7f69bd5e2cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f69b77da9d0>
                     └ <function get_request_handler.<locals>.app at 0x7f69bd5d85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f69c1a98040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f69bef97820>

  File "./app/routes/login.py", line 58, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f69b77daa30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f69c664c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f69c73c49d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f69c73c4040>
    └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f69c5fe2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
    │    └ <function subprocess_started at 0x7f69c3ea8160>
    └ <SpawnProcess name='SpawnProcess-3' parent=784782 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f69c5fe2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f69c3e9a550>
           │       │   └ <uvicorn.server.Server object at 0x7f69c5fe2430>
           │       └ <function run at 0x7f69c505a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f69c33f8040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f69c341f280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f69c341f310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c1580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f69c37d7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f69c2709f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f69c37d7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77c15...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f69b77...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>
          └ <fastapi.applications.FastAPI object at 0x7f69c2709f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f69b77da8e0>
                     │    └ <function exception_handler at 0x7f69bd839310>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f69bd5d7940>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f69c1ac7e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f69b77da8e0>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f69c5f75790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f69b77daa30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:30:30.210 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34552 - "POST /upload_images HTTP/1.1" 500
2022-01-07 15:30:35.557 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34562 - "GET /docs HTTP/1.1" 200
2022-01-07 15:30:35.815 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34562 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:32:24.800 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:32:24.801 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:32:24.801 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:32:24.902 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:32:24.902 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:32:24.903 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:32:24.903 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:32:24.904 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:32:24.904 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:32:24.905 | INFO     | uvicorn.server:serve:94 - Finished server process [792038]
2022-01-07 15:32:24.906 | INFO     | uvicorn.server:serve:94 - Finished server process [792038]
2022-01-07 15:32:24.906 | INFO     | uvicorn.server:serve:94 - Finished server process [792038]
2022-01-07 15:43:30.328 | INFO     | uvicorn.server:serve:84 - Started server process [796008]
2022-01-07 15:43:30.329 | INFO     | uvicorn.server:serve:84 - Started server process [796008]
2022-01-07 15:43:30.329 | INFO     | uvicorn.server:serve:84 - Started server process [796008]
2022-01-07 15:43:30.330 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:43:30.330 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:43:30.331 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:43:30.331 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:43:30.332 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:43:30.332 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:43:39.149 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34914 - "GET /docs HTTP/1.1" 200
2022-01-07 15:43:39.446 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34914 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:43:46.159 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:43:46.533 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34918 - "POST /token HTTP/1.1" 200
2022-01-07 15:43:54.103 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f4e20601b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4e223907f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f4e223694f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4e223907f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f4e268419d0>
          └ <fastapi.routing.APIRoute object at 0x7f4e21321580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f4e2131a430>
          └ <fastapi.routing.APIRoute object at 0x7f4e21321580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f4e205c1c40>
                     └ <function get_request_handler.<locals>.app at 0x7f4e2131a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f4e26830040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f4e23d2f820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f4e205c1ca0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f4e2b3e6430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f4e2c15c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f4e2c15c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f4e2ad7a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
    │    └ <function subprocess_started at 0x7f4e28c41160>
    └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f4e2ad7a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f4e28c33550>
           │       │   └ <uvicorn.server.Server object at 0x7f4e2ad7a430>
           │       └ <function run at 0x7f4e29df2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f4e28190040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f4e281b9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f4e281b9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f4e2856fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f4e274a2f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f4e2856fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>
          └ <fastapi.applications.FastAPI object at 0x7f4e274a2f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f4e205c1c10>
                     │    └ <function exception_handler at 0x7f4e22366f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f4e2685fea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f4e205c1c10>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f4e2ad0d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f4e205c1ca0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:43:54.123 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f4e20601b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4e223907f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f4e223694f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4e223907f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f4e268419d0>
          └ <fastapi.routing.APIRoute object at 0x7f4e21321580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f4e2131a430>
          └ <fastapi.routing.APIRoute object at 0x7f4e21321580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f4e205c1c40>
                     └ <function get_request_handler.<locals>.app at 0x7f4e2131a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f4e26830040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f4e23d2f820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f4e205c1ca0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f4e2b3e6430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f4e2c15c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f4e2c15c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f4e2ad7a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
    │    └ <function subprocess_started at 0x7f4e28c41160>
    └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f4e2ad7a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f4e28c33550>
           │       │   └ <uvicorn.server.Server object at 0x7f4e2ad7a430>
           │       └ <function run at 0x7f4e29df2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f4e28190040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f4e281b9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f4e281b9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f4e2856fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f4e274a2f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f4e2856fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>
          └ <fastapi.applications.FastAPI object at 0x7f4e274a2f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f4e205c1c10>
                     │    └ <function exception_handler at 0x7f4e22366f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f4e2685fea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f4e205c1c10>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f4e2ad0d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f4e205c1ca0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:43:54.145 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f4e20601b80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4e223907f0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f4e223694f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f4e223907f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f4e268419d0>
          └ <fastapi.routing.APIRoute object at 0x7f4e21321580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f4e20601a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f4e2131a430>
          └ <fastapi.routing.APIRoute object at 0x7f4e21321580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f4e205c1c40>
                     └ <function get_request_handler.<locals>.app at 0x7f4e2131a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f4e26830040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f4e23d2f820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f4e205c1ca0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f4e2b3e6430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f4e2c15c9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f4e2c15c040>
    └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f4e2ad7a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
    │    └ <function subprocess_started at 0x7f4e28c41160>
    └ <SpawnProcess name='SpawnProcess-1' parent=795971 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f4e2ad7a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f4e28c33550>
           │       │   └ <uvicorn.server.Server object at 0x7f4e2ad7a430>
           │       └ <function run at 0x7f4e29df2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f4e28190040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f4e281b9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f4e281b9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c1310>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f4e2856fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f4e274a2f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f4e2856fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205c13...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f4e205...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>
          └ <fastapi.applications.FastAPI object at 0x7f4e274a2f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f4e205c1c10>
                     │    └ <function exception_handler at 0x7f4e22366f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f4e22390850>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f4e2685fea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f4e205c1c10>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f4e2ad0d790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f4e205c1ca0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:43:54.164 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34944 - "POST /upload_images HTTP/1.1" 500
2022-01-07 15:45:53.066 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:45:53.067 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:45:53.067 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:45:53.167 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:45:53.168 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:45:53.169 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:45:53.170 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:45:53.170 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:45:53.170 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:45:53.171 | INFO     | uvicorn.server:serve:94 - Finished server process [796008]
2022-01-07 15:45:53.172 | INFO     | uvicorn.server:serve:94 - Finished server process [796008]
2022-01-07 15:45:53.173 | INFO     | uvicorn.server:serve:94 - Finished server process [796008]
2022-01-07 15:45:54.422 | INFO     | uvicorn.server:serve:84 - Started server process [796778]
2022-01-07 15:45:54.423 | INFO     | uvicorn.server:serve:84 - Started server process [796778]
2022-01-07 15:45:54.423 | INFO     | uvicorn.server:serve:84 - Started server process [796778]
2022-01-07 15:45:54.424 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:45:54.424 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:45:54.425 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:45:54.425 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:45:54.426 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:45:54.427 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:45:56.434 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:45:56.435 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:45:56.435 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:45:56.536 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:45:56.537 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:45:56.537 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:45:56.537 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:45:56.538 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:45:56.538 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:45:56.538 | INFO     | uvicorn.server:serve:94 - Finished server process [796778]
2022-01-07 15:45:56.539 | INFO     | uvicorn.server:serve:94 - Finished server process [796778]
2022-01-07 15:45:56.539 | INFO     | uvicorn.server:serve:94 - Finished server process [796778]
2022-01-07 15:45:58.843 | INFO     | uvicorn.server:serve:84 - Started server process [796900]
2022-01-07 15:45:58.843 | INFO     | uvicorn.server:serve:84 - Started server process [796900]
2022-01-07 15:45:58.843 | INFO     | uvicorn.server:serve:84 - Started server process [796900]
2022-01-07 15:45:58.844 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:45:58.844 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:45:58.845 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:45:58.845 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:45:58.846 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:45:58.846 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:46:01.435 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34990 - "GET /docs HTTP/1.1" 200
2022-01-07 15:46:01.624 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:34990 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:50:19.361 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:50:19.362 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:50:19.362 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:50:19.463 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:50:19.464 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:50:19.464 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:50:19.465 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:50:19.466 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:50:19.466 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:50:19.467 | INFO     | uvicorn.server:serve:94 - Finished server process [796900]
2022-01-07 15:50:19.467 | INFO     | uvicorn.server:serve:94 - Finished server process [796900]
2022-01-07 15:50:19.468 | INFO     | uvicorn.server:serve:94 - Finished server process [796900]
2022-01-07 15:50:20.572 | INFO     | uvicorn.server:serve:84 - Started server process [798448]
2022-01-07 15:50:20.572 | INFO     | uvicorn.server:serve:84 - Started server process [798448]
2022-01-07 15:50:20.573 | INFO     | uvicorn.server:serve:84 - Started server process [798448]
2022-01-07 15:50:20.573 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:50:20.574 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:50:20.574 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:50:20.574 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:50:20.575 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:50:20.575 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:50:23.761 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35286 - "GET /docs HTTP/1.1" 200
2022-01-07 15:50:23.965 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35286 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:50:43.254 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcce2387730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce685f9d0>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce133a430>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fcce135beb0>
                     └ <function get_request_handler.<locals>.app at 0x7fcce133a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'request': <starlette.requests.Request object at 0x7fcce135beb0>}
                   └ <fastapi.security.oauth2.OAuth2PasswordBearer object at 0x7fcce5c48d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/security/oauth2.py", line 164, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce135be50>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fcce133aa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fcce135bd30>
                     └ <function http_exception_handler at 0x7fcce2388310>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce135bd30>
    │      │         └ HTTPException(status_code=401, detail='Not authenticated')
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce135be50>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce135bd90>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcceb403430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fccec1799d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fccec179040>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fccead98340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    └ <function subprocess_started at 0x7fcce8c5e160>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fccead98430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce8c4f550>
           │       │   └ <uvicorn.server.Server object at 0x7fccead98430>
           │       └ <function run at 0x7fcce9e10700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce81ae040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce81d9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce81d9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fcce135bbb0>
                     │    └ <function exception_handler at 0x7fcce2385f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce135bbb0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce135bd90>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:50:43.282 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcce2387730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce685f9d0>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce133a430>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fcce135beb0>
                     └ <function get_request_handler.<locals>.app at 0x7fcce133a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'request': <starlette.requests.Request object at 0x7fcce135beb0>}
                   └ <fastapi.security.oauth2.OAuth2PasswordBearer object at 0x7fcce5c48d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/security/oauth2.py", line 164, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce135be50>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fcce133aa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fcce135bd30>
                     └ <function http_exception_handler at 0x7fcce2388310>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce135bd30>
    │      │         └ HTTPException(status_code=401, detail='Not authenticated')
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce135be50>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce135bd90>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcceb403430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fccec1799d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fccec179040>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fccead98340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    └ <function subprocess_started at 0x7fcce8c5e160>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fccead98430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce8c4f550>
           │       │   └ <uvicorn.server.Server object at 0x7fccead98430>
           │       └ <function run at 0x7fcce9e10700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce81ae040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce81d9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce81d9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fcce135bbb0>
                     │    └ <function exception_handler at 0x7fcce2385f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce135bbb0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce135bd90>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:50:43.299 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcce2387730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce685f9d0>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce133ab80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce133a430>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fcce135beb0>
                     └ <function get_request_handler.<locals>.app at 0x7fcce133a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 496, in solve_dependencies
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'request': <starlette.requests.Request object at 0x7fcce135beb0>}
                   └ <fastapi.security.oauth2.OAuth2PasswordBearer object at 0x7fcce5c48d60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/security/oauth2.py", line 164, in __call__
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce135be50>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fcce133aa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fcce135bd30>
                     └ <function http_exception_handler at 0x7fcce2388310>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce135bd30>
    │      │         └ HTTPException(status_code=401, detail='Not authenticated')
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce135be50>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce135bd90>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcceb403430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fccec1799d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fccec179040>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fccead98340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    └ <function subprocess_started at 0x7fcce8c5e160>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fccead98430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce8c4f550>
           │       │   └ <uvicorn.server.Server object at 0x7fccead98430>
           │       └ <function run at 0x7fcce9e10700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce81ae040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce81d9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce81d9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b460>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce135b4...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce13...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fcce135bbb0>
                     │    └ <function exception_handler at 0x7fcce2385f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce135bbb0>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce135bd90>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:50:43.317 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35290 - "POST /upload_images HTTP/1.1" 500
2022-01-07 15:51:53.450 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:51:53.826 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35328 - "POST /token HTTP/1.1" 200
2022-01-07 15:51:59.549 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fcce054d940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcce2387730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce685f9d0>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce133a430>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fcce0508820>
                     └ <function get_request_handler.<locals>.app at 0x7fcce133a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7fcce3d4d820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce05084c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcceb403430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fccec1799d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fccec179040>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fccead98340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    └ <function subprocess_started at 0x7fcce8c5e160>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fccead98430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce8c4f550>
           │       │   └ <uvicorn.server.Server object at 0x7fccead98430>
           │       └ <function run at 0x7fcce9e10700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce81ae040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce81d9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce81d9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fcce0508b80>
                     │    └ <function exception_handler at 0x7fcce2385f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce0508b80>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce05084c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:51:59.563 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fcce054d940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcce2387730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce685f9d0>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce133a430>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fcce0508820>
                     └ <function get_request_handler.<locals>.app at 0x7fcce133a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7fcce3d4d820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce05084c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcceb403430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fccec1799d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fccec179040>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fccead98340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    └ <function subprocess_started at 0x7fcce8c5e160>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fccead98430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce8c4f550>
           │       │   └ <uvicorn.server.Server object at 0x7fccead98430>
           │       └ <function run at 0x7fcce9e10700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce81ae040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce81d9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce81d9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fcce0508b80>
                     │    └ <function exception_handler at 0x7fcce2385f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce0508b80>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce05084c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:51:59.576 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fcce054d940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fcce2387730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fcce23afa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce685f9d0>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fcce054d820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce133a430>
          └ <fastapi.routing.APIRoute object at 0x7fcce1342790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fcce0508820>
                     └ <function get_request_handler.<locals>.app at 0x7fcce133a3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7fcce684e040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7fcce3d4d820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fcce05084c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcceb403430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fccec1799d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fccec179040>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fccead98340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
    │    └ <function subprocess_started at 0x7fcce8c5e160>
    └ <SpawnProcess name='SpawnProcess-3' parent=796860 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fccead98430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce8c4f550>
           │       │   └ <uvicorn.server.Server object at 0x7fccead98430>
           │       └ <function run at 0x7fcce9e10700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce81ae040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce81d9280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce81d9310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce858ddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce0508e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fcce05...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce74bff40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fcce0508b80>
                     │    └ <function exception_handler at 0x7fcce2385f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fcce23afac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce687ddb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fcce0508b80>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7fccead2b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fcce05084c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:51:59.601 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35348 - "POST /upload_images HTTP/1.1" 500
2022-01-07 15:52:03.309 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:52:03.309 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:52:03.310 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:52:03.410 | INFO     | uvicorn.server:serve:94 - Finished server process [798448]
2022-01-07 15:52:03.410 | INFO     | uvicorn.server:serve:94 - Finished server process [798448]
2022-01-07 15:52:03.410 | INFO     | uvicorn.server:serve:94 - Finished server process [798448]
2022-01-07 15:52:03.413 | ERROR    | uvicorn.lifespan.on:send:132 - Traceback (most recent call last):
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 624, in lifespan
    await receive()
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/lifespan/on.py", line 135, in receive
    return await self.receive_queue.get()
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/queues.py", line 163, in get
    await getter
asyncio.exceptions.CancelledError

2022-01-07 15:52:03.413 | ERROR    | uvicorn.lifespan.on:send:132 - Traceback (most recent call last):
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 624, in lifespan
    await receive()
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/lifespan/on.py", line 135, in receive
    return await self.receive_queue.get()
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/queues.py", line 163, in get
    await getter
asyncio.exceptions.CancelledError

2022-01-07 15:52:03.414 | ERROR    | uvicorn.lifespan.on:send:132 - Traceback (most recent call last):
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 624, in lifespan
    await receive()
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/lifespan/on.py", line 135, in receive
    return await self.receive_queue.get()
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/queues.py", line 163, in get
    await getter
asyncio.exceptions.CancelledError

2022-01-07 15:52:07.216 | INFO     | uvicorn.server:serve:84 - Started server process [799199]
2022-01-07 15:52:07.217 | INFO     | uvicorn.server:serve:84 - Started server process [799199]
2022-01-07 15:52:07.217 | INFO     | uvicorn.server:serve:84 - Started server process [799199]
2022-01-07 15:52:07.217 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:52:07.218 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:52:07.218 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:52:07.218 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:52:07.219 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:52:07.219 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:52:10.830 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35358 - "GET /docs HTTP/1.1" 200
2022-01-07 15:52:11.117 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35358 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:52:16.432 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:52:16.817 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35362 - "POST /token HTTP/1.1" 200
2022-01-07 15:52:32.818 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f170449cc10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1706220ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f17061f8790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1706220ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f170a6d09d0>
          └ <fastapi.routing.APIRoute object at 0x7f17051b37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f17051ab430>
          └ <fastapi.routing.APIRoute object at 0x7f17051b37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1704451400>
                     └ <function get_request_handler.<locals>.app at 0x7f17051ab3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f170a6bf040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f1707bbe820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1704404070>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f170f274430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f170ffea9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f170ffea040>
    └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f170ec09340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
    │    └ <function subprocess_started at 0x7f170cad0160>
    └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f170ec09430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f170cac1550>
           │       │   └ <uvicorn.server.Server object at 0x7f170ec09430>
           │       └ <function run at 0x7f170dc81700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f170c01f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f170c046280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f170c046310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f170c3fedf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f170b331f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f170c3fedf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>
          └ <fastapi.applications.FastAPI object at 0x7f170b331f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1704451a30>
                     │    └ <function exception_handler at 0x7f17061f6f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f170a6eee50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1704451a30>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f170eb9c790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1704404070>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:52:32.838 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f170449cc10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1706220ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f17061f8790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1706220ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f170a6d09d0>
          └ <fastapi.routing.APIRoute object at 0x7f17051b37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f17051ab430>
          └ <fastapi.routing.APIRoute object at 0x7f17051b37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1704451400>
                     └ <function get_request_handler.<locals>.app at 0x7f17051ab3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f170a6bf040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f1707bbe820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1704404070>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f170f274430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f170ffea9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f170ffea040>
    └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f170ec09340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
    │    └ <function subprocess_started at 0x7f170cad0160>
    └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f170ec09430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f170cac1550>
           │       │   └ <uvicorn.server.Server object at 0x7f170ec09430>
           │       └ <function run at 0x7f170dc81700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f170c01f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f170c046280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f170c046310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f170c3fedf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f170b331f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f170c3fedf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>
          └ <fastapi.applications.FastAPI object at 0x7f170b331f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1704451a30>
                     │    └ <function exception_handler at 0x7f17061f6f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f170a6eee50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1704451a30>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f170eb9c790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1704404070>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:52:32.852 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f170449cc10>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1706220ac0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f17061f8790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1706220ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f170a6d09d0>
          └ <fastapi.routing.APIRoute object at 0x7f17051b37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f170449caf0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f17051ab430>
          └ <fastapi.routing.APIRoute object at 0x7f17051b37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1704451400>
                     └ <function get_request_handler.<locals>.app at 0x7f17051ab3a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 216, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x7f170a6bf040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/dependencies/utils.py", line 525, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'current_user': Users<admin>}
                   └ <function get_current_active_user at 0x7f1707bbe820>

  File "./app/routes/login.py", line 66, in get_current_active_user
    if current_user.disabled:
       └ Users<admin>

AttributeError: 'Users' object has no attribute 'disabled'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1704404070>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f170f274430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f170ffea9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f170ffea040>
    └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f170ec09340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
    │    └ <function subprocess_started at 0x7f170cad0160>
    └ <SpawnProcess name='SpawnProcess-1' parent=799162 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f170ec09430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f170cac1550>
           │       │   └ <uvicorn.server.Server object at 0x7f170ec09430>
           │       └ <function run at 0x7f170dc81700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f170c01f040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f170c046280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f170c046310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451ac0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f170c3fedf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f170b331f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f170c3fedf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1704451a...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f17044...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>
          └ <fastapi.applications.FastAPI object at 0x7f170b331f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1704451a30>
                     │    └ <function exception_handler at 0x7f17061f6f70>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1706220b20>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f170a6eee50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1704451a30>
    │      │         └ AttributeError("'Users' object has no attribute 'disabled'")
    │      └ <function Logger.exception at 0x7f170eb9c790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1704404070>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 15:52:32.866 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35386 - "POST /upload_images HTTP/1.1" 500
2022-01-07 15:53:35.510 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:53:35.510 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:53:35.511 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:53:35.612 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:53:35.613 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:53:35.613 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:53:35.614 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:53:35.615 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:53:35.616 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:53:35.618 | INFO     | uvicorn.server:serve:94 - Finished server process [799199]
2022-01-07 15:53:35.619 | INFO     | uvicorn.server:serve:94 - Finished server process [799199]
2022-01-07 15:53:35.620 | INFO     | uvicorn.server:serve:94 - Finished server process [799199]
2022-01-07 15:53:36.994 | INFO     | uvicorn.server:serve:84 - Started server process [799877]
2022-01-07 15:53:36.994 | INFO     | uvicorn.server:serve:84 - Started server process [799877]
2022-01-07 15:53:36.994 | INFO     | uvicorn.server:serve:84 - Started server process [799877]
2022-01-07 15:53:36.995 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:53:36.995 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:53:36.995 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:53:36.996 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:53:36.996 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:53:36.996 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:53:58.451 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:53:58.452 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:53:58.453 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:53:58.553 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:53:58.554 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:53:58.554 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:53:58.555 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:53:58.555 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:53:58.556 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:53:58.557 | INFO     | uvicorn.server:serve:94 - Finished server process [799877]
2022-01-07 15:53:58.557 | INFO     | uvicorn.server:serve:94 - Finished server process [799877]
2022-01-07 15:53:58.558 | INFO     | uvicorn.server:serve:94 - Finished server process [799877]
2022-01-07 15:54:02.493 | INFO     | uvicorn.server:serve:84 - Started server process [800720]
2022-01-07 15:54:02.493 | INFO     | uvicorn.server:serve:84 - Started server process [800720]
2022-01-07 15:54:02.493 | INFO     | uvicorn.server:serve:84 - Started server process [800720]
2022-01-07 15:54:02.494 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:54:02.494 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:54:02.495 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 15:54:02.496 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:54:02.496 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:54:02.497 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 15:54:11.566 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35476 - "GET /docs HTTP/1.1" 200
2022-01-07 15:54:11.842 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35476 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 15:54:18.638 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 15:54:18.694 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:54:21.464 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 15:54:21.678 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35480 - "GET /sanity_check HTTP/1.1" 200
2022-01-07 15:54:48.919 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35610 - "POST /token HTTP/1.1" 200
2022-01-07 15:55:12.874 | INFO     | app.routes.images:upload_image:28 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/e8fe96c8-58f7-4656-ba9b-196b2525e3d8.jpg
2022-01-07 15:55:12.876 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:35626 - "POST /upload_images HTTP/1.1" 200
2022-01-07 15:55:18.773 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:55:18.774 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:55:18.774 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 15:55:18.875 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:55:18.875 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:55:18.876 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 15:55:18.876 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:55:18.877 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:55:18.877 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 15:55:18.877 | INFO     | uvicorn.server:serve:94 - Finished server process [800720]
2022-01-07 15:55:18.878 | INFO     | uvicorn.server:serve:94 - Finished server process [800720]
2022-01-07 15:55:18.878 | INFO     | uvicorn.server:serve:94 - Finished server process [800720]
2022-01-07 16:16:49.562 | INFO     | uvicorn.server:serve:84 - Started server process [806254]
2022-01-07 16:16:49.562 | INFO     | uvicorn.server:serve:84 - Started server process [806254]
2022-01-07 16:16:49.562 | INFO     | uvicorn.server:serve:84 - Started server process [806254]
2022-01-07 16:16:49.563 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:16:49.563 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:16:49.563 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:16:49.564 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:16:49.564 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:16:49.565 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:17:11.854 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36064 - "GET /docs HTTP/1.1" 200
2022-01-07 16:17:12.154 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36064 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 16:17:18.666 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 16:17:19.049 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36068 - "POST /token HTTP/1.1" 200
2022-01-07 16:17:37.651 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/8d18f9a6-f4e1-4527-9975-34aeedf96ecf.jpg
2022-01-07 16:17:37.682 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 16:17:37.879 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/ff9b0b5b-0e48-491b-8449-aac048d36aef.jpg
2022-01-07 16:17:37.910 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36094 - "POST /upload_images HTTP/1.1" 200
2022-01-07 16:18:37.706 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:18:37.707 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:18:37.707 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:18:37.808 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:18:37.808 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:18:37.808 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:18:37.809 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:18:37.809 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:18:37.810 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:18:37.810 | INFO     | uvicorn.server:serve:94 - Finished server process [806254]
2022-01-07 16:18:37.810 | INFO     | uvicorn.server:serve:94 - Finished server process [806254]
2022-01-07 16:18:37.810 | INFO     | uvicorn.server:serve:94 - Finished server process [806254]
2022-01-07 16:18:41.026 | INFO     | uvicorn.server:serve:84 - Started server process [807039]
2022-01-07 16:18:41.027 | INFO     | uvicorn.server:serve:84 - Started server process [807039]
2022-01-07 16:18:41.027 | INFO     | uvicorn.server:serve:84 - Started server process [807039]
2022-01-07 16:18:41.028 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:18:41.028 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:18:41.028 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:18:41.029 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:18:41.030 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:18:41.030 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:18:43.280 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36172 - "GET /docs HTTP/1.1" 200
2022-01-07 16:18:43.566 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36172 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 16:18:49.727 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 16:18:50.104 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36176 - "POST /token HTTP/1.1" 200
2022-01-07 16:19:09.955 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/c1a6c453-0bf1-4956-987e-6d3b0c0f9ef4.jpg
2022-01-07 16:19:09.984 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 16:19:10.189 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/d7202e83-e2f1-43f4-b69f-c6a83f9ac262.jpg
2022-01-07 16:19:10.222 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36216 - "POST /upload_images HTTP/1.1" 200
2022-01-07 16:20:01.399 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:20:01.400 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:20:01.401 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:20:01.502 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:20:01.503 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:20:01.503 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:20:01.504 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:20:01.505 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:20:01.506 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:20:01.507 | INFO     | uvicorn.server:serve:94 - Finished server process [807039]
2022-01-07 16:20:01.508 | INFO     | uvicorn.server:serve:94 - Finished server process [807039]
2022-01-07 16:20:01.509 | INFO     | uvicorn.server:serve:94 - Finished server process [807039]
2022-01-07 16:20:02.711 | INFO     | uvicorn.server:serve:84 - Started server process [807620]
2022-01-07 16:20:02.712 | INFO     | uvicorn.server:serve:84 - Started server process [807620]
2022-01-07 16:20:02.712 | INFO     | uvicorn.server:serve:84 - Started server process [807620]
2022-01-07 16:20:02.712 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:20:02.713 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:20:02.713 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:20:02.715 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:20:02.715 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:20:02.716 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:20:03.118 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:20:03.118 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:20:03.119 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:20:03.219 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:20:03.220 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:20:03.220 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:20:03.220 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:20:03.221 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:20:03.221 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:20:03.221 | INFO     | uvicorn.server:serve:94 - Finished server process [807620]
2022-01-07 16:20:03.221 | INFO     | uvicorn.server:serve:94 - Finished server process [807620]
2022-01-07 16:20:03.222 | INFO     | uvicorn.server:serve:94 - Finished server process [807620]
2022-01-07 16:20:06.666 | INFO     | uvicorn.server:serve:84 - Started server process [807731]
2022-01-07 16:20:06.667 | INFO     | uvicorn.server:serve:84 - Started server process [807731]
2022-01-07 16:20:06.667 | INFO     | uvicorn.server:serve:84 - Started server process [807731]
2022-01-07 16:20:06.667 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:20:06.668 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:20:06.668 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:20:06.669 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:20:06.670 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:20:06.670 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:20:08.063 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36284 - "GET /docs HTTP/1.1" 200
2022-01-07 16:20:08.386 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36284 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 16:20:15.853 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 16:20:16.229 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36288 - "POST /token HTTP/1.1" 200
2022-01-07 16:21:02.201 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/1e557000-7947-4211-a4ab-6eebe61af01b.jpg
2022-01-07 16:21:02.231 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 16:21:02.348 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:36330 - "POST /upload_images HTTP/1.1" 200
2022-01-07 16:27:21.988 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:27:21.989 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:27:21.989 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:27:22.090 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:27:22.090 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:27:22.091 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:27:22.092 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:27:22.092 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:27:22.092 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:27:22.093 | INFO     | uvicorn.server:serve:94 - Finished server process [807731]
2022-01-07 16:27:22.093 | INFO     | uvicorn.server:serve:94 - Finished server process [807731]
2022-01-07 16:27:22.094 | INFO     | uvicorn.server:serve:94 - Finished server process [807731]
2022-01-07 16:27:23.210 | INFO     | uvicorn.server:serve:84 - Started server process [809698]
2022-01-07 16:27:23.210 | INFO     | uvicorn.server:serve:84 - Started server process [809698]
2022-01-07 16:27:23.211 | INFO     | uvicorn.server:serve:84 - Started server process [809698]
2022-01-07 16:27:23.211 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:27:23.212 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:27:23.213 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:27:23.214 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:27:23.215 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:27:23.215 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:29:14.830 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:29:14.830 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:29:14.830 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:29:14.931 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:29:14.932 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:29:14.932 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:29:14.932 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:29:14.933 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:29:14.934 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:29:14.935 | INFO     | uvicorn.server:serve:94 - Finished server process [809698]
2022-01-07 16:29:14.935 | INFO     | uvicorn.server:serve:94 - Finished server process [809698]
2022-01-07 16:29:14.936 | INFO     | uvicorn.server:serve:94 - Finished server process [809698]
2022-01-07 16:29:15.718 | INFO     | uvicorn.server:serve:84 - Started server process [810130]
2022-01-07 16:29:15.718 | INFO     | uvicorn.server:serve:84 - Started server process [810130]
2022-01-07 16:29:15.719 | INFO     | uvicorn.server:serve:84 - Started server process [810130]
2022-01-07 16:29:15.719 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:29:15.719 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:29:15.720 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:29:15.720 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:29:15.721 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:29:15.721 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:42:14.585 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:42:14.586 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:42:14.587 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:42:14.688 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:42:14.688 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:42:14.688 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:42:14.689 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:42:14.689 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:42:14.689 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:42:14.690 | INFO     | uvicorn.server:serve:94 - Finished server process [810130]
2022-01-07 16:42:14.690 | INFO     | uvicorn.server:serve:94 - Finished server process [810130]
2022-01-07 16:42:14.690 | INFO     | uvicorn.server:serve:94 - Finished server process [810130]
2022-01-07 16:42:15.724 | INFO     | uvicorn.server:serve:84 - Started server process [812645]
2022-01-07 16:42:15.724 | INFO     | uvicorn.server:serve:84 - Started server process [812645]
2022-01-07 16:42:15.724 | INFO     | uvicorn.server:serve:84 - Started server process [812645]
2022-01-07 16:42:15.725 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:42:15.725 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:42:15.726 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:42:15.726 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:42:15.726 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:42:15.727 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:47:06.980 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:47:06.980 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:47:06.980 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:47:07.081 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:47:07.082 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:47:07.083 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:47:07.085 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:47:07.085 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:47:07.086 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:47:07.087 | INFO     | uvicorn.server:serve:94 - Finished server process [812645]
2022-01-07 16:47:07.087 | INFO     | uvicorn.server:serve:94 - Finished server process [812645]
2022-01-07 16:47:07.088 | INFO     | uvicorn.server:serve:94 - Finished server process [812645]
2022-01-07 16:47:08.479 | INFO     | uvicorn.server:serve:84 - Started server process [814167]
2022-01-07 16:47:08.480 | INFO     | uvicorn.server:serve:84 - Started server process [814167]
2022-01-07 16:47:08.481 | INFO     | uvicorn.server:serve:84 - Started server process [814167]
2022-01-07 16:47:08.481 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:47:08.482 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:47:08.484 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:47:08.485 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:47:08.485 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:47:08.485 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:58:17.593 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:58:17.594 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:58:17.595 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 16:58:17.695 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:58:17.696 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:58:17.697 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 16:58:17.698 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:58:17.698 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:58:17.699 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 16:58:17.700 | INFO     | uvicorn.server:serve:94 - Finished server process [814167]
2022-01-07 16:58:17.700 | INFO     | uvicorn.server:serve:94 - Finished server process [814167]
2022-01-07 16:58:17.701 | INFO     | uvicorn.server:serve:94 - Finished server process [814167]
2022-01-07 16:58:18.505 | INFO     | uvicorn.server:serve:84 - Started server process [816720]
2022-01-07 16:58:18.506 | INFO     | uvicorn.server:serve:84 - Started server process [816720]
2022-01-07 16:58:18.506 | INFO     | uvicorn.server:serve:84 - Started server process [816720]
2022-01-07 16:58:18.507 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:58:18.507 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:58:18.508 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 16:58:18.509 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:58:18.509 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 16:58:18.510 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 17:02:52.208 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 17:02:52.209 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 17:02:52.209 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 17:02:52.309 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 17:02:52.309 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 17:02:52.310 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 17:02:52.310 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 17:02:52.311 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 17:02:52.312 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 17:02:52.312 | INFO     | uvicorn.server:serve:94 - Finished server process [816720]
2022-01-07 17:02:52.313 | INFO     | uvicorn.server:serve:94 - Finished server process [816720]
2022-01-07 17:02:52.313 | INFO     | uvicorn.server:serve:94 - Finished server process [816720]
2022-01-07 17:02:53.646 | INFO     | uvicorn.server:serve:84 - Started server process [817802]
2022-01-07 17:02:53.646 | INFO     | uvicorn.server:serve:84 - Started server process [817802]
2022-01-07 17:02:53.647 | INFO     | uvicorn.server:serve:84 - Started server process [817802]
2022-01-07 17:02:53.647 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 17:02:53.647 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 17:02:53.648 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 17:02:53.649 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 17:02:53.649 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 17:02:53.650 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 17:02:54.953 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 17:02:54.953 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 17:02:54.953 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 17:02:55.054 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 17:02:55.055 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 17:02:55.055 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 17:02:55.056 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 17:02:55.056 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 17:02:55.056 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 17:02:55.057 | INFO     | uvicorn.server:serve:94 - Finished server process [817802]
2022-01-07 17:02:55.057 | INFO     | uvicorn.server:serve:94 - Finished server process [817802]
2022-01-07 17:02:55.057 | INFO     | uvicorn.server:serve:94 - Finished server process [817802]
2022-01-07 18:09:51.313 | INFO     | uvicorn.server:serve:84 - Started server process [834529]
2022-01-07 18:09:51.314 | INFO     | uvicorn.server:serve:84 - Started server process [834529]
2022-01-07 18:09:51.315 | INFO     | uvicorn.server:serve:84 - Started server process [834529]
2022-01-07 18:09:51.316 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:09:51.317 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:09:51.318 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:09:51.319 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:09:51.319 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:09:51.319 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:09:53.123 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:09:53.124 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:09:53.125 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:09:53.226 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:09:53.226 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:09:53.226 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:09:53.227 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:09:53.228 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:09:53.229 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:09:53.229 | INFO     | uvicorn.server:serve:94 - Finished server process [834529]
2022-01-07 18:09:53.230 | INFO     | uvicorn.server:serve:94 - Finished server process [834529]
2022-01-07 18:09:53.230 | INFO     | uvicorn.server:serve:94 - Finished server process [834529]
2022-01-07 18:17:49.742 | INFO     | uvicorn.server:serve:84 - Started server process [836958]
2022-01-07 18:17:49.743 | INFO     | uvicorn.server:serve:84 - Started server process [836958]
2022-01-07 18:17:49.743 | INFO     | uvicorn.server:serve:84 - Started server process [836958]
2022-01-07 18:17:49.744 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:17:49.744 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:17:49.745 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:17:49.745 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:17:49.746 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:17:49.746 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:17:52.956 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:38984 - "GET /docs HTTP/1.1" 200
2022-01-07 18:17:53.308 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:38984 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:18:11.593 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:18:13.763 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f45a07e08b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f45a07e0a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f459e0154c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f459e849880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f45a2d189d0>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f459e868670>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f459e01de80>
                     └ <function get_request_handler.<locals>.app at 0x7f459e868700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f45a2d075e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>}
                 │         └ <function login_for_access_token at 0x7f45a0208ca0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f45a4a3cc40>

  File "./app/routes/login.py", line 92, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>
           └ <function authenticate_user at 0x7f45a0208b80>

  File "./app/routes/login.py", line 82, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f45a0e3e3a0>

  File "./app/models/models.py", line 48, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f45a0777ac0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f45a07734c0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f459ea80190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
                └ <pynamodb.pagination.ResultIterator object at 0x7f459ea80190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>>
           └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f45a07e4c10>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f45a07e0ca0>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f459caaa6a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f45a78bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f45a86339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f45a8633040>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f45a7251340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    └ <function subprocess_started at 0x7f45a5118160>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f45a7251430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f45a510a550>
           │       │   └ <uvicorn.server.Server object at 0x7f45a7251430>
           │       └ <function run at 0x7f45a62c9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f45a4666040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f45a4692280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f45a4692310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
          └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f459e01de50>
                     │    └ <function exception_handler at 0x7f459e83e1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f45a2d36ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f459e01de50>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f45a71e4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f459caaa6a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:18:13.790 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f45a07e08b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f45a07e0a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f459e0154c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f459e849880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f45a2d189d0>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f459e868670>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f459e01de80>
                     └ <function get_request_handler.<locals>.app at 0x7f459e868700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f45a2d075e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>}
                 │         └ <function login_for_access_token at 0x7f45a0208ca0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f45a4a3cc40>

  File "./app/routes/login.py", line 92, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>
           └ <function authenticate_user at 0x7f45a0208b80>

  File "./app/routes/login.py", line 82, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f45a0e3e3a0>

  File "./app/models/models.py", line 48, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f45a0777ac0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f45a07734c0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f459ea80190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
                └ <pynamodb.pagination.ResultIterator object at 0x7f459ea80190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>>
           └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f45a07e4c10>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f45a07e0ca0>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f459caaa6a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f45a78bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f45a86339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f45a8633040>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f45a7251340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    └ <function subprocess_started at 0x7f45a5118160>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f45a7251430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f45a510a550>
           │       │   └ <uvicorn.server.Server object at 0x7f45a7251430>
           │       └ <function run at 0x7f45a62c9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f45a4666040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f45a4692280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f45a4692310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
          └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f459e01de50>
                     │    └ <function exception_handler at 0x7f459e83e1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f45a2d36ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f459e01de50>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f45a71e4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f459caaa6a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:18:13.809 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f45a07e08b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f45a07e0a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f459e0154c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f459e849880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f45a2d189d0>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459e015670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f459e868670>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f459e01de80>
                     └ <function get_request_handler.<locals>.app at 0x7f459e868700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f45a2d075e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>}
                 │         └ <function login_for_access_token at 0x7f45a0208ca0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f45a4a3cc40>

  File "./app/routes/login.py", line 92, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459d770fa0>
           └ <function authenticate_user at 0x7f45a0208b80>

  File "./app/routes/login.py", line 82, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f45a0e3e3a0>

  File "./app/models/models.py", line 48, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f45a0777ac0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f45a07734c0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f459ea80190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
                └ <pynamodb.pagination.ResultIterator object at 0x7f459ea80190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>>
           └ <pynamodb.pagination.PageIterator object at 0x7f459ea80160>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f45a07e4c10>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f45a07e0ca0>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f459caaa6a0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f45a78bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f45a86339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f45a8633040>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f45a7251340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    └ <function subprocess_started at 0x7f45a5118160>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f45a7251430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f45a510a550>
           │       │   └ <uvicorn.server.Server object at 0x7f45a7251430>
           │       └ <function run at 0x7f45a62c9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f45a4666040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f45a4692280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f45a4692310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da60>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e86da...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459e8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
          └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f459e01de50>
                     │    └ <function exception_handler at 0x7f459e83e1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f45a2d36ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f459e01de50>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f45a71e4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f459caaa6a0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:18:13.837 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:38988 - "POST /token HTTP/1.1" 500
2022-01-07 18:18:13.871 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f45a07e08b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f45a07e0a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f459e015430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f459e849880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f45a2d189d0>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f459e868670>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f459ca48730>
                     └ <function get_request_handler.<locals>.app at 0x7f459e868700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f45a2d075e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>}
                 │         └ <function login_for_access_token at 0x7f45a0208ca0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f45a4a3cc40>

  File "./app/routes/login.py", line 92, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>
           └ <function authenticate_user at 0x7f45a0208b80>

  File "./app/routes/login.py", line 82, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f45a0e3e3a0>

  File "./app/models/models.py", line 48, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f45a0777ac0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f45a07734c0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f459d7a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f459d7a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>>
           └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f45a07e4c10>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f45a07e0ca0>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f459c98c100>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f45a78bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f45a86339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f45a8633040>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f45a7251340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    └ <function subprocess_started at 0x7f45a5118160>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f45a7251430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f45a510a550>
           │       │   └ <uvicorn.server.Server object at 0x7f45a7251430>
           │       └ <function run at 0x7f45a62c9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f45a4666040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f45a4692280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f45a4692310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
          └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f459ca48700>
                     │    └ <function exception_handler at 0x7f459e83e1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f45a2d36ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f459ca48700>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f45a71e4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f459c98c100>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:18:13.896 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f45a07e08b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f45a07e0a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f459e015430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f459e849880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f45a2d189d0>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f459e868670>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f459ca48730>
                     └ <function get_request_handler.<locals>.app at 0x7f459e868700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f45a2d075e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>}
                 │         └ <function login_for_access_token at 0x7f45a0208ca0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f45a4a3cc40>

  File "./app/routes/login.py", line 92, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>
           └ <function authenticate_user at 0x7f45a0208b80>

  File "./app/routes/login.py", line 82, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f45a0e3e3a0>

  File "./app/models/models.py", line 48, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f45a0777ac0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f45a07734c0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f459d7a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f459d7a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>>
           └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f45a07e4c10>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f45a07e0ca0>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f459c98c100>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f45a78bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f45a86339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f45a8633040>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f45a7251340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    └ <function subprocess_started at 0x7f45a5118160>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f45a7251430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f45a510a550>
           │       │   └ <uvicorn.server.Server object at 0x7f45a7251430>
           │       └ <function run at 0x7f45a62c9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f45a4666040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f45a4692280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f45a4692310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
          └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f459ca48700>
                     │    └ <function exception_handler at 0x7f459e83e1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f45a2d36ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f459ca48700>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f45a71e4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f459c98c100>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:18:13.928 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 548, in get_meta_table
    data = self.dispatch(DESCRIBE_TABLE, operation_kwargs)
           │    │        │               └ {'TableName': 'Users'}
           │    │        └ 'DescribeTable'
           │    └ <function Connection.dispatch at 0x7f45a07e08b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │              │               └ {'TableName': 'Users'}
           │    │              └ 'DescribeTable'
           │    └ <function Connection._make_api_call at 0x7f45a07e0a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': None, 'table_name': 'Users'}
          │                  │                         └ 'DescribeTable'
          │                  └ {'Error': {'Message': 'Cannot do operations on a non-existent table', 'Code': 'ResourceNotFoundException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ResourceNotFoundException) on request (None) on table (Users) when calling the DescribeTable operation: Cannot do operations on a non-existent table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f459e015430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f459e849880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f459e86dc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f45a2d189d0>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f459c9b5af0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f459e868670>
          └ <fastapi.routing.APIRoute object at 0x7f459e849ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f459ca48730>
                     └ <function get_request_handler.<locals>.app at 0x7f459e868700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f45a2d075e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 159, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>}
                 │         └ <function login_for_access_token at 0x7f45a0208ca0>
                 └ <fastapi.dependencies.models.Dependant object at 0x7f45a4a3cc40>

  File "./app/routes/login.py", line 92, in login_for_access_token
    user = authenticate_user(form_data.username, form_data.password)
           │                 │         │         │         └ 'admin'
           │                 │         │         └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>
           │                 │         └ 'admin'
           │                 └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7f459e01db20>
           └ <function authenticate_user at 0x7f45a0208b80>

  File "./app/routes/login.py", line 82, in authenticate_user
    user = query_user(username)
           │          └ 'admin'
           └ <function query_user at 0x7f45a0e3e3a0>

  File "./app/models/models.py", line 48, in query_user
    result = list(Users.query(username))
                  │     │     └ 'admin'
                  │     └ <classmethod object at 0x7f45a0777ac0>
                  └ <class 'app.models.models.Users'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f45a07734c0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f459d7a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f459d7a7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': None, 'exclusive_start_key': None, 'consistent_read': F...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f45a07dc1f0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    │           │    └ ('admin',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>>
           └ <pynamodb.pagination.PageIterator object at 0x7f459ca487f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f45a07e4c10>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f459e01da90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1288, in query
    tbl = self.get_meta_table(table_name)
          │    │              └ 'Users'
          │    └ <function Connection.get_meta_table at 0x7f45a07e0ca0>
          └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 554, in get_meta_table
    raise TableDoesNotExist(e.response['Error']['Message'])
          └ <class 'pynamodb.exceptions.TableDoesNotExist'>

pynamodb.exceptions.TableDoesNotExist: Table does not exist: `Cannot do operations on a non-existent table`


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f459c98c100>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f45a78bd430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f45a86339d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f45a8633040>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f45a7251340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
    │    └ <function subprocess_started at 0x7f45a5118160>
    └ <SpawnProcess name='SpawnProcess-1' parent=836918 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f45a7251430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f45a510a550>
           │       │   └ <uvicorn.server.Server object at 0x7f45a7251430>
           │       └ <function run at 0x7f45a62c9700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f45a4666040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f45a4692280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f45a4692310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f45a4a46df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca485...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f459ca...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>
          └ <fastapi.applications.FastAPI object at 0x7f45a3979f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f459ca48700>
                     │    └ <function exception_handler at 0x7f459e83e1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f459e86dca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f45a2d36ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f459ca48700>
    │      │         └ TableDoesNotExist('Table does not exist: `Cannot do operations on a non-existent table`')
    │      └ <function Logger.exception at 0x7f45a71e4790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f459c98c100>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:18:13.960 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39032 - "POST /token HTTP/1.1" 500
2022-01-07 18:18:37.414 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:18:37.415 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:18:37.416 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:18:37.517 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:18:37.518 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:18:37.518 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:18:37.519 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:18:37.519 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:18:37.519 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:18:37.521 | INFO     | uvicorn.server:serve:94 - Finished server process [836958]
2022-01-07 18:18:37.521 | INFO     | uvicorn.server:serve:94 - Finished server process [836958]
2022-01-07 18:18:37.522 | INFO     | uvicorn.server:serve:94 - Finished server process [836958]
2022-01-07 18:18:49.393 | INFO     | uvicorn.server:serve:84 - Started server process [838168]
2022-01-07 18:18:49.393 | INFO     | uvicorn.server:serve:84 - Started server process [838168]
2022-01-07 18:18:49.394 | INFO     | uvicorn.server:serve:84 - Started server process [838168]
2022-01-07 18:18:49.394 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:18:49.394 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:18:49.395 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:18:49.395 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:18:49.395 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:18:49.396 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:18:50.698 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39104 - "GET /docs HTTP/1.1" 200
2022-01-07 18:18:50.935 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39104 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:18:57.228 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 18:18:57.293 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:19:00.171 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:19:00.392 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 649, in create_table
    data = self.dispatch(CREATE_TABLE, operation_kwargs)
           │    │        │             └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │        └ 'CreateTable'
           │    └ <function Connection.dispatch at 0x7f87960578b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f87960531f0>
           │    │              │               └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │              └ 'CreateTable'
           │    └ <function Connection._make_api_call at 0x7f8796057a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'b8c88667-5f4f-4c71-98e4-4bb5838b8be4', 'table_name': 'Images'}
          │                  │                         └ 'CreateTable'
          │                  └ {'Error': {'Message': 'Local secondary indices must have a range key', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4) on table (Images) when calling the CreateTable operation: Local secondary indices must have a range key


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f879388e550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f87940e4cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f87940bf910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f87940e4cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f879858f9d0>
          └ <fastapi.routing.APIRoute object at 0x7f87938766a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f87940dfa60>
          └ <fastapi.routing.APIRoute object at 0x7f87938766a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f879389af70>
                     └ <function get_request_handler.<locals>.app at 0x7f87940df9d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f879857e5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f8795a9e1f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f87938766d0>
                 └ <function run_in_threadpool at 0x7f8798769af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f8793882fc0>
                 │     │         └ <function run_sync at 0x7f87987879d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
                 │                                        └ <built-in method run of Context object at 0x7f8793882fc0>
                 └ <function get_asynclib at 0x7f8798787310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableError('Failed to create table: An error occurred (ValidationException) on request (b8c88667-5...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
             │       │   └ <built-in method run of Context object at 0x7f8793882fc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f8793892bc0>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f8795ab5430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7f8795feec70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 816, in create_table
    cls._get_connection().create_table(
    │   └ <classmethod object at 0x7f8795feee80>
    └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 334, in create_table
    return self.connection.create_table(
           │    │          └ <function Connection.create_table at 0x7f8796057d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f8791d50850>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 651, in create_table
    raise TableError("Failed to create table: {}".format(e), e)
          └ <class 'pynamodb.exceptions.TableError'>

pynamodb.exceptions.TableError: Failed to create table: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4) on table (Images) when calling the CreateTable operation: Local secondary indices must have a range key


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f879389ad30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f879d134430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f879dea99d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f879dea9040>
    └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f879cac8340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
    │    └ <function subprocess_started at 0x7f879a98f160>
    └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f879cac8430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f879a981550>
           │       │   └ <uvicorn.server.Server object at 0x7f879cac8430>
           │       └ <function run at 0x7f879bb40700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f8799ede040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f8799f07280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f8799f07310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f879a2bddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f87991f0f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f879a2bddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>
          └ <fastapi.applications.FastAPI object at 0x7f87991f0f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f879389ad60>
                     │    └ <function exception_handler at 0x7f87940b51f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f87985ade50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f879389ad60>
    │      │         └ TableError('Failed to create table: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4)...
    │      └ <function Logger.exception at 0x7f879ca5b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f879389ad30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:19:00.428 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 649, in create_table
    data = self.dispatch(CREATE_TABLE, operation_kwargs)
           │    │        │             └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │        └ 'CreateTable'
           │    └ <function Connection.dispatch at 0x7f87960578b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f87960531f0>
           │    │              │               └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │              └ 'CreateTable'
           │    └ <function Connection._make_api_call at 0x7f8796057a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'b8c88667-5f4f-4c71-98e4-4bb5838b8be4', 'table_name': 'Images'}
          │                  │                         └ 'CreateTable'
          │                  └ {'Error': {'Message': 'Local secondary indices must have a range key', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4) on table (Images) when calling the CreateTable operation: Local secondary indices must have a range key


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f879388e550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f87940e4cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f87940bf910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f87940e4cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f879858f9d0>
          └ <fastapi.routing.APIRoute object at 0x7f87938766a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f87940dfa60>
          └ <fastapi.routing.APIRoute object at 0x7f87938766a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f879389af70>
                     └ <function get_request_handler.<locals>.app at 0x7f87940df9d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f879857e5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f8795a9e1f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f87938766d0>
                 └ <function run_in_threadpool at 0x7f8798769af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f8793882fc0>
                 │     │         └ <function run_sync at 0x7f87987879d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
                 │                                        └ <built-in method run of Context object at 0x7f8793882fc0>
                 └ <function get_asynclib at 0x7f8798787310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableError('Failed to create table: An error occurred (ValidationException) on request (b8c88667-5...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
             │       │   └ <built-in method run of Context object at 0x7f8793882fc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f8793892bc0>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f8795ab5430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7f8795feec70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 816, in create_table
    cls._get_connection().create_table(
    │   └ <classmethod object at 0x7f8795feee80>
    └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 334, in create_table
    return self.connection.create_table(
           │    │          └ <function Connection.create_table at 0x7f8796057d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f8791d50850>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 651, in create_table
    raise TableError("Failed to create table: {}".format(e), e)
          └ <class 'pynamodb.exceptions.TableError'>

pynamodb.exceptions.TableError: Failed to create table: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4) on table (Images) when calling the CreateTable operation: Local secondary indices must have a range key


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f879389ad30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f879d134430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f879dea99d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f879dea9040>
    └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f879cac8340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
    │    └ <function subprocess_started at 0x7f879a98f160>
    └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f879cac8430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f879a981550>
           │       │   └ <uvicorn.server.Server object at 0x7f879cac8430>
           │       └ <function run at 0x7f879bb40700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f8799ede040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f8799f07280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f8799f07310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f879a2bddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f87991f0f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f879a2bddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>
          └ <fastapi.applications.FastAPI object at 0x7f87991f0f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f879389ad60>
                     │    └ <function exception_handler at 0x7f87940b51f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f87985ade50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f879389ad60>
    │      │         └ TableError('Failed to create table: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4)...
    │      └ <function Logger.exception at 0x7f879ca5b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f879389ad30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:19:00.454 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 649, in create_table
    data = self.dispatch(CREATE_TABLE, operation_kwargs)
           │    │        │             └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │        └ 'CreateTable'
           │    └ <function Connection.dispatch at 0x7f87960578b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f87960531f0>
           │    │              │               └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │              └ 'CreateTable'
           │    └ <function Connection._make_api_call at 0x7f8796057a60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'b8c88667-5f4f-4c71-98e4-4bb5838b8be4', 'table_name': 'Images'}
          │                  │                         └ 'CreateTable'
          │                  └ {'Error': {'Message': 'Local secondary indices must have a range key', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4) on table (Images) when calling the CreateTable operation: Local secondary indices must have a range key


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f879388e550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f87940e4cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f87940bf910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f87940e4cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f879858f9d0>
          └ <fastapi.routing.APIRoute object at 0x7f87938766a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f879388e670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f87940dfa60>
          └ <fastapi.routing.APIRoute object at 0x7f87938766a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f879389af70>
                     └ <function get_request_handler.<locals>.app at 0x7f87940df9d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f879857e5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f8795a9e1f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f87938766d0>
                 └ <function run_in_threadpool at 0x7f8798769af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f8793882fc0>
                 │     │         └ <function run_sync at 0x7f87987879d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
                 │                                        └ <built-in method run of Context object at 0x7f8793882fc0>
                 └ <function get_asynclib at 0x7f8798787310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableError('Failed to create table: An error occurred (ValidationException) on request (b8c88667-5...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f8795a9e1f0>),)
             │       │   └ <built-in method run of Context object at 0x7f8793882fc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f8793892bc0>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f8795ab5430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7f8795feec70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 816, in create_table
    cls._get_connection().create_table(
    │   └ <classmethod object at 0x7f8795feee80>
    └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 334, in create_table
    return self.connection.create_table(
           │    │          └ <function Connection.create_table at 0x7f8796057d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f8791d50850>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 651, in create_table
    raise TableError("Failed to create table: {}".format(e), e)
          └ <class 'pynamodb.exceptions.TableError'>

pynamodb.exceptions.TableError: Failed to create table: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4) on table (Images) when calling the CreateTable operation: Local secondary indices must have a range key


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f879389ad30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f879d134430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f879dea99d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f879dea9040>
    └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f879cac8340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
    │    └ <function subprocess_started at 0x7f879a98f160>
    └ <SpawnProcess name='SpawnProcess-1' parent=838131 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f879cac8430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f879a981550>
           │       │   └ <uvicorn.server.Server object at 0x7f879cac8430>
           │       └ <function run at 0x7f879bb40700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f8799ede040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f8799f07280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f8799f07310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d30>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f879a2bddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f87991f0f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f879a2bddf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f8793886d...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f87938...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>
          └ <fastapi.applications.FastAPI object at 0x7f87991f0f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f879389ad60>
                     │    └ <function exception_handler at 0x7f87940b51f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f87940e4d30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f87985ade50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f879389ad60>
    │      │         └ TableError('Failed to create table: An error occurred (ValidationException) on request (b8c88667-5f4f-4c71-98e4-4bb5838b8be4)...
    │      └ <function Logger.exception at 0x7f879ca5b790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f879389ad30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:19:00.480 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39108 - "GET /sanity_check HTTP/1.1" 500
2022-01-07 18:20:00.416 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:20:00.416 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:20:00.417 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:20:00.518 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:20:00.519 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:20:00.521 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:20:00.523 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:20:00.524 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:20:00.525 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:20:00.529 | INFO     | uvicorn.server:serve:94 - Finished server process [838168]
2022-01-07 18:20:00.530 | INFO     | uvicorn.server:serve:94 - Finished server process [838168]
2022-01-07 18:20:00.530 | INFO     | uvicorn.server:serve:94 - Finished server process [838168]
2022-01-07 18:20:01.937 | INFO     | uvicorn.server:serve:84 - Started server process [838686]
2022-01-07 18:20:01.938 | INFO     | uvicorn.server:serve:84 - Started server process [838686]
2022-01-07 18:20:01.938 | INFO     | uvicorn.server:serve:84 - Started server process [838686]
2022-01-07 18:20:01.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:20:01.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:20:01.939 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:20:01.940 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:20:01.940 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:20:01.940 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:20:02.342 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:20:02.342 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:20:02.342 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:20:02.443 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:20:02.443 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:20:02.444 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:20:02.445 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:20:02.446 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:20:02.447 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:20:02.447 | INFO     | uvicorn.server:serve:94 - Finished server process [838686]
2022-01-07 18:20:02.448 | INFO     | uvicorn.server:serve:94 - Finished server process [838686]
2022-01-07 18:20:02.449 | INFO     | uvicorn.server:serve:94 - Finished server process [838686]
2022-01-07 18:20:06.219 | INFO     | uvicorn.server:serve:84 - Started server process [838790]
2022-01-07 18:20:06.220 | INFO     | uvicorn.server:serve:84 - Started server process [838790]
2022-01-07 18:20:06.220 | INFO     | uvicorn.server:serve:84 - Started server process [838790]
2022-01-07 18:20:06.221 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:20:06.221 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:20:06.222 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:20:06.222 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:20:06.223 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:20:06.223 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:20:08.502 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39254 - "GET /docs HTTP/1.1" 200
2022-01-07 18:20:08.749 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39254 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:20:12.410 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 18:20:12.488 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:20:12.608 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:20:12.793 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 649, in create_table
    data = self.dispatch(CREATE_TABLE, operation_kwargs)
           │    │        │             └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │        └ 'CreateTable'
           │    └ <function Connection.dispatch at 0x7f5b6d6bd8b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b6d6b91f0>
           │    │              │               └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │              └ 'CreateTable'
           │    └ <function Connection._make_api_call at 0x7f5b6d6bda60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '266d9332-77dc-4fce-b30a-a6b0fa015f70', 'table_name': 'Images'}
          │                  │                         └ 'CreateTable'
          │                  └ {'Error': {'Message': 'Local Secondary indices must have the same hash key as the main table', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70) on table (Images) when calling the CreateTable operation: Local Secondary indices must have the same hash key as the main table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5b6aef45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b6b74acd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5b6b725910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b6b74acd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5b6fbf59d0>
          └ <fastapi.routing.APIRoute object at 0x7f5b6aedc6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5b6b746a60>
          └ <fastapi.routing.APIRoute object at 0x7f5b6aedc6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5b6af00400>
                     └ <function get_request_handler.<locals>.app at 0x7f5b6b7469d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5b6fbe45e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f5b6d1041f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5b6aedc6d0>
                 └ <function run_in_threadpool at 0x7f5b6fdcfaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f5b6af010c0>
                 │     │         └ <function run_sync at 0x7f5b6fded9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
                 │                                        └ <built-in method run of Context object at 0x7f5b6af010c0>
                 └ <function get_asynclib at 0x7f5b6fded310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableError('Failed to create table: An error occurred (ValidationException) on request (266d9332-7...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
             │       │   └ <built-in method run of Context object at 0x7f5b6af010c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5b6a6a14c0>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f5b6d11c430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7f5b6d654c70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 816, in create_table
    cls._get_connection().create_table(
    │   └ <classmethod object at 0x7f5b6d654e80>
    └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 334, in create_table
    return self.connection.create_table(
           │    │          └ <function Connection.create_table at 0x7f5b6d6bdd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f5b698f5190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 651, in create_table
    raise TableError("Failed to create table: {}".format(e), e)
          └ <class 'pynamodb.exceptions.TableError'>

pynamodb.exceptions.TableError: Failed to create table: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70) on table (Images) when calling the CreateTable operation: Local Secondary indices must have the same hash key as the main table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5b6af001c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5b74798430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5b755109d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5b75510040>
    └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5b7412e340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
    │    └ <function subprocess_started at 0x7f5b71ff6160>
    └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5b7412e430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5b71fe7550>
           │       │   └ <uvicorn.server.Server object at 0x7f5b7412e430>
           │       └ <function run at 0x7f5b731a6700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5b71544040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5b7156d280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5b7156d310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b71923df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5b70856f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b71923df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>
          └ <fastapi.applications.FastAPI object at 0x7f5b70856f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5b6aeecf10>
                     │    └ <function exception_handler at 0x7f5b6b71c1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5b6fc13db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5b6aeecf10>
    │      │         └ TableError('Failed to create table: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70)...
    │      └ <function Logger.exception at 0x7f5b740c1790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5b6af001c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:20:12.824 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 649, in create_table
    data = self.dispatch(CREATE_TABLE, operation_kwargs)
           │    │        │             └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │        └ 'CreateTable'
           │    └ <function Connection.dispatch at 0x7f5b6d6bd8b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b6d6b91f0>
           │    │              │               └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │              └ 'CreateTable'
           │    └ <function Connection._make_api_call at 0x7f5b6d6bda60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '266d9332-77dc-4fce-b30a-a6b0fa015f70', 'table_name': 'Images'}
          │                  │                         └ 'CreateTable'
          │                  └ {'Error': {'Message': 'Local Secondary indices must have the same hash key as the main table', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70) on table (Images) when calling the CreateTable operation: Local Secondary indices must have the same hash key as the main table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5b6aef45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b6b74acd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5b6b725910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b6b74acd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5b6fbf59d0>
          └ <fastapi.routing.APIRoute object at 0x7f5b6aedc6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5b6b746a60>
          └ <fastapi.routing.APIRoute object at 0x7f5b6aedc6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5b6af00400>
                     └ <function get_request_handler.<locals>.app at 0x7f5b6b7469d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5b6fbe45e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f5b6d1041f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5b6aedc6d0>
                 └ <function run_in_threadpool at 0x7f5b6fdcfaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f5b6af010c0>
                 │     │         └ <function run_sync at 0x7f5b6fded9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
                 │                                        └ <built-in method run of Context object at 0x7f5b6af010c0>
                 └ <function get_asynclib at 0x7f5b6fded310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableError('Failed to create table: An error occurred (ValidationException) on request (266d9332-7...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
             │       │   └ <built-in method run of Context object at 0x7f5b6af010c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5b6a6a14c0>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f5b6d11c430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7f5b6d654c70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 816, in create_table
    cls._get_connection().create_table(
    │   └ <classmethod object at 0x7f5b6d654e80>
    └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 334, in create_table
    return self.connection.create_table(
           │    │          └ <function Connection.create_table at 0x7f5b6d6bdd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f5b698f5190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 651, in create_table
    raise TableError("Failed to create table: {}".format(e), e)
          └ <class 'pynamodb.exceptions.TableError'>

pynamodb.exceptions.TableError: Failed to create table: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70) on table (Images) when calling the CreateTable operation: Local Secondary indices must have the same hash key as the main table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5b6af001c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5b74798430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5b755109d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5b75510040>
    └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5b7412e340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
    │    └ <function subprocess_started at 0x7f5b71ff6160>
    └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5b7412e430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5b71fe7550>
           │       │   └ <uvicorn.server.Server object at 0x7f5b7412e430>
           │       └ <function run at 0x7f5b731a6700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5b71544040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5b7156d280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5b7156d310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b71923df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5b70856f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b71923df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>
          └ <fastapi.applications.FastAPI object at 0x7f5b70856f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5b6aeecf10>
                     │    └ <function exception_handler at 0x7f5b6b71c1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5b6fc13db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5b6aeecf10>
    │      │         └ TableError('Failed to create table: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70)...
    │      └ <function Logger.exception at 0x7f5b740c1790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5b6af001c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:20:12.854 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 649, in create_table
    data = self.dispatch(CREATE_TABLE, operation_kwargs)
           │    │        │             └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │        └ 'CreateTable'
           │    └ <function Connection.dispatch at 0x7f5b6d6bd8b0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b6d6b91f0>
           │    │              │               └ {'TableName': 'Images', 'ProvisionedThroughput': {'ReadCapacityUnits': 10, 'WriteCapacityUnits': 10}, 'AttributeDefinitions':...
           │    │              └ 'CreateTable'
           │    └ <function Connection._make_api_call at 0x7f5b6d6bda60>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '266d9332-77dc-4fce-b30a-a6b0fa015f70', 'table_name': 'Images'}
          │                  │                         └ 'CreateTable'
          │                  └ {'Error': {'Message': 'Local Secondary indices must have the same hash key as the main table', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70) on table (Images) when calling the CreateTable operation: Local Secondary indices must have the same hash key as the main table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5b6aef45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b6b74acd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5b6b725910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b6b74acd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5b6fbf59d0>
          └ <fastapi.routing.APIRoute object at 0x7f5b6aedc6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b6aef4670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5b6b746a60>
          └ <fastapi.routing.APIRoute object at 0x7f5b6aedc6a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5b6af00400>
                     └ <function get_request_handler.<locals>.app at 0x7f5b6b7469d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5b6fbe45e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7f5b6d1041f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5b6aedc6d0>
                 └ <function run_in_threadpool at 0x7f5b6fdcfaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f5b6af010c0>
                 │     │         └ <function run_sync at 0x7f5b6fded9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
                 │                                        └ <built-in method run of Context object at 0x7f5b6af010c0>
                 └ <function get_asynclib at 0x7f5b6fded310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TableError('Failed to create table: An error occurred (ValidationException) on request (266d9332-7...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7f5b6d1041f0>),)
             │       │   └ <built-in method run of Context object at 0x7f5b6af010c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5b6a6a14c0>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7f5b6d11c430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7f5b6d654c70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 816, in create_table
    cls._get_connection().create_table(
    │   └ <classmethod object at 0x7f5b6d654e80>
    └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 334, in create_table
    return self.connection.create_table(
           │    │          └ <function Connection.create_table at 0x7f5b6d6bdd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f5b698f5190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 651, in create_table
    raise TableError("Failed to create table: {}".format(e), e)
          └ <class 'pynamodb.exceptions.TableError'>

pynamodb.exceptions.TableError: Failed to create table: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70) on table (Images) when calling the CreateTable operation: Local Secondary indices must have the same hash key as the main table


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5b6af001c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5b74798430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5b755109d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5b75510040>
    └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5b7412e340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
    │    └ <function subprocess_started at 0x7f5b71ff6160>
    └ <SpawnProcess name='SpawnProcess-1' parent=838753 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5b7412e430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5b71fe7550>
           │       │   └ <uvicorn.server.Server object at 0x7f5b7412e430>
           │       └ <function run at 0x7f5b731a6700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5b71544040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5b7156d280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5b7156d310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecfd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b71923df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5b70856f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b71923df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6aeecf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b6ae...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>
          └ <fastapi.applications.FastAPI object at 0x7f5b70856f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5b6aeecf10>
                     │    └ <function exception_handler at 0x7f5b6b71c1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b6b74ad30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5b6fc13db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5b6aeecf10>
    │      │         └ TableError('Failed to create table: An error occurred (ValidationException) on request (266d9332-77dc-4fce-b30a-a6b0fa015f70)...
    │      └ <function Logger.exception at 0x7f5b740c1790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5b6af001c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:20:12.886 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39254 - "GET /sanity_check HTTP/1.1" 500
2022-01-07 18:21:40.488 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:40.489 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:40.490 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:40.591 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:40.592 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:40.593 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:40.594 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:40.594 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:40.595 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:40.596 | INFO     | uvicorn.server:serve:94 - Finished server process [838790]
2022-01-07 18:21:40.596 | INFO     | uvicorn.server:serve:94 - Finished server process [838790]
2022-01-07 18:21:40.597 | INFO     | uvicorn.server:serve:94 - Finished server process [838790]
2022-01-07 18:21:41.633 | INFO     | uvicorn.server:serve:84 - Started server process [839280]
2022-01-07 18:21:41.634 | INFO     | uvicorn.server:serve:84 - Started server process [839280]
2022-01-07 18:21:41.634 | INFO     | uvicorn.server:serve:84 - Started server process [839280]
2022-01-07 18:21:41.635 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:41.635 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:41.636 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:41.636 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:41.637 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:41.637 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:53.867 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:53.868 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:53.868 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:53.969 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:53.969 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:53.970 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:53.970 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:53.971 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:53.972 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:53.974 | INFO     | uvicorn.server:serve:94 - Finished server process [839280]
2022-01-07 18:21:53.974 | INFO     | uvicorn.server:serve:94 - Finished server process [839280]
2022-01-07 18:21:53.975 | INFO     | uvicorn.server:serve:94 - Finished server process [839280]
2022-01-07 18:21:55.518 | INFO     | uvicorn.server:serve:84 - Started server process [839429]
2022-01-07 18:21:55.519 | INFO     | uvicorn.server:serve:84 - Started server process [839429]
2022-01-07 18:21:55.519 | INFO     | uvicorn.server:serve:84 - Started server process [839429]
2022-01-07 18:21:55.520 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:55.520 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:55.520 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:55.521 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:55.521 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:55.521 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:55.822 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:55.822 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:55.823 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:21:55.924 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:55.924 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:55.924 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:21:55.925 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:55.927 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:55.930 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:21:55.931 | INFO     | uvicorn.server:serve:94 - Finished server process [839429]
2022-01-07 18:21:55.932 | INFO     | uvicorn.server:serve:94 - Finished server process [839429]
2022-01-07 18:21:55.932 | INFO     | uvicorn.server:serve:94 - Finished server process [839429]
2022-01-07 18:21:59.046 | INFO     | uvicorn.server:serve:84 - Started server process [839532]
2022-01-07 18:21:59.047 | INFO     | uvicorn.server:serve:84 - Started server process [839532]
2022-01-07 18:21:59.048 | INFO     | uvicorn.server:serve:84 - Started server process [839532]
2022-01-07 18:21:59.048 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:59.048 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:59.050 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:21:59.051 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:59.052 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:21:59.052 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:22:03.347 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39368 - "GET /docs HTTP/1.1" 200
2022-01-07 18:22:03.588 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39368 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:22:08.741 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 18:22:08.811 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:22:08.916 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:22:09.051 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ffac200a550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ffac2860cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ffac283b910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ffac2860cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7ffac6d0b9d0>
          └ <fastapi.routing.APIRoute object at 0x7ffac1ff26a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ffac285ca60>
          └ <fastapi.routing.APIRoute object at 0x7ffac1ff26a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ffac2016f70>
                     └ <function get_request_handler.<locals>.app at 0x7ffac285c9d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ffac6cf95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7ffac421a1f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7ffac1ff26d0>
                 └ <function run_in_threadpool at 0x7ffac6ee5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7ffac1ffeec0>
                 │     │         └ <function run_sync at 0x7ffac6f029d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
                 │                                        └ <built-in method run of Context object at 0x7ffac1ffeec0>
                 └ <function get_asynclib at 0x7ffac6f02310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("type object 'Meta' has no attribute 'read_capacity_units'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
             │       │   └ <built-in method run of Context object at 0x7ffac1ffeec0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7ffac2008a00>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7ffac4231430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7ffac476ac70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 796, in create_table
    schema = cls._get_schema()
             │   └ <classmethod object at 0x7ffac476acd0>
             └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 880, in _get_schema
    index_schema = index._get_schema()
                   │     └ <classmethod object at 0x7ffac47e1eb0>
                   └ <app.models.models.ImageViewIndex object at 0x7ffac4773400>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/indexes.py", line 181, in _get_schema
    READ_CAPACITY_UNITS: cls.Meta.read_capacity_units,
    │                    │   └ <class 'app.models.models.ImageViewIndex.Meta'>
    │                    └ <class 'app.models.models.ImageViewIndex'>
    └ 'ReadCapacityUnits'

AttributeError: type object 'Meta' has no attribute 'read_capacity_units'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7ffac2016d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ffacb8b0430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ffacc6269d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ffacc626040>
    └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ffacb244340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
    │    └ <function subprocess_started at 0x7ffac910c160>
    └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ffacb244430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7ffac90fd550>
           │       │   └ <uvicorn.server.Server object at 0x7ffacb244430>
           │       └ <function run at 0x7ffaca2bc700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7ffac865a040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ffac8683280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ffac8683310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ffac8a39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ffac796cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ffac8a39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>
          └ <fastapi.applications.FastAPI object at 0x7ffac796cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7ffac2016d90>
                     │    └ <function exception_handler at 0x7ffac28311f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7ffac6d29e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7ffac2016d90>
    │      │         └ AttributeError("type object 'Meta' has no attribute 'read_capacity_units'")
    │      └ <function Logger.exception at 0x7ffacb1d7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7ffac2016d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:22:09.088 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ffac200a550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ffac2860cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ffac283b910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ffac2860cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7ffac6d0b9d0>
          └ <fastapi.routing.APIRoute object at 0x7ffac1ff26a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ffac285ca60>
          └ <fastapi.routing.APIRoute object at 0x7ffac1ff26a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ffac2016f70>
                     └ <function get_request_handler.<locals>.app at 0x7ffac285c9d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ffac6cf95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7ffac421a1f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7ffac1ff26d0>
                 └ <function run_in_threadpool at 0x7ffac6ee5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7ffac1ffeec0>
                 │     │         └ <function run_sync at 0x7ffac6f029d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
                 │                                        └ <built-in method run of Context object at 0x7ffac1ffeec0>
                 └ <function get_asynclib at 0x7ffac6f02310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("type object 'Meta' has no attribute 'read_capacity_units'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
             │       │   └ <built-in method run of Context object at 0x7ffac1ffeec0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7ffac2008a00>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7ffac4231430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7ffac476ac70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 796, in create_table
    schema = cls._get_schema()
             │   └ <classmethod object at 0x7ffac476acd0>
             └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 880, in _get_schema
    index_schema = index._get_schema()
                   │     └ <classmethod object at 0x7ffac47e1eb0>
                   └ <app.models.models.ImageViewIndex object at 0x7ffac4773400>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/indexes.py", line 181, in _get_schema
    READ_CAPACITY_UNITS: cls.Meta.read_capacity_units,
    │                    │   └ <class 'app.models.models.ImageViewIndex.Meta'>
    │                    └ <class 'app.models.models.ImageViewIndex'>
    └ 'ReadCapacityUnits'

AttributeError: type object 'Meta' has no attribute 'read_capacity_units'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7ffac2016d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ffacb8b0430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ffacc6269d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ffacc626040>
    └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ffacb244340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
    │    └ <function subprocess_started at 0x7ffac910c160>
    └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ffacb244430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7ffac90fd550>
           │       │   └ <uvicorn.server.Server object at 0x7ffacb244430>
           │       └ <function run at 0x7ffaca2bc700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7ffac865a040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ffac8683280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ffac8683310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ffac8a39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ffac796cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ffac8a39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>
          └ <fastapi.applications.FastAPI object at 0x7ffac796cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7ffac2016d90>
                     │    └ <function exception_handler at 0x7ffac28311f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7ffac6d29e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7ffac2016d90>
    │      │         └ AttributeError("type object 'Meta' has no attribute 'read_capacity_units'")
    │      └ <function Logger.exception at 0x7ffacb1d7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7ffac2016d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:22:09.108 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ffac200a550>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ffac2860cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ffac283b910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ffac2860cd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7ffac6d0b9d0>
          └ <fastapi.routing.APIRoute object at 0x7ffac1ff26a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ffac200a670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ffac285ca60>
          └ <fastapi.routing.APIRoute object at 0x7ffac1ff26a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ffac2016f70>
                     └ <function get_request_handler.<locals>.app at 0x7ffac285c9d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ffac6cf95e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {}
                 │                 │         └ <function checkmarks at 0x7ffac421a1f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7ffac1ff26d0>
                 └ <function run_in_threadpool at 0x7ffac6ee5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
                 │     │         │        └ <built-in method run of Context object at 0x7ffac1ffeec0>
                 │     │         └ <function run_sync at 0x7ffac6f029d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
                 │                                        └ <built-in method run of Context object at 0x7ffac1ffeec0>
                 └ <function get_asynclib at 0x7ffac6f02310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("type object 'Meta' has no attribute 'read_capacity_units'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function checkmarks at 0x7ffac421a1f0>),)
             │       │   └ <built-in method run of Context object at 0x7ffac1ffeec0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7ffac2008a00>

  File "./app/routes/login.py", line 151, in checkmarks
    sanity_check()
    └ <function sanity_check at 0x7ffac4231430>

  File "./app/internal/utilities.py", line 81, in sanity_check
    Images.create_table(read_capacity_units=10,write_capacity_units=10,wait=True)
    │      └ <classmethod object at 0x7ffac476ac70>
    └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 796, in create_table
    schema = cls._get_schema()
             │   └ <classmethod object at 0x7ffac476acd0>
             └ <class 'app.models.models.Images'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/models.py", line 880, in _get_schema
    index_schema = index._get_schema()
                   │     └ <classmethod object at 0x7ffac47e1eb0>
                   └ <app.models.models.ImageViewIndex object at 0x7ffac4773400>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/indexes.py", line 181, in _get_schema
    READ_CAPACITY_UNITS: cls.Meta.read_capacity_units,
    │                    │   └ <class 'app.models.models.ImageViewIndex.Meta'>
    │                    └ <class 'app.models.models.ImageViewIndex'>
    └ 'ReadCapacityUnits'

AttributeError: type object 'Meta' has no attribute 'read_capacity_units'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7ffac2016d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ffacb8b0430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ffacc6269d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ffacc626040>
    └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ffacb244340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
    │    └ <function subprocess_started at 0x7ffac910c160>
    └ <SpawnProcess name='SpawnProcess-1' parent=839495 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ffacb244430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7ffac90fd550>
           │       │   └ <uvicorn.server.Server object at 0x7ffacb244430>
           │       └ <function run at 0x7ffaca2bc700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7ffac865a040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ffac8683280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ffac8683310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac2016520>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ffac8a39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ffac796cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ffac8a39df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20165...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ffac20...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>
          └ <fastapi.applications.FastAPI object at 0x7ffac796cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7ffac2016d90>
                     │    └ <function exception_handler at 0x7ffac28311f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ffac2860d30>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7ffac6d29e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7ffac2016d90>
    │      │         └ AttributeError("type object 'Meta' has no attribute 'read_capacity_units'")
    │      └ <function Logger.exception at 0x7ffacb1d7790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7ffac2016d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:22:09.128 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39372 - "GET /sanity_check HTTP/1.1" 500
2022-01-07 18:22:29.173 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:22:29.173 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:22:29.174 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:22:29.275 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:22:29.275 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:22:29.276 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:22:29.277 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:22:29.278 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:22:29.278 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:22:29.280 | INFO     | uvicorn.server:serve:94 - Finished server process [839532]
2022-01-07 18:22:29.280 | INFO     | uvicorn.server:serve:94 - Finished server process [839532]
2022-01-07 18:22:29.281 | INFO     | uvicorn.server:serve:94 - Finished server process [839532]
2022-01-07 18:22:34.221 | INFO     | uvicorn.server:serve:84 - Started server process [839902]
2022-01-07 18:22:34.222 | INFO     | uvicorn.server:serve:84 - Started server process [839902]
2022-01-07 18:22:34.222 | INFO     | uvicorn.server:serve:84 - Started server process [839902]
2022-01-07 18:22:34.223 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:22:34.223 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:22:34.223 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:22:34.224 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:22:34.224 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:22:34.225 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:22:38.404 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39424 - "GET /docs HTTP/1.1" 200
2022-01-07 18:22:38.682 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39424 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:22:42.190 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 18:22:42.257 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:22:42.374 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:22:42.601 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39424 - "GET /sanity_check HTTP/1.1" 200
2022-01-07 18:22:53.219 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39428 - "POST /token HTTP/1.1" 200
2022-01-07 18:24:48.786 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:24:48.788 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:24:48.789 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:24:48.891 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:24:48.892 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:24:48.892 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:24:48.893 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:24:48.893 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:24:48.893 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:24:48.894 | INFO     | uvicorn.server:serve:94 - Finished server process [839902]
2022-01-07 18:24:48.894 | INFO     | uvicorn.server:serve:94 - Finished server process [839902]
2022-01-07 18:24:48.895 | INFO     | uvicorn.server:serve:94 - Finished server process [839902]
2022-01-07 18:24:50.269 | INFO     | uvicorn.server:serve:84 - Started server process [840660]
2022-01-07 18:24:50.271 | INFO     | uvicorn.server:serve:84 - Started server process [840660]
2022-01-07 18:24:50.271 | INFO     | uvicorn.server:serve:84 - Started server process [840660]
2022-01-07 18:24:50.273 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:24:50.274 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:24:50.275 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:24:50.276 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:24:50.277 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:24:50.278 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:24:52.022 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39542 - "GET /docs HTTP/1.1" 200
2022-01-07 18:24:52.287 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39542 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:25:05.897 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:25:06.308 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39546 - "POST /token HTTP/1.1" 200
2022-01-07 18:25:24.226 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/b32eac55-15d4-4b1f-ac8d-13de4acb0d3a.jpg
2022-01-07 18:25:24.259 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:25:24.480 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/60a7e67d-5c02-4f34-9ae1-10768ec52588.jpg
2022-01-07 18:25:24.517 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39584 - "POST /upload_images HTTP/1.1" 200
2022-01-07 18:25:56.016 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39664 - "GET /share_image?image_id=de6fabab-fa64-4e72-a1bc-ef5b89001350 HTTP/1.1" 200
2022-01-07 18:26:53.738 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39712 - "GET /delete_image?image_id=03356143-669d-441b-94e2-771b3a1b6e9a HTTP/1.1" 200
2022-01-07 18:27:10.100 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbecfdaa160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbee4f0ed60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbee4eea9a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbee4f0ed60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbee93b99d0>
          └ <fastapi.routing.APIRoute object at 0x7fbee46a0a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbee4f09b80>
          └ <fastapi.routing.APIRoute object at 0x7fbee46a0a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbecfda8490>
                     └ <function get_request_handler.<locals>.app at 0x7fbee4f09af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbee93a85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<admin>}
                 │                 │         └ <function show_deleted_images at 0x7fbee4edf280>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbee46a0ac0>
                 └ <function run_in_threadpool at 0x7fbee9593af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbecfd4bf40>
                 │     │         └ <function run_sync at 0x7fbee95b09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
                 │                                        └ <built-in method run of Context object at 0x7fbecfd4bf40>
                 └ <function get_asynclib at 0x7fbee95b0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type ResultIterator is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
             │       │   └ <built-in method run of Context object at 0x7fbecfd4bf40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbecfd9ae80>

  File "./app/routes/images.py", line 36, in show_deleted_images
    return JSONResponse(content={"images":images},status_code=status.HTTP_200_OK)
           │                              │                   │      └ 200
           │                              │                   └ <module 'starlette.status' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/status...
           │                              └ <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>
           └ <class 'starlette.responses.JSONResponse'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 49, in __init__
    self.body = self.render(content)
    │           │    │      └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
    │           │    └ <function JSONResponse.render at 0x7fbee93f8430>
    │           └ <starlette.responses.JSONResponse object at 0x7fbee46c3a60>
    └ <starlette.responses.JSONResponse object at 0x7fbee46c3a60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 157, in render
    return json.dumps(
           │    └ <function dumps at 0x7fbeec942d30>
           └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 234, in dumps
    return cls(
           └ <class 'json.encoder.JSONEncoder'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
             │    └ <function JSONEncoder.iterencode at 0x7fbeec942ca0>
             └ <json.encoder.JSONEncoder object at 0x7fbecfd42c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
           └ <_json.Encoder object at 0x7fbecfda61c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ResultIterator is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbecfda8160>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbeedf5e430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbeeecd49d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbeeecd4040>
    └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbeed8f2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
    │    └ <function subprocess_started at 0x7fbeeb7b9160>
    └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbeed8f2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbeeb7aa550>
           │       │   └ <uvicorn.server.Server object at 0x7fbeed8f2430>
           │       └ <function run at 0x7fbeec96a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbeead08040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbeead31280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbeead31310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbeeb0e7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbeea01af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbeeb0e7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>
          └ <fastapi.applications.FastAPI object at 0x7fbeea01af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbee4625100>
                     │    └ <function exception_handler at 0x7fbee4edf1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbee93d7f40>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbee4625100>
    │      │         └ TypeError('Object of type ResultIterator is not JSON serializable')
    │      └ <function Logger.exception at 0x7fbeed885790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbecfda8160>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:27:10.132 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbecfdaa160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbee4f0ed60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbee4eea9a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbee4f0ed60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbee93b99d0>
          └ <fastapi.routing.APIRoute object at 0x7fbee46a0a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbee4f09b80>
          └ <fastapi.routing.APIRoute object at 0x7fbee46a0a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbecfda8490>
                     └ <function get_request_handler.<locals>.app at 0x7fbee4f09af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbee93a85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<admin>}
                 │                 │         └ <function show_deleted_images at 0x7fbee4edf280>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbee46a0ac0>
                 └ <function run_in_threadpool at 0x7fbee9593af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbecfd4bf40>
                 │     │         └ <function run_sync at 0x7fbee95b09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
                 │                                        └ <built-in method run of Context object at 0x7fbecfd4bf40>
                 └ <function get_asynclib at 0x7fbee95b0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type ResultIterator is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
             │       │   └ <built-in method run of Context object at 0x7fbecfd4bf40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbecfd9ae80>

  File "./app/routes/images.py", line 36, in show_deleted_images
    return JSONResponse(content={"images":images},status_code=status.HTTP_200_OK)
           │                              │                   │      └ 200
           │                              │                   └ <module 'starlette.status' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/status...
           │                              └ <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>
           └ <class 'starlette.responses.JSONResponse'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 49, in __init__
    self.body = self.render(content)
    │           │    │      └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
    │           │    └ <function JSONResponse.render at 0x7fbee93f8430>
    │           └ <starlette.responses.JSONResponse object at 0x7fbee46c3a60>
    └ <starlette.responses.JSONResponse object at 0x7fbee46c3a60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 157, in render
    return json.dumps(
           │    └ <function dumps at 0x7fbeec942d30>
           └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 234, in dumps
    return cls(
           └ <class 'json.encoder.JSONEncoder'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
             │    └ <function JSONEncoder.iterencode at 0x7fbeec942ca0>
             └ <json.encoder.JSONEncoder object at 0x7fbecfd42c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
           └ <_json.Encoder object at 0x7fbecfda61c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ResultIterator is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbecfda8160>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbeedf5e430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbeeecd49d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbeeecd4040>
    └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbeed8f2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
    │    └ <function subprocess_started at 0x7fbeeb7b9160>
    └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbeed8f2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbeeb7aa550>
           │       │   └ <uvicorn.server.Server object at 0x7fbeed8f2430>
           │       └ <function run at 0x7fbeec96a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbeead08040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbeead31280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbeead31310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbeeb0e7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbeea01af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbeeb0e7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>
          └ <fastapi.applications.FastAPI object at 0x7fbeea01af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbee4625100>
                     │    └ <function exception_handler at 0x7fbee4edf1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbee93d7f40>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbee4625100>
    │      │         └ TypeError('Object of type ResultIterator is not JSON serializable')
    │      └ <function Logger.exception at 0x7fbeed885790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbecfda8160>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:27:10.156 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbecfdaa160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbee4f0ed60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbee4eea9a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbee4f0ed60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbee93b99d0>
          └ <fastapi.routing.APIRoute object at 0x7fbee46a0a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbecfdaa1f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbee4f09b80>
          └ <fastapi.routing.APIRoute object at 0x7fbee46a0a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbecfda8490>
                     └ <function get_request_handler.<locals>.app at 0x7fbee4f09af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbee93a85e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<admin>}
                 │                 │         └ <function show_deleted_images at 0x7fbee4edf280>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbee46a0ac0>
                 └ <function run_in_threadpool at 0x7fbee9593af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbecfd4bf40>
                 │     │         └ <function run_sync at 0x7fbee95b09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
                 │                                        └ <built-in method run of Context object at 0x7fbecfd4bf40>
                 └ <function get_asynclib at 0x7fbee95b0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type ResultIterator is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fbee4edf280>, token=Users<admin>),)
             │       │   └ <built-in method run of Context object at 0x7fbecfd4bf40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbecfd9ae80>

  File "./app/routes/images.py", line 36, in show_deleted_images
    return JSONResponse(content={"images":images},status_code=status.HTTP_200_OK)
           │                              │                   │      └ 200
           │                              │                   └ <module 'starlette.status' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/status...
           │                              └ <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>
           └ <class 'starlette.responses.JSONResponse'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 49, in __init__
    self.body = self.render(content)
    │           │    │      └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
    │           │    └ <function JSONResponse.render at 0x7fbee93f8430>
    │           └ <starlette.responses.JSONResponse object at 0x7fbee46c3a60>
    └ <starlette.responses.JSONResponse object at 0x7fbee46c3a60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 157, in render
    return json.dumps(
           │    └ <function dumps at 0x7fbeec942d30>
           └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 234, in dumps
    return cls(
           └ <class 'json.encoder.JSONEncoder'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
             │    └ <function JSONEncoder.iterencode at 0x7fbeec942ca0>
             └ <json.encoder.JSONEncoder object at 0x7fbecfd42c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'images': <pynamodb.pagination.ResultIterator object at 0x7fbecfd95880>}
           └ <_json.Encoder object at 0x7fbecfda61c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ResultIterator is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbecfda8160>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbeedf5e430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbeeecd49d0>
           └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbeeecd4040>
    └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbeed8f2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
    │    └ <function subprocess_started at 0x7fbeeb7b9160>
    └ <SpawnProcess name='SpawnProcess-3' parent=839865 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbeed8f2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbeeb7aa550>
           │       │   └ <uvicorn.server.Server object at 0x7fbeed8f2430>
           │       └ <function run at 0x7fbeec96a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbeead08040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbeead31280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbeead31310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd42940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbeeb0e7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbeea01af40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbeeb0e7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd429...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbecfd...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>
          └ <fastapi.applications.FastAPI object at 0x7fbeea01af40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbee4625100>
                     │    └ <function exception_handler at 0x7fbee4edf1f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbee4f0edc0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbee93d7f40>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbee4625100>
    │      │         └ TypeError('Object of type ResultIterator is not JSON serializable')
    │      └ <function Logger.exception at 0x7fbeed885790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbecfda8160>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:27:10.204 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39740 - "GET /show_deleted_images HTTP/1.1" 500
2022-01-07 18:31:25.100 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:31:25.101 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:31:25.101 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:31:25.202 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:31:25.203 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:31:25.204 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:31:25.205 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:31:25.206 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:31:25.207 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:31:25.207 | INFO     | uvicorn.server:serve:94 - Finished server process [840660]
2022-01-07 18:31:25.208 | INFO     | uvicorn.server:serve:94 - Finished server process [840660]
2022-01-07 18:31:25.209 | INFO     | uvicorn.server:serve:94 - Finished server process [840660]
2022-01-07 18:31:26.540 | INFO     | uvicorn.server:serve:84 - Started server process [842555]
2022-01-07 18:31:26.541 | INFO     | uvicorn.server:serve:84 - Started server process [842555]
2022-01-07 18:31:26.542 | INFO     | uvicorn.server:serve:84 - Started server process [842555]
2022-01-07 18:31:26.542 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:31:26.543 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:31:26.543 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:31:26.545 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:31:26.546 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:31:26.547 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:31:26.648 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:31:26.648 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:31:26.649 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:31:26.750 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:31:26.750 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:31:26.751 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:31:26.752 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:31:26.753 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:31:26.754 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:31:26.754 | INFO     | uvicorn.server:serve:94 - Finished server process [842555]
2022-01-07 18:31:26.754 | INFO     | uvicorn.server:serve:94 - Finished server process [842555]
2022-01-07 18:31:26.755 | INFO     | uvicorn.server:serve:94 - Finished server process [842555]
2022-01-07 18:31:29.006 | INFO     | uvicorn.server:serve:84 - Started server process [842639]
2022-01-07 18:31:29.007 | INFO     | uvicorn.server:serve:84 - Started server process [842639]
2022-01-07 18:31:29.008 | INFO     | uvicorn.server:serve:84 - Started server process [842639]
2022-01-07 18:31:29.008 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:31:29.009 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:31:29.009 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:31:29.011 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:31:29.012 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:31:29.012 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:31:31.933 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39812 - "GET /docs HTTP/1.1" 200
2022-01-07 18:31:32.181 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39812 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:31:37.112 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:31:37.555 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39812 - "POST /token HTTP/1.1" 200
2022-01-07 18:31:43.520 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:31:43.635 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fa10b191670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa10b9e8d30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fa10b9c3970>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa10b9e8d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fa10fe939d0>
          └ <fastapi.routing.APIRoute object at 0x7fa10b17aa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa10b9e4b80>
          └ <fastapi.routing.APIRoute object at 0x7fa10b17aa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fa109c1a700>
                     └ <function get_request_handler.<locals>.app at 0x7fa10b9e4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa10fe825e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<admin>}
                 │                 │         └ <function show_deleted_images at 0x7fa10b9b9280>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fa10b17aa90>
                 └ <function run_in_threadpool at 0x7fa11006daf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fa10b18a400>
                 │     │         └ <function run_sync at 0x7fa11008a9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
                 │                                        └ <built-in method run of Context object at 0x7fa10b18a400>
                 └ <function get_asynclib at 0x7fa11008a310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Images is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
             │       │   └ <built-in method run of Context object at 0x7fa10b18a400>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fa10b193e00>

  File "./app/routes/images.py", line 36, in show_deleted_images
    return JSONResponse(content={"images":images},status_code=status.HTTP_200_OK)
           │                              │                   │      └ 200
           │                              │                   └ <module 'starlette.status' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/status...
           │                              └ [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]
           └ <class 'starlette.responses.JSONResponse'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 49, in __init__
    self.body = self.render(content)
    │           │    │      └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
    │           │    └ <function JSONResponse.render at 0x7fa10fed2430>
    │           └ <starlette.responses.JSONResponse object at 0x7fa109c1ae20>
    └ <starlette.responses.JSONResponse object at 0x7fa109c1ae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 157, in render
    return json.dumps(
           │    └ <function dumps at 0x7fa11341cd30>
           └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 234, in dumps
    return cls(
           └ <class 'json.encoder.JSONEncoder'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
             │    └ <function JSONEncoder.iterencode at 0x7fa11341cca0>
             └ <json.encoder.JSONEncoder object at 0x7fa1096729a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
           └ <_json.Encoder object at 0x7fa10a950700>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Images is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fa109c1aa30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fa114a37430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa1157ae9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa1157ae040>
    └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa1143cc340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
    │    └ <function subprocess_started at 0x7fa112293160>
    └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa1143cc430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fa112285550>
           │       │   └ <uvicorn.server.Server object at 0x7fa1143cc430>
           │       └ <function run at 0x7fa113444700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fa1117e2040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fa11180b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fa11180b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa111bc1df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fa110af4f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa111bc1df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>
          └ <fastapi.applications.FastAPI object at 0x7fa110af4f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fa109c1aa60>
                     │    └ <function exception_handler at 0x7fa10b9b91f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fa10feb1e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7fa109c1aa60>
    │      │         └ TypeError('Object of type Images is not JSON serializable')
    │      └ <function Logger.exception at 0x7fa11435f790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fa109c1aa30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:31:43.663 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fa10b191670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa10b9e8d30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fa10b9c3970>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa10b9e8d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fa10fe939d0>
          └ <fastapi.routing.APIRoute object at 0x7fa10b17aa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa10b9e4b80>
          └ <fastapi.routing.APIRoute object at 0x7fa10b17aa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fa109c1a700>
                     └ <function get_request_handler.<locals>.app at 0x7fa10b9e4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa10fe825e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<admin>}
                 │                 │         └ <function show_deleted_images at 0x7fa10b9b9280>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fa10b17aa90>
                 └ <function run_in_threadpool at 0x7fa11006daf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fa10b18a400>
                 │     │         └ <function run_sync at 0x7fa11008a9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
                 │                                        └ <built-in method run of Context object at 0x7fa10b18a400>
                 └ <function get_asynclib at 0x7fa11008a310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Images is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
             │       │   └ <built-in method run of Context object at 0x7fa10b18a400>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fa10b193e00>

  File "./app/routes/images.py", line 36, in show_deleted_images
    return JSONResponse(content={"images":images},status_code=status.HTTP_200_OK)
           │                              │                   │      └ 200
           │                              │                   └ <module 'starlette.status' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/status...
           │                              └ [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]
           └ <class 'starlette.responses.JSONResponse'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 49, in __init__
    self.body = self.render(content)
    │           │    │      └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
    │           │    └ <function JSONResponse.render at 0x7fa10fed2430>
    │           └ <starlette.responses.JSONResponse object at 0x7fa109c1ae20>
    └ <starlette.responses.JSONResponse object at 0x7fa109c1ae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 157, in render
    return json.dumps(
           │    └ <function dumps at 0x7fa11341cd30>
           └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 234, in dumps
    return cls(
           └ <class 'json.encoder.JSONEncoder'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
             │    └ <function JSONEncoder.iterencode at 0x7fa11341cca0>
             └ <json.encoder.JSONEncoder object at 0x7fa1096729a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
           └ <_json.Encoder object at 0x7fa10a950700>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Images is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fa109c1aa30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fa114a37430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa1157ae9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa1157ae040>
    └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa1143cc340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
    │    └ <function subprocess_started at 0x7fa112293160>
    └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa1143cc430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fa112285550>
           │       │   └ <uvicorn.server.Server object at 0x7fa1143cc430>
           │       └ <function run at 0x7fa113444700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fa1117e2040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fa11180b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fa11180b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa111bc1df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fa110af4f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa111bc1df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>
          └ <fastapi.applications.FastAPI object at 0x7fa110af4f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fa109c1aa60>
                     │    └ <function exception_handler at 0x7fa10b9b91f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fa10feb1e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7fa109c1aa60>
    │      │         └ TypeError('Object of type Images is not JSON serializable')
    │      └ <function Logger.exception at 0x7fa11435f790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fa109c1aa30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:31:43.684 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fa10b191670>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa10b9e8d30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fa10b9c3970>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fa10b9e8d30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fa10fe939d0>
          └ <fastapi.routing.APIRoute object at 0x7fa10b17aa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fa109bb5700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fa10b9e4b80>
          └ <fastapi.routing.APIRoute object at 0x7fa10b17aa60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fa109c1a700>
                     └ <function get_request_handler.<locals>.app at 0x7fa10b9e4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fa10fe825e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<admin>}
                 │                 │         └ <function show_deleted_images at 0x7fa10b9b9280>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fa10b17aa90>
                 └ <function run_in_threadpool at 0x7fa11006daf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fa10b18a400>
                 │     │         └ <function run_sync at 0x7fa11008a9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
                 │                                        └ <built-in method run of Context object at 0x7fa10b18a400>
                 └ <function get_asynclib at 0x7fa11008a310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Images is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fa10b9b9280>, token=Users<admin>),)
             │       │   └ <built-in method run of Context object at 0x7fa10b18a400>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fa10b193e00>

  File "./app/routes/images.py", line 36, in show_deleted_images
    return JSONResponse(content={"images":images},status_code=status.HTTP_200_OK)
           │                              │                   │      └ 200
           │                              │                   └ <module 'starlette.status' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/status...
           │                              └ [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]
           └ <class 'starlette.responses.JSONResponse'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 49, in __init__
    self.body = self.render(content)
    │           │    │      └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
    │           │    └ <function JSONResponse.render at 0x7fa10fed2430>
    │           └ <starlette.responses.JSONResponse object at 0x7fa109c1ae20>
    └ <starlette.responses.JSONResponse object at 0x7fa109c1ae20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/responses.py", line 157, in render
    return json.dumps(
           │    └ <function dumps at 0x7fa11341cd30>
           └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 234, in dumps
    return cls(
           └ <class 'json.encoder.JSONEncoder'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
             │    └ <function JSONEncoder.iterencode at 0x7fa11341cca0>
             └ <json.encoder.JSONEncoder object at 0x7fa1096729a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'images': [Images<de6fabab-fa64-4e72-a1bc-ef5b89001350, 0>, Images<03356143-669d-441b-94e2-771b3a1b6e9a, 0>]}
           └ <_json.Encoder object at 0x7fa10a950700>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Images is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fa109c1aa30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fa114a37430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fa1157ae9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fa1157ae040>
    └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fa1143cc340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
    │    └ <function subprocess_started at 0x7fa112293160>
    └ <SpawnProcess name='SpawnProcess-1' parent=842601 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fa1143cc430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fa112285550>
           │       │   └ <uvicorn.server.Server object at 0x7fa1143cc430>
           │       └ <function run at 0x7fa113444700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fa1117e2040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fa11180b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fa11180b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa111bc1df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fa110af4f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fa111bc1df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c1ab...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fa109c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>
          └ <fastapi.applications.FastAPI object at 0x7fa110af4f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fa109c1aa60>
                     │    └ <function exception_handler at 0x7fa10b9b91f0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fa10b9e8d90>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fa10feb1e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7fa109c1aa60>
    │      │         └ TypeError('Object of type Images is not JSON serializable')
    │      └ <function Logger.exception at 0x7fa11435f790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fa109c1aa30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 18:31:43.707 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39816 - "GET /show_deleted_images HTTP/1.1" 500
2022-01-07 18:32:38.225 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:32:38.226 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:32:38.226 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:32:38.327 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:32:38.328 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:32:38.329 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:32:38.330 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:32:38.331 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:32:38.333 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:32:38.334 | INFO     | uvicorn.server:serve:94 - Finished server process [842639]
2022-01-07 18:32:38.335 | INFO     | uvicorn.server:serve:94 - Finished server process [842639]
2022-01-07 18:32:38.336 | INFO     | uvicorn.server:serve:94 - Finished server process [842639]
2022-01-07 18:32:41.394 | INFO     | uvicorn.server:serve:84 - Started server process [843171]
2022-01-07 18:32:41.394 | INFO     | uvicorn.server:serve:84 - Started server process [843171]
2022-01-07 18:32:41.394 | INFO     | uvicorn.server:serve:84 - Started server process [843171]
2022-01-07 18:32:41.395 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:32:41.395 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:32:41.395 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:32:41.396 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:32:41.396 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:32:41.396 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:32:45.876 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39898 - "GET /docs HTTP/1.1" 200
2022-01-07 18:32:46.199 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39898 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 18:32:52.471 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:32:52.870 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39902 - "POST /token HTTP/1.1" 200
2022-01-07 18:32:58.347 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 18:32:58.462 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:39928 - "GET /show_deleted_images HTTP/1.1" 200
2022-01-07 18:33:32.564 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:33:32.565 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:33:32.565 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:33:32.666 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:33:32.666 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:33:32.668 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:33:32.670 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:33:32.671 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:33:32.671 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:33:32.672 | INFO     | uvicorn.server:serve:94 - Finished server process [843171]
2022-01-07 18:33:32.675 | INFO     | uvicorn.server:serve:94 - Finished server process [843171]
2022-01-07 18:33:32.677 | INFO     | uvicorn.server:serve:94 - Finished server process [843171]
2022-01-07 18:33:34.070 | INFO     | uvicorn.server:serve:84 - Started server process [843559]
2022-01-07 18:33:34.071 | INFO     | uvicorn.server:serve:84 - Started server process [843559]
2022-01-07 18:33:34.071 | INFO     | uvicorn.server:serve:84 - Started server process [843559]
2022-01-07 18:33:34.071 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:33:34.072 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:33:34.072 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:33:34.073 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:33:34.073 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:33:34.074 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:33:54.720 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:33:54.721 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:33:54.721 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:33:54.822 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:33:54.822 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:33:54.822 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:33:54.823 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:33:54.823 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:33:54.823 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:33:54.824 | INFO     | uvicorn.server:serve:94 - Finished server process [843559]
2022-01-07 18:33:54.824 | INFO     | uvicorn.server:serve:94 - Finished server process [843559]
2022-01-07 18:33:54.824 | INFO     | uvicorn.server:serve:94 - Finished server process [843559]
2022-01-07 18:33:56.952 | INFO     | uvicorn.server:serve:84 - Started server process [843739]
2022-01-07 18:33:56.953 | INFO     | uvicorn.server:serve:84 - Started server process [843739]
2022-01-07 18:33:56.953 | INFO     | uvicorn.server:serve:84 - Started server process [843739]
2022-01-07 18:33:56.953 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:33:56.954 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:33:56.954 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:33:56.955 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:33:56.955 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:33:56.955 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:34:09.383 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:34:09.384 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:34:09.385 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:34:09.485 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:34:09.485 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:34:09.486 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:34:09.487 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:34:09.487 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:34:09.488 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:34:09.488 | INFO     | uvicorn.server:serve:94 - Finished server process [843739]
2022-01-07 18:34:09.489 | INFO     | uvicorn.server:serve:94 - Finished server process [843739]
2022-01-07 18:34:09.489 | INFO     | uvicorn.server:serve:94 - Finished server process [843739]
2022-01-07 18:34:10.740 | INFO     | uvicorn.server:serve:84 - Started server process [843854]
2022-01-07 18:34:10.741 | INFO     | uvicorn.server:serve:84 - Started server process [843854]
2022-01-07 18:34:10.742 | INFO     | uvicorn.server:serve:84 - Started server process [843854]
2022-01-07 18:34:10.742 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:34:10.743 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:34:10.744 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:34:10.745 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:34:10.746 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:34:10.747 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:34:52.745 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:34:52.747 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:34:52.748 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:34:52.848 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:34:52.849 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:34:52.849 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:34:52.850 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:34:52.851 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:34:52.852 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:34:52.852 | INFO     | uvicorn.server:serve:94 - Finished server process [843854]
2022-01-07 18:34:52.852 | INFO     | uvicorn.server:serve:94 - Finished server process [843854]
2022-01-07 18:34:52.853 | INFO     | uvicorn.server:serve:94 - Finished server process [843854]
2022-01-07 18:34:53.876 | INFO     | uvicorn.server:serve:84 - Started server process [844109]
2022-01-07 18:34:53.877 | INFO     | uvicorn.server:serve:84 - Started server process [844109]
2022-01-07 18:34:53.877 | INFO     | uvicorn.server:serve:84 - Started server process [844109]
2022-01-07 18:34:53.878 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:34:53.878 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:34:53.879 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:34:53.881 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:34:53.881 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:34:53.882 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:01.601 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:01.602 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:01.602 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:01.703 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:01.704 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:01.704 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:01.705 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:01.706 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:01.706 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:01.707 | INFO     | uvicorn.server:serve:94 - Finished server process [844109]
2022-01-07 18:35:01.707 | INFO     | uvicorn.server:serve:94 - Finished server process [844109]
2022-01-07 18:35:01.708 | INFO     | uvicorn.server:serve:94 - Finished server process [844109]
2022-01-07 18:35:02.900 | INFO     | uvicorn.server:serve:84 - Started server process [844206]
2022-01-07 18:35:02.900 | INFO     | uvicorn.server:serve:84 - Started server process [844206]
2022-01-07 18:35:02.901 | INFO     | uvicorn.server:serve:84 - Started server process [844206]
2022-01-07 18:35:02.901 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:02.901 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:02.902 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:02.903 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:02.904 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:02.904 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:20.944 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:20.944 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:20.945 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:21.047 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:21.047 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:21.048 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:21.049 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:21.049 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:21.050 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:21.050 | INFO     | uvicorn.server:serve:94 - Finished server process [844206]
2022-01-07 18:35:21.051 | INFO     | uvicorn.server:serve:94 - Finished server process [844206]
2022-01-07 18:35:21.051 | INFO     | uvicorn.server:serve:94 - Finished server process [844206]
2022-01-07 18:35:22.268 | INFO     | uvicorn.server:serve:84 - Started server process [844340]
2022-01-07 18:35:22.269 | INFO     | uvicorn.server:serve:84 - Started server process [844340]
2022-01-07 18:35:22.269 | INFO     | uvicorn.server:serve:84 - Started server process [844340]
2022-01-07 18:35:22.269 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:22.269 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:22.270 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:22.270 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:22.270 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:22.271 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:23.474 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:23.475 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:23.476 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:35:23.577 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:23.577 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:23.577 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:35:23.578 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:23.579 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:23.579 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:35:23.580 | INFO     | uvicorn.server:serve:94 - Finished server process [844340]
2022-01-07 18:35:23.581 | INFO     | uvicorn.server:serve:94 - Finished server process [844340]
2022-01-07 18:35:23.583 | INFO     | uvicorn.server:serve:94 - Finished server process [844340]
2022-01-07 18:35:24.762 | INFO     | uvicorn.server:serve:84 - Started server process [844391]
2022-01-07 18:35:24.762 | INFO     | uvicorn.server:serve:84 - Started server process [844391]
2022-01-07 18:35:24.763 | INFO     | uvicorn.server:serve:84 - Started server process [844391]
2022-01-07 18:35:24.763 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:24.763 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:24.764 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:35:24.765 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:24.767 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:35:24.769 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:36:15.889 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:36:15.890 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:36:15.890 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:36:15.991 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:36:15.992 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:36:15.993 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:36:15.994 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:36:15.995 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:36:15.996 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:36:15.997 | INFO     | uvicorn.server:serve:94 - Finished server process [844391]
2022-01-07 18:36:15.997 | INFO     | uvicorn.server:serve:94 - Finished server process [844391]
2022-01-07 18:36:15.998 | INFO     | uvicorn.server:serve:94 - Finished server process [844391]
2022-01-07 18:36:17.114 | INFO     | uvicorn.server:serve:84 - Started server process [844605]
2022-01-07 18:36:17.115 | INFO     | uvicorn.server:serve:84 - Started server process [844605]
2022-01-07 18:36:17.116 | INFO     | uvicorn.server:serve:84 - Started server process [844605]
2022-01-07 18:36:17.119 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:36:17.120 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:36:17.121 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:36:17.122 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:36:17.123 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:36:17.124 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:36:33.765 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:36:33.766 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:36:33.766 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:36:33.867 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:36:33.868 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:36:33.868 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:36:33.869 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:36:33.870 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:36:33.871 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:36:33.873 | INFO     | uvicorn.server:serve:94 - Finished server process [844605]
2022-01-07 18:36:33.873 | INFO     | uvicorn.server:serve:94 - Finished server process [844605]
2022-01-07 18:36:33.874 | INFO     | uvicorn.server:serve:94 - Finished server process [844605]
2022-01-07 18:36:35.104 | INFO     | uvicorn.server:serve:84 - Started server process [844755]
2022-01-07 18:36:35.104 | INFO     | uvicorn.server:serve:84 - Started server process [844755]
2022-01-07 18:36:35.105 | INFO     | uvicorn.server:serve:84 - Started server process [844755]
2022-01-07 18:36:35.105 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:36:35.105 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:36:35.106 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:36:35.108 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:36:35.109 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:36:35.110 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:37:49.483 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:37:49.483 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:37:49.484 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:37:49.584 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:37:49.585 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:37:49.585 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:37:49.586 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:37:49.586 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:37:49.586 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:37:49.587 | INFO     | uvicorn.server:serve:94 - Finished server process [844755]
2022-01-07 18:37:49.587 | INFO     | uvicorn.server:serve:94 - Finished server process [844755]
2022-01-07 18:37:49.587 | INFO     | uvicorn.server:serve:94 - Finished server process [844755]
2022-01-07 18:37:50.777 | INFO     | uvicorn.server:serve:84 - Started server process [845091]
2022-01-07 18:37:50.777 | INFO     | uvicorn.server:serve:84 - Started server process [845091]
2022-01-07 18:37:50.778 | INFO     | uvicorn.server:serve:84 - Started server process [845091]
2022-01-07 18:37:50.778 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:37:50.778 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:37:50.779 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:37:50.779 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:37:50.780 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:37:50.780 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:39:32.218 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:39:32.221 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:39:32.221 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:39:32.322 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:39:32.323 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:39:32.324 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:39:32.324 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:39:32.325 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:39:32.326 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:39:32.327 | INFO     | uvicorn.server:serve:94 - Finished server process [845091]
2022-01-07 18:39:32.328 | INFO     | uvicorn.server:serve:94 - Finished server process [845091]
2022-01-07 18:39:32.328 | INFO     | uvicorn.server:serve:94 - Finished server process [845091]
2022-01-07 18:39:33.598 | INFO     | uvicorn.server:serve:84 - Started server process [845502]
2022-01-07 18:39:33.598 | INFO     | uvicorn.server:serve:84 - Started server process [845502]
2022-01-07 18:39:33.599 | INFO     | uvicorn.server:serve:84 - Started server process [845502]
2022-01-07 18:39:33.599 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:39:33.599 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:39:33.600 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:39:33.600 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:39:33.601 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:39:33.601 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:40:30.931 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:40:30.931 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:40:30.932 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:40:31.033 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:40:31.034 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:40:31.035 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:40:31.036 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:40:31.037 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:40:31.039 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:40:31.040 | INFO     | uvicorn.server:serve:94 - Finished server process [845502]
2022-01-07 18:40:31.040 | INFO     | uvicorn.server:serve:94 - Finished server process [845502]
2022-01-07 18:40:31.041 | INFO     | uvicorn.server:serve:94 - Finished server process [845502]
2022-01-07 18:40:32.128 | INFO     | uvicorn.server:serve:84 - Started server process [845798]
2022-01-07 18:40:32.128 | INFO     | uvicorn.server:serve:84 - Started server process [845798]
2022-01-07 18:40:32.129 | INFO     | uvicorn.server:serve:84 - Started server process [845798]
2022-01-07 18:40:32.129 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:40:32.129 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:40:32.130 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 18:40:32.130 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:40:32.130 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:40:32.131 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 18:42:24.298 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:42:24.299 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:42:24.299 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 18:42:24.400 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:42:24.400 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:42:24.401 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 18:42:24.401 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:42:24.402 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:42:24.402 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 18:42:24.403 | INFO     | uvicorn.server:serve:94 - Finished server process [845798]
2022-01-07 18:42:24.404 | INFO     | uvicorn.server:serve:94 - Finished server process [845798]
2022-01-07 18:42:24.404 | INFO     | uvicorn.server:serve:94 - Finished server process [845798]
2022-01-07 19:19:15.100 | INFO     | uvicorn.server:serve:84 - Started server process [856972]
2022-01-07 19:19:15.101 | INFO     | uvicorn.server:serve:84 - Started server process [856972]
2022-01-07 19:19:15.101 | INFO     | uvicorn.server:serve:84 - Started server process [856972]
2022-01-07 19:19:15.101 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:19:15.102 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:19:15.102 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:19:15.103 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:19:15.103 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:19:15.103 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:19:16.695 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41308 - "GET /docs HTTP/1.1" 200
2022-01-07 19:19:17.130 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41308 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:19:53.409 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:19:53.410 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:19:53.410 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:19:53.511 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:19:53.512 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:19:53.512 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:19:53.513 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:19:53.513 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:19:53.514 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:19:53.515 | INFO     | uvicorn.server:serve:94 - Finished server process [856972]
2022-01-07 19:19:53.515 | INFO     | uvicorn.server:serve:94 - Finished server process [856972]
2022-01-07 19:19:53.515 | INFO     | uvicorn.server:serve:94 - Finished server process [856972]
2022-01-07 19:19:54.899 | INFO     | uvicorn.server:serve:84 - Started server process [857304]
2022-01-07 19:19:54.901 | INFO     | uvicorn.server:serve:84 - Started server process [857304]
2022-01-07 19:19:54.904 | INFO     | uvicorn.server:serve:84 - Started server process [857304]
2022-01-07 19:19:54.906 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:19:54.908 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:19:54.909 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:19:54.911 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:19:54.913 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:19:54.917 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:19:55.377 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41344 - "GET /docs HTTP/1.1" 200
2022-01-07 19:19:55.640 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41344 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:20:05.042 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-07 19:20:05.113 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:20:08.577 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:20:08.825 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41348 - "GET /sanity_check HTTP/1.1" 200
2022-01-07 19:20:17.929 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41482 - "POST /token HTTP/1.1" 200
2022-01-07 19:20:41.022 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41502 - "POST /signup HTTP/1.1" 201
2022-01-07 19:20:50.775 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41528 - "POST /signup HTTP/1.1" 201
2022-01-07 19:20:57.991 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41552 - "POST /signup HTTP/1.1" 201
2022-01-07 19:21:07.571 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41576 - "POST /signup HTTP/1.1" 201
2022-01-07 19:21:29.990 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41596 - "POST /token HTTP/1.1" 200
2022-01-07 19:21:46.873 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/84b7e5ba-6b65-4ffe-a4f1-42da2e8e02dc.jpg
2022-01-07 19:21:47.008 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/88f5d205-2bc4-47ed-b399-60eff22b6bc4.jpg
2022-01-07 19:21:47.051 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41608 - "POST /upload_images HTTP/1.1" 200
2022-01-07 19:22:30.090 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:22:30.091 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:22:30.091 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:22:30.192 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:22:30.193 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:22:30.193 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:22:30.194 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:22:30.194 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:22:30.194 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:22:30.195 | INFO     | uvicorn.server:serve:94 - Finished server process [857304]
2022-01-07 19:22:30.195 | INFO     | uvicorn.server:serve:94 - Finished server process [857304]
2022-01-07 19:22:30.196 | INFO     | uvicorn.server:serve:94 - Finished server process [857304]
2022-01-07 19:27:36.900 | INFO     | uvicorn.server:serve:84 - Started server process [860182]
2022-01-07 19:27:36.901 | INFO     | uvicorn.server:serve:84 - Started server process [860182]
2022-01-07 19:27:36.901 | INFO     | uvicorn.server:serve:84 - Started server process [860182]
2022-01-07 19:27:36.901 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:27:36.902 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:27:36.902 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:27:36.904 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:27:36.905 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:27:36.905 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:27:39.858 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41830 - "GET /docs HTTP/1.1" 200
2022-01-07 19:27:40.123 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41830 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:27:40.831 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41830 - "GET /docs HTTP/1.1" 200
2022-01-07 19:27:40.967 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41830 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:27:50.662 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:27:51.075 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41834 - "POST /token HTTP/1.1" 200
2022-01-07 19:27:56.771 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f6595d998b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f6597bd9c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f6597bb4850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f6597bd9c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f659c0849d0>
          └ <fastapi.routing.APIRoute object at 0x7f659736a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f6597bd4c10>
          └ <fastapi.routing.APIRoute object at 0x7f659736a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f6595db59d0>
                     └ <function get_request_handler.<locals>.app at 0x7f6597bd4b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f659c0735e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f6597ba8160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f659736a970>
                 └ <function run_in_threadpool at 0x7f659c25faf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f6597389680>
                 │     │         └ <function run_sync at 0x7f659c27c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f6597389680>
                 └ <function get_asynclib at 0x7f659c27c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("query() got an unexpected keyword argument 'Images__is_deleted'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f6597389680>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f65973894c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f6599bbac70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f6599aefdc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images__is_deleted=is_deleted)]
                                            │      │          │     │                          └ False
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f6599ae60d0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f6599aee8e0>
                                            └ <class 'app.models.models.Images'>

TypeError: query() got an unexpected keyword argument 'Images__is_deleted'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f6595db5d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f65a0c29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f65a199f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f65a199f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f65a05bd340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
    │    └ <function subprocess_started at 0x7f659e483160>
    └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f65a05bd430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f659e476550>
           │       │   └ <uvicorn.server.Server object at 0x7f65a05bd430>
           │       └ <function run at 0x7f659f635700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f659d9d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f659d9fc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f659d9fc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f659ddb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f659cce5f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f659ddb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>
          └ <fastapi.applications.FastAPI object at 0x7f659cce5f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f6596b4c520>
                     │    └ <function exception_handler at 0x7f6597ba80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f659c0a2ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f6596b4c520>
    │      │         └ TypeError("query() got an unexpected keyword argument 'Images__is_deleted'")
    │      └ <function Logger.exception at 0x7f65a0550790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f6595db5d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:27:56.803 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f6595d998b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f6597bd9c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f6597bb4850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f6597bd9c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f659c0849d0>
          └ <fastapi.routing.APIRoute object at 0x7f659736a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f6597bd4c10>
          └ <fastapi.routing.APIRoute object at 0x7f659736a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f6595db59d0>
                     └ <function get_request_handler.<locals>.app at 0x7f6597bd4b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f659c0735e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f6597ba8160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f659736a970>
                 └ <function run_in_threadpool at 0x7f659c25faf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f6597389680>
                 │     │         └ <function run_sync at 0x7f659c27c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f6597389680>
                 └ <function get_asynclib at 0x7f659c27c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("query() got an unexpected keyword argument 'Images__is_deleted'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f6597389680>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f65973894c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f6599bbac70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f6599aefdc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images__is_deleted=is_deleted)]
                                            │      │          │     │                          └ False
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f6599ae60d0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f6599aee8e0>
                                            └ <class 'app.models.models.Images'>

TypeError: query() got an unexpected keyword argument 'Images__is_deleted'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f6595db5d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f65a0c29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f65a199f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f65a199f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f65a05bd340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
    │    └ <function subprocess_started at 0x7f659e483160>
    └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f65a05bd430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f659e476550>
           │       │   └ <uvicorn.server.Server object at 0x7f65a05bd430>
           │       └ <function run at 0x7f659f635700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f659d9d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f659d9fc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f659d9fc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f659ddb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f659cce5f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f659ddb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>
          └ <fastapi.applications.FastAPI object at 0x7f659cce5f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f6596b4c520>
                     │    └ <function exception_handler at 0x7f6597ba80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f659c0a2ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f6596b4c520>
    │      │         └ TypeError("query() got an unexpected keyword argument 'Images__is_deleted'")
    │      └ <function Logger.exception at 0x7f65a0550790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f6595db5d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:27:56.827 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f6595d998b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f6597bd9c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f6597bb4850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f6597bd9c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f659c0849d0>
          └ <fastapi.routing.APIRoute object at 0x7f659736a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f6595d99790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f6597bd4c10>
          └ <fastapi.routing.APIRoute object at 0x7f659736a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f6595db59d0>
                     └ <function get_request_handler.<locals>.app at 0x7f6597bd4b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f659c0735e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f6597ba8160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f659736a970>
                 └ <function run_in_threadpool at 0x7f659c25faf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f6597389680>
                 │     │         └ <function run_sync at 0x7f659c27c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f6597389680>
                 └ <function get_asynclib at 0x7f659c27c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("query() got an unexpected keyword argument 'Images__is_deleted'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f6597ba8160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f6597389680>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f65973894c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f6599bbac70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f6599aefdc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images__is_deleted=is_deleted)]
                                            │      │          │     │                          └ False
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f6599ae60d0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f6599aee8e0>
                                            └ <class 'app.models.models.Images'>

TypeError: query() got an unexpected keyword argument 'Images__is_deleted'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f6595db5d30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f65a0c29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f65a199f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f65a199f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f65a05bd340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
    │    └ <function subprocess_started at 0x7f659e483160>
    └ <SpawnProcess name='SpawnProcess-1' parent=860144 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f65a05bd430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f659e476550>
           │       │   └ <uvicorn.server.Server object at 0x7f65a05bd430>
           │       └ <function run at 0x7f659f635700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f659d9d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f659d9fc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f659d9fc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f659ddb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f659cce5f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f659ddb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595db5f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f6595d...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>
          └ <fastapi.applications.FastAPI object at 0x7f659cce5f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f6596b4c520>
                     │    └ <function exception_handler at 0x7f6597ba80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f6597bd9c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f659c0a2ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f6596b4c520>
    │      │         └ TypeError("query() got an unexpected keyword argument 'Images__is_deleted'")
    │      └ <function Logger.exception at 0x7f65a0550790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f6595db5d30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:27:56.856 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41874 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:28:17.001 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:28:17.002 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:28:17.003 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:28:17.103 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:28:17.103 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:28:17.104 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:28:17.104 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:28:17.106 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:28:17.107 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:28:17.108 | INFO     | uvicorn.server:serve:94 - Finished server process [860182]
2022-01-07 19:28:17.108 | INFO     | uvicorn.server:serve:94 - Finished server process [860182]
2022-01-07 19:28:17.108 | INFO     | uvicorn.server:serve:94 - Finished server process [860182]
2022-01-07 19:28:29.191 | INFO     | uvicorn.server:serve:84 - Started server process [860712]
2022-01-07 19:28:29.191 | INFO     | uvicorn.server:serve:84 - Started server process [860712]
2022-01-07 19:28:29.192 | INFO     | uvicorn.server:serve:84 - Started server process [860712]
2022-01-07 19:28:29.192 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:28:29.192 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:28:29.193 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:28:29.193 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:28:29.194 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:28:29.194 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:28:30.413 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41890 - "GET /docs HTTP/1.1" 200
2022-01-07 19:28:30.729 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41890 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:28:37.803 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:28:38.199 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41894 - "POST /token HTTP/1.1" 200
2022-01-07 19:28:44.354 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:28:44.492 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f94246329d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f9424632b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '03838efe-cda9-4dca-81aa-28a1d3b5e4d6', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f94208398b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9422679c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f9422654850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9422679c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f9426b249d0>
          └ <fastapi.routing.APIRoute object at 0x7f9421e0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f9422674c10>
          └ <fastapi.routing.APIRoute object at 0x7f9421e0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f94208569d0>
                     └ <function get_request_handler.<locals>.app at 0x7f9422674b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f9426b135e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f9422648160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f9421e0a970>
                 └ <function run_in_threadpool at 0x7f9426cffaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f9420d599c0>
                 │     │         └ <function run_sync at 0x7f9426d1c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f9420d599c0>
                 └ <function get_asynclib at 0x7f9426d1c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (03838efe-cd...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f9420d599c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f9420d59540>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f942465ac70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f942458fdc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f942458e850>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f94245860a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f942458e8b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 117, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f942458e850>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f94245860a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f942458e8b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f94245835e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f942080c1c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
                └ <pynamodb.pagination.ResultIterator object at 0x7f942080c1c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f942080c070>>
           └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f9424633d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f942080c070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f9420856cd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f942b6c9430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f942c43f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f942c43f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f942b05d340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
    │    └ <function subprocess_started at 0x7f9428f25160>
    └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f942b05d430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9428f16550>
           │       │   └ <uvicorn.server.Server object at 0x7f942b05d430>
           │       └ <function run at 0x7f942a0d5700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9428473040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f942849a280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f942849a310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9428852df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9427784f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9428852df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>
          └ <fastapi.applications.FastAPI object at 0x7f9427784f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f9420856d30>
                     │    └ <function exception_handler at 0x7f94226480d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9426b42db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f9420856d30>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) ...
    │      └ <function Logger.exception at 0x7f942aff0790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f9420856cd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:28:44.526 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f94246329d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f9424632b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '03838efe-cda9-4dca-81aa-28a1d3b5e4d6', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f94208398b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9422679c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f9422654850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9422679c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f9426b249d0>
          └ <fastapi.routing.APIRoute object at 0x7f9421e0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f9422674c10>
          └ <fastapi.routing.APIRoute object at 0x7f9421e0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f94208569d0>
                     └ <function get_request_handler.<locals>.app at 0x7f9422674b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f9426b135e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f9422648160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f9421e0a970>
                 └ <function run_in_threadpool at 0x7f9426cffaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f9420d599c0>
                 │     │         └ <function run_sync at 0x7f9426d1c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f9420d599c0>
                 └ <function get_asynclib at 0x7f9426d1c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (03838efe-cd...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f9420d599c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f9420d59540>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f942465ac70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f942458fdc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f942458e850>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f94245860a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f942458e8b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 117, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f942458e850>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f94245860a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f942458e8b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f94245835e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f942080c1c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
                └ <pynamodb.pagination.ResultIterator object at 0x7f942080c1c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f942080c070>>
           └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f9424633d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f942080c070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f9420856cd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f942b6c9430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f942c43f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f942c43f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f942b05d340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
    │    └ <function subprocess_started at 0x7f9428f25160>
    └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f942b05d430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9428f16550>
           │       │   └ <uvicorn.server.Server object at 0x7f942b05d430>
           │       └ <function run at 0x7f942a0d5700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9428473040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f942849a280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f942849a310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9428852df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9427784f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9428852df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>
          └ <fastapi.applications.FastAPI object at 0x7f9427784f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f9420856d30>
                     │    └ <function exception_handler at 0x7f94226480d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9426b42db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f9420856d30>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) ...
    │      └ <function Logger.exception at 0x7f942aff0790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f9420856cd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:28:44.557 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f94246329d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f9424632b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '03838efe-cda9-4dca-81aa-28a1d3b5e4d6', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f94208398b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9422679c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f9422654850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f9422679c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f9426b249d0>
          └ <fastapi.routing.APIRoute object at 0x7f9421e0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9420839790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f9422674c10>
          └ <fastapi.routing.APIRoute object at 0x7f9421e0a940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f94208569d0>
                     └ <function get_request_handler.<locals>.app at 0x7f9422674b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f9426b135e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f9422648160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f9421e0a970>
                 └ <function run_in_threadpool at 0x7f9426cffaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f9420d599c0>
                 │     │         └ <function run_sync at 0x7f9426d1c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f9420d599c0>
                 └ <function get_asynclib at 0x7f9426d1c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (03838efe-cd...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f9422648160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f9420d599c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f9420d59540>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f942465ac70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f942458fdc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f942458e850>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f94245860a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f942458e8b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 117, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f942458e850>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f94245860a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f942458e8b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f94245835e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f942080c1c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
                └ <pynamodb.pagination.ResultIterator object at 0x7f942080c1c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f942462b6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f942080c070>>
           └ <pynamodb.pagination.PageIterator object at 0x7f942080c220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f9424633d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f942080c070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f9420856cd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f942b6c9430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f942c43f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f942c43f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f942b05d340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
    │    └ <function subprocess_started at 0x7f9428f25160>
    └ <SpawnProcess name='SpawnProcess-1' parent=860675 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f942b05d430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9428f16550>
           │       │   └ <uvicorn.server.Server object at 0x7f942b05d430>
           │       └ <function run at 0x7f942a0d5700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f9428473040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f942849a280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f942849a310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9428852df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f9427784f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f9428852df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f9420856f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f94208...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>
          └ <fastapi.applications.FastAPI object at 0x7f9427784f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f9420856d30>
                     │    └ <function exception_handler at 0x7f94226480d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f9422679c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f9426b42db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f9420856d30>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (03838efe-cda9-4dca-81aa-28a1d3b5e4d6) ...
    │      └ <function Logger.exception at 0x7f942aff0790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f9420856cd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:28:44.594 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41920 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:29:50.447 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:29:50.448 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:29:50.449 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:29:50.551 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:29:50.551 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:29:50.553 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:29:50.554 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:29:50.554 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:29:50.555 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:29:50.555 | INFO     | uvicorn.server:serve:94 - Finished server process [860712]
2022-01-07 19:29:50.557 | INFO     | uvicorn.server:serve:94 - Finished server process [860712]
2022-01-07 19:29:50.559 | INFO     | uvicorn.server:serve:94 - Finished server process [860712]
2022-01-07 19:29:51.976 | INFO     | uvicorn.server:serve:84 - Started server process [861206]
2022-01-07 19:29:51.977 | INFO     | uvicorn.server:serve:84 - Started server process [861206]
2022-01-07 19:29:51.978 | INFO     | uvicorn.server:serve:84 - Started server process [861206]
2022-01-07 19:29:51.978 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:29:51.978 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:29:51.979 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:29:51.979 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:29:51.980 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:29:51.980 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:29:53.183 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:29:53.184 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:29:53.184 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:29:53.285 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:29:53.285 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:29:53.286 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:29:53.286 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:29:53.286 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:29:53.287 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:29:53.287 | INFO     | uvicorn.server:serve:94 - Finished server process [861206]
2022-01-07 19:29:53.288 | INFO     | uvicorn.server:serve:94 - Finished server process [861206]
2022-01-07 19:29:53.288 | INFO     | uvicorn.server:serve:94 - Finished server process [861206]
2022-01-07 19:29:55.566 | INFO     | uvicorn.server:serve:84 - Started server process [861300]
2022-01-07 19:29:55.567 | INFO     | uvicorn.server:serve:84 - Started server process [861300]
2022-01-07 19:29:55.567 | INFO     | uvicorn.server:serve:84 - Started server process [861300]
2022-01-07 19:29:55.567 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:29:55.568 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:29:55.568 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:29:55.568 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:29:55.569 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:29:55.569 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:29:56.923 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41970 - "GET /docs HTTP/1.1" 200
2022-01-07 19:29:57.263 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41970 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:30:04.803 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:30:05.197 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:41974 - "POST /token HTTP/1.1" 200
2022-01-07 19:30:10.616 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:30:10.722 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f08757ed9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f08757edb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '03a3371b-5299-4df3-ab01-97bd41512e63', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08719f58b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0872fb6c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f0873811850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0872fb6c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0877ce19d0>
          └ <fastapi.routing.APIRoute object at 0x7f0872fc7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0873831c10>
          └ <fastapi.routing.APIRoute object at 0x7f0872fc7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0871a129d0>
                     └ <function get_request_handler.<locals>.app at 0x7f0873831b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0877cd05e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f0873805160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f0872fc7970>
                 └ <function run_in_threadpool at 0x7f0877ebcaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f087278ccc0>
                 │     │         └ <function run_sync at 0x7f0877ed99d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f087278ccc0>
                 └ <function get_asynclib at 0x7f0877ed9310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (03a3371b-52...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f087278ccc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f0871f16f40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f0875816c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f087574cdc0>

  File "./app/models/models.py", line 118, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f087574b8b0>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f08757430a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f087574b910>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 118, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f087574b8b0>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f08757430a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f087574b910>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08757405e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08719c81c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08719c81c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08719c8070>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08757f0d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08719c8070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f0871a12cd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f087c885430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f087d5fb9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f087d5fb040>
    └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f087c21a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
    │    └ <function subprocess_started at 0x7f087a0e0160>
    └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f087c21a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f087a0d1550>
           │       │   └ <uvicorn.server.Server object at 0x7f087c21a430>
           │       └ <function run at 0x7f087b292700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f0879630040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f087965b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f087965b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0879a0fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0878942f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0879a0fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>
          └ <fastapi.applications.FastAPI object at 0x7f0878942f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f0871a12d30>
                     │    └ <function exception_handler at 0x7f08738050d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0877cffd60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f0871a12d30>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) ...
    │      └ <function Logger.exception at 0x7f087c1ad790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f0871a12cd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:30:10.756 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f08757ed9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f08757edb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '03a3371b-5299-4df3-ab01-97bd41512e63', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08719f58b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0872fb6c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f0873811850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0872fb6c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0877ce19d0>
          └ <fastapi.routing.APIRoute object at 0x7f0872fc7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0873831c10>
          └ <fastapi.routing.APIRoute object at 0x7f0872fc7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0871a129d0>
                     └ <function get_request_handler.<locals>.app at 0x7f0873831b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0877cd05e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f0873805160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f0872fc7970>
                 └ <function run_in_threadpool at 0x7f0877ebcaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f087278ccc0>
                 │     │         └ <function run_sync at 0x7f0877ed99d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f087278ccc0>
                 └ <function get_asynclib at 0x7f0877ed9310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (03a3371b-52...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f087278ccc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f0871f16f40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f0875816c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f087574cdc0>

  File "./app/models/models.py", line 118, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f087574b8b0>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f08757430a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f087574b910>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 118, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f087574b8b0>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f08757430a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f087574b910>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08757405e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08719c81c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08719c81c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08719c8070>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08757f0d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08719c8070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f0871a12cd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f087c885430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f087d5fb9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f087d5fb040>
    └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f087c21a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
    │    └ <function subprocess_started at 0x7f087a0e0160>
    └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f087c21a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f087a0d1550>
           │       │   └ <uvicorn.server.Server object at 0x7f087c21a430>
           │       └ <function run at 0x7f087b292700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f0879630040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f087965b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f087965b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0879a0fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0878942f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0879a0fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>
          └ <fastapi.applications.FastAPI object at 0x7f0878942f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f0871a12d30>
                     │    └ <function exception_handler at 0x7f08738050d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0877cffd60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f0871a12d30>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) ...
    │      └ <function Logger.exception at 0x7f087c1ad790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f0871a12cd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:30:10.787 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f08757ed9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f08757edb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '03a3371b-5299-4df3-ab01-97bd41512e63', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f08719f58b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0872fb6c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f0873811850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f0872fb6c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f0877ce19d0>
          └ <fastapi.routing.APIRoute object at 0x7f0872fc7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f08719f5790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f0873831c10>
          └ <fastapi.routing.APIRoute object at 0x7f0872fc7940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f0871a129d0>
                     └ <function get_request_handler.<locals>.app at 0x7f0873831b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f0877cd05e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f0873805160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f0872fc7970>
                 └ <function run_in_threadpool at 0x7f0877ebcaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f087278ccc0>
                 │     │         └ <function run_sync at 0x7f0877ed99d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f087278ccc0>
                 └ <function get_asynclib at 0x7f0877ed9310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (03a3371b-52...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f0873805160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f087278ccc0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f0871f16f40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f0875816c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f087574cdc0>

  File "./app/models/models.py", line 118, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f087574b8b0>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f08757430a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f087574b910>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 118, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f087574b8b0>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f08757430a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f087574b910>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f08757405e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f08719c81c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
                └ <pynamodb.pagination.ResultIterator object at 0x7f08719c81c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f08757e86a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f08719c8070>>
           └ <pynamodb.pagination.PageIterator object at 0x7f08719c8220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f08757f0d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f08719c8070>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f0871a12cd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f087c885430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f087d5fb9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f087d5fb040>
    └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f087c21a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
    │    └ <function subprocess_started at 0x7f087a0e0160>
    └ <SpawnProcess name='SpawnProcess-1' parent=861262 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f087c21a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f087a0d1550>
           │       │   └ <uvicorn.server.Server object at 0x7f087c21a430>
           │       └ <function run at 0x7f087b292700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f0879630040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f087965b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f087965b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0879a0fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f0878942f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f0879a0fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a12f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f0871a...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>
          └ <fastapi.applications.FastAPI object at 0x7f0878942f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f0871a12d30>
                     │    └ <function exception_handler at 0x7f08738050d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f0872fb6c70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f0877cffd60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f0871a12d30>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (03a3371b-5299-4df3-ab01-97bd41512e63) ...
    │      └ <function Logger.exception at 0x7f087c1ad790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f0871a12cd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:30:10.813 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42000 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:30:52.712 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:30:52.713 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:30:52.713 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:30:52.814 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:30:52.814 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:30:52.815 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:30:52.816 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:30:52.816 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:30:52.817 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:30:52.817 | INFO     | uvicorn.server:serve:94 - Finished server process [861300]
2022-01-07 19:30:52.818 | INFO     | uvicorn.server:serve:94 - Finished server process [861300]
2022-01-07 19:30:52.818 | INFO     | uvicorn.server:serve:94 - Finished server process [861300]
2022-01-07 19:30:54.478 | INFO     | uvicorn.server:serve:84 - Started server process [861689]
2022-01-07 19:30:54.479 | INFO     | uvicorn.server:serve:84 - Started server process [861689]
2022-01-07 19:30:54.479 | INFO     | uvicorn.server:serve:84 - Started server process [861689]
2022-01-07 19:30:54.480 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:30:54.480 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:30:54.481 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:30:54.481 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:30:54.482 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:30:54.482 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:00.093 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:00.094 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:00.094 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:00.195 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:00.196 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:00.197 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:00.199 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:00.200 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:00.200 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:00.201 | INFO     | uvicorn.server:serve:94 - Finished server process [861689]
2022-01-07 19:31:00.202 | INFO     | uvicorn.server:serve:94 - Finished server process [861689]
2022-01-07 19:31:00.202 | INFO     | uvicorn.server:serve:94 - Finished server process [861689]
2022-01-07 19:31:01.520 | INFO     | uvicorn.server:serve:84 - Started server process [861787]
2022-01-07 19:31:01.521 | INFO     | uvicorn.server:serve:84 - Started server process [861787]
2022-01-07 19:31:01.523 | INFO     | uvicorn.server:serve:84 - Started server process [861787]
2022-01-07 19:31:01.524 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:31:01.525 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:31:01.526 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:31:01.527 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:01.528 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:01.528 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:01.829 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:01.829 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:01.830 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:01.932 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:01.933 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:01.933 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:01.934 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:01.934 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:01.935 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:01.935 | INFO     | uvicorn.server:serve:94 - Finished server process [861787]
2022-01-07 19:31:01.936 | INFO     | uvicorn.server:serve:94 - Finished server process [861787]
2022-01-07 19:31:01.936 | INFO     | uvicorn.server:serve:94 - Finished server process [861787]
2022-01-07 19:31:03.932 | INFO     | uvicorn.server:serve:84 - Started server process [861852]
2022-01-07 19:31:03.932 | INFO     | uvicorn.server:serve:84 - Started server process [861852]
2022-01-07 19:31:03.933 | INFO     | uvicorn.server:serve:84 - Started server process [861852]
2022-01-07 19:31:03.936 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:31:03.937 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:31:03.938 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:31:03.939 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:03.940 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:03.941 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:31:05.737 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42052 - "GET /docs HTTP/1.1" 200
2022-01-07 19:31:06.157 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42052 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:31:13.980 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:31:14.433 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42056 - "POST /token HTTP/1.1" 200
2022-01-07 19:31:18.241 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:31:18.358 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fcce1fc59d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fcce1fc5b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '71929c38-8ff0-41ac-b2cc-c86b66b12494', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fccdf7ad940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fccdf78ca60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fccdffe76a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fccdf78ca60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce44b79d0>
          └ <fastapi.routing.APIRoute object at 0x7fccdf7a0790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce0007c10>
          └ <fastapi.routing.APIRoute object at 0x7fccdf7a0790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fccdf7c7100>
                     └ <function get_request_handler.<locals>.app at 0x7fcce0007b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fcce44a65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fccdffda160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fccdf7a07c0>
                 └ <function run_in_threadpool at 0x7fcce4692af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fccdef3bf00>
                 │     │         └ <function run_sync at 0x7fcce46af9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fccdef3bf00>
                 └ <function get_asynclib at 0x7fcce46af310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (71929c38-8f...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fccdef3bf00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fccdf7b3f80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fcce1fedc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fcce1f22dc0>

  File "./app/models/models.py", line 115, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fcce1f217f0>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7fcce1f190a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fcce1f21850>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 115, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fcce1f217f0>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fcce1f190a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fcce1f21850>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fcce1f165e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fccdf7b4f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
                └ <pynamodb.pagination.ResultIterator object at 0x7fccdf7b4f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fccdf7b4e20>>
           └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fcce1fc6d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fccdf7b4e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fccdf7c7c40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcce905b430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fcce9dd29d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fcce9dd2040>
    └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fcce89f0340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
    │    └ <function subprocess_started at 0x7fcce68b7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fcce89f0430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce68a9550>
           │       │   └ <uvicorn.server.Server object at 0x7fcce89f0430>
           │       └ <function run at 0x7fcce7a68700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce5e06040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce5e2d280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce5e2d310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce61e5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce5118f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce61e5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce5118f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fccdf7c7fd0>
                     │    └ <function exception_handler at 0x7fccdffda0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce44d5d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fccdf7c7fd0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) ...
    │      └ <function Logger.exception at 0x7fcce8983790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fccdf7c7c40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:31:18.394 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fcce1fc59d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fcce1fc5b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '71929c38-8ff0-41ac-b2cc-c86b66b12494', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fccdf7ad940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fccdf78ca60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fccdffe76a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fccdf78ca60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce44b79d0>
          └ <fastapi.routing.APIRoute object at 0x7fccdf7a0790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce0007c10>
          └ <fastapi.routing.APIRoute object at 0x7fccdf7a0790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fccdf7c7100>
                     └ <function get_request_handler.<locals>.app at 0x7fcce0007b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fcce44a65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fccdffda160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fccdf7a07c0>
                 └ <function run_in_threadpool at 0x7fcce4692af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fccdef3bf00>
                 │     │         └ <function run_sync at 0x7fcce46af9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fccdef3bf00>
                 └ <function get_asynclib at 0x7fcce46af310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (71929c38-8f...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fccdef3bf00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fccdf7b3f80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fcce1fedc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fcce1f22dc0>

  File "./app/models/models.py", line 115, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fcce1f217f0>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7fcce1f190a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fcce1f21850>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 115, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fcce1f217f0>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fcce1f190a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fcce1f21850>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fcce1f165e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fccdf7b4f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
                └ <pynamodb.pagination.ResultIterator object at 0x7fccdf7b4f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fccdf7b4e20>>
           └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fcce1fc6d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fccdf7b4e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fccdf7c7c40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcce905b430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fcce9dd29d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fcce9dd2040>
    └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fcce89f0340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
    │    └ <function subprocess_started at 0x7fcce68b7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fcce89f0430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce68a9550>
           │       │   └ <uvicorn.server.Server object at 0x7fcce89f0430>
           │       └ <function run at 0x7fcce7a68700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce5e06040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce5e2d280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce5e2d310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce61e5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce5118f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce61e5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce5118f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fccdf7c7fd0>
                     │    └ <function exception_handler at 0x7fccdffda0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce44d5d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fccdf7c7fd0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) ...
    │      └ <function Logger.exception at 0x7fcce8983790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fccdf7c7c40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:31:18.422 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fcce1fc59d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fcce1fc5b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '71929c38-8ff0-41ac-b2cc-c86b66b12494', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fccdf7ad940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fccdf78ca60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fccdffe76a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fccdf78ca60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fcce44b79d0>
          └ <fastapi.routing.APIRoute object at 0x7fccdf7a0790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fccde249820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fcce0007c10>
          └ <fastapi.routing.APIRoute object at 0x7fccdf7a0790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fccdf7c7100>
                     └ <function get_request_handler.<locals>.app at 0x7fcce0007b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fcce44a65e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fccdffda160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fccdf7a07c0>
                 └ <function run_in_threadpool at 0x7fcce4692af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fccdef3bf00>
                 │     │         └ <function run_sync at 0x7fcce46af9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fccdef3bf00>
                 └ <function get_asynclib at 0x7fcce46af310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (71929c38-8f...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fccdffda160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fccdef3bf00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fccdf7b3f80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fcce1fedc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fcce1f22dc0>

  File "./app/models/models.py", line 115, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fcce1f217f0>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7fcce1f190a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fcce1f21850>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 115, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fcce1f217f0>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fcce1f190a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fcce1f21850>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fcce1f165e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fccdf7b4f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
                └ <pynamodb.pagination.ResultIterator object at 0x7fccdf7b4f10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fcce1fbe6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fccdf7b4e20>>
           └ <pynamodb.pagination.PageIterator object at 0x7fccdf7b4670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fcce1fc6d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fccdf7b4e20>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fccdf7c7c40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fcce905b430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fcce9dd29d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fcce9dd2040>
    └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fcce89f0340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
    │    └ <function subprocess_started at 0x7fcce68b7160>
    └ <SpawnProcess name='SpawnProcess-1' parent=861814 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fcce89f0430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fcce68a9550>
           │       │   └ <uvicorn.server.Server object at 0x7fcce89f0430>
           │       └ <function run at 0x7fcce7a68700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fcce5e06040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fcce5e2d280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fcce5e2d310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce61e5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fcce5118f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fcce61e5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7c79...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fccdf7...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>
          └ <fastapi.applications.FastAPI object at 0x7fcce5118f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fccdf7c7fd0>
                     │    └ <function exception_handler at 0x7fccdffda0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fccdf78cac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fcce44d5d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fccdf7c7fd0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (71929c38-8ff0-41ac-b2cc-c86b66b12494) ...
    │      └ <function Logger.exception at 0x7fcce8983790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fccdf7c7c40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:31:18.452 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42056 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:31:35.996 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:35.997 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:35.997 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:31:36.098 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:36.098 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:36.099 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:31:36.099 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:36.099 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:36.100 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:31:36.100 | INFO     | uvicorn.server:serve:94 - Finished server process [861852]
2022-01-07 19:31:36.100 | INFO     | uvicorn.server:serve:94 - Finished server process [861852]
2022-01-07 19:31:36.101 | INFO     | uvicorn.server:serve:94 - Finished server process [861852]
2022-01-07 19:32:10.726 | INFO     | uvicorn.server:serve:84 - Started server process [862409]
2022-01-07 19:32:10.727 | INFO     | uvicorn.server:serve:84 - Started server process [862409]
2022-01-07 19:32:10.727 | INFO     | uvicorn.server:serve:84 - Started server process [862409]
2022-01-07 19:32:10.727 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:32:10.728 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:32:10.728 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:32:10.729 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:32:10.730 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:32:10.730 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:32:11.896 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42134 - "GET /docs HTTP/1.1" 200
2022-01-07 19:32:12.188 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42134 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:32:20.038 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:32:20.423 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42138 - "POST /token HTTP/1.1" 200
2022-01-07 19:32:25.618 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:32:25.592 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f21eaaaa820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f21f007db80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f21f08d87c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f21f007db80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f21f4da89d0>
          └ <fastapi.routing.APIRoute object at 0x7f21f008e8b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f21f08f8c10>
          └ <fastapi.routing.APIRoute object at 0x7f21f008e8b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f21eaa9c9a0>
                     └ <function get_request_handler.<locals>.app at 0x7f21f08f8b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f21f4d975e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f21f08cc160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f21f008e8e0>
                 └ <function run_in_threadpool at 0x7f21f4f83af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f21f22aab00>
                 │     │         └ <function run_sync at 0x7f21f4fa09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f21f22aab00>
                 └ <function get_asynclib at 0x7f21f4fa0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError("'range_key_condition' must be an instance of Condition")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f21f22aab00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f21eaa92a40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f21f28dec70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f21f2813dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,is_deleted==is_deleted)]
                                            │      │          │     │       │           └ False
                                            │      │          │     │       └ False
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f21f280a0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f21f28128b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,is_deleted==is_deleted)]
                                            │      │          └ <classmethod object at 0x7f21f280a0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f21f28128b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f21f28075e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f21eaa9c550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f21eaa9c550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': True, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_key': None, 'consistent_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f21f28af6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f21eb7c65b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f21f28b7d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f21eb7c65b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1281, in query
    self._check_condition('range_key_condition', range_key_condition)
    │    │                                       └ True
    │    └ <function Connection._check_condition at 0x7f21f28b7dc0>
    └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1340, in _check_condition
    raise ValueError("'{}' must be an instance of Condition".format(name))
                                                                    └ 'range_key_condition'

ValueError: 'range_key_condition' must be an instance of Condition


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f21eaa9cf40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f21f994c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f21fa6c39d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f21fa6c3040>
    └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f21f92e1340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
    │    └ <function subprocess_started at 0x7f21f71a9160>
    └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f21f92e1430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f21f719a550>
           │       │   └ <uvicorn.server.Server object at 0x7f21f92e1430>
           │       └ <function run at 0x7f21f8359700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f21f66f8040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f21f6722280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f21f6722310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f21f6ad6df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f21f5a09f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f21f6ad6df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>
          └ <fastapi.applications.FastAPI object at 0x7f21f5a09f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f21eaa9c850>
                     │    └ <function exception_handler at 0x7f21f08cc0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f21f4dc6e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f21eaa9c850>
    │      │         └ ValueError("'range_key_condition' must be an instance of Condition")
    │      └ <function Logger.exception at 0x7f21f9274790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f21eaa9cf40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:32:25.672 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f21eaaaa820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f21f007db80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f21f08d87c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f21f007db80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f21f4da89d0>
          └ <fastapi.routing.APIRoute object at 0x7f21f008e8b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f21f08f8c10>
          └ <fastapi.routing.APIRoute object at 0x7f21f008e8b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f21eaa9c9a0>
                     └ <function get_request_handler.<locals>.app at 0x7f21f08f8b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f21f4d975e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f21f08cc160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f21f008e8e0>
                 └ <function run_in_threadpool at 0x7f21f4f83af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f21f22aab00>
                 │     │         └ <function run_sync at 0x7f21f4fa09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f21f22aab00>
                 └ <function get_asynclib at 0x7f21f4fa0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError("'range_key_condition' must be an instance of Condition")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f21f22aab00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f21eaa92a40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f21f28dec70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f21f2813dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,is_deleted==is_deleted)]
                                            │      │          │     │       │           └ False
                                            │      │          │     │       └ False
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f21f280a0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f21f28128b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,is_deleted==is_deleted)]
                                            │      │          └ <classmethod object at 0x7f21f280a0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f21f28128b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f21f28075e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f21eaa9c550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f21eaa9c550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': True, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_key': None, 'consistent_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f21f28af6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f21eb7c65b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f21f28b7d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f21eb7c65b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1281, in query
    self._check_condition('range_key_condition', range_key_condition)
    │    │                                       └ True
    │    └ <function Connection._check_condition at 0x7f21f28b7dc0>
    └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1340, in _check_condition
    raise ValueError("'{}' must be an instance of Condition".format(name))
                                                                    └ 'range_key_condition'

ValueError: 'range_key_condition' must be an instance of Condition


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f21eaa9cf40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f21f994c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f21fa6c39d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f21fa6c3040>
    └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f21f92e1340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
    │    └ <function subprocess_started at 0x7f21f71a9160>
    └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f21f92e1430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f21f719a550>
           │       │   └ <uvicorn.server.Server object at 0x7f21f92e1430>
           │       └ <function run at 0x7f21f8359700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f21f66f8040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f21f6722280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f21f6722310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f21f6ad6df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f21f5a09f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f21f6ad6df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>
          └ <fastapi.applications.FastAPI object at 0x7f21f5a09f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f21eaa9c850>
                     │    └ <function exception_handler at 0x7f21f08cc0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f21f4dc6e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f21eaa9c850>
    │      │         └ ValueError("'range_key_condition' must be an instance of Condition")
    │      └ <function Logger.exception at 0x7f21f9274790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f21eaa9cf40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:32:25.697 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f21eaaaa820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f21f007db80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f21f08d87c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f21f007db80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f21f4da89d0>
          └ <fastapi.routing.APIRoute object at 0x7f21f008e8b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f21eaaaa700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f21f08f8c10>
          └ <fastapi.routing.APIRoute object at 0x7f21f008e8b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f21eaa9c9a0>
                     └ <function get_request_handler.<locals>.app at 0x7f21f08f8b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f21f4d975e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f21f08cc160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f21f008e8e0>
                 └ <function run_in_threadpool at 0x7f21f4f83af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f21f22aab00>
                 │     │         └ <function run_sync at 0x7f21f4fa09d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f21f22aab00>
                 └ <function get_asynclib at 0x7f21f4fa0310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError("'range_key_condition' must be an instance of Condition")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f21f08cc160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f21f22aab00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f21eaa92a40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f21f28dec70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f21f2813dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,is_deleted==is_deleted)]
                                            │      │          │     │       │           └ False
                                            │      │          │     │       └ False
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f21f280a0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f21f28128b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,is_deleted==is_deleted)]
                                            │      │          └ <classmethod object at 0x7f21f280a0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f21f28128b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f21f28075e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f21eaa9c550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f21eaa9c550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': True, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_key': None, 'consistent_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f21f28af6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f21eb7c65b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f21eaa9ccd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f21f28b7d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f21eb7c65b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1281, in query
    self._check_condition('range_key_condition', range_key_condition)
    │    │                                       └ True
    │    └ <function Connection._check_condition at 0x7f21f28b7dc0>
    └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1340, in _check_condition
    raise ValueError("'{}' must be an instance of Condition".format(name))
                                                                    └ 'range_key_condition'

ValueError: 'range_key_condition' must be an instance of Condition


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f21eaa9cf40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f21f994c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f21fa6c39d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f21fa6c3040>
    └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f21f92e1340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
    │    └ <function subprocess_started at 0x7f21f71a9160>
    └ <SpawnProcess name='SpawnProcess-1' parent=862372 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f21f92e1430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f21f719a550>
           │       │   └ <uvicorn.server.Server object at 0x7f21f92e1430>
           │       └ <function run at 0x7f21f8359700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f21f66f8040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f21f6722280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f21f6722310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9cee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f21f6ad6df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f21f5a09f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f21f6ad6df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa9ce...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f21eaa...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>
          └ <fastapi.applications.FastAPI object at 0x7f21f5a09f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f21eaa9c850>
                     │    └ <function exception_handler at 0x7f21f08cc0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f21f007dbe0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f21f4dc6e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f21eaa9c850>
    │      │         └ ValueError("'range_key_condition' must be an instance of Condition")
    │      └ <function Logger.exception at 0x7f21f9274790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f21eaa9cf40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:32:25.720 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42174 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:33:01.604 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:33:01.604 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:33:01.605 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:33:01.707 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:33:01.707 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:33:01.708 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:33:01.708 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:33:01.709 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:33:01.709 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:33:01.710 | INFO     | uvicorn.server:serve:94 - Finished server process [862409]
2022-01-07 19:33:01.710 | INFO     | uvicorn.server:serve:94 - Finished server process [862409]
2022-01-07 19:33:01.711 | INFO     | uvicorn.server:serve:94 - Finished server process [862409]
2022-01-07 19:33:05.092 | INFO     | uvicorn.server:serve:84 - Started server process [862853]
2022-01-07 19:33:05.092 | INFO     | uvicorn.server:serve:84 - Started server process [862853]
2022-01-07 19:33:05.093 | INFO     | uvicorn.server:serve:84 - Started server process [862853]
2022-01-07 19:33:05.093 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:33:05.093 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:33:05.094 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:33:05.094 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:33:05.094 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:33:05.095 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:33:06.466 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42198 - "GET /docs HTTP/1.1" 200
2022-01-07 19:33:06.784 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42198 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:33:18.288 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:33:18.678 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42202 - "POST /token HTTP/1.1" 200
2022-01-07 19:33:22.781 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:33:22.893 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f2ab877f9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f2ab877fb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '16b34e4c-7dac-4ce7-a47d-657e4b6ea801', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2ab5f698b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2ab67c7c40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2ab67a2880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2ab67c7c40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2abac729d0>
          └ <fastapi.routing.APIRoute object at 0x7f2ab5f58970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2ab67c2c10>
          └ <fastapi.routing.APIRoute object at 0x7f2ab5f58970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2ab5f830a0>
                     └ <function get_request_handler.<locals>.app at 0x7f2ab67c2b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2abac615e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f2ab6796160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2ab5f589a0>
                 └ <function run_in_threadpool at 0x7f2abae4daf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2ab56d0580>
                 │     │         └ <function run_sync at 0x7f2abae6a9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f2ab56d0580>
                 └ <function get_asynclib at 0x7f2abae6a310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7d...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f2ab56d0580>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2ab5f59c80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2ab87a8c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f2ab86dddc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2ab86dc850>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f2ab86d40a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f2ab86dc8b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2ab86dc850>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f2ab86d40a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f2ab86dc8b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f2ab86d15e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f2ab49a3dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
                └ <pynamodb.pagination.ResultIterator object at 0x7f2ab49a3dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f2ab49a3f40>>
           └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f2ab8781d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f2ab49a3f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2ab5f6dc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2abf816430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2ac058d9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2ac058d040>
    └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2abf1ab340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
    │    └ <function subprocess_started at 0x7f2abd072160>
    └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2abf1ab430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2abd063550>
           │       │   └ <uvicorn.server.Server object at 0x7f2abf1ab430>
           │       └ <function run at 0x7f2abe223700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2abc5c1040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2abc5ec280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2abc5ec310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2abc9a0df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2abb8d3f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2abc9a0df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>
          └ <fastapi.applications.FastAPI object at 0x7f2abb8d3f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2ab5f835e0>
                     │    └ <function exception_handler at 0x7f2ab67960d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2abac90ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2ab5f835e0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) ...
    │      └ <function Logger.exception at 0x7f2abf13e790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2ab5f6dc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:33:22.927 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f2ab877f9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f2ab877fb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '16b34e4c-7dac-4ce7-a47d-657e4b6ea801', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2ab5f698b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2ab67c7c40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2ab67a2880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2ab67c7c40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2abac729d0>
          └ <fastapi.routing.APIRoute object at 0x7f2ab5f58970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2ab67c2c10>
          └ <fastapi.routing.APIRoute object at 0x7f2ab5f58970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2ab5f830a0>
                     └ <function get_request_handler.<locals>.app at 0x7f2ab67c2b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2abac615e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f2ab6796160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2ab5f589a0>
                 └ <function run_in_threadpool at 0x7f2abae4daf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2ab56d0580>
                 │     │         └ <function run_sync at 0x7f2abae6a9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f2ab56d0580>
                 └ <function get_asynclib at 0x7f2abae6a310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7d...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f2ab56d0580>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2ab5f59c80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2ab87a8c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f2ab86dddc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2ab86dc850>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f2ab86d40a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f2ab86dc8b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2ab86dc850>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f2ab86d40a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f2ab86dc8b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f2ab86d15e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f2ab49a3dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
                └ <pynamodb.pagination.ResultIterator object at 0x7f2ab49a3dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f2ab49a3f40>>
           └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f2ab8781d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f2ab49a3f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2ab5f6dc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2abf816430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2ac058d9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2ac058d040>
    └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2abf1ab340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
    │    └ <function subprocess_started at 0x7f2abd072160>
    └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2abf1ab430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2abd063550>
           │       │   └ <uvicorn.server.Server object at 0x7f2abf1ab430>
           │       └ <function run at 0x7f2abe223700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2abc5c1040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2abc5ec280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2abc5ec310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2abc9a0df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2abb8d3f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2abc9a0df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>
          └ <fastapi.applications.FastAPI object at 0x7f2abb8d3f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2ab5f835e0>
                     │    └ <function exception_handler at 0x7f2ab67960d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2abac90ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2ab5f835e0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) ...
    │      └ <function Logger.exception at 0x7f2abf13e790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2ab5f6dc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:33:22.953 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f2ab877f9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f2ab877fb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '16b34e4c-7dac-4ce7-a47d-657e4b6ea801', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2ab5f698b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2ab67c7c40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2ab67a2880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2ab67c7c40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2abac729d0>
          └ <fastapi.routing.APIRoute object at 0x7f2ab5f58970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2ab4986820>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2ab67c2c10>
          └ <fastapi.routing.APIRoute object at 0x7f2ab5f58970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2ab5f830a0>
                     └ <function get_request_handler.<locals>.app at 0x7f2ab67c2b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2abac615e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f2ab6796160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2ab5f589a0>
                 └ <function run_in_threadpool at 0x7f2abae4daf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2ab56d0580>
                 │     │         └ <function run_sync at 0x7f2abae6a9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f2ab56d0580>
                 └ <function get_asynclib at 0x7f2abae6a310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7d...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f2ab6796160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f2ab56d0580>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2ab5f59c80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2ab87a8c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f2ab86dddc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │       │      │           └ False
                                            │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2ab86dc850>
                                            │      │          │     │       └ <class 'app.models.models.Images'>
                                            │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          └ <classmethod object at 0x7f2ab86d40a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f2ab86dc8b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(user_id,Images.is_deleted==is_deleted)]
                                            │      │          │             │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2ab86dc850>
                                            │      │          │             └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f2ab86d40a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f2ab86dc8b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f2ab86d15e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f2ab49a3dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
                └ <pynamodb.pagination.ResultIterator object at 0x7f2ab49a3dc0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f2ab87796a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f2ab49a3f40>>
           └ <pynamodb.pagination.PageIterator object at 0x7f2ab49a3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f2ab8781d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f2ab49a3f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2ab5f6dc70>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2abf816430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2ac058d9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2ac058d040>
    └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2abf1ab340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
    │    └ <function subprocess_started at 0x7f2abd072160>
    └ <SpawnProcess name='SpawnProcess-1' parent=862815 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2abf1ab430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2abd063550>
           │       │   └ <uvicorn.server.Server object at 0x7f2abf1ab430>
           │       └ <function run at 0x7f2abe223700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2abc5c1040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2abc5ec280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2abc5ec310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49edeb0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2abc9a0df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2abb8d3f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2abc9a0df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49ede...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2ab49...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>
          └ <fastapi.applications.FastAPI object at 0x7f2abb8d3f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2ab5f835e0>
                     │    └ <function exception_handler at 0x7f2ab67960d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2ab67c7ca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2abac90ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2ab5f835e0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (16b34e4c-7dac-4ce7-a47d-657e4b6ea801) ...
    │      └ <function Logger.exception at 0x7f2abf13e790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2ab5f6dc70>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:33:22.981 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42202 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:38:16.259 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:38:16.260 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:38:16.261 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:38:16.362 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:38:16.363 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:38:16.364 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:38:16.367 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:38:16.368 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:38:16.369 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:38:16.370 | INFO     | uvicorn.server:serve:94 - Finished server process [862853]
2022-01-07 19:38:16.371 | INFO     | uvicorn.server:serve:94 - Finished server process [862853]
2022-01-07 19:38:16.371 | INFO     | uvicorn.server:serve:94 - Finished server process [862853]
2022-01-07 19:38:17.866 | INFO     | uvicorn.server:serve:84 - Started server process [864376]
2022-01-07 19:38:17.868 | INFO     | uvicorn.server:serve:84 - Started server process [864376]
2022-01-07 19:38:17.869 | INFO     | uvicorn.server:serve:84 - Started server process [864376]
2022-01-07 19:38:17.869 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:38:17.870 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:38:17.870 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:38:17.872 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:38:17.873 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:38:17.874 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:38:25.291 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:38:25.292 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:38:25.292 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:38:25.393 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:38:25.394 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:38:25.394 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:38:25.395 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:38:25.395 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:38:25.395 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:38:25.396 | INFO     | uvicorn.server:serve:94 - Finished server process [864376]
2022-01-07 19:38:25.396 | INFO     | uvicorn.server:serve:94 - Finished server process [864376]
2022-01-07 19:38:25.396 | INFO     | uvicorn.server:serve:94 - Finished server process [864376]
2022-01-07 19:38:30.373 | INFO     | uvicorn.server:serve:84 - Started server process [864576]
2022-01-07 19:38:30.373 | INFO     | uvicorn.server:serve:84 - Started server process [864576]
2022-01-07 19:38:30.373 | INFO     | uvicorn.server:serve:84 - Started server process [864576]
2022-01-07 19:38:30.374 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:38:30.375 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:38:30.375 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:38:30.376 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:38:30.376 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:38:30.377 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:38:44.249 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42386 - "GET / HTTP/1.1" 404
2022-01-07 19:38:50.509 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42388 - "GET /docs HTTP/1.1" 200
2022-01-07 19:38:52.481 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42388 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:39:00.462 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:39:00.850 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42390 - "POST /token HTTP/1.1" 200
2022-01-07 19:39:09.763 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:39:09.826 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f90295008b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f902b341b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f902b31c7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f902b341b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f902f7ec9d0>
          └ <fastapi.routing.APIRoute object at 0x7f902aad38b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f902b33cc10>
          └ <fastapi.routing.APIRoute object at 0x7f902aad38b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f902951e9a0>
                     └ <function get_request_handler.<locals>.app at 0x7f902b33cb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f902f7db5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f902b310160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f902aad38e0>
                 └ <function run_in_threadpool at 0x7f902f9c7af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f902aaffec0>
                 │     │         └ <function run_sync at 0x7f902f9e49d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f902aaffec0>
                 └ <function get_asynclib at 0x7f902f9e4310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f902aaffec0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f902a2858c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d321c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f902d257dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f902d255850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d2556a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f902d24e0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f902d2558b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f902d255850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d2556a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f902d24e0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f902d2558b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f902d24b5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f90294d5970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
                └ <pynamodb.pagination.ResultIterator object at 0x7f90294d5970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f90294d5880>>
           └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f902d2fbd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f90294d5880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f902d2f99d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f902d2f9b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f902d2f7400>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f902ece19d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f9028fbfe50>
                   └ <botocore.client.DynamoDB object at 0x7f9028fbfa00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f9028fbfe50>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f9032d75d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f9032d75c10>
           └ <json.encoder.JSONEncoder object at 0x7f9033d35550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f9032d75ca0>
             └ <json.encoder.JSONEncoder object at 0x7f9033d35550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f902903bb20>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f902951ef40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f9034390430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f90351079d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f9035107040>
    └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f9033d25340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
    │    └ <function subprocess_started at 0x7f9031bec160>
    └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f9033d25430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9031bdd550>
           │       │   └ <uvicorn.server.Server object at 0x7f9033d25430>
           │       └ <function run at 0x7f9032d9d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f903113b040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9031162280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9031162310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f903151adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f903044df40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f903151adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>
          └ <fastapi.applications.FastAPI object at 0x7f903044df40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f902951e850>
                     │    └ <function exception_handler at 0x7f902b3100d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f902f80ae00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f902951e850>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f9033cb8790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f902951ef40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:39:09.861 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f90295008b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f902b341b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f902b31c7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f902b341b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f902f7ec9d0>
          └ <fastapi.routing.APIRoute object at 0x7f902aad38b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f902b33cc10>
          └ <fastapi.routing.APIRoute object at 0x7f902aad38b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f902951e9a0>
                     └ <function get_request_handler.<locals>.app at 0x7f902b33cb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f902f7db5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f902b310160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f902aad38e0>
                 └ <function run_in_threadpool at 0x7f902f9c7af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f902aaffec0>
                 │     │         └ <function run_sync at 0x7f902f9e49d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f902aaffec0>
                 └ <function get_asynclib at 0x7f902f9e4310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f902aaffec0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f902a2858c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d321c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f902d257dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f902d255850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d2556a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f902d24e0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f902d2558b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f902d255850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d2556a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f902d24e0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f902d2558b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f902d24b5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f90294d5970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
                └ <pynamodb.pagination.ResultIterator object at 0x7f90294d5970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f90294d5880>>
           └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f902d2fbd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f90294d5880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f902d2f99d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f902d2f9b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f902d2f7400>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f902ece19d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f9028fbfe50>
                   └ <botocore.client.DynamoDB object at 0x7f9028fbfa00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f9028fbfe50>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f9032d75d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f9032d75c10>
           └ <json.encoder.JSONEncoder object at 0x7f9033d35550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f9032d75ca0>
             └ <json.encoder.JSONEncoder object at 0x7f9033d35550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f902903bb20>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f902951ef40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f9034390430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f90351079d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f9035107040>
    └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f9033d25340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
    │    └ <function subprocess_started at 0x7f9031bec160>
    └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f9033d25430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9031bdd550>
           │       │   └ <uvicorn.server.Server object at 0x7f9033d25430>
           │       └ <function run at 0x7f9032d9d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f903113b040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9031162280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9031162310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f903151adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f903044df40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f903151adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>
          └ <fastapi.applications.FastAPI object at 0x7f903044df40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f902951e850>
                     │    └ <function exception_handler at 0x7f902b3100d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f902f80ae00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f902951e850>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f9033cb8790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f902951ef40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:39:09.892 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f90295008b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f902b341b80>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f902b31c7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f902b341b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f902f7ec9d0>
          └ <fastapi.routing.APIRoute object at 0x7f902aad38b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f9029500790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f902b33cc10>
          └ <fastapi.routing.APIRoute object at 0x7f902aad38b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f902951e9a0>
                     └ <function get_request_handler.<locals>.app at 0x7f902b33cb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f902f7db5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f902b310160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f902aad38e0>
                 └ <function run_in_threadpool at 0x7f902f9c7af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f902aaffec0>
                 │     │         └ <function run_sync at 0x7f902f9e49d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f902aaffec0>
                 └ <function get_asynclib at 0x7f902f9e4310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f902b310160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f902aaffec0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f902a2858c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d321c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f902d257dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f902d255850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d2556a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f902d24e0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f902d2558b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f902d255850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f902d2556a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7f902d24e0a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7f902d2558b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f902d24b5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f90294d5970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
                └ <pynamodb.pagination.ResultIterator object at 0x7f90294d5970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f90294d5880>>
           └ <pynamodb.pagination.PageIterator object at 0x7f90294d5a00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f902d2fbd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f90294d5880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f902d2f99d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f902d2f36a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f902d2f9b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f902d2f7400>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f902ece19d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f9028fbfe50>
                   └ <botocore.client.DynamoDB object at 0x7f9028fbfa00>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f9028fbfe50>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f9032d75d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f9032d75c10>
           └ <json.encoder.JSONEncoder object at 0x7f9033d35550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f9032d75ca0>
             └ <json.encoder.JSONEncoder object at 0x7f9033d35550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f902903bb20>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f902951ef40>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f9034390430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f90351079d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f9035107040>
    └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f9033d25340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
    │    └ <function subprocess_started at 0x7f9031bec160>
    └ <SpawnProcess name='SpawnProcess-1' parent=864536 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f9033d25430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f9031bdd550>
           │       │   └ <uvicorn.server.Server object at 0x7f9033d25430>
           │       └ <function run at 0x7f9032d9d700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f903113b040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f9031162280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f9031162310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f903151adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f903044df40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f903151adf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f902951ef...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f90295...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>
          └ <fastapi.applications.FastAPI object at 0x7f903044df40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f902951e850>
                     │    └ <function exception_handler at 0x7f902b3100d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f902b341be0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f902f80ae00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f902951e850>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f9033cb8790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f902951ef40>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:39:09.923 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42416 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:40:13.171 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:40:13.173 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:40:13.174 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:40:13.275 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:40:13.275 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:40:13.276 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:40:13.277 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:40:13.278 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:40:13.278 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:40:13.281 | INFO     | uvicorn.server:serve:94 - Finished server process [864576]
2022-01-07 19:40:13.282 | INFO     | uvicorn.server:serve:94 - Finished server process [864576]
2022-01-07 19:40:13.283 | INFO     | uvicorn.server:serve:94 - Finished server process [864576]
2022-01-07 19:40:15.738 | INFO     | uvicorn.server:serve:84 - Started server process [865383]
2022-01-07 19:40:15.739 | INFO     | uvicorn.server:serve:84 - Started server process [865383]
2022-01-07 19:40:15.741 | INFO     | uvicorn.server:serve:84 - Started server process [865383]
2022-01-07 19:40:15.741 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:40:15.743 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:40:15.746 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:40:15.747 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:40:15.747 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:40:15.748 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:41:11.471 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:41:11.471 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:41:11.471 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:41:11.572 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:41:11.573 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:41:11.573 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:41:11.573 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:41:11.574 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:41:11.574 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:41:11.574 | INFO     | uvicorn.server:serve:94 - Finished server process [865383]
2022-01-07 19:41:11.574 | INFO     | uvicorn.server:serve:94 - Finished server process [865383]
2022-01-07 19:41:11.575 | INFO     | uvicorn.server:serve:94 - Finished server process [865383]
2022-01-07 19:41:15.198 | INFO     | uvicorn.server:serve:84 - Started server process [865676]
2022-01-07 19:41:15.199 | INFO     | uvicorn.server:serve:84 - Started server process [865676]
2022-01-07 19:41:15.199 | INFO     | uvicorn.server:serve:84 - Started server process [865676]
2022-01-07 19:41:15.199 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:41:15.199 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:41:15.200 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:41:15.200 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:41:15.201 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:41:15.201 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:41:20.699 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:41:20.808 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:41:20.877 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fac499659d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fac49943c40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fac4a19e880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fac49943c40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fac4e66e9d0>
          └ <fastapi.routing.APIRoute object at 0x7fac49954970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fac4a1bec10>
          └ <fastapi.routing.APIRoute object at 0x7fac49954970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fac4997e3d0>
                     └ <function get_request_handler.<locals>.app at 0x7fac4a1beb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fac4e65d5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fac4a191160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fac499549a0>
                 └ <function run_in_threadpool at 0x7fac4e849af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fac49979b40>
                 │     │         └ <function run_sync at 0x7fac4e8669d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fac49979b40>
                 └ <function get_asynclib at 0x7fac4e866310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fac49979b40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fac48bebd40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c1a3c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fac4c0d9dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fac4c0d7850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c0d76a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fac4c0d00a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fac4c0d78b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fac4c0d7850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c0d76a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fac4c0d00a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fac4c0d78b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fac4c0cc5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fac48b95790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7fac48b95790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fac48b95700>>
           └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fac4c13dd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fac48b95700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fac4c13a9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fac4c13ab80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fac4c139270>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fac4db639d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fac3be86f10>
                   └ <botocore.client.DynamoDB object at 0x7fac3be86ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fac3be86f10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7fac51bf7d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7fac51bf7c10>
           └ <json.encoder.JSONEncoder object at 0x7fac52bb7550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7fac51bf7ca0>
             └ <json.encoder.JSONEncoder object at 0x7fac52bb7550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7fac3beba160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fac49969ac0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fac53213430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fac53f899d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fac53f89040>
    └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fac52ba7340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
    │    └ <function subprocess_started at 0x7fac50a6d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fac52ba7430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fac50a5f550>
           │       │   └ <uvicorn.server.Server object at 0x7fac52ba7430>
           │       └ <function run at 0x7fac51c1f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fac4ffbc040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fac4ffe8280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fac4ffe8310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fac5039cdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fac4f2cef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fac5039cdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>
          └ <fastapi.applications.FastAPI object at 0x7fac4f2cef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fac4997e3a0>
                     │    └ <function exception_handler at 0x7fac4a1910d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fac4e68cdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fac4997e3a0>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7fac52b3a790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fac49969ac0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:41:20.911 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fac499659d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fac49943c40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fac4a19e880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fac49943c40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fac4e66e9d0>
          └ <fastapi.routing.APIRoute object at 0x7fac49954970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fac4a1bec10>
          └ <fastapi.routing.APIRoute object at 0x7fac49954970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fac4997e3d0>
                     └ <function get_request_handler.<locals>.app at 0x7fac4a1beb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fac4e65d5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fac4a191160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fac499549a0>
                 └ <function run_in_threadpool at 0x7fac4e849af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fac49979b40>
                 │     │         └ <function run_sync at 0x7fac4e8669d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fac49979b40>
                 └ <function get_asynclib at 0x7fac4e866310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fac49979b40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fac48bebd40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c1a3c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fac4c0d9dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fac4c0d7850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c0d76a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fac4c0d00a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fac4c0d78b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fac4c0d7850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c0d76a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fac4c0d00a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fac4c0d78b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fac4c0cc5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fac48b95790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7fac48b95790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fac48b95700>>
           └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fac4c13dd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fac48b95700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fac4c13a9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fac4c13ab80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fac4c139270>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fac4db639d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fac3be86f10>
                   └ <botocore.client.DynamoDB object at 0x7fac3be86ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fac3be86f10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7fac51bf7d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7fac51bf7c10>
           └ <json.encoder.JSONEncoder object at 0x7fac52bb7550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7fac51bf7ca0>
             └ <json.encoder.JSONEncoder object at 0x7fac52bb7550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7fac3beba160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fac49969ac0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fac53213430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fac53f899d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fac53f89040>
    └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fac52ba7340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
    │    └ <function subprocess_started at 0x7fac50a6d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fac52ba7430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fac50a5f550>
           │       │   └ <uvicorn.server.Server object at 0x7fac52ba7430>
           │       └ <function run at 0x7fac51c1f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fac4ffbc040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fac4ffe8280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fac4ffe8310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fac5039cdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fac4f2cef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fac5039cdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>
          └ <fastapi.applications.FastAPI object at 0x7fac4f2cef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fac4997e3a0>
                     │    └ <function exception_handler at 0x7fac4a1910d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fac4e68cdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fac4997e3a0>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7fac52b3a790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fac49969ac0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:41:20.949 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fac499659d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fac49943c40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fac4a19e880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fac49943c40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fac4e66e9d0>
          └ <fastapi.routing.APIRoute object at 0x7fac49954970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fac49965a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fac4a1bec10>
          └ <fastapi.routing.APIRoute object at 0x7fac49954970>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fac4997e3d0>
                     └ <function get_request_handler.<locals>.app at 0x7fac4a1beb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fac4e65d5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fac4a191160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fac499549a0>
                 └ <function run_in_threadpool at 0x7fac4e849af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fac49979b40>
                 │     │         └ <function run_sync at 0x7fac4e8669d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fac49979b40>
                 └ <function get_asynclib at 0x7fac4e866310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fac4a191160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fac49979b40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fac48bebd40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c1a3c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fac4c0d9dc0>

  File "./app/models/models.py", line 116, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fac4c0d7850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c0d76a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fac4c0d00a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fac4c0d78b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 116, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fac4c0d7850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fac4c0d76a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fac4c0d00a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fac4c0d78b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fac4c0cc5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fac48b95790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7fac48b95790>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fac48b95700>>
           └ <pynamodb.pagination.PageIterator object at 0x7fac48b957f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fac4c13dd30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fac48b95700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fac4c13a9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fac4c1356a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fac4c13ab80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fac4c139270>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fac4db639d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fac3be86f10>
                   └ <botocore.client.DynamoDB object at 0x7fac3be86ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fac3be86f10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7fac51bf7d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7fac51bf7c10>
           └ <json.encoder.JSONEncoder object at 0x7fac52bb7550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7fac51bf7ca0>
             └ <json.encoder.JSONEncoder object at 0x7fac52bb7550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7fac3beba160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fac49969ac0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fac53213430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fac53f899d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fac53f89040>
    └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fac52ba7340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
    │    └ <function subprocess_started at 0x7fac50a6d160>
    └ <SpawnProcess name='SpawnProcess-1' parent=865637 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fac52ba7430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fac50a5f550>
           │       │   └ <uvicorn.server.Server object at 0x7fac52ba7430>
           │       └ <function run at 0x7fac51c1f700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fac4ffbc040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fac4ffe8280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fac4ffe8310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1c0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fac5039cdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fac4f2cef40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fac5039cdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac4997e1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fac499...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>
          └ <fastapi.applications.FastAPI object at 0x7fac4f2cef40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fac4997e3a0>
                     │    └ <function exception_handler at 0x7fac4a1910d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fac49943ca0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fac4e68cdb0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fac4997e3a0>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7fac52b3a790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fac49969ac0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:41:20.993 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42468 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:42:03.388 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:03.389 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:03.389 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:03.490 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:03.490 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:03.491 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:03.492 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:03.494 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:03.495 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:03.496 | INFO     | uvicorn.server:serve:94 - Finished server process [865676]
2022-01-07 19:42:03.497 | INFO     | uvicorn.server:serve:94 - Finished server process [865676]
2022-01-07 19:42:03.498 | INFO     | uvicorn.server:serve:94 - Finished server process [865676]
2022-01-07 19:42:04.870 | INFO     | uvicorn.server:serve:84 - Started server process [865989]
2022-01-07 19:42:04.870 | INFO     | uvicorn.server:serve:84 - Started server process [865989]
2022-01-07 19:42:04.871 | INFO     | uvicorn.server:serve:84 - Started server process [865989]
2022-01-07 19:42:04.871 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:04.871 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:04.872 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:04.873 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:04.874 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:04.875 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:05.377 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:05.378 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:05.378 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:05.479 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:05.479 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:05.480 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:05.481 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:05.481 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:05.482 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:05.483 | INFO     | uvicorn.server:serve:94 - Finished server process [865989]
2022-01-07 19:42:05.483 | INFO     | uvicorn.server:serve:94 - Finished server process [865989]
2022-01-07 19:42:05.484 | INFO     | uvicorn.server:serve:94 - Finished server process [865989]
2022-01-07 19:42:07.157 | INFO     | uvicorn.server:serve:84 - Started server process [866071]
2022-01-07 19:42:07.158 | INFO     | uvicorn.server:serve:84 - Started server process [866071]
2022-01-07 19:42:07.158 | INFO     | uvicorn.server:serve:84 - Started server process [866071]
2022-01-07 19:42:07.159 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:07.159 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:07.161 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:07.163 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:07.164 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:07.165 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:10.096 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:42:10.214 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:42:10.289 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbe7c3ad9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbe7cc0bc70>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbe7cbe68b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbe7cc0bc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbe810b69d0>
          └ <fastapi.routing.APIRoute object at 0x7fbe7c39c9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbe7cc06c10>
          └ <fastapi.routing.APIRoute object at 0x7fbe7c39c9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbe7c3c6400>
                     └ <function get_request_handler.<locals>.app at 0x7fbe7cc06b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbe810a55e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fbe7cbda160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbe7c39c9d0>
                 └ <function run_in_threadpool at 0x7fbe81291af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbe7c3bdc40>
                 │     │         └ <function run_sync at 0x7fbe812ae9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fbe7c3bdc40>
                 └ <function get_asynclib at 0x7fbe812ae310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fbe7c3bdc40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbe7766cdc0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7ebebc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fbe7eb21dc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fbe7eb20850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7eb206a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fbe7eb180a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fbe7eb208b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 117, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fbe7eb20850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7eb206a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fbe7eb180a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fbe7eb208b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fbe7eb155e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fbe775d3550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7fbe775d3550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fbe775d3730>>
           └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fbe7ebc5d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fbe775d3730>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fbe7ebc29d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fbe7ebc2b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fbe7ebc3310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fbe805ab9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fbe768c4f40>
                   └ <botocore.client.DynamoDB object at 0x7fbe768c4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fbe768c4f40>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7fbe8463fd30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7fbe8463fc10>
           └ <json.encoder.JSONEncoder object at 0x7fbe85600550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7fbe8463fca0>
             └ <json.encoder.JSONEncoder object at 0x7fbe85600550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7fbe768f7100>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbe7c3b18e0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbe85c5a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbe869d09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbe869d0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbe855ef340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
    │    └ <function subprocess_started at 0x7fbe834b6160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbe855ef430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbe834a8550>
           │       │   └ <uvicorn.server.Server object at 0x7fbe855ef430>
           │       └ <function run at 0x7fbe84667700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbe82a04040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbe82a30280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbe82a30310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbe82de4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbe81d17f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbe82de4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>
          └ <fastapi.applications.FastAPI object at 0x7fbe81d17f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbe7c3c63d0>
                     │    └ <function exception_handler at 0x7fbe7cbda0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbe810d4db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbe7c3c63d0>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7fbe85582790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbe7c3b18e0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:42:10.325 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbe7c3ad9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbe7cc0bc70>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbe7cbe68b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbe7cc0bc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbe810b69d0>
          └ <fastapi.routing.APIRoute object at 0x7fbe7c39c9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbe7cc06c10>
          └ <fastapi.routing.APIRoute object at 0x7fbe7c39c9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbe7c3c6400>
                     └ <function get_request_handler.<locals>.app at 0x7fbe7cc06b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbe810a55e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fbe7cbda160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbe7c39c9d0>
                 └ <function run_in_threadpool at 0x7fbe81291af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbe7c3bdc40>
                 │     │         └ <function run_sync at 0x7fbe812ae9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fbe7c3bdc40>
                 └ <function get_asynclib at 0x7fbe812ae310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fbe7c3bdc40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbe7766cdc0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7ebebc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fbe7eb21dc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fbe7eb20850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7eb206a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fbe7eb180a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fbe7eb208b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 117, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fbe7eb20850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7eb206a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fbe7eb180a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fbe7eb208b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fbe7eb155e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fbe775d3550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7fbe775d3550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fbe775d3730>>
           └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fbe7ebc5d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fbe775d3730>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fbe7ebc29d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fbe7ebc2b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fbe7ebc3310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fbe805ab9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fbe768c4f40>
                   └ <botocore.client.DynamoDB object at 0x7fbe768c4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fbe768c4f40>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7fbe8463fd30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7fbe8463fc10>
           └ <json.encoder.JSONEncoder object at 0x7fbe85600550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7fbe8463fca0>
             └ <json.encoder.JSONEncoder object at 0x7fbe85600550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7fbe768f7100>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbe7c3b18e0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbe85c5a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbe869d09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbe869d0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbe855ef340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
    │    └ <function subprocess_started at 0x7fbe834b6160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbe855ef430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbe834a8550>
           │       │   └ <uvicorn.server.Server object at 0x7fbe855ef430>
           │       └ <function run at 0x7fbe84667700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbe82a04040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbe82a30280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbe82a30310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbe82de4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbe81d17f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbe82de4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>
          └ <fastapi.applications.FastAPI object at 0x7fbe81d17f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbe7c3c63d0>
                     │    └ <function exception_handler at 0x7fbe7cbda0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbe810d4db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbe7c3c63d0>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7fbe85582790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbe7c3b18e0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:42:10.362 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fbe7c3ad9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbe7cc0bc70>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fbe7cbe68b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fbe7cc0bc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fbe810b69d0>
          └ <fastapi.routing.APIRoute object at 0x7fbe7c39c9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fbe7c3ada60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fbe7cc06c10>
          └ <fastapi.routing.APIRoute object at 0x7fbe7c39c9a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fbe7c3c6400>
                     └ <function get_request_handler.<locals>.app at 0x7fbe7cc06b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fbe810a55e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fbe7cbda160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fbe7c39c9d0>
                 └ <function run_in_threadpool at 0x7fbe81291af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fbe7c3bdc40>
                 │     │         └ <function run_sync at 0x7fbe812ae9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fbe7c3bdc40>
                 └ <function get_asynclib at 0x7fbe812ae310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fbe7cbda160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fbe7c3bdc40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fbe7766cdc0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7ebebc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fbe7eb21dc0>

  File "./app/models/models.py", line 117, in list_images
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │        │       │      │           └ False
                                            │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fbe7eb20850>
                                            │      │          │     │      │        │       └ <class 'app.models.models.Images'>
                                            │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7eb206a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fbe7eb180a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fbe7eb208b0>
                                            └ <class 'app.models.models.Images'>

  File "./app/models/models.py", line 117, in <listcomp>
    images = [image.public_url for image in Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)]
                                            │      │          │     │      │                │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fbe7eb20850>
                                            │      │          │     │      │                └ <class 'app.models.models.Images'>
                                            │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fbe7eb206a0>
                                            │      │          │     └ <class 'app.models.models.Images'>
                                            │      │          └ <classmethod object at 0x7fbe7eb180a0>
                                            │      └ <app.models.models.ImageViewIndex object at 0x7fbe7eb208b0>
                                            └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fbe7eb155e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fbe775d3550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7fbe775d3550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fbe775d3730>>
           └ <pynamodb.pagination.PageIterator object at 0x7fbe775d37f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fbe7ebc5d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fbe775d3730>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fbe7ebc29d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fbe7ebbd6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fbe7ebc2b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fbe7ebc3310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fbe805ab9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fbe768c4f40>
                   └ <botocore.client.DynamoDB object at 0x7fbe768c4af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fbe768c4f40>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7fbe8463fd30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7fbe8463fc10>
           └ <json.encoder.JSONEncoder object at 0x7fbe85600550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7fbe8463fca0>
             └ <json.encoder.JSONEncoder object at 0x7fbe85600550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7fbe768f7100>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fbe7c3b18e0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fbe85c5a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fbe869d09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fbe869d0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fbe855ef340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
    │    └ <function subprocess_started at 0x7fbe834b6160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866034 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fbe855ef430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fbe834a8550>
           │       │   └ <uvicorn.server.Server object at 0x7fbe855ef430>
           │       └ <function run at 0x7fbe84667700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fbe82a04040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fbe82a30280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fbe82a30310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbe82de4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fbe81d17f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fbe82de4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3c61...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fbe7c3...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>
          └ <fastapi.applications.FastAPI object at 0x7fbe81d17f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fbe7c3c63d0>
                     │    └ <function exception_handler at 0x7fbe7cbda0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fbe7cc0bcd0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fbe810d4db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7fbe7c3c63d0>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7fbe85582790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fbe7c3b18e0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:42:10.403 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42522 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:42:35.957 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:35.958 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:35.959 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:36.061 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:36.062 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:36.064 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:36.066 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:36.066 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:36.067 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:36.067 | INFO     | uvicorn.server:serve:94 - Finished server process [866071]
2022-01-07 19:42:36.067 | INFO     | uvicorn.server:serve:94 - Finished server process [866071]
2022-01-07 19:42:36.068 | INFO     | uvicorn.server:serve:94 - Finished server process [866071]
2022-01-07 19:42:37.466 | INFO     | uvicorn.server:serve:84 - Started server process [866292]
2022-01-07 19:42:37.466 | INFO     | uvicorn.server:serve:84 - Started server process [866292]
2022-01-07 19:42:37.467 | INFO     | uvicorn.server:serve:84 - Started server process [866292]
2022-01-07 19:42:37.467 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:37.467 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:37.468 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:37.470 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:37.470 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:37.472 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:38.574 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:38.575 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:38.575 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:38.676 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:38.677 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:38.677 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:38.678 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:38.679 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:38.679 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:38.680 | INFO     | uvicorn.server:serve:94 - Finished server process [866292]
2022-01-07 19:42:38.680 | INFO     | uvicorn.server:serve:94 - Finished server process [866292]
2022-01-07 19:42:38.681 | INFO     | uvicorn.server:serve:94 - Finished server process [866292]
2022-01-07 19:42:40.698 | INFO     | uvicorn.server:serve:84 - Started server process [866415]
2022-01-07 19:42:40.699 | INFO     | uvicorn.server:serve:84 - Started server process [866415]
2022-01-07 19:42:40.701 | INFO     | uvicorn.server:serve:84 - Started server process [866415]
2022-01-07 19:42:40.702 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:40.703 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:40.704 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:40.705 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:40.705 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:40.705 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:41.975 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:42:42.076 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:42:42.141 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2fe687e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2fe70dcc10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2fe70b7850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2fe70dcc10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2feb5879d0>
          └ <fastapi.routing.APIRoute object at 0x7f2fe686d940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2fe70d7c10>
          └ <fastapi.routing.APIRoute object at 0x7f2fe686d940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2fe68973a0>
                     └ <function get_request_handler.<locals>.app at 0x7f2fe70d7b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2feb5765e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f2fe70ab160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2fe686d970>
                 └ <function run_in_threadpool at 0x7f2feb762af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2fe688fe00>
                 │     │         └ <function run_sync at 0x7f2feb77f9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f2fe688fe00>
                 └ <function get_asynclib at 0x7f2feb77f310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f2fe688fe00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2fe5b124c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2fe90bdc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f2fe8ff2dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)))
               │      │          │     │      │        │       │      │           └ False
               │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2fe8ff1850>
               │      │          │     │      │        │       └ <class 'app.models.models.Images'>
               │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2fe8ff16a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f2fe8fe90a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f2fe8ff18b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f2fe8fe65e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f2fe5aaf760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f2fe5aaf760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f2fe5aaf6d0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f2fe9096d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f2fe5aaf6d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f2fe90949d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f2fe9094b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f2fe9092400>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f2feaa7c9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f2fe4da2f10>
                   └ <botocore.client.DynamoDB object at 0x7f2fe4da2ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f2fe4da2f10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f2feeb10d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f2feeb10c10>
           └ <json.encoder.JSONEncoder object at 0x7f2fefad1550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f2feeb10ca0>
             └ <json.encoder.JSONEncoder object at 0x7f2fefad1550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f2fe4dd4160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2fe70dca30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2ff012c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2ff0ea19d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2ff0ea1040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2fefac0340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
    │    └ <function subprocess_started at 0x7f2fed987160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2fefac0430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2fed979550>
           │       │   └ <uvicorn.server.Server object at 0x7f2fefac0430>
           │       └ <function run at 0x7f2feeb38700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2feced6040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2fecf01280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2fecf01310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2fed2b5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2fec1e8f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2fed2b5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>
          └ <fastapi.applications.FastAPI object at 0x7f2fec1e8f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2fe6897370>
                     │    └ <function exception_handler at 0x7f2fe70ab0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2feb5a5e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2fe6897370>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f2fefa53790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2fe70dca30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:42:42.174 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2fe687e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2fe70dcc10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2fe70b7850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2fe70dcc10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2feb5879d0>
          └ <fastapi.routing.APIRoute object at 0x7f2fe686d940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2fe70d7c10>
          └ <fastapi.routing.APIRoute object at 0x7f2fe686d940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2fe68973a0>
                     └ <function get_request_handler.<locals>.app at 0x7f2fe70d7b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2feb5765e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f2fe70ab160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2fe686d970>
                 └ <function run_in_threadpool at 0x7f2feb762af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2fe688fe00>
                 │     │         └ <function run_sync at 0x7f2feb77f9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f2fe688fe00>
                 └ <function get_asynclib at 0x7f2feb77f310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f2fe688fe00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2fe5b124c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2fe90bdc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f2fe8ff2dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)))
               │      │          │     │      │        │       │      │           └ False
               │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2fe8ff1850>
               │      │          │     │      │        │       └ <class 'app.models.models.Images'>
               │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2fe8ff16a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f2fe8fe90a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f2fe8ff18b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f2fe8fe65e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f2fe5aaf760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f2fe5aaf760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f2fe5aaf6d0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f2fe9096d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f2fe5aaf6d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f2fe90949d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f2fe9094b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f2fe9092400>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f2feaa7c9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f2fe4da2f10>
                   └ <botocore.client.DynamoDB object at 0x7f2fe4da2ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f2fe4da2f10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f2feeb10d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f2feeb10c10>
           └ <json.encoder.JSONEncoder object at 0x7f2fefad1550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f2feeb10ca0>
             └ <json.encoder.JSONEncoder object at 0x7f2fefad1550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f2fe4dd4160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2fe70dca30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2ff012c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2ff0ea19d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2ff0ea1040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2fefac0340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
    │    └ <function subprocess_started at 0x7f2fed987160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2fefac0430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2fed979550>
           │       │   └ <uvicorn.server.Server object at 0x7f2fefac0430>
           │       └ <function run at 0x7f2feeb38700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2feced6040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2fecf01280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2fecf01310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2fed2b5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2fec1e8f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2fed2b5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>
          └ <fastapi.applications.FastAPI object at 0x7f2fec1e8f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2fe6897370>
                     │    └ <function exception_handler at 0x7f2fe70ab0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2feb5a5e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2fe6897370>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f2fefa53790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2fe70dca30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:42:42.201 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f2fe687e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2fe70dcc10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f2fe70b7850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f2fe70dcc10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f2feb5879d0>
          └ <fastapi.routing.APIRoute object at 0x7f2fe686d940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f2fe687ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f2fe70d7c10>
          └ <fastapi.routing.APIRoute object at 0x7f2fe686d940>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f2fe68973a0>
                     └ <function get_request_handler.<locals>.app at 0x7f2fe70d7b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f2feb5765e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f2fe70ab160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f2fe686d970>
                 └ <function run_in_threadpool at 0x7f2feb762af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f2fe688fe00>
                 │     │         └ <function run_sync at 0x7f2feb77f9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f2fe688fe00>
                 └ <function get_asynclib at 0x7f2feb77f310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f2fe70ab160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f2fe688fe00>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f2fe5b124c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2fe90bdc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f2fe8ff2dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)))
               │      │          │     │      │        │       │      │           └ False
               │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f2fe8ff1850>
               │      │          │     │      │        │       └ <class 'app.models.models.Images'>
               │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f2fe8ff16a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f2fe8fe90a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f2fe8ff18b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f2fe8fe65e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f2fe5aaf760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f2fe5aaf760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f2fe5aaf6d0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f2fe5aaf7c0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f2fe9096d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f2fe5aaf6d0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f2fe90949d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f2fe908e6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f2fe9094b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f2fe9092400>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f2feaa7c9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f2fe4da2f10>
                   └ <botocore.client.DynamoDB object at 0x7f2fe4da2ac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f2fe4da2f10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f2feeb10d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f2feeb10c10>
           └ <json.encoder.JSONEncoder object at 0x7f2fefad1550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f2feeb10ca0>
             └ <json.encoder.JSONEncoder object at 0x7f2fefad1550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f2fe4dd4160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f2fe70dca30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f2ff012c430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f2ff0ea19d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f2ff0ea1040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f2fefac0340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
    │    └ <function subprocess_started at 0x7f2fed987160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866378 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f2fefac0430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f2fed979550>
           │       │   └ <uvicorn.server.Server object at 0x7f2fefac0430>
           │       └ <function run at 0x7f2feeb38700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f2feced6040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f2fecf01280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f2fecf01310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe6897190>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2fed2b5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f2fec1e8f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f2fed2b5df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68971...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f2fe68...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>
          └ <fastapi.applications.FastAPI object at 0x7f2fec1e8f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f2fe6897370>
                     │    └ <function exception_handler at 0x7f2fe70ab0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f2fe70dcc70>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f2feb5a5e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f2fe6897370>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f2fefa53790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f2fe70dca30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:42:42.243 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42578 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:42:54.571 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:54.572 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:54.572 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:42:54.673 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:54.673 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:54.674 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:42:54.674 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:54.675 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:54.675 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:42:54.675 | INFO     | uvicorn.server:serve:94 - Finished server process [866415]
2022-01-07 19:42:54.675 | INFO     | uvicorn.server:serve:94 - Finished server process [866415]
2022-01-07 19:42:54.676 | INFO     | uvicorn.server:serve:94 - Finished server process [866415]
2022-01-07 19:42:58.762 | INFO     | uvicorn.server:serve:84 - Started server process [866602]
2022-01-07 19:42:58.763 | INFO     | uvicorn.server:serve:84 - Started server process [866602]
2022-01-07 19:42:58.764 | INFO     | uvicorn.server:serve:84 - Started server process [866602]
2022-01-07 19:42:58.767 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:58.768 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:58.769 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:42:58.771 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:58.772 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:42:58.772 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:43:00.531 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:43:00.679 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:43:00.762 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f89c72119d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f89c7a6fbb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f89c7a4a7f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f89c7a6fbb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f89cbf1a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f89c72018e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f89c7a6ac10>
          └ <fastapi.routing.APIRoute object at 0x7f89c72018e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f89c722a340>
                     └ <function get_request_handler.<locals>.app at 0x7f89c7a6ab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f89cbf095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f89c7a3e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f89c7201910>
                 └ <function run_in_threadpool at 0x7f89cc0f5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f89c7222d80>
                 │     │         └ <function run_sync at 0x7f89cc1129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f89c7222d80>
                 └ <function get_asynclib at 0x7f89cc112310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f89c7222d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f89c64a6500>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f89c9a4fc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f89c9985dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)))
               │      │          │     │      │        │       │      │           └ False
               │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f89c9983850>
               │      │          │     │      │        │       └ <class 'app.models.models.Images'>
               │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f89c99836a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f89c997c0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f89c99838b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f89c99795e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f89c6443700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
                └ <pynamodb.pagination.ResultIterator object at 0x7f89c6443700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f89c6443670>>
           └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f89c99e9d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f89c6443670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f89c99e69d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f89c99e6b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f89c99e7310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f89cb40f9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f89c5734eb0>
                   └ <botocore.client.DynamoDB object at 0x7f89c5734a60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f89c5734eb0>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f89cf4a3d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f89cf4a3c10>
           └ <json.encoder.JSONEncoder object at 0x7f89d0463550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f89cf4a3ca0>
             └ <json.encoder.JSONEncoder object at 0x7f89d0463550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f89c5767160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f89c7215c10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f89d0abe430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f89d18359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f89d1835040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f89d0453340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
    │    └ <function subprocess_started at 0x7f89ce31a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f89d0453430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f89ce30c550>
           │       │   └ <uvicorn.server.Server object at 0x7f89d0453430>
           │       └ <function run at 0x7f89cf4cb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f89cd868040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f89cd894280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f89cd894310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f89cdc48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f89ccb7bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f89cdc48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>
          └ <fastapi.applications.FastAPI object at 0x7f89ccb7bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f89c722a310>
                     │    └ <function exception_handler at 0x7f89c7a3e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f89cbf38e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f89c722a310>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f89d03e6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f89c7215c10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:43:00.810 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f89c72119d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f89c7a6fbb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f89c7a4a7f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f89c7a6fbb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f89cbf1a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f89c72018e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f89c7a6ac10>
          └ <fastapi.routing.APIRoute object at 0x7f89c72018e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f89c722a340>
                     └ <function get_request_handler.<locals>.app at 0x7f89c7a6ab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f89cbf095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f89c7a3e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f89c7201910>
                 └ <function run_in_threadpool at 0x7f89cc0f5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f89c7222d80>
                 │     │         └ <function run_sync at 0x7f89cc1129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f89c7222d80>
                 └ <function get_asynclib at 0x7f89cc112310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f89c7222d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f89c64a6500>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f89c9a4fc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f89c9985dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)))
               │      │          │     │      │        │       │      │           └ False
               │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f89c9983850>
               │      │          │     │      │        │       └ <class 'app.models.models.Images'>
               │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f89c99836a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f89c997c0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f89c99838b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f89c99795e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f89c6443700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
                └ <pynamodb.pagination.ResultIterator object at 0x7f89c6443700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f89c6443670>>
           └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f89c99e9d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f89c6443670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f89c99e69d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f89c99e6b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f89c99e7310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f89cb40f9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f89c5734eb0>
                   └ <botocore.client.DynamoDB object at 0x7f89c5734a60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f89c5734eb0>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f89cf4a3d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f89cf4a3c10>
           └ <json.encoder.JSONEncoder object at 0x7f89d0463550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f89cf4a3ca0>
             └ <json.encoder.JSONEncoder object at 0x7f89d0463550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f89c5767160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f89c7215c10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f89d0abe430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f89d18359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f89d1835040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f89d0453340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
    │    └ <function subprocess_started at 0x7f89ce31a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f89d0453430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f89ce30c550>
           │       │   └ <uvicorn.server.Server object at 0x7f89d0453430>
           │       └ <function run at 0x7f89cf4cb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f89cd868040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f89cd894280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f89cd894310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f89cdc48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f89ccb7bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f89cdc48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>
          └ <fastapi.applications.FastAPI object at 0x7f89ccb7bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f89c722a310>
                     │    └ <function exception_handler at 0x7f89c7a3e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f89cbf38e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f89c722a310>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f89d03e6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f89c7215c10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:43:00.848 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f89c72119d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f89c7a6fbb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f89c7a4a7f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f89c7a6fbb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f89cbf1a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f89c72018e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f89c7211a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f89c7a6ac10>
          └ <fastapi.routing.APIRoute object at 0x7f89c72018e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f89c722a340>
                     └ <function get_request_handler.<locals>.app at 0x7f89c7a6ab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f89cbf095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f89c7a3e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f89c7201910>
                 └ <function run_in_threadpool at 0x7f89cc0f5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f89c7222d80>
                 │     │         └ <function run_sync at 0x7f89cc1129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f89c7222d80>
                 └ <function get_asynclib at 0x7f89cc112310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f89c7a3e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f89c7222d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f89c64a6500>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f89c9a4fc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f89c9985dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id==user_id,Images.is_deleted==is_deleted)))
               │      │          │     │      │        │       │      │           └ False
               │      │          │     │      │        │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f89c9983850>
               │      │          │     │      │        │       └ <class 'app.models.models.Images'>
               │      │          │     │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f89c99836a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f89c997c0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f89c99838b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f89c99795e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f89c6443700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
                └ <pynamodb.pagination.ResultIterator object at 0x7f89c6443700>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f89c6443670>>
           └ <pynamodb.pagination.PageIterator object at 0x7f89c6443760>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f89c99e9d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f89c6443670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f89c99e69d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f89c99e16a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f89c99e6b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f89c99e7310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f89cb40f9d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f89c5734eb0>
                   └ <botocore.client.DynamoDB object at 0x7f89c5734a60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f89c5734eb0>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f89cf4a3d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f89cf4a3c10>
           └ <json.encoder.JSONEncoder object at 0x7f89d0463550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f89cf4a3ca0>
             └ <json.encoder.JSONEncoder object at 0x7f89d0463550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f89c5767160>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f89c7215c10>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f89d0abe430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f89d18359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f89d1835040>
    └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f89d0453340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
    │    └ <function subprocess_started at 0x7f89ce31a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=866563 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f89d0453430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f89ce30c550>
           │       │   └ <uvicorn.server.Server object at 0x7f89d0453430>
           │       └ <function run at 0x7f89cf4cb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f89cd868040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f89cd894280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f89cd894310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a130>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f89cdc48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f89ccb7bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f89cdc48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c722a1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f89c72...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>
          └ <fastapi.applications.FastAPI object at 0x7f89ccb7bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f89c722a310>
                     │    └ <function exception_handler at 0x7f89c7a3e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f89c7a6fc10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f89cbf38e00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f89c722a310>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f89d03e6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f89c7215c10>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:43:00.882 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42616 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:44:11.846 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:11.847 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:11.847 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:11.950 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:11.951 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:11.952 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:11.953 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:11.954 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:11.955 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:11.955 | INFO     | uvicorn.server:serve:94 - Finished server process [866602]
2022-01-07 19:44:11.956 | INFO     | uvicorn.server:serve:94 - Finished server process [866602]
2022-01-07 19:44:11.957 | INFO     | uvicorn.server:serve:94 - Finished server process [866602]
2022-01-07 19:44:14.896 | INFO     | uvicorn.server:serve:84 - Started server process [867028]
2022-01-07 19:44:14.897 | INFO     | uvicorn.server:serve:84 - Started server process [867028]
2022-01-07 19:44:14.897 | INFO     | uvicorn.server:serve:84 - Started server process [867028]
2022-01-07 19:44:14.897 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:44:14.898 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:44:14.898 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:44:14.898 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:44:14.899 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:44:14.899 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:44:18.006 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:18.007 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:18.007 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:18.108 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:18.108 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:18.109 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:18.110 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:18.110 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:18.111 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:18.111 | INFO     | uvicorn.server:serve:94 - Finished server process [867028]
2022-01-07 19:44:18.112 | INFO     | uvicorn.server:serve:94 - Finished server process [867028]
2022-01-07 19:44:18.112 | INFO     | uvicorn.server:serve:94 - Finished server process [867028]
2022-01-07 19:44:21.254 | INFO     | uvicorn.server:serve:84 - Started server process [867146]
2022-01-07 19:44:21.255 | INFO     | uvicorn.server:serve:84 - Started server process [867146]
2022-01-07 19:44:21.255 | INFO     | uvicorn.server:serve:84 - Started server process [867146]
2022-01-07 19:44:21.255 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:44:21.256 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:44:21.256 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:44:21.256 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:44:21.257 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:44:21.257 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:44:23.535 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:44:23.687 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:44:23.775 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f1bff8c29d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1bff8a0af0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f1c000fb730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1bff8a0af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f1c045cb9d0>
          └ <fastapi.routing.APIRoute object at 0x7f1bff8b4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f1c0011bc10>
          └ <fastapi.routing.APIRoute object at 0x7f1bff8b4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1bff8db280>
                     └ <function get_request_handler.<locals>.app at 0x7f1c0011bb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f1c045ba5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f1c000ef160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f1bff8b4850>
                 └ <function run_in_threadpool at 0x7f1c047a6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f1bff8c9480>
                 │     │         └ <function run_sync at 0x7f1c047c39d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f1bff8c9480>
                 └ <function get_asynclib at 0x7f1c047c3310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f1bff8c9480>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f1bfeb59240>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1c02100c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f1c02036dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id.__eq__(user_id),Images.is_deleted.__eq__(is_deleted))))
               │      │          │     │      │       │      │        │      │          │      └ False
               │      │          │     │      │       │      │        │      │          └ <function Attribute.__eq__ at 0x7f1c020b0040>
               │      │          │     │      │       │      │        │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f1c02035850>
               │      │          │     │      │       │      │        └ <class 'app.models.models.Images'>
               │      │          │     │      │       │      └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      │       └ <function Attribute.__eq__ at 0x7f1c020b0040>
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1c020356a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f1c0202d0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f1c020358b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f1c0202a5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f1bfeaf3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f1bfeaf3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f1bfeaf35b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f1c020dad30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f1bfeaf35b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f1c020d79d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f1c020d7b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f1c020d8310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f1c03ac09d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f1bfdde4df0>
                   └ <botocore.client.DynamoDB object at 0x7f1bfdde49a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f1bfdde4df0>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f1c07b54d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f1c07b54c10>
           └ <json.encoder.JSONEncoder object at 0x7f1c08b15550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f1c07b54ca0>
             └ <json.encoder.JSONEncoder object at 0x7f1c08b15550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f1bfde17100>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1bff8c8730>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1c09170430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f1c09ee59d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f1c09ee5040>
    └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1c08b04340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
    │    └ <function subprocess_started at 0x7f1c069cb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1c08b04430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1c069bc550>
           │       │   └ <uvicorn.server.Server object at 0x7f1c08b04430>
           │       └ <function run at 0x7f1c07b7c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f1c05f19040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1c05f45280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1c05f45310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1c062f9df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f1c0522cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1c062f9df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>
          └ <fastapi.applications.FastAPI object at 0x7f1c0522cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1bff8db250>
                     │    └ <function exception_handler at 0x7f1c000ef0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f1c045e9e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1bff8db250>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f1c08a97790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1bff8c8730>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:44:23.822 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f1bff8c29d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1bff8a0af0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f1c000fb730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1bff8a0af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f1c045cb9d0>
          └ <fastapi.routing.APIRoute object at 0x7f1bff8b4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f1c0011bc10>
          └ <fastapi.routing.APIRoute object at 0x7f1bff8b4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1bff8db280>
                     └ <function get_request_handler.<locals>.app at 0x7f1c0011bb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f1c045ba5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f1c000ef160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f1bff8b4850>
                 └ <function run_in_threadpool at 0x7f1c047a6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f1bff8c9480>
                 │     │         └ <function run_sync at 0x7f1c047c39d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f1bff8c9480>
                 └ <function get_asynclib at 0x7f1c047c3310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f1bff8c9480>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f1bfeb59240>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1c02100c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f1c02036dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id.__eq__(user_id),Images.is_deleted.__eq__(is_deleted))))
               │      │          │     │      │       │      │        │      │          │      └ False
               │      │          │     │      │       │      │        │      │          └ <function Attribute.__eq__ at 0x7f1c020b0040>
               │      │          │     │      │       │      │        │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f1c02035850>
               │      │          │     │      │       │      │        └ <class 'app.models.models.Images'>
               │      │          │     │      │       │      └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      │       └ <function Attribute.__eq__ at 0x7f1c020b0040>
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1c020356a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f1c0202d0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f1c020358b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f1c0202a5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f1bfeaf3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f1bfeaf3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f1bfeaf35b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f1c020dad30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f1bfeaf35b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f1c020d79d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f1c020d7b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f1c020d8310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f1c03ac09d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f1bfdde4df0>
                   └ <botocore.client.DynamoDB object at 0x7f1bfdde49a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f1bfdde4df0>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f1c07b54d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f1c07b54c10>
           └ <json.encoder.JSONEncoder object at 0x7f1c08b15550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f1c07b54ca0>
             └ <json.encoder.JSONEncoder object at 0x7f1c08b15550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f1bfde17100>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1bff8c8730>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1c09170430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f1c09ee59d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f1c09ee5040>
    └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1c08b04340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
    │    └ <function subprocess_started at 0x7f1c069cb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1c08b04430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1c069bc550>
           │       │   └ <uvicorn.server.Server object at 0x7f1c08b04430>
           │       └ <function run at 0x7f1c07b7c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f1c05f19040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1c05f45280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1c05f45310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1c062f9df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f1c0522cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1c062f9df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>
          └ <fastapi.applications.FastAPI object at 0x7f1c0522cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1bff8db250>
                     │    └ <function exception_handler at 0x7f1c000ef0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f1c045e9e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1bff8db250>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f1c08a97790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1bff8c8730>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:44:23.857 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f1bff8c29d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1bff8a0af0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f1c000fb730>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f1bff8a0af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f1c045cb9d0>
          └ <fastapi.routing.APIRoute object at 0x7f1bff8b4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f1bff8c2a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f1c0011bc10>
          └ <fastapi.routing.APIRoute object at 0x7f1bff8b4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f1bff8db280>
                     └ <function get_request_handler.<locals>.app at 0x7f1c0011bb80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f1c045ba5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f1c000ef160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f1bff8b4850>
                 └ <function run_in_threadpool at 0x7f1c047a6af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f1bff8c9480>
                 │     │         └ <function run_sync at 0x7f1c047c39d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f1bff8c9480>
                 └ <function get_asynclib at 0x7f1c047c3310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type Comparison is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f1c000ef160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f1bff8c9480>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f1bfeb59240>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1c02100c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f1c02036dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(Images.user_id.__eq__(user_id),Images.is_deleted.__eq__(is_deleted))))
               │      │          │     │      │       │      │        │      │          │      └ False
               │      │          │     │      │       │      │        │      │          └ <function Attribute.__eq__ at 0x7f1c020b0040>
               │      │          │     │      │       │      │        │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f1c02035850>
               │      │          │     │      │       │      │        └ <class 'app.models.models.Images'>
               │      │          │     │      │       │      └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │     │      │       └ <function Attribute.__eq__ at 0x7f1c020b0040>
               │      │          │     │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7f1c020356a0>
               │      │          │     └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7f1c0202d0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f1c020358b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f1c0202a5e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f1bfeaf3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f1bfeaf3640>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    │           │    └ (user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'},)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f1bfeaf35b0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f1bfeaf36a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f1c020dad30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f1bfeaf35b0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f1c020d79d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f1c020d26a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f1c020d7b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7f1c020d8310>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7f1c03ac09d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7f1bfdde4df0>
                   └ <botocore.client.DynamoDB object at 0x7f1bfdde49a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7f1bfdde4df0>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
    │                    │    └ <function dumps at 0x7f1c07b54d30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │                └ <function JSONEncoder.encode at 0x7f1c07b54c10>
           └ <json.encoder.JSONEncoder object at 0x7f1c08b15550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
             │    └ <function JSONEncoder.iterencode at 0x7f1c07b54ca0>
             └ <json.encoder.JSONEncoder object at 0x7f1c08b15550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           └ <_json.Encoder object at 0x7f1bfde17100>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type Comparison is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f1bff8c8730>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f1c09170430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f1c09ee59d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f1c09ee5040>
    └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f1c08b04340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
    │    └ <function subprocess_started at 0x7f1c069cb160>
    └ <SpawnProcess name='SpawnProcess-1' parent=867109 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f1c08b04430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f1c069bc550>
           │       │   └ <uvicorn.server.Server object at 0x7f1c08b04430>
           │       └ <function run at 0x7f1c07b7c700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f1c05f19040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f1c05f45280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f1c05f45310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db070>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1c062f9df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f1c0522cf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f1c062f9df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8db0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f1bff8...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>
          └ <fastapi.applications.FastAPI object at 0x7f1c0522cf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f1bff8db250>
                     │    └ <function exception_handler at 0x7f1c000ef0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f1bff8a0b50>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f1c045e9e50>
    │      │         │                  └ <starlette.requests.Request object at 0x7f1bff8db250>
    │      │         └ TypeError('Object of type Comparison is not JSON serializable')
    │      └ <function Logger.exception at 0x7f1c08a97790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f1bff8c8730>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:44:23.896 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42674 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:44:56.871 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:56.872 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:56.872 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:44:56.973 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:56.974 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:56.974 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:44:56.975 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:56.975 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:56.977 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:44:56.978 | INFO     | uvicorn.server:serve:94 - Finished server process [867146]
2022-01-07 19:44:56.978 | INFO     | uvicorn.server:serve:94 - Finished server process [867146]
2022-01-07 19:44:56.979 | INFO     | uvicorn.server:serve:94 - Finished server process [867146]
2022-01-07 19:49:19.868 | INFO     | uvicorn.server:serve:84 - Started server process [868683]
2022-01-07 19:49:19.869 | INFO     | uvicorn.server:serve:84 - Started server process [868683]
2022-01-07 19:49:19.870 | INFO     | uvicorn.server:serve:84 - Started server process [868683]
2022-01-07 19:49:19.871 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:49:19.872 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:49:19.872 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:49:19.873 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:49:19.874 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:49:19.875 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:49:34.005 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42848 - "GET / HTTP/1.1" 404
2022-01-07 19:49:38.637 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42848 - "GET /docs HTTP/1.1" 200
2022-01-07 19:49:39.499 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42848 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 19:49:47.730 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:49:48.123 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42850 - "POST /token HTTP/1.1" 200
2022-01-07 19:49:55.748 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:49:55.819 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fedf82258b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fedf97e6bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fedfa0417f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fedf97e6bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fedfe5119d0>
          └ <fastapi.routing.APIRoute object at 0x7fedf97f78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fedfa061c10>
          └ <fastapi.routing.APIRoute object at 0x7fedf97f78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fedf8244ca0>
                     └ <function get_request_handler.<locals>.app at 0x7fedfa061b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fedfe5005e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fedfa035160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fedf97f7910>
                 └ <function run_in_threadpool at 0x7fedfe6ecaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fedf8fbd900>
                 │     │         └ <function run_sync at 0x7fedfe7099d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fedf8fbd900>
                 └ <function get_asynclib at 0x7fedfe709310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type And is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fedf8fbd900>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fedf8fbd940>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fedfc047c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fedfbf7cdc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query((Images.user_id==user_id)&(Images.is_deleted==is_deleted))))
               │      │          │      │      │        │         │      │           └ False
               │      │          │      │      │        │         │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fedfbf7b850>
               │      │          │      │      │        │         └ <class 'app.models.models.Images'>
               │      │          │      │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │      │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fedfbf7b6a0>
               │      │          │      └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7fedfbf730a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7fedfbf7b8b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fedfbf705e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fedf81f9a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
                └ <pynamodb.pagination.ResultIterator object at 0x7fedf81f9a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_key': None, 'consistent_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    │           │    └ ((user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'} AND is_deleted = {'BOOL': False}),)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fedf81f9910>>
           └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fedfc020d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fedf81f9910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fedfc01e9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fedfc01eb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fedfc01c2c0>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fedfda069d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fedebd3ef10>
                   └ <botocore.client.DynamoDB object at 0x7fedebd3eac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fedebd3ef10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
    │                    │    └ <function dumps at 0x7fee01a9ad30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │                └ <function JSONEncoder.encode at 0x7fee01a9ac10>
           └ <json.encoder.JSONEncoder object at 0x7fee02a5a550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
             │    └ <function JSONEncoder.iterencode at 0x7fee01a9aca0>
             └ <json.encoder.JSONEncoder object at 0x7fee02a5a550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           └ <_json.Encoder object at 0x7fedebd3abe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type And is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fedf8244fd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fee030b5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fee03e2b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fee03e2b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fee02a4a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
    │    └ <function subprocess_started at 0x7fee00911160>
    └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fee02a4a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fee00902550>
           │       │   └ <uvicorn.server.Server object at 0x7fee02a4a430>
           │       └ <function run at 0x7fee01ac2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fedffe60040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fedffe8b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fedffe8b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fee0023fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fedff171f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fee0023fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>
          └ <fastapi.applications.FastAPI object at 0x7fedff171f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fedf82449d0>
                     │    └ <function exception_handler at 0x7fedfa0350d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fedfe530d10>
    │      │         │                  └ <starlette.requests.Request object at 0x7fedf82449d0>
    │      │         └ TypeError('Object of type And is not JSON serializable')
    │      └ <function Logger.exception at 0x7fee029dd790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fedf8244fd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:49:55.853 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fedf82258b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fedf97e6bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fedfa0417f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fedf97e6bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fedfe5119d0>
          └ <fastapi.routing.APIRoute object at 0x7fedf97f78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fedfa061c10>
          └ <fastapi.routing.APIRoute object at 0x7fedf97f78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fedf8244ca0>
                     └ <function get_request_handler.<locals>.app at 0x7fedfa061b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fedfe5005e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fedfa035160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fedf97f7910>
                 └ <function run_in_threadpool at 0x7fedfe6ecaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fedf8fbd900>
                 │     │         └ <function run_sync at 0x7fedfe7099d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fedf8fbd900>
                 └ <function get_asynclib at 0x7fedfe709310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type And is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fedf8fbd900>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fedf8fbd940>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fedfc047c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fedfbf7cdc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query((Images.user_id==user_id)&(Images.is_deleted==is_deleted))))
               │      │          │      │      │        │         │      │           └ False
               │      │          │      │      │        │         │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fedfbf7b850>
               │      │          │      │      │        │         └ <class 'app.models.models.Images'>
               │      │          │      │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │      │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fedfbf7b6a0>
               │      │          │      └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7fedfbf730a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7fedfbf7b8b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fedfbf705e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fedf81f9a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
                └ <pynamodb.pagination.ResultIterator object at 0x7fedf81f9a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_key': None, 'consistent_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    │           │    └ ((user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'} AND is_deleted = {'BOOL': False}),)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fedf81f9910>>
           └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fedfc020d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fedf81f9910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fedfc01e9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fedfc01eb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fedfc01c2c0>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fedfda069d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fedebd3ef10>
                   └ <botocore.client.DynamoDB object at 0x7fedebd3eac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fedebd3ef10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
    │                    │    └ <function dumps at 0x7fee01a9ad30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │                └ <function JSONEncoder.encode at 0x7fee01a9ac10>
           └ <json.encoder.JSONEncoder object at 0x7fee02a5a550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
             │    └ <function JSONEncoder.iterencode at 0x7fee01a9aca0>
             └ <json.encoder.JSONEncoder object at 0x7fee02a5a550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           └ <_json.Encoder object at 0x7fedebd3abe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type And is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fedf8244fd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fee030b5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fee03e2b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fee03e2b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fee02a4a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
    │    └ <function subprocess_started at 0x7fee00911160>
    └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fee02a4a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fee00902550>
           │       │   └ <uvicorn.server.Server object at 0x7fee02a4a430>
           │       └ <function run at 0x7fee01ac2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fedffe60040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fedffe8b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fedffe8b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fee0023fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fedff171f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fee0023fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>
          └ <fastapi.applications.FastAPI object at 0x7fedff171f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fedf82449d0>
                     │    └ <function exception_handler at 0x7fedfa0350d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fedfe530d10>
    │      │         │                  └ <starlette.requests.Request object at 0x7fedf82449d0>
    │      │         └ TypeError('Object of type And is not JSON serializable')
    │      └ <function Logger.exception at 0x7fee029dd790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fedf8244fd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:49:55.882 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fedf82258b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fedf97e6bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fedfa0417f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fedf97e6bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fedfe5119d0>
          └ <fastapi.routing.APIRoute object at 0x7fedf97f78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fedf8225790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fedfa061c10>
          └ <fastapi.routing.APIRoute object at 0x7fedf97f78e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fedf8244ca0>
                     └ <function get_request_handler.<locals>.app at 0x7fedfa061b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fedfe5005e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7fedfa035160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fedf97f7910>
                 └ <function run_in_threadpool at 0x7fedfe6ecaf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7fedf8fbd900>
                 │     │         └ <function run_sync at 0x7fedfe7099d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7fedf8fbd900>
                 └ <function get_asynclib at 0x7fedfe709310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError('Object of type And is not JSON serializable')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7fedfa035160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7fedf8fbd900>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fedf8fbd940>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7fedfc047c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7fedfbf7cdc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query((Images.user_id==user_id)&(Images.is_deleted==is_deleted))))
               │      │          │      │      │        │         │      │           └ False
               │      │          │      │      │        │         │      └ <pynamodb.attributes.BooleanAttribute object at 0x7fedfbf7b850>
               │      │          │      │      │        │         └ <class 'app.models.models.Images'>
               │      │          │      │      │        └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          │      │      └ <pynamodb.attributes.UnicodeAttribute object at 0x7fedfbf7b6a0>
               │      │          │      └ <class 'app.models.models.Images'>
               │      │          └ <classmethod object at 0x7fedfbf730a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7fedfbf7b8b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7fedfbf705e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7fedf81f9a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
                └ <pynamodb.pagination.ResultIterator object at 0x7fedf81f9a30>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': None, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_key': None, 'consistent_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    │           │    └ ((user_id = {'S': '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'} AND is_deleted = {'BOOL': False}),)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7fedf81f9910>>
           └ <pynamodb.pagination.PageIterator object at 0x7fedf81f9a90>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7fedfc020d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7fedf81f9910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7fedfc01e9d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7fedfc0186a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7fedfc01eb80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 358, in _make_api_call
    request_dict = self.client._convert_to_request_dict(
                   │    └ <property object at 0x7fedfc01c2c0>
                   └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/client.py", line 739, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
                   │    │           └ <function JSONSerializer.serialize_to_request at 0x7fedfda069d0>
                   │    └ <botocore.serialize.JSONSerializer object at 0x7fedebd3ef10>
                   └ <botocore.client.DynamoDB object at 0x7fedebd3eac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/botocore/serialize.py", line 351, in serialize_to_request
    serialized['body'] = json.dumps(body).encode(self.DEFAULT_ENCODING)
    │                    │    │     │            │    └ 'utf-8'
    │                    │    │     │            └ <botocore.serialize.JSONSerializer object at 0x7fedebd3ef10>
    │                    │    │     └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
    │                    │    └ <function dumps at 0x7fee01a9ad30>
    │                    └ <module 'json' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py'>
    └ {'url_path': '/', 'query_string': '', 'method': 'POST', 'headers': {'X-Amz-Target': 'DynamoDB_20120810.Query', 'Content-Type'...
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           │                └ <function JSONEncoder.encode at 0x7fee01a9ac10>
           └ <json.encoder.JSONEncoder object at 0x7fee02a5a550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
             │    └ <function JSONEncoder.iterencode at 0x7fee01a9aca0>
             └ <json.encoder.JSONEncoder object at 0x7fee02a5a550>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ {'TableName': 'Images', 'KeyConditionExpression': '#0 = :0', 'IndexName': 'view_index', 'ExpressionAttributeNames': {'#0': 'u...
           └ <_json.Encoder object at 0x7fedebd3abe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type And is not JSON serializable


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fedf8244fd0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fee030b5430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fee03e2b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fee03e2b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fee02a4a340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
    │    └ <function subprocess_started at 0x7fee00911160>
    └ <SpawnProcess name='SpawnProcess-1' parent=868646 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fee02a4a430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fee00902550>
           │       │   └ <uvicorn.server.Server object at 0x7fee02a4a430>
           │       └ <function run at 0x7fee01ac2700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fedffe60040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fedffe8b280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fedffe8b310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244ee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fee0023fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fedff171f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fee0023fdf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf8244e...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fedf82...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>
          └ <fastapi.applications.FastAPI object at 0x7fedff171f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fedf82449d0>
                     │    └ <function exception_handler at 0x7fedfa0350d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fedf97e6c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fedfe530d10>
    │      │         │                  └ <starlette.requests.Request object at 0x7fedf82449d0>
    │      │         └ TypeError('Object of type And is not JSON serializable')
    │      └ <function Logger.exception at 0x7fee029dd790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fedf8244fd0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:49:55.909 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42878 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:53:51.069 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:53:51.071 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:53:51.073 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:53:51.174 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:53:51.175 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:53:51.176 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:53:51.177 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:53:51.177 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:53:51.178 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:53:51.178 | INFO     | uvicorn.server:serve:94 - Finished server process [868683]
2022-01-07 19:53:51.179 | INFO     | uvicorn.server:serve:94 - Finished server process [868683]
2022-01-07 19:53:51.179 | INFO     | uvicorn.server:serve:94 - Finished server process [868683]
2022-01-07 19:53:52.263 | INFO     | uvicorn.server:serve:84 - Started server process [869944]
2022-01-07 19:53:52.264 | INFO     | uvicorn.server:serve:84 - Started server process [869944]
2022-01-07 19:53:52.265 | INFO     | uvicorn.server:serve:84 - Started server process [869944]
2022-01-07 19:53:52.266 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:53:52.267 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:53:52.267 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:53:52.268 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:53:52.268 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:53:52.269 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:18.231 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:54:18.231 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:54:18.232 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:54:18.333 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:54:18.334 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:54:18.336 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:54:18.337 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:54:18.339 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:54:18.339 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:54:18.340 | INFO     | uvicorn.server:serve:94 - Finished server process [869944]
2022-01-07 19:54:18.340 | INFO     | uvicorn.server:serve:94 - Finished server process [869944]
2022-01-07 19:54:18.341 | INFO     | uvicorn.server:serve:94 - Finished server process [869944]
2022-01-07 19:54:19.918 | INFO     | uvicorn.server:serve:84 - Started server process [870208]
2022-01-07 19:54:19.919 | INFO     | uvicorn.server:serve:84 - Started server process [870208]
2022-01-07 19:54:19.919 | INFO     | uvicorn.server:serve:84 - Started server process [870208]
2022-01-07 19:54:19.920 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:54:19.920 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:54:19.921 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:54:19.923 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:19.924 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:19.926 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:20.629 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:54:20.630 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:54:20.630 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:54:20.731 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:54:20.731 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:54:20.731 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:54:20.732 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:54:20.732 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:54:20.732 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:54:20.733 | INFO     | uvicorn.server:serve:94 - Finished server process [870208]
2022-01-07 19:54:20.733 | INFO     | uvicorn.server:serve:94 - Finished server process [870208]
2022-01-07 19:54:20.733 | INFO     | uvicorn.server:serve:94 - Finished server process [870208]
2022-01-07 19:54:24.380 | INFO     | uvicorn.server:serve:84 - Started server process [870311]
2022-01-07 19:54:24.381 | INFO     | uvicorn.server:serve:84 - Started server process [870311]
2022-01-07 19:54:24.381 | INFO     | uvicorn.server:serve:84 - Started server process [870311]
2022-01-07 19:54:24.381 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:54:24.382 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:54:24.382 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:54:24.383 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:24.383 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:24.383 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:54:35.635 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:54:35.742 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:54:35.847 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f63d59919d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f63d5991b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '5f0965a5-7c0b-4744-b636-af24c849c990', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f63d317b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f63d39d9b50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f63d39b4790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f63d39d9b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f63d7e849d0>
          └ <fastapi.routing.APIRoute object at 0x7f63d316b880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f63d39d4c10>
          └ <fastapi.routing.APIRoute object at 0x7f63d316b880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f63d31942e0>
                     └ <function get_request_handler.<locals>.app at 0x7f63d39d4b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f63d7e735e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f63d39a8160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f63d316b8b0>
                 └ <function run_in_threadpool at 0x7f63d805faf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f63d318fd40>
                 │     │         └ <function run_sync at 0x7f63d807c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f63d318fd40>
                 └ <function get_asynclib at 0x7f63d807c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f63d318fd40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f63d2411200>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f63d59b9c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f63d58efdc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f63d58ed850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f63d58e60a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f63d58ed8b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f63d58e35e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f63d23ac580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f63d23ac580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f63d23ac4f0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f63d5993d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f63d23ac4f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f63d3181910>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f63dca29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f63dd79f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f63dd79f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f63dc3bd340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
    │    └ <function subprocess_started at 0x7f63da284160>
    └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f63dc3bd430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f63da275550>
           │       │   └ <uvicorn.server.Server object at 0x7f63dc3bd430>
           │       └ <function run at 0x7f63db435700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f63d97d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f63d97fc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f63d97fc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f63d9bb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f63d8ae5f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f63d9bb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>
          └ <fastapi.applications.FastAPI object at 0x7f63d8ae5f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f63d31942b0>
                     │    └ <function exception_handler at 0x7f63d39a80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f63d7ea2ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f63d31942b0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) ...
    │      └ <function Logger.exception at 0x7f63dc350790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f63d3181910>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:54:35.879 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f63d59919d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f63d5991b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '5f0965a5-7c0b-4744-b636-af24c849c990', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f63d317b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f63d39d9b50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f63d39b4790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f63d39d9b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f63d7e849d0>
          └ <fastapi.routing.APIRoute object at 0x7f63d316b880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f63d39d4c10>
          └ <fastapi.routing.APIRoute object at 0x7f63d316b880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f63d31942e0>
                     └ <function get_request_handler.<locals>.app at 0x7f63d39d4b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f63d7e735e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f63d39a8160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f63d316b8b0>
                 └ <function run_in_threadpool at 0x7f63d805faf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f63d318fd40>
                 │     │         └ <function run_sync at 0x7f63d807c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f63d318fd40>
                 └ <function get_asynclib at 0x7f63d807c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f63d318fd40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f63d2411200>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f63d59b9c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f63d58efdc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f63d58ed850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f63d58e60a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f63d58ed8b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f63d58e35e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f63d23ac580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f63d23ac580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f63d23ac4f0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f63d5993d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f63d23ac4f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f63d3181910>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f63dca29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f63dd79f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f63dd79f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f63dc3bd340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
    │    └ <function subprocess_started at 0x7f63da284160>
    └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f63dc3bd430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f63da275550>
           │       │   └ <uvicorn.server.Server object at 0x7f63dc3bd430>
           │       └ <function run at 0x7f63db435700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f63d97d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f63d97fc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f63d97fc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f63d9bb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f63d8ae5f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f63d9bb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>
          └ <fastapi.applications.FastAPI object at 0x7f63d8ae5f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f63d31942b0>
                     │    └ <function exception_handler at 0x7f63d39a80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f63d7ea2ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f63d31942b0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) ...
    │      └ <function Logger.exception at 0x7f63dc350790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f63d3181910>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:54:35.910 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f63d59919d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f63d5991b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '5f0965a5-7c0b-4744-b636-af24c849c990', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f63d317b9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f63d39d9b50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f63d39b4790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f63d39d9b50>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f63d7e849d0>
          └ <fastapi.routing.APIRoute object at 0x7f63d316b880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f63d317ba60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f63d39d4c10>
          └ <fastapi.routing.APIRoute object at 0x7f63d316b880>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f63d31942e0>
                     └ <function get_request_handler.<locals>.app at 0x7f63d39d4b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f63d7e735e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f63d39a8160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f63d316b8b0>
                 └ <function run_in_threadpool at 0x7f63d805faf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f63d318fd40>
                 │     │         └ <function run_sync at 0x7f63d807c9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f63d318fd40>
                 └ <function get_asynclib at 0x7f63d807c310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f63d39a8160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f63d318fd40>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f63d2411200>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f63d59b9c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f63d58efdc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f63d58ed850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f63d58e60a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f63d58ed8b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f63d58e35e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f63d23ac580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f63d23ac580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f63d598b6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f63d23ac4f0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f63d23ac5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f63d5993d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f63d23ac4f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f63d3181910>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f63dca29430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f63dd79f9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f63dd79f040>
    └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f63dc3bd340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
    │    └ <function subprocess_started at 0x7f63da284160>
    └ <SpawnProcess name='SpawnProcess-1' parent=870274 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f63dc3bd430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f63da275550>
           │       │   └ <uvicorn.server.Server object at 0x7f63dc3bd430>
           │       └ <function run at 0x7f63db435700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f63d97d3040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f63d97fc280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f63d97fc310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f63d9bb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f63d8ae5f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f63d9bb2df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31940...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f63d31...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>
          └ <fastapi.applications.FastAPI object at 0x7f63d8ae5f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f63d31942b0>
                     │    └ <function exception_handler at 0x7f63d39a80d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f63d39d9bb0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f63d7ea2ea0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f63d31942b0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (5f0965a5-7c0b-4744-b636-af24c849c990) ...
    │      └ <function Logger.exception at 0x7f63dc350790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f63d3181910>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:54:35.953 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:42972 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:55:03.721 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:55:03.721 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:55:03.722 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:55:03.823 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:55:03.824 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:55:03.824 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:55:03.825 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:55:03.826 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:55:03.827 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:55:03.828 | INFO     | uvicorn.server:serve:94 - Finished server process [870311]
2022-01-07 19:55:03.828 | INFO     | uvicorn.server:serve:94 - Finished server process [870311]
2022-01-07 19:55:03.829 | INFO     | uvicorn.server:serve:94 - Finished server process [870311]
2022-01-07 19:55:07.464 | INFO     | uvicorn.server:serve:84 - Started server process [870706]
2022-01-07 19:55:07.465 | INFO     | uvicorn.server:serve:84 - Started server process [870706]
2022-01-07 19:55:07.465 | INFO     | uvicorn.server:serve:84 - Started server process [870706]
2022-01-07 19:55:07.466 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:55:07.466 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:55:07.466 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 19:55:07.467 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:55:07.467 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:55:07.467 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 19:55:11.212 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:55:11.322 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 19:55:11.442 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7ff024d439d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7ff024d43b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '93c764d6-f0d7-4918-a8ee-557f36135cf5', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff02252e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff022d8cbe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ff022d67820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff022d8cbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7ff0272379d0>
          └ <fastapi.routing.APIRoute object at 0x7ff02251d910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ff022d87c10>
          └ <fastapi.routing.APIRoute object at 0x7ff02251d910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ff022547370>
                     └ <function get_request_handler.<locals>.app at 0x7ff022d87b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ff0272265e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7ff022d5b160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7ff02251d940>
                 └ <function run_in_threadpool at 0x7ff027412af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7ff022517d80>
                 │     │         └ <function run_sync at 0x7ff02742f9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7ff022517d80>
                 └ <function get_asynclib at 0x7ff02742f310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7ff022517d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7ff0217c4300>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7ff024d6cc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7ff024ca2dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted.__eq__(is_deleted))))
               │      │          │     │       │      │          │      └ False
               │      │          │     │       │      │          └ <function Attribute.__eq__ at 0x7ff024d1c040>
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7ff024ca0850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7ff024c990a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7ff024ca08b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7ff024c965e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7ff021760610>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
                └ <pynamodb.pagination.ResultIterator object at 0x7ff021760610>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7ff021760580>>
           └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7ff024d46d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7ff021760580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7ff022532a30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ff02bddc430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ff02cb529d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ff02cb52040>
    └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ff02b770340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
    │    └ <function subprocess_started at 0x7ff029637160>
    └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ff02b770430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7ff029628550>
           │       │   └ <uvicorn.server.Server object at 0x7ff02b770430>
           │       └ <function run at 0x7ff02a7e8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7ff028b86040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ff028baf280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ff028baf310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff028f65df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ff027e98f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff028f65df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>
          └ <fastapi.applications.FastAPI object at 0x7ff027e98f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7ff022547340>
                     │    └ <function exception_handler at 0x7ff022d5b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7ff027255db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7ff022547340>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) ...
    │      └ <function Logger.exception at 0x7ff02b703790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7ff022532a30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:55:11.484 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7ff024d439d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7ff024d43b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '93c764d6-f0d7-4918-a8ee-557f36135cf5', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff02252e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff022d8cbe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ff022d67820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff022d8cbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7ff0272379d0>
          └ <fastapi.routing.APIRoute object at 0x7ff02251d910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ff022d87c10>
          └ <fastapi.routing.APIRoute object at 0x7ff02251d910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ff022547370>
                     └ <function get_request_handler.<locals>.app at 0x7ff022d87b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ff0272265e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7ff022d5b160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7ff02251d940>
                 └ <function run_in_threadpool at 0x7ff027412af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7ff022517d80>
                 │     │         └ <function run_sync at 0x7ff02742f9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7ff022517d80>
                 └ <function get_asynclib at 0x7ff02742f310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7ff022517d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7ff0217c4300>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7ff024d6cc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7ff024ca2dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted.__eq__(is_deleted))))
               │      │          │     │       │      │          │      └ False
               │      │          │     │       │      │          └ <function Attribute.__eq__ at 0x7ff024d1c040>
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7ff024ca0850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7ff024c990a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7ff024ca08b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7ff024c965e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7ff021760610>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
                └ <pynamodb.pagination.ResultIterator object at 0x7ff021760610>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7ff021760580>>
           └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7ff024d46d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7ff021760580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7ff022532a30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ff02bddc430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ff02cb529d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ff02cb52040>
    └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ff02b770340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
    │    └ <function subprocess_started at 0x7ff029637160>
    └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ff02b770430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7ff029628550>
           │       │   └ <uvicorn.server.Server object at 0x7ff02b770430>
           │       └ <function run at 0x7ff02a7e8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7ff028b86040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ff028baf280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ff028baf310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff028f65df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ff027e98f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff028f65df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>
          └ <fastapi.applications.FastAPI object at 0x7ff027e98f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7ff022547340>
                     │    └ <function exception_handler at 0x7ff022d5b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7ff027255db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7ff022547340>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) ...
    │      └ <function Logger.exception at 0x7ff02b703790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7ff022532a30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:55:11.516 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7ff024d439d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7ff024d43b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '93c764d6-f0d7-4918-a8ee-557f36135cf5', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7ff02252e9d0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff022d8cbe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7ff022d67820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7ff022d8cbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7ff0272379d0>
          └ <fastapi.routing.APIRoute object at 0x7ff02251d910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7ff02252ea60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7ff022d87c10>
          └ <fastapi.routing.APIRoute object at 0x7ff02251d910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7ff022547370>
                     └ <function get_request_handler.<locals>.app at 0x7ff022d87b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7ff0272265e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7ff022d5b160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7ff02251d940>
                 └ <function run_in_threadpool at 0x7ff027412af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7ff022517d80>
                 │     │         └ <function run_sync at 0x7ff02742f9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7ff022517d80>
                 └ <function get_asynclib at 0x7ff02742f310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7ff022d5b160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7ff022517d80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7ff0217c4300>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7ff024d6cc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7ff024ca2dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted.__eq__(is_deleted))))
               │      │          │     │       │      │          │      └ False
               │      │          │     │       │      │          └ <function Attribute.__eq__ at 0x7ff024d1c040>
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7ff024ca0850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7ff024c990a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7ff024ca08b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7ff024c965e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7ff021760610>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
                └ <pynamodb.pagination.ResultIterator object at 0x7ff021760610>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7ff024d3e6a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7ff021760580>>
           └ <pynamodb.pagination.PageIterator object at 0x7ff021760670>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7ff024d46d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7ff021760580>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7ff022532a30>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7ff02bddc430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7ff02cb529d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7ff02cb52040>
    └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7ff02b770340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
    │    └ <function subprocess_started at 0x7ff029637160>
    └ <SpawnProcess name='SpawnProcess-1' parent=870669 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7ff02b770430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7ff029628550>
           │       │   └ <uvicorn.server.Server object at 0x7ff02b770430>
           │       └ <function run at 0x7ff02a7e8700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7ff028b86040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7ff028baf280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7ff028baf310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff022547160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff028f65df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7ff027e98f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7ff028f65df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225471...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7ff0225...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>
          └ <fastapi.applications.FastAPI object at 0x7ff027e98f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7ff022547340>
                     │    └ <function exception_handler at 0x7ff022d5b0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7ff022d8cc40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7ff027255db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7ff022547340>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (93c764d6-f0d7-4918-a8ee-557f36135cf5) ...
    │      └ <function Logger.exception at 0x7ff02b703790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7ff022532a30>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 19:55:11.548 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:43032 - "GET /show_images HTTP/1.1" 500
2022-01-07 19:55:25.279 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:55:25.280 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:55:25.280 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 19:55:25.381 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:55:25.382 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:55:25.383 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 19:55:25.384 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:55:25.385 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:55:25.386 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 19:55:25.387 | INFO     | uvicorn.server:serve:94 - Finished server process [870706]
2022-01-07 19:55:25.387 | INFO     | uvicorn.server:serve:94 - Finished server process [870706]
2022-01-07 19:55:25.387 | INFO     | uvicorn.server:serve:94 - Finished server process [870706]
2022-01-07 22:12:05.178 | INFO     | uvicorn.server:serve:84 - Started server process [897289]
2022-01-07 22:12:05.179 | INFO     | uvicorn.server:serve:84 - Started server process [897289]
2022-01-07 22:12:05.179 | INFO     | uvicorn.server:serve:84 - Started server process [897289]
2022-01-07 22:12:05.180 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:12:05.180 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:12:05.180 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:12:05.182 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:12:05.182 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:12:05.182 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:12:08.984 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45138 - "GET /docs HTTP/1.1" 200
2022-01-07 22:12:09.207 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45138 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 22:12:18.033 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 22:12:18.412 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45140 - "POST /token HTTP/1.1" 200
2022-01-07 22:12:25.342 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 22:12:25.435 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f5b247459d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f5b24745b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '15929844-5b4c-4607-9b26-71738ba72878', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5b2098d8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b21f4ebe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5b227a9820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b21f4ebe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5b26c799d0>
          └ <fastapi.routing.APIRoute object at 0x7f5b21f5f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5b227c9c10>
          └ <fastapi.routing.APIRoute object at 0x7f5b21f5f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5b209abd00>
                     └ <function get_request_handler.<locals>.app at 0x7f5b227c9b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5b26c675e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f5b2279d160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5b21f5f940>
                 └ <function run_in_threadpool at 0x7f5b26e54af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f5b21f55700>
                 │     │         └ <function run_sync at 0x7f5b26e719d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f5b21f55700>
                 └ <function get_asynclib at 0x7f5b26e71310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (15929844-5b...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f5b21f55700>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5b20eaf0c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f5b247aec70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f5b246e3dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f5b246e2850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f5b246db0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f5b246e28b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f5b246d85e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f5b20962190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f5b20962190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f5b20962040>>
           └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f5b24748d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f5b20962040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5b209abfa0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5b2b81d430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5b2c5949d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5b2c594040>
    └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5b2b1b2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
    │    └ <function subprocess_started at 0x7f5b29078160>
    └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5b2b1b2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5b2906a550>
           │       │   └ <uvicorn.server.Server object at 0x7f5b2b1b2430>
           │       └ <function run at 0x7f5b2a22a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5b285c7040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5b285f3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5b285f3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b289a7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5b278d9f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b289a7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>
          └ <fastapi.applications.FastAPI object at 0x7f5b278d9f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5b209abcd0>
                     │    └ <function exception_handler at 0x7f5b2279d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5b26c97db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5b209abcd0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) ...
    │      └ <function Logger.exception at 0x7f5b2b145790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5b209abfa0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 22:12:25.466 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f5b247459d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f5b24745b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '15929844-5b4c-4607-9b26-71738ba72878', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5b2098d8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b21f4ebe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5b227a9820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b21f4ebe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5b26c799d0>
          └ <fastapi.routing.APIRoute object at 0x7f5b21f5f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5b227c9c10>
          └ <fastapi.routing.APIRoute object at 0x7f5b21f5f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5b209abd00>
                     └ <function get_request_handler.<locals>.app at 0x7f5b227c9b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5b26c675e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f5b2279d160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5b21f5f940>
                 └ <function run_in_threadpool at 0x7f5b26e54af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f5b21f55700>
                 │     │         └ <function run_sync at 0x7f5b26e719d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f5b21f55700>
                 └ <function get_asynclib at 0x7f5b26e71310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (15929844-5b...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f5b21f55700>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5b20eaf0c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f5b247aec70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f5b246e3dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f5b246e2850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f5b246db0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f5b246e28b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f5b246d85e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f5b20962190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f5b20962190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f5b20962040>>
           └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f5b24748d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f5b20962040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5b209abfa0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5b2b81d430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5b2c5949d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5b2c594040>
    └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5b2b1b2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
    │    └ <function subprocess_started at 0x7f5b29078160>
    └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5b2b1b2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5b2906a550>
           │       │   └ <uvicorn.server.Server object at 0x7f5b2b1b2430>
           │       └ <function run at 0x7f5b2a22a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5b285c7040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5b285f3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5b285f3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b289a7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5b278d9f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b289a7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>
          └ <fastapi.applications.FastAPI object at 0x7f5b278d9f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5b209abcd0>
                     │    └ <function exception_handler at 0x7f5b2279d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5b26c97db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5b209abcd0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) ...
    │      └ <function Logger.exception at 0x7f5b2b145790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5b209abfa0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 22:12:25.486 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f5b247459d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f5b24745b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': '15929844-5b4c-4607-9b26-71738ba72878', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f5b2098d8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b21f4ebe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f5b227a9820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f5b21f4ebe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f5b26c799d0>
          └ <fastapi.routing.APIRoute object at 0x7f5b21f5f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f5b2098d790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f5b227c9c10>
          └ <fastapi.routing.APIRoute object at 0x7f5b21f5f910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f5b209abd00>
                     └ <function get_request_handler.<locals>.app at 0x7f5b227c9b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f5b26c675e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f5b2279d160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f5b21f5f940>
                 └ <function run_in_threadpool at 0x7f5b26e54af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f5b21f55700>
                 │     │         └ <function run_sync at 0x7f5b26e719d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f5b21f55700>
                 └ <function get_asynclib at 0x7f5b26e71310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (15929844-5b...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f5b2279d160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f5b21f55700>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f5b20eaf0c0>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f5b247aec70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f5b246e3dc0>

  File "./app/models/models.py", line 116, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f5b246e2850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f5b246db0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f5b246e28b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f5b246d85e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f5b20962190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
                └ <pynamodb.pagination.ResultIterator object at 0x7f5b20962190>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f5b247406a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f5b20962040>>
           └ <pynamodb.pagination.PageIterator object at 0x7f5b209621f0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f5b24748d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f5b20962040>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f5b209abfa0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f5b2b81d430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f5b2c5949d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f5b2c594040>
    └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f5b2b1b2340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
    │    └ <function subprocess_started at 0x7f5b29078160>
    └ <SpawnProcess name='SpawnProcess-1' parent=897252 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f5b2b1b2430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f5b2906a550>
           │       │   └ <uvicorn.server.Server object at 0x7f5b2b1b2430>
           │       └ <function run at 0x7f5b2a22a700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f5b285c7040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f5b285f3280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f5b285f3310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b289a7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f5b278d9f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f5b289a7df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209abf...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f5b209...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>
          └ <fastapi.applications.FastAPI object at 0x7f5b278d9f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f5b209abcd0>
                     │    └ <function exception_handler at 0x7f5b2279d0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f5b21f4ec40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f5b26c97db0>
    │      │         │                  └ <starlette.requests.Request object at 0x7f5b209abcd0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (15929844-5b4c-4607-9b26-71738ba72878) ...
    │      └ <function Logger.exception at 0x7f5b2b145790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f5b209abfa0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 22:12:25.510 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45160 - "GET /show_images HTTP/1.1" 500
2022-01-07 22:20:36.941 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:20:36.942 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:20:36.942 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:20:37.043 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:20:37.043 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:20:37.044 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:20:37.044 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:20:37.045 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:20:37.046 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:20:37.047 | INFO     | uvicorn.server:serve:94 - Finished server process [897289]
2022-01-07 22:20:37.048 | INFO     | uvicorn.server:serve:94 - Finished server process [897289]
2022-01-07 22:20:37.048 | INFO     | uvicorn.server:serve:94 - Finished server process [897289]
2022-01-07 22:20:41.494 | INFO     | uvicorn.server:serve:84 - Started server process [899579]
2022-01-07 22:20:41.494 | INFO     | uvicorn.server:serve:84 - Started server process [899579]
2022-01-07 22:20:41.494 | INFO     | uvicorn.server:serve:84 - Started server process [899579]
2022-01-07 22:20:41.495 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:20:41.495 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:20:41.495 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:20:41.496 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:20:41.496 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:20:41.496 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:20:48.988 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45408 - "GET /docs HTTP/1.1" 200
2022-01-07 22:20:49.207 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45408 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 22:21:14.141 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 22:21:14.520 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45410 - "POST /token HTTP/1.1" 200
2022-01-07 22:21:22.354 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f306022f8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f306186fbe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f306184a820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f306186fbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3065d1a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f3061000910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f306186ac10>
          └ <fastapi.routing.APIRoute object at 0x7f3061000910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f306024dd00>
                     └ <function get_request_handler.<locals>.app at 0x7f306186ab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3065d095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f306183e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f3061000940>
                 └ <function run_in_threadpool at 0x7f3065ef5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f306024e4c0>
                 │     │         └ <function run_sync at 0x7f3065f129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f306024e4c0>
                 └ <function get_asynclib at 0x7f3065f12310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'BooleanAttribute' object has no attribute 'eq'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f306024e4c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f3061018d80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f3063850c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f3063785dc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted.eq(is_deleted))))
               │      │          │     │       │      │             └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f3063784850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f306377c0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f30637848b0>
               └ <class 'app.models.models.Images'>

AttributeError: 'BooleanAttribute' object has no attribute 'eq'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f30607e14c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f306a8be430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f306b6359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f306b635040>
    └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f306a253340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
    │    └ <function subprocess_started at 0x7f306811a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f306a253430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f306810c550>
           │       │   └ <uvicorn.server.Server object at 0x7f306a253430>
           │       └ <function run at 0x7f30692cb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3067668040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3067694280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3067694310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3067a48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f306697bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3067a48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>
          └ <fastapi.applications.FastAPI object at 0x7f306697bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3061015880>
                     │    └ <function exception_handler at 0x7f306183e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3065d38d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3061015880>
    │      │         └ AttributeError("'BooleanAttribute' object has no attribute 'eq'")
    │      └ <function Logger.exception at 0x7f306a1e6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f30607e14c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 22:21:22.383 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f306022f8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f306186fbe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f306184a820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f306186fbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3065d1a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f3061000910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f306186ac10>
          └ <fastapi.routing.APIRoute object at 0x7f3061000910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f306024dd00>
                     └ <function get_request_handler.<locals>.app at 0x7f306186ab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3065d095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f306183e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f3061000940>
                 └ <function run_in_threadpool at 0x7f3065ef5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f306024e4c0>
                 │     │         └ <function run_sync at 0x7f3065f129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f306024e4c0>
                 └ <function get_asynclib at 0x7f3065f12310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'BooleanAttribute' object has no attribute 'eq'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f306024e4c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f3061018d80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f3063850c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f3063785dc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted.eq(is_deleted))))
               │      │          │     │       │      │             └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f3063784850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f306377c0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f30637848b0>
               └ <class 'app.models.models.Images'>

AttributeError: 'BooleanAttribute' object has no attribute 'eq'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f30607e14c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f306a8be430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f306b6359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f306b635040>
    └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f306a253340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
    │    └ <function subprocess_started at 0x7f306811a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f306a253430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f306810c550>
           │       │   └ <uvicorn.server.Server object at 0x7f306a253430>
           │       └ <function run at 0x7f30692cb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3067668040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3067694280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3067694310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3067a48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f306697bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3067a48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>
          └ <fastapi.applications.FastAPI object at 0x7f306697bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3061015880>
                     │    └ <function exception_handler at 0x7f306183e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3065d38d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3061015880>
    │      │         └ AttributeError("'BooleanAttribute' object has no attribute 'eq'")
    │      └ <function Logger.exception at 0x7f306a1e6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f30607e14c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 22:21:22.399 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f306022f8b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f306186fbe0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f306184a820>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f306186fbe0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f3065d1a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f3061000910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f306022f790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f306186ac10>
          └ <fastapi.routing.APIRoute object at 0x7f3061000910>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f306024dd00>
                     └ <function get_request_handler.<locals>.app at 0x7f306186ab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f3065d095e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f306183e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f3061000940>
                 └ <function run_in_threadpool at 0x7f3065ef5af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f306024e4c0>
                 │     │         └ <function run_sync at 0x7f3065f129d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f306024e4c0>
                 └ <function get_asynclib at 0x7f3065f12310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=AttributeError("'BooleanAttribute' object has no attribute 'eq'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f306183e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f306024e4c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f3061018d80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f3063850c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f3063785dc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted.eq(is_deleted))))
               │      │          │     │       │      │             └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f3063784850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f306377c0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f30637848b0>
               └ <class 'app.models.models.Images'>

AttributeError: 'BooleanAttribute' object has no attribute 'eq'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f30607e14c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f306a8be430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f306b6359d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f306b635040>
    └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f306a253340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
    │    └ <function subprocess_started at 0x7f306811a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=899542 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f306a253430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f306810c550>
           │       │   └ <uvicorn.server.Server object at 0x7f306a253430>
           │       └ <function run at 0x7f30692cb700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f3067668040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f3067694280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f3067694310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3067a48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f306697bf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f3067a48df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f306024df...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f30602...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>
          └ <fastapi.applications.FastAPI object at 0x7f306697bf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f3061015880>
                     │    └ <function exception_handler at 0x7f306183e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f306186fc40>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f3065d38d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7f3061015880>
    │      │         └ AttributeError("'BooleanAttribute' object has no attribute 'eq'")
    │      └ <function Logger.exception at 0x7f306a1e6790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f30607e14c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 22:21:22.419 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:45442 - "GET /show_images HTTP/1.1" 500
2022-01-07 22:35:52.392 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:35:52.392 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:35:52.393 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:35:52.494 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:35:52.494 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:35:52.495 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:35:52.496 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:35:52.497 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:35:52.499 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:35:52.499 | INFO     | uvicorn.server:serve:94 - Finished server process [899579]
2022-01-07 22:35:52.500 | INFO     | uvicorn.server:serve:94 - Finished server process [899579]
2022-01-07 22:35:52.500 | INFO     | uvicorn.server:serve:94 - Finished server process [899579]
2022-01-07 22:35:53.587 | INFO     | uvicorn.server:serve:84 - Started server process [902751]
2022-01-07 22:35:53.587 | INFO     | uvicorn.server:serve:84 - Started server process [902751]
2022-01-07 22:35:53.588 | INFO     | uvicorn.server:serve:84 - Started server process [902751]
2022-01-07 22:35:53.588 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:35:53.589 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:35:53.589 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:35:53.590 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:35:53.591 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:35:53.591 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:42:44.134 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:42:44.135 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:42:44.136 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 22:42:44.238 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:42:44.238 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:42:44.238 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 22:42:44.239 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:42:44.240 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:42:44.241 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 22:42:44.242 | INFO     | uvicorn.server:serve:94 - Finished server process [902751]
2022-01-07 22:42:44.242 | INFO     | uvicorn.server:serve:94 - Finished server process [902751]
2022-01-07 22:42:44.243 | INFO     | uvicorn.server:serve:94 - Finished server process [902751]
2022-01-07 22:42:45.309 | INFO     | uvicorn.server:serve:84 - Started server process [904103]
2022-01-07 22:42:45.310 | INFO     | uvicorn.server:serve:84 - Started server process [904103]
2022-01-07 22:42:45.310 | INFO     | uvicorn.server:serve:84 - Started server process [904103]
2022-01-07 22:42:45.310 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:42:45.311 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:42:45.311 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 22:42:45.312 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:42:45.312 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 22:42:45.312 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:20:54.359 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:20:54.360 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:20:54.361 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:20:54.462 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:20:54.462 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:20:54.462 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:20:54.463 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:20:54.464 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:20:54.465 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:20:54.465 | INFO     | uvicorn.server:serve:94 - Finished server process [904103]
2022-01-07 23:20:54.465 | INFO     | uvicorn.server:serve:94 - Finished server process [904103]
2022-01-07 23:20:54.466 | INFO     | uvicorn.server:serve:94 - Finished server process [904103]
2022-01-07 23:20:55.601 | INFO     | uvicorn.server:serve:84 - Started server process [912021]
2022-01-07 23:20:55.602 | INFO     | uvicorn.server:serve:84 - Started server process [912021]
2022-01-07 23:20:55.602 | INFO     | uvicorn.server:serve:84 - Started server process [912021]
2022-01-07 23:20:55.603 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:20:55.603 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:20:55.604 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:20:55.604 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:20:55.605 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:20:55.605 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:20:55.807 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:20:55.807 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:20:55.807 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:20:55.908 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:20:55.909 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:20:55.909 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:20:55.910 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:20:55.910 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:20:55.910 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:20:55.911 | INFO     | uvicorn.server:serve:94 - Finished server process [912021]
2022-01-07 23:20:55.911 | INFO     | uvicorn.server:serve:94 - Finished server process [912021]
2022-01-07 23:20:55.911 | INFO     | uvicorn.server:serve:94 - Finished server process [912021]
2022-01-07 23:20:57.562 | INFO     | uvicorn.server:serve:84 - Started server process [912108]
2022-01-07 23:20:57.563 | INFO     | uvicorn.server:serve:84 - Started server process [912108]
2022-01-07 23:20:57.563 | INFO     | uvicorn.server:serve:84 - Started server process [912108]
2022-01-07 23:20:57.563 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:20:57.563 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:20:57.564 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:20:57.564 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:20:57.565 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:20:57.565 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:21:10.458 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46440 - "GET /docs HTTP/1.1" 200
2022-01-07 23:21:10.677 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46440 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 23:21:35.549 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 23:21:35.936 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46442 - "POST /token HTTP/1.1" 200
2022-01-07 23:24:20.348 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f41d65848b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f41d83c5bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f41d83a07f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f41d83c5bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f41dc8709d0>
          └ <fastapi.routing.APIRoute object at 0x7f41d7b568e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f41d83c0c10>
          └ <fastapi.routing.APIRoute object at 0x7f41d7b568e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f41d65a1cd0>
                     └ <function get_request_handler.<locals>.app at 0x7f41d83c0b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f41dc85f5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f41d8394160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f41d7b56910>
                 └ <function run_in_threadpool at 0x7f41dca4baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f41d7b834c0>
                 │     │         └ <function run_sync at 0x7f41dca689d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f41d7b834c0>
                 └ <function get_asynclib at 0x7f41dca68310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("query() got an unexpected keyword argument 'is_deleted__eq'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f41d7b834c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f41d7b83a40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f41da3a5c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f41da2dbdc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,is_deleted__eq=is_deleted)))
               │      │          │     │                      └ False
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f41da2d20d0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f41da2d98e0>
               └ <class 'app.models.models.Images'>

TypeError: query() got an unexpected keyword argument 'is_deleted__eq'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f41d65a1ca0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f41e1415430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f41e218b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f41e218b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f41e0da9340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
    │    └ <function subprocess_started at 0x7f41dec6f160>
    └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f41e0da9430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f41dec61550>
           │       │   └ <uvicorn.server.Server object at 0x7f41e0da9430>
           │       └ <function run at 0x7f41dfe21700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f41de1bf040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f41de1ea280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f41de1ea310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f41de59edf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f41dd4d1f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f41de59edf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>
          └ <fastapi.applications.FastAPI object at 0x7f41dd4d1f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f41d73374f0>
                     │    └ <function exception_handler at 0x7f41d83940d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f41dc88ee00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f41d73374f0>
    │      │         └ TypeError("query() got an unexpected keyword argument 'is_deleted__eq'")
    │      └ <function Logger.exception at 0x7f41e0d3c790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f41d65a1ca0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 23:24:20.371 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f41d65848b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f41d83c5bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f41d83a07f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f41d83c5bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f41dc8709d0>
          └ <fastapi.routing.APIRoute object at 0x7f41d7b568e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f41d83c0c10>
          └ <fastapi.routing.APIRoute object at 0x7f41d7b568e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f41d65a1cd0>
                     └ <function get_request_handler.<locals>.app at 0x7f41d83c0b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f41dc85f5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f41d8394160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f41d7b56910>
                 └ <function run_in_threadpool at 0x7f41dca4baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f41d7b834c0>
                 │     │         └ <function run_sync at 0x7f41dca689d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f41d7b834c0>
                 └ <function get_asynclib at 0x7f41dca68310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("query() got an unexpected keyword argument 'is_deleted__eq'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f41d7b834c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f41d7b83a40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f41da3a5c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f41da2dbdc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,is_deleted__eq=is_deleted)))
               │      │          │     │                      └ False
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f41da2d20d0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f41da2d98e0>
               └ <class 'app.models.models.Images'>

TypeError: query() got an unexpected keyword argument 'is_deleted__eq'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f41d65a1ca0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f41e1415430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f41e218b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f41e218b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f41e0da9340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
    │    └ <function subprocess_started at 0x7f41dec6f160>
    └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f41e0da9430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f41dec61550>
           │       │   └ <uvicorn.server.Server object at 0x7f41e0da9430>
           │       └ <function run at 0x7f41dfe21700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f41de1bf040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f41de1ea280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f41de1ea310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f41de59edf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f41dd4d1f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f41de59edf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>
          └ <fastapi.applications.FastAPI object at 0x7f41dd4d1f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f41d73374f0>
                     │    └ <function exception_handler at 0x7f41d83940d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f41dc88ee00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f41d73374f0>
    │      │         └ TypeError("query() got an unexpected keyword argument 'is_deleted__eq'")
    │      └ <function Logger.exception at 0x7f41e0d3c790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f41d65a1ca0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 23:24:20.386 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f41d65848b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f41d83c5bb0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f41d83a07f0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f41d83c5bb0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f41dc8709d0>
          └ <fastapi.routing.APIRoute object at 0x7f41d7b568e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f41d6584790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f41d83c0c10>
          └ <fastapi.routing.APIRoute object at 0x7f41d7b568e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f41d65a1cd0>
                     └ <function get_request_handler.<locals>.app at 0x7f41d83c0b80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f41dc85f5e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f41d8394160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f41d7b56910>
                 └ <function run_in_threadpool at 0x7f41dca4baf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f41d7b834c0>
                 │     │         └ <function run_sync at 0x7f41dca689d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f41d7b834c0>
                 └ <function get_asynclib at 0x7f41dca68310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=TypeError("query() got an unexpected keyword argument 'is_deleted__eq'")>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f41d8394160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f41d7b834c0>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f41d7b83a40>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f41da3a5c70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f41da2dbdc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,is_deleted__eq=is_deleted)))
               │      │          │     │                      └ False
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f41da2d20d0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f41da2d98e0>
               └ <class 'app.models.models.Images'>

TypeError: query() got an unexpected keyword argument 'is_deleted__eq'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f41d65a1ca0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f41e1415430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f41e218b9d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f41e218b040>
    └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f41e0da9340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
    │    └ <function subprocess_started at 0x7f41dec6f160>
    └ <SpawnProcess name='SpawnProcess-1' parent=912065 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f41e0da9430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f41dec61550>
           │       │   └ <uvicorn.server.Server object at 0x7f41e0da9430>
           │       └ <function run at 0x7f41dfe21700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f41de1bf040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f41de1ea280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f41de1ea310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1fd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f41de59edf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f41dd4d1f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f41de59edf0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65a1f...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f41d65...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>
          └ <fastapi.applications.FastAPI object at 0x7f41dd4d1f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f41d73374f0>
                     │    └ <function exception_handler at 0x7f41d83940d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f41d83c5c10>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f41dc88ee00>
    │      │         │                  └ <starlette.requests.Request object at 0x7f41d73374f0>
    │      │         └ TypeError("query() got an unexpected keyword argument 'is_deleted__eq'")
    │      └ <function Logger.exception at 0x7f41e0d3c790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f41d65a1ca0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 23:24:20.409 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46494 - "GET /show_images HTTP/1.1" 500
2022-01-07 23:24:38.157 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:24:38.157 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:24:38.158 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:24:38.258 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:24:38.259 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:24:38.259 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:24:38.261 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:24:38.262 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:24:38.262 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:24:38.263 | INFO     | uvicorn.server:serve:94 - Finished server process [912108]
2022-01-07 23:24:38.263 | INFO     | uvicorn.server:serve:94 - Finished server process [912108]
2022-01-07 23:24:38.263 | INFO     | uvicorn.server:serve:94 - Finished server process [912108]
2022-01-07 23:48:44.403 | INFO     | uvicorn.server:serve:84 - Started server process [918197]
2022-01-07 23:48:44.403 | INFO     | uvicorn.server:serve:84 - Started server process [918197]
2022-01-07 23:48:44.404 | INFO     | uvicorn.server:serve:84 - Started server process [918197]
2022-01-07 23:48:44.404 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:48:44.404 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:48:44.404 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:48:44.405 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:48:44.405 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:48:44.406 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:48:55.999 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46892 - "GET /docs HTTP/1.1" 200
2022-01-07 23:48:56.294 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46892 - "GET /openapi.json HTTP/1.1" 200
2022-01-07 23:49:06.659 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 23:49:07.032 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46894 - "POST /token HTTP/1.1" 200
2022-01-07 23:49:41.458 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-07 23:49:41.550 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f77c72879d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f77c7287b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'd819daf1-9e8a-483b-9da3-d12deae7af21', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f77bf4808b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f77c52cfc70>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f77c52aa8b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f77c52cfc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f77c977a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f77c4a609a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f77c52cac10>
          └ <fastapi.routing.APIRoute object at 0x7f77c4a609a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f77bf49d640>
                     └ <function get_request_handler.<locals>.app at 0x7f77c52cab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f77c97695e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f77c529e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f77c4a609d0>
                 └ <function run_in_threadpool at 0x7f77c9955af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f77bf4a1640>
                 │     │         └ <function run_sync at 0x7f77c99729d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f77bf4a1640>
                 └ <function get_asynclib at 0x7f77c9972310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f77bf4a1640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f77c4a8db80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f77c72afc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f77c71e5dc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f77c71e3850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f77c71dc0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f77c71e38b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f77c71d95e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f77bf452220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
                └ <pynamodb.pagination.ResultIterator object at 0x7f77bf452220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f77bf4520a0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f77c7289d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f77bf4520a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f77bf49d1c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f77ce31f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f77cf0959d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f77cf095040>
    └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f77cdcb3340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
    │    └ <function subprocess_started at 0x7f77cbb7a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f77cdcb3430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f77cbb6c550>
           │       │   └ <uvicorn.server.Server object at 0x7f77cdcb3430>
           │       └ <function run at 0x7f77ccd2b700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f77cb0c9040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f77cb0f0280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f77cb0f0310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f77cb4a8df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f77ca3dbf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f77cb4a8df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>
          └ <fastapi.applications.FastAPI object at 0x7f77ca3dbf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f77bf49ddf0>
                     │    └ <function exception_handler at 0x7f77c529e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f77c9798f40>
    │      │         │                  └ <starlette.requests.Request object at 0x7f77bf49ddf0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) ...
    │      └ <function Logger.exception at 0x7f77cdc46790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f77bf49d1c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 23:49:41.579 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f77c72879d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f77c7287b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'd819daf1-9e8a-483b-9da3-d12deae7af21', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f77bf4808b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f77c52cfc70>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f77c52aa8b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f77c52cfc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f77c977a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f77c4a609a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f77c52cac10>
          └ <fastapi.routing.APIRoute object at 0x7f77c4a609a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f77bf49d640>
                     └ <function get_request_handler.<locals>.app at 0x7f77c52cab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f77c97695e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f77c529e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f77c4a609d0>
                 └ <function run_in_threadpool at 0x7f77c9955af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f77bf4a1640>
                 │     │         └ <function run_sync at 0x7f77c99729d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f77bf4a1640>
                 └ <function get_asynclib at 0x7f77c9972310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f77bf4a1640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f77c4a8db80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f77c72afc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f77c71e5dc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f77c71e3850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f77c71dc0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f77c71e38b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f77c71d95e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f77bf452220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
                └ <pynamodb.pagination.ResultIterator object at 0x7f77bf452220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f77bf4520a0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f77c7289d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f77bf4520a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f77bf49d1c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f77ce31f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f77cf0959d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f77cf095040>
    └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f77cdcb3340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
    │    └ <function subprocess_started at 0x7f77cbb7a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f77cdcb3430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f77cbb6c550>
           │       │   └ <uvicorn.server.Server object at 0x7f77cdcb3430>
           │       └ <function run at 0x7f77ccd2b700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f77cb0c9040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f77cb0f0280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f77cb0f0310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f77cb4a8df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f77ca3dbf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f77cb4a8df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>
          └ <fastapi.applications.FastAPI object at 0x7f77ca3dbf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f77bf49ddf0>
                     │    └ <function exception_handler at 0x7f77c529e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f77c9798f40>
    │      │         │                  └ <starlette.requests.Request object at 0x7f77bf49ddf0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) ...
    │      └ <function Logger.exception at 0x7f77cdc46790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f77bf49d1c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 23:49:41.609 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1333, in query
    return self.dispatch(QUERY, operation_kwargs, settings)
           │    │        │      │                 └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │        │      └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │        └ 'Query'
           │    └ <function Connection.dispatch at 0x7f77c72879d0>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 329, in dispatch
    data = self._make_api_call(operation_name, operation_kwargs, settings)
           │    │              │               │                 └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │              │               └ {'TableName': 'Images', 'KeyConditionExpression': '(#0 = :0 AND #1 = :1)', 'IndexName': 'view_index', 'ExpressionAttributeNam...
           │    │              └ 'Query'
           │    └ <function Connection._make_api_call at 0x7f77c7287b80>
           └ Connection<http://localhost:4566>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 440, in _make_api_call
    raise VerboseClientError(botocore_expected_format, operation_name, verbose_properties)
          │                  │                         │               └ {'request_id': 'd819daf1-9e8a-483b-9da3-d12deae7af21', 'table_name': 'Images'}
          │                  │                         └ 'Query'
          │                  └ {'Error': {'Message': 'Query condition missed key schema element', 'Code': 'ValidationException'}}
          └ <class 'pynamodb.exceptions.VerboseClientError'>

pynamodb.exceptions.VerboseClientError: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7f77bf4808b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7f77c52cfc70>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7f77c52aa8b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7f77c52cfc70>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7f77c977a9d0>
          └ <fastapi.routing.APIRoute object at 0x7f77c4a609a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7f77bf480790>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7f77c52cac10>
          └ <fastapi.routing.APIRoute object at 0x7f77c4a609a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7f77bf49d640>
                     └ <function get_request_handler.<locals>.app at 0x7f77c52cab80>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7f77c97695e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'token': Users<kaumil>}
                 │                 │         └ <function show_deleted_images at 0x7f77c529e160>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7f77c4a609d0>
                 └ <function run_in_threadpool at 0x7f77c9955af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
                 │     │         │        └ <built-in method run of Context object at 0x7f77bf4a1640>
                 │     │         └ <function run_sync at 0x7f77c99729d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
                 │                                        └ <built-in method run of Context object at 0x7f77bf4a1640>
                 └ <function get_asynclib at 0x7f77c9972310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=QueryError('Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function show_deleted_images at 0x7f77c529e160>, token=Users<kaumil>),)
             │       │   └ <built-in method run of Context object at 0x7f77bf4a1640>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7f77c4a8db80>

  File "./app/routes/images.py", line 35, in show_deleted_images
    images = list_images(user_id=token.user_id,is_deleted=False)
             │                   │     └ <pynamodb.attributes.UnicodeAttribute object at 0x7f77c72afc70>
             │                   └ Users<kaumil>
             └ <function list_images at 0x7f77c71e5dc0>

  File "./app/models/models.py", line 118, in list_images
    print(list(Images.view_index.query(user_id,Images.is_deleted==is_deleted)))
               │      │          │     │       │      │           └ False
               │      │          │     │       │      └ <pynamodb.attributes.BooleanAttribute object at 0x7f77c71e3850>
               │      │          │     │       └ <class 'app.models.models.Images'>
               │      │          │     └ '2378cc39-fe3d-49f0-ba6c-d65e60f5cb96'
               │      │          └ <classmethod object at 0x7f77c71dc0a0>
               │      └ <app.models.models.ImageViewIndex object at 0x7f77c71e38b0>
               └ <class 'app.models.models.Images'>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 194, in __next__
    self._get_next_page()
    │    └ <function ResultIterator._get_next_page at 0x7f77c71d95e0>
    └ <pynamodb.pagination.ResultIterator object at 0x7f77bf452220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 179, in _get_next_page
    page = next(self.page_iter)
                │    └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
                └ <pynamodb.pagination.ResultIterator object at 0x7f77bf452220>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/pagination.py", line 115, in __next__
    page = self._operation(*self._args, settings=self._settings, **self._kwargs)
           │    │           │    │               │    │            │    └ {'range_key_condition': is_deleted = {'BOOL': False}, 'filter_condition': None, 'index_name': 'view_index', 'exclusive_start_...
           │    │           │    │               │    │            └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    │           │    │               │    └ <pynamodb.settings.OperationSettings object at 0x7f77c72816a0>
           │    │           │    │               └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    │           │    └ ('2378cc39-fe3d-49f0-ba6c-d65e60f5cb96',)
           │    │           └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
           │    └ <bound method TableConnection.query of <pynamodb.connection.table.TableConnection object at 0x7f77bf4520a0>>
           └ <pynamodb.pagination.PageIterator object at 0x7f77bf452280>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/table.py", line 270, in query
    return self.connection.query(
           │    │          └ <function Connection.query at 0x7f77c7289d30>
           │    └ Connection<http://localhost:4566>
           └ <pynamodb.connection.table.TableConnection object at 0x7f77bf4520a0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/pynamodb/connection/base.py", line 1335, in query
    raise QueryError("Failed to query items: {}".format(e), e)
          └ <class 'pynamodb.exceptions.QueryError'>

pynamodb.exceptions.QueryError: Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) on table (Images) when calling the Query operation: Query condition missed key schema element


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7f77bf49d1c0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7f77ce31f430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7f77cf0959d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7f77cf095040>
    └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7f77cdcb3340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
    │    └ <function subprocess_started at 0x7f77cbb7a160>
    └ <SpawnProcess name='SpawnProcess-1' parent=918159 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7f77cdcb3430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7f77cbb6c550>
           │       │   └ <uvicorn.server.Server object at 0x7f77cdcb3430>
           │       └ <function run at 0x7f77ccd2b700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7f77cb0c9040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7f77cb0f0280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7f77cb0f0310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49dac0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f77cb4a8df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7f77ca3dbf40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7f77cb4a8df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf49da...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7f77bf4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>
          └ <fastapi.applications.FastAPI object at 0x7f77ca3dbf40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7f77bf49ddf0>
                     │    └ <function exception_handler at 0x7f77c529e0d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7f77c52cfcd0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7f77c9798f40>
    │      │         │                  └ <starlette.requests.Request object at 0x7f77bf49ddf0>
    │      │         └ QueryError('Failed to query items: An error occurred (ValidationException) on request (d819daf1-9e8a-483b-9da3-d12deae7af21) ...
    │      └ <function Logger.exception at 0x7f77cdc46790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7f77bf49d1c0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-07 23:49:41.638 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:46928 - "GET /show_images HTTP/1.1" 500
2022-01-07 23:55:57.256 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:55:57.256 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:55:57.257 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-07 23:55:57.358 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:55:57.359 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:55:57.359 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-07 23:55:57.360 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:55:57.360 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:55:57.360 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-07 23:55:57.361 | INFO     | uvicorn.server:serve:94 - Finished server process [918197]
2022-01-07 23:55:57.361 | INFO     | uvicorn.server:serve:94 - Finished server process [918197]
2022-01-07 23:55:57.362 | INFO     | uvicorn.server:serve:94 - Finished server process [918197]
2022-01-07 23:55:58.484 | INFO     | uvicorn.server:serve:84 - Started server process [920135]
2022-01-07 23:55:58.484 | INFO     | uvicorn.server:serve:84 - Started server process [920135]
2022-01-07 23:55:58.485 | INFO     | uvicorn.server:serve:84 - Started server process [920135]
2022-01-07 23:55:58.485 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:55:58.486 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:55:58.486 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-07 23:55:58.486 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:55:58.487 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-07 23:55:58.487 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:00:24.728 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:00:24.728 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:00:24.729 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:00:24.829 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:00:24.830 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:00:24.831 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:00:24.832 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:00:24.833 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:00:24.833 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:00:24.834 | INFO     | uvicorn.server:serve:94 - Finished server process [920135]
2022-01-08 00:00:24.834 | INFO     | uvicorn.server:serve:94 - Finished server process [920135]
2022-01-08 00:00:24.836 | INFO     | uvicorn.server:serve:94 - Finished server process [920135]
2022-01-08 00:00:27.503 | INFO     | uvicorn.server:serve:84 - Started server process [921218]
2022-01-08 00:00:27.504 | INFO     | uvicorn.server:serve:84 - Started server process [921218]
2022-01-08 00:00:27.504 | INFO     | uvicorn.server:serve:84 - Started server process [921218]
2022-01-08 00:00:27.504 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:00:27.504 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:00:27.505 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:00:27.505 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:00:27.506 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:00:27.506 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:00:31.785 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47210 - "GET /docs HTTP/1.1" 200
2022-01-08 00:00:32.022 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47210 - "GET /openapi.json HTTP/1.1" 200
2022-01-08 00:00:39.446 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:00:39.819 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47212 - "POST /token HTTP/1.1" 200
2022-01-08 00:00:45.340 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:00:45.397 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47242 - "GET /show_images HTTP/1.1" 200
2022-01-08 00:01:33.237 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47270 - "GET /show_deleted_images HTTP/1.1" 200
2022-01-08 00:05:38.147 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:05:38.147 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:05:38.148 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:05:38.249 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:05:38.249 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:05:38.249 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:05:38.250 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:05:38.250 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:05:38.251 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:05:38.251 | INFO     | uvicorn.server:serve:94 - Finished server process [921218]
2022-01-08 00:05:38.251 | INFO     | uvicorn.server:serve:94 - Finished server process [921218]
2022-01-08 00:05:38.252 | INFO     | uvicorn.server:serve:94 - Finished server process [921218]
2022-01-08 00:05:39.427 | INFO     | uvicorn.server:serve:84 - Started server process [922510]
2022-01-08 00:05:39.428 | INFO     | uvicorn.server:serve:84 - Started server process [922510]
2022-01-08 00:05:39.428 | INFO     | uvicorn.server:serve:84 - Started server process [922510]
2022-01-08 00:05:39.428 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:05:39.429 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:05:39.429 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:05:39.430 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:05:39.430 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:05:39.431 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:05:39.933 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:05:39.933 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:05:39.934 | INFO     | uvicorn.server:shutdown:263 - Shutting down
2022-01-08 00:05:40.035 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:05:40.036 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:05:40.036 | INFO     | uvicorn.lifespan.on:shutdown:64 - Waiting for application shutdown.
2022-01-08 00:05:40.037 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:05:40.037 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:05:40.037 | INFO     | uvicorn.lifespan.on:shutdown:75 - Application shutdown complete.
2022-01-08 00:05:40.037 | INFO     | uvicorn.server:serve:94 - Finished server process [922510]
2022-01-08 00:05:40.038 | INFO     | uvicorn.server:serve:94 - Finished server process [922510]
2022-01-08 00:05:40.038 | INFO     | uvicorn.server:serve:94 - Finished server process [922510]
2022-01-08 00:06:01.790 | INFO     | uvicorn.server:serve:84 - Started server process [923257]
2022-01-08 00:06:01.791 | INFO     | uvicorn.server:serve:84 - Started server process [923257]
2022-01-08 00:06:01.791 | INFO     | uvicorn.server:serve:84 - Started server process [923257]
2022-01-08 00:06:01.791 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:06:01.792 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:06:01.792 | INFO     | uvicorn.lifespan.on:startup:45 - Waiting for application startup.
2022-01-08 00:06:01.793 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:06:01.793 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:06:01.793 | INFO     | uvicorn.lifespan.on:startup:59 - Application startup complete.
2022-01-08 00:06:03.904 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47398 - "GET /docs HTTP/1.1" 200
2022-01-08 00:06:04.120 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47398 - "GET /openapi.json HTTP/1.1" 200
2022-01-08 00:06:19.196 | INFO     | botocore.credentials:load:1224 - Found credentials in shared credentials file: ~/.aws/credentials
2022-01-08 00:06:19.259 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:06:21.964 | INFO     | botocore.credentials:load:1102 - Found credentials in environment variables.
2022-01-08 00:06:22.143 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47400 - "GET /sanity_check HTTP/1.1" 200
2022-01-08 00:07:21.216 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47530 - "POST /token HTTP/1.1" 200
2022-01-08 00:09:14.172 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47568 - "POST /signup HTTP/1.1" 201
2022-01-08 00:09:29.723 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47586 - "POST /signup HTTP/1.1" 201
2022-01-08 00:09:39.298 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47600 - "POST /signup HTTP/1.1" 201
2022-01-08 00:17:33.660 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fae60fb66a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fae654869d0>
          └ <fastapi.routing.APIRoute object at 0x7fae60764550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fae60fd48b0>
          └ <fastapi.routing.APIRoute object at 0x7fae60764550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fae62c05610>
                     └ <function get_request_handler.<locals>.app at 0x7fae60fd4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fae654755e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7fae5ac39100>}
                 │                 │         └ <function signup at 0x7fae629861f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fae60764580>
                 └ <function run_in_threadpool at 0x7fae65661af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7fae5aba8c80>
                 │     │         └ <function run_sync at 0x7fae6567e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7fae5aba8c80>
                 └ <function get_asynclib at 0x7fae6567e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7fae5aba8c80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fae5abaf3c0>

  File "./app/routes/login.py", line 115, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae62c058e0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fae62bf83a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fae62c055e0>
                     └ <function http_exception_handler at 0x7fae60fa9af0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c055e0>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae62c058e0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae62c052b0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fae6a02a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fae6ada09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fae6ada0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fae699bf340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    └ <function subprocess_started at 0x7fae67886160>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fae699bf430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fae67878550>
           │       │   └ <uvicorn.server.Server object at 0x7fae699bf430>
           │       └ <function run at 0x7fae68a37700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fae66dd4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fae66e00280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fae66e00310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
          └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fae62c05460>
                     │    └ <function exception_handler at 0x7fae60fa90d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c05460>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae62c052b0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:17:33.689 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fae60fb66a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fae654869d0>
          └ <fastapi.routing.APIRoute object at 0x7fae60764550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fae60fd48b0>
          └ <fastapi.routing.APIRoute object at 0x7fae60764550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fae62c05610>
                     └ <function get_request_handler.<locals>.app at 0x7fae60fd4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fae654755e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7fae5ac39100>}
                 │                 │         └ <function signup at 0x7fae629861f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fae60764580>
                 └ <function run_in_threadpool at 0x7fae65661af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7fae5aba8c80>
                 │     │         └ <function run_sync at 0x7fae6567e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7fae5aba8c80>
                 └ <function get_asynclib at 0x7fae6567e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7fae5aba8c80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fae5abaf3c0>

  File "./app/routes/login.py", line 115, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae62c058e0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fae62bf83a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fae62c055e0>
                     └ <function http_exception_handler at 0x7fae60fa9af0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c055e0>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae62c058e0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae62c052b0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fae6a02a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fae6ada09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fae6ada0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fae699bf340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    └ <function subprocess_started at 0x7fae67886160>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fae699bf430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fae67878550>
           │       │   └ <uvicorn.server.Server object at 0x7fae699bf430>
           │       └ <function run at 0x7fae68a37700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fae66dd4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fae66e00280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fae66e00310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
          └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fae62c05460>
                     │    └ <function exception_handler at 0x7fae60fa90d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c05460>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae62c052b0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:17:33.718 | ERROR    | uvicorn.protocols.http.httptools_impl:run_asgi:379 - Exception in ASGI application

Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x7fae60fb66a0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x7fae654869d0>
          └ <fastapi.routing.APIRoute object at 0x7fae60764550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x7fae62bf8430>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x7fae60fd48b0>
          └ <fastapi.routing.APIRoute object at 0x7fae60764550>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x7fae62c05610>
                     └ <function get_request_handler.<locals>.app at 0x7fae60fd4820>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 226, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x7fae654755e0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/routing.py", line 161, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
                 │                 │         │       └ {'form_data': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x7fae5ac39100>}
                 │                 │         └ <function signup at 0x7fae629861f0>
                 │                 └ <fastapi.dependencies.models.Dependant object at 0x7fae60764580>
                 └ <function run_in_threadpool at 0x7fae65661af0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/concurrency.py", line 39, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │     │         │        └ <built-in method run of Context object at 0x7fae5aba8c80>
                 │     │         └ <function run_sync at 0x7fae6567e9d0>
                 │     └ <module 'anyio.to_thread' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py'>
                 └ <module 'anyio' from '/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/to_thread.py", line 28, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(func, *args, cancellable=cancellable,
                 │                                        │      │                 └ False
                 │                                        │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
                 │                                        └ <built-in method run of Context object at 0x7fae5aba8c80>
                 └ <function get_asynclib at 0x7fae6567e310>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 818, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=HTTPException(status_code=409, detail='Account already exists')>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/anyio/_backends/_asyncio.py", line 754, in run
    result = context.run(func, *args)
             │       │   │      └ (functools.partial(<function signup at 0x7fae629861f0>, form_data=<fastapi.security.oauth2.OAuth2PasswordRequestForm object a...
             │       │   └ <built-in method run of Context object at 0x7fae5aba8c80>
             │       └ <method 'run' of 'Context' objects>
             └ <Context object at 0x7fae5abaf3c0>

  File "./app/routes/login.py", line 115, in signup
    raise HTTPException(
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae62c058e0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x7fae62bf83a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x7fae6075ba60>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/exceptions.py", line 90, in __call__
    response = await handler(request, exc)
                     │       └ <starlette.requests.Request object at 0x7fae62c055e0>
                     └ <function http_exception_handler at 0x7fae60fa9af0>

  File "./app/handlers/http_exception_handler.py", line 9, in http_exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'api-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c055e0>
    │      │         └ HTTPException(status_code=409, detail='Account already exists')
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae62c058e0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 661, in __getattr__
    return self._state[key]
           │    │      └ 'correlation_id'
           │    └ {}
           └ <starlette.datastructures.State object at 0x7fae62c052b0>

KeyError: 'correlation_id'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x7fae6a02a430>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x7fae6ada09d0>
           └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x7fae6ada0040>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x7fae699bf340>, 'target': <bound method Server.run of <uvicorn.server.Server obj...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
    │    └ <function subprocess_started at 0x7fae67886160>
    └ <SpawnProcess name='SpawnProcess-1' parent=923220 started>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x7fae699bf430>>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/server.py", line 68, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x7fae67878550>
           │       │   └ <uvicorn.server.Server object at 0x7fae699bf430>
           │       └ <function run at 0x7fae68a37700>
           └ <module 'asyncio' from '/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/__init__.py'>
  File "/home/kaumil/.pyenv/versions/3.8.0/lib/python3.8/asyncio/runners.py", line 43, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x7fae66dd4040>
           │    └ <method 'run_until_complete' of 'uvloop.loop.Loop' objects>
           └ <uvloop.Loop running=True closed=False debug=False>
> File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py", line 376, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x7fae66e00280>
                   │   │    │      │    │        └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x7fae66e00310>
                   │   │    │      └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c05220>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x7fae671b4df0>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/fastapi/applications.py", line 208, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c052...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x7fae62c...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>
          └ <fastapi.applications.FastAPI object at 0x7fae660e7f40>
  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/middleware/errors.py", line 172, in __call__
    response = await self.handler(request, exc)
                     │    │       └ <starlette.requests.Request object at 0x7fae62c05460>
                     │    └ <function exception_handler at 0x7fae60fa90d0>
                     └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x7fae6075bac0>

  File "./app/handlers/exception_handler.py", line 9, in exception_handler
    logger.exception(exc, extra={'uuid':request.state.correlation_id, 'type':'app-error'})
    │      │         │                  │       └ <property object at 0x7fae654a4d60>
    │      │         │                  └ <starlette.requests.Request object at 0x7fae62c05460>
    │      │         └ AttributeError("'State' object has no attribute 'correlation_id'")
    │      └ <function Logger.exception at 0x7fae69952790>
    └ <RootLogger root (NOTSET)>

  File "/home/kaumil/.pyenv/versions/3.8.0/envs/fastapi/lib/python3.8/site-packages/starlette/datastructures.py", line 664, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
                         │       │      │    │         │         └ 'correlation_id'
                         │       │      │    │         └ <member '__name__' of 'getset_descriptor' objects>
                         │       │      │    └ <attribute '__class__' of 'object' objects>
                         │       │      └ <starlette.datastructures.State object at 0x7fae62c052b0>
                         │       └ <method 'format' of 'str' objects>
                         └ "'{}' object has no attribute '{}'"

AttributeError: 'State' object has no attribute 'correlation_id'
2022-01-08 00:17:33.745 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47788 - "POST /signup HTTP/1.1" 500
2022-01-08 00:17:53.007 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47800 - "POST /token HTTP/1.1" 200
2022-01-08 00:18:23.388 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/b14f8676-8af2-4b71-afa4-21ff92065d30.jpg
2022-01-08 00:18:23.420 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47814 - "POST /upload_images HTTP/1.1" 200
2022-01-08 00:18:48.097 | INFO     | uvicorn.protocols.http.httptools_impl:send:441 - 127.0.0.1:47848 - "GET /show_images HTTP/1.1" 200
2022-01-08 00:19:09.908 | INFO     | app.routes.images:upload_image:26 - File uploaded path : https://imagerepobucket.s3.us-east-1.amazonaws.com/72fc7d98-883a-4b5f-a6b8-39dfa4b9280b.jpg
